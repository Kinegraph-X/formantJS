{
  "version": 3,
  "sources": [
    "node_modules/browser-pack/_prelude.js",
    "_formantCoreBundler-master/src/main.js",
    "codebase/jsCore/src/Error&Log/Logger.js",
    "codebase/jsCore/src/_DesignSystemManager/SWrapperInViewManipulator.js",
    "codebase/jsCore/src/_LayoutEngine/NaiveDOMNode.js",
    "codebase/jsCore/src/_LayoutEngine/SpecialDependencyInjector.js",
    "codebase/jsCore/src/appLauncher/appLauncher.js",
    "codebase/jsCore/src/appLauncher/dependancyInjector.js",
    "codebase/jsCore/src/coreComponents/AppBoundaryComponent/AppBoundaryComponent.js",
    "codebase/jsCore/src/coreComponents/AppBoundaryComponent/coreComponentDefs/AppBoundaryComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/AppOverlayComponent/AppOverlayComponent.js",
    "codebase/jsCore/src/coreComponents/AppOverlayComponent/coreComponentDefs/AppOverlayComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/ComponentPickingInput/ComponentPickingInput.js",
    "codebase/jsCore/src/coreComponents/ComponentPickingInput/coreComponentDefs/ComponentPickingInputHostDef.js",
    "codebase/jsCore/src/coreComponents/FlexColumnComponent/FlexColumnComponent.js",
    "codebase/jsCore/src/coreComponents/FlexColumnComponent/coreComponentDefs/FlexColumnComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/FlexGridComponent/FlexGridComponent.js",
    "codebase/jsCore/src/coreComponents/FlexRowComponent/FlexRowComponent.js",
    "codebase/jsCore/src/coreComponents/FlexRowComponent/coreComponentDefs/FlexRowComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/HToolbarComponent/HToolbarComponent.js",
    "codebase/jsCore/src/coreComponents/HToolbarComponent/coreComponentDefs/HToolbarComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/IFrameComponent/IFrameComponent.js",
    "codebase/jsCore/src/coreComponents/IFrameComponent/coreComponentDefs/IFrameComponentHostDef.js",
    "codebase/jsCore/src/coreComponents/RPCStackComponent/RPCStackComponent.js",
    "codebase/jsCore/src/coreComponents/RootViewComponent/RootViewComponent.js",
    "codebase/jsCore/src/coreComponents/RootViewComponent/coreComponentDefs/RootViewComponentHostDef.js",
    "codebase/jsCore/src/coreDefs/AbstractAccordionDef.js",
    "codebase/jsCore/src/coreDefs/AbstractAccordionSlotsDef.js",
    "codebase/jsCore/src/coreDefs/IteratingComponentHostDef.js",
    "codebase/jsCore/src/coreDefs/IteratingComponentSlotsDef.js",
    "codebase/jsCore/src/coreDefs/abstractTableDef.js",
    "codebase/jsCore/src/coreDefs/abstractTablePseudoSlotsStyleDef.js",
    "codebase/jsCore/src/coreDefs/abstractTableSlotsDef.js",
    "codebase/jsCore/src/coreDefs/abstractTreeDef.js",
    "codebase/jsCore/src/coreDefs/branchTemplateDef.js",
    "codebase/jsCore/src/coreDefs/lazySlottedComponentDef.js",
    "codebase/jsCore/src/coreDefs/lazySlottedComponentSlotsDef.js",
    "codebase/jsCore/src/coreDefs/leafTemplateDef.js",
    "codebase/jsCore/src/core/App.js",
    "codebase/jsCore/src/core/BinarySchema.js",
    "codebase/jsCore/src/core/BinarySlice.js",
    "codebase/jsCore/src/core/CachedTypes.js",
    "codebase/jsCore/src/core/Component.js",
    "codebase/jsCore/src/core/ComponentSet.js",
    "codebase/jsCore/src/core/CompoundComponent.js",
    "codebase/jsCore/src/core/CoreTypes.js",
    "codebase/jsCore/src/core/GenericElementConstructor.js",
    "codebase/jsCore/src/core/GenericStyleConstructor.js",
    "codebase/jsCore/src/core/MemoryBufferStack.js",
    "codebase/jsCore/src/core/MemoryMapBuffer.js",
    "codebase/jsCore/src/core/MemorySingleBuffer.js",
    "codebase/jsCore/src/core/PropertyCache.js",
    "codebase/jsCore/src/core/ReactiveDataset.js",
    "codebase/jsCore/src/core/Registries.js",
    "codebase/jsCore/src/core/ResizeObserver.js",
    "codebase/jsCore/src/core/TemplateFactory.js",
    "codebase/jsCore/src/core/TextSizeGetter.js",
    "codebase/jsCore/src/core/TypeManager.js",
    "codebase/jsCore/src/core/UIDGenerator.js",
    "codebase/jsCore/src/core/_functionalStyleHelpers.js",
    "codebase/jsCore/src/core/elementDecorator_HSD.js",
    "codebase/jsCore/src/core/elementDecorator_Offset.js",
    "codebase/jsCore/src/extendedNative/array.js",
    "codebase/jsCore/src/extendedNative/boolean.js",
    "codebase/jsCore/src/extendedNative/object.js",
    "codebase/jsCore/src/extendedNative/regexp.js",
    "codebase/jsCore/src/extendedNative/string.js",
    "codebase/jsCore/src/integrated_libs_&_forks/Hamster.js",
    "codebase/jsCore/src/integrated_libs_&_forks/Validate.js",
    "codebase/jsCore/src/integrated_libs_&_forks/md5.min.js",
    "codebase/jsLexicalTools/src/parsers/css-parser_forked.js",
    "codebase/jsLexicalTools/src/parsers/css-parser_forked_normalized.js",
    "codebase/jsStyleManager/src/editing/AbstractStylesheet.js",
    "codebase/jsStyleManager/src/editing/CSSPropertyBuffer.js",
    "codebase/jsStyleManager/src/editing/CSSPropertyDescriptors.js",
    "codebase/jsStyleManager/src/editing/CSSPropertySetBuffer.js",
    "codebase/jsStyleManager/src/editing/CSSSelectorSetBuffer.js",
    "codebase/jsStyleManager/src/editing/CSSSelectorsList.js",
    "codebase/jsStyleManager/src/editing/FontSizeBuffer.js",
    "codebase/jsStyleManager/src/editing/SplittedAttributes.js",
    "codebase/jsStyleManager/src/editing/Style.js",
    "codebase/jsStyleManager/src/editing/StylePropertyEnhancer.js",
    "codebase/jsStyleManager/src/editing/StyleRule.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3iBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACz9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1oCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACh8EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5ZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACt3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC76CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACt+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",
    "\"use strict\";\nconst App = require('src/core/App');\r\nApp.data = {\r\n\tstringifiedSources : []\r\n};\r\n\r\nconst dependancyInjector = require('src/appLauncher/dependancyInjector');\r\n\r\nmodule.exports = {\r\n\tApp : App,\r\n\tappConstants : require('src/appLauncher/appLauncher'),\r\n\tCoreTypes : require('src/core/CoreTypes'),\r\n\tComponents : require('src/core/Component'),\r\n\tTemplateFactory : require('src/core/TemplateFactory'),\r\n\tTypeManager : require('src/core/TypeManager'),\r\n\tRegistries : require('src/core/Registries'),\r\n\tReactiveDataset : require('src/core/ReactiveDataset'),\r\n\tComponentSet : require('src/core/ComponentSet'),\r\n\tCreateStyle : require('src/core/GenericStyleConstructor'),\r\n\tintegratedLibs : {\r\n\t\tmd5 : require('src/integrated_libs_&_forks/md5.min'),\r\n\t\tValidate : require('src/integrated_libs_&_forks/Validate')\r\n\t}\r\n}",
    "\"use strict\";\n/**\n * @module errorHandler\n */\n\n\n\tvar Logger = function() {\n//\t\tFactory.CoreModule.call(this);\n\t\tthis.objectType = 'Logger';\n\t\t\n\t\tthis._currentlyCallingObjectName;\n\t\tthis._currentlyCallingObjectType;\n\t}\n\tLogger.prototype = {};//Object.create(Factory.CoreModule.prototype);\n\tLogger.prototype.objectType = 'Logger';\n\tLogger.prototype.constructor = Logger;\n\n\tLogger.prototype.colors = {\n\t                message : 'color:#777',\n\t                messageEven : 'color:#777',\n\t                messageOdd : 'color:#222',\n\t                target : 'color:#5555FF',\n\t                warning : 'color:#CC5500',\n\t                error : 'color:#CC0000',\n\t                serialized : 'color:#999'\n\t\t\t\t\t}\n\n\tLogger.prototype.changeCallingObject = function(e) {\n\t\tthis._currentlyCallingObjectName = e.data.name;\n\t\tthis._currentlyCallingObjectType = e.data.objectType;\n\t}\n\n\tLogger.prototype.log = function(isOfType) {\n\t\tvar args = Array.apply(null, arguments), logs = [];\n\t\tif (Object.keys(this.colors).indexOf(args[0]) !== -1) {\n\t\t\tisOfType = args[0];\n\t\t\tpreambule = '%c %s %c %s %c %s ';\n\t\t\tlogs = [\n\t\t\t            preambule,\n\t\t\t            this.colors[isOfType],\n\t\t\t            isOfType\n\t\t\t            ];\n\t\t\targs.shift();\n\t\t}\n\t\telse {\n\t\t\tpreambule = '%c %s %c %s ';\n\t\t\tlogs = [preambule]\n\t\t}\n\n\t\tvar message = args[0] || 'empty log',\n\t\ttarget = args[1] + ':' || 'empty target:',\n\t\tisSerialized = args[args.length - 1] === 'serialized' ? true : undefined,\n\n\t\tlogs = logs.concat([\n\t\t            this.colors['target'],\n\t\t            args[1],\n\t\t            typeof isOfType !== 'undefined' ? this.colors[isOfType] : this.colors['message'],\n\t\t            args[0]\t\t\n\t\t            ]);\n\n\t\tfor (var i = 2, l = args.length, val; i < l; i++) {\n\t\t\t(function(i) {\n\t\t\t\tval = args[i];\n\t\t\t\tswitch(typeof val) {\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tlogs[0] += '%c %s ';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'object':\n\t\t\t\t\t\tlogs[0] += '%c %o ';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'number':\n\t\t\t\t\t\tif (Math.round(val) === val)\n\t\t\t\t\t\t\tlogs[0] += '%c %i ';\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tlogs[0] += '%c %.2f ';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlogs.push(typeof isSerialized !== 'undefined' ? this.colors['serialized'] : (i % 2 === 0) ? this.colors['messageOdd'] : this.colors['messageEven']);\n\t\t\t\tlogs.push(val);\n\t\t\t}).call(this, i);\n\t\t}\n//\t\tconsole.log(args, logs);\n\t\tconsole.log.apply(null, logs);\n\t}\n\t\n\tLogger.prototype.warn = Logger.prototype.log.bind(Logger.prototype, 'warning');\n\tLogger.prototype.error = Logger.prototype.log.bind(Logger.prototype, 'error');\n\n\tLogger.prototype.m = {\n\t\t\tOK : 'OK'\n\t}\n\t\n//var logger =  new Logger();\n\nmodule.exports = Logger;\n",
    "\"use strict\";\n/**\r\n * @constructor SWrapperInViewManipulator\r\n */\r\n\r\nvar appConstants = require('src/appLauncher/appLauncher');\r\nvar TypeManager = require('src/core/TypeManager');\r\n//var CoreTypes = require('src/core/CoreTypes');\r\n\r\nvar textSizeGetter = appConstants.textSizeGetter;\r\n//var ScalesUtilities = require('src/tools/ScalesUtilities');\r\n\r\n\r\nvar SWrapperInViewManipulator = function(hostView) {\r\n//\tif (!hostView.sWrapper) {\r\n//\t\treturn null;\r\n//\t}\r\n\tthis.hostView = hostView;\r\n\tthis.currentViewAPI = hostView.currentViewAPI;\r\n\t// TODO: this.s refers to the AbstractStylesheet => change that, it's not at all explicit\r\n\tthis.s;// = hostView.sWrapper;\r\n\t\r\n\tthis.rulesCache = new TypeManager.PropertyCache('rulesCache');\r\n//\tthis.textSizeGetter = textSizeGetter;\r\n\t\r\n\tthis.viewPresenceKeyWord;\r\n\tthis.fontSize;\r\n\tthis.boundingBox;\r\n\t\r\n\tthis.getViewPresenceKeyWord();\r\n}\r\nSWrapperInViewManipulator.prototype = Object.create(Object.prototype);\r\n//SWrapperInViewManipulator.prototype.extends = 'EventEmitter';\r\n\r\n\r\n\r\n\r\n\r\nSWrapperInViewManipulator.prototype.getBoundingBox = function() {\r\n\tvar self = this;\r\n\t\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tvar inter = setInterval(function() {\r\n\t\t\tif (self.hostView.getMasterNode()) {\r\n\t\t\t\tclearInterval(inter);\r\n\t\t\t\t\r\n\t\t\t\tappConstants.resizeObserver.observe(self.hostView.getMasterNode(), self.storeBoundingBox.bind(self));\r\n\t\t\t}\r\n\t\t}, 512);\r\n\t});\r\n}\r\nSWrapperInViewManipulator.prototype.storeBoundingBox = function(resolve, e) {\r\n\tresolve(this.boundingBox = e.data.boundingBox);\r\n}\r\nSWrapperInViewManipulator.prototype.getViewPresenceKeyWord = function() {\r\n\t(this.s && (this.viewPresenceKeyWord = this.s.getRuleDefinition(':host', 'display'))) || (this.viewPresenceKeyWord = this.hostView.isCustomElem ? 'inline-block' : 'block');\r\n}\r\nSWrapperInViewManipulator.prototype.getFontSize = function() {\r\n\tvar self = this;\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tself.textSizeGetter.oneShot(\r\n\t\t\tself.hostView.getMasterNode(),\r\n\t\t\tself.storeFontSize.bind(self, resolve)\r\n\t\t);\r\n\t});\r\n}\r\nSWrapperInViewManipulator.prototype.storeFontSize = function(resolve, fontStyle) {\r\n\tresolve(this.fontSize = fontStyle.fontSize);\r\n}\r\nSWrapperInViewManipulator.prototype.setFontSize = function(fontSize) {\r\n\tthis.s.setProp(':host', 'fontSize', fontSize.toString() + 'px');\r\n}\r\nSWrapperInViewManipulator.prototype.setFontFamily = function(fontFamily) {\r\n\tthis.s.setProp(':host', 'fontFamily', fontFamily.toString());\r\n}\r\nSWrapperInViewManipulator.prototype.setTextInputFontSize = function(fontSize) {\r\n\tthis.s.setProp('input[type=text]', 'fontSize', fontSize.toString() + 'px');\r\n}\r\nSWrapperInViewManipulator.prototype.setTextInputFontFamily = function(fontFamily) {\r\n\tthis.s.setProp('input[type=text]', 'fontFamily', fontFamily.toString());\r\n}\r\nSWrapperInViewManipulator.prototype.getPresence = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.setPresence = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.getVisibility = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.setVisibility = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.getOpacity = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.setOpacity = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.revealSelfOnly = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.setNeonEmphasis = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.restoreOriginalEmphasis = function() {\r\n\t\r\n}\r\nSWrapperInViewManipulator.prototype.addEventListener = function(eventType, handler) {\r\n\tthis.currentViewAPI.addEventListener(eventType, handler);\r\n}\r\nSWrapperInViewManipulator.prototype.removeEventListener = function(eventType, handler) {\r\n\tthis.currentViewAPI.removeEventListener(eventType, handler);\r\n}\r\nSWrapperInViewManipulator.prototype.getWidth = function(selector) {\r\n\tvar width;\r\n\tif (width = this.s.getRuleAsObject(selector).rule.attributes.width)\r\n\t\treturn parseInt(width.replace(/px/, ''));\r\n}\r\nSWrapperInViewManipulator.prototype.setWidth = function(selector, w) {\r\n\tvar rule = this.s.getRuleAsObject(selector).rule;\r\n\trule.attributes.width = w.toString();\r\n\tthis.s.replaceStyle(rule, rule.attributes);\r\n}\r\nSWrapperInViewManipulator.prototype.setMaxWidth = function(selector, w) {\r\n\tvar rule = this.s.getRuleAsObject(selector).rule;\r\n\trule.attributes.maxWidth = w.toString();\r\n\tthis.s.replaceStyle(rule, rule.attributes);\r\n}\r\nSWrapperInViewManipulator.prototype.getHeight = function(selector) {\r\n\tvar height;\r\n\tif (height = this.s.getRuleAsObject(selector).rule.attributes.height)\r\n\t\treturn parseInt(height.replace(/px/, ''));\r\n}\r\nSWrapperInViewManipulator.prototype.setHeight = function(selector, h) {\r\n\tvar rule = this.s.getRuleAsObject(selector).rule;\r\n\trule.attributes.height = h.toString();\r\n\tthis.s.replaceStyle(rule, rule.attributes);\r\n}\r\nSWrapperInViewManipulator.prototype.setMaxHeight = function(selector, h) {\r\n\tvar rule = this.s.getRuleAsObject(selector).rule;\r\n\trule.attributes.maxHeight = h.toString();\r\n\tthis.s.replaceStyle(rule, rule.attributes);\r\n}\r\n\r\nSWrapperInViewManipulator.prototype.setFlex = function(selector, f) {\r\n\tthis.s.setProp(selector, 'flex', f.toString());\r\n}\r\n\r\nSWrapperInViewManipulator.prototype.getComponentViewAsCanvas = function(nodeName) {\r\n\tvar member;\r\n\tif (nodeName === 'header')\r\n\t\tmember = this.hostView.subViewsHolder.firstMember();\r\n\telse\r\n\t\tmember = this.hostView.getMasterNode();\r\n\t\r\n\treturn Rasterizer(member);\r\n}\r\nSWrapperInViewManipulator.prototype.setRotationAlongCylinder = function(nodeName) {\r\n\tvar y;\t\r\n//\tvar rule = this.s.getRuleAsObject('header').rule;\r\n//\trule.attributes.transform = 'scaleY(' + this.getRotationBasedOnYPos(y) + ')';\r\n\t\r\n\tvar partialCanvas = this.getComponentViewAsCanvas(nodeName);\r\n\t// => then compose a new Canvas assembling alltogether the partials Canvas\r\n\t\r\n\t\r\n//\tthis.s.replaceStyle(rule, rule.attributes);\r\n}\r\nSWrapperInViewManipulator.prototype.getRotationBasedOnYPos = function(y) {\r\n\treturn ScalesUtilities.elevationDependantAngle(y);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = SWrapperInViewManipulator;",
    "\"use strict\";\n/**\r\n * Constructor NaiveDOMNode\r\n * \r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CoreTypes = require('src/core/CoreTypes');\r\nvar Components = require('src/core/Component');\r\nvar UIDGenerator = require('src/core/UIDGenerator').UIDGenerator;\r\n\r\n\r\n\r\n\r\n/*\r\n * constructor NaiveDOMNode\r\n * \r\n * All is conditionned on the presence of the view Object as the layoutTreePrepare is using this constructor\r\n * to build a \"viewport\" layoutNode\r\n */\r\nvar NaiveDOMNode = function(viewWrapper, view, hierarchicalDepth, _defUID, hostNode, hostView, subNodesGroup) {\r\n\tthis.objectType = 'NaiveDOMNode';\r\n\tthis.hasBeenSeenForLayout = false;\r\n//\tconsole.log(view.currentViewAPI, view);\r\n\tvar masterNode = view ? view.getMasterNode() : null;\r\n\t\r\n\tthis._viewWrapper = viewWrapper;\r\n\tthis._parentView = view ? this.getParentView(view, hierarchicalDepth, hostNode, hostView, subNodesGroup) : null;\r\n\tthis._UID = UIDGenerator.newUID();\r\n\t\r\n\tthis.nodeName = view ? masterNode.nodeName.toLowerCase() : null;\r\n\tthis.nodeId = view ? masterNode.id : null;\r\n\tthis.section = view \r\n\t\t\t\t\t? view.section === null ? '0' : view.section.toString()\r\n\t\t\t\t\t: '0';\r\n\tthis.classNames = view ? Object.values(masterNode.classList) : null;\r\n\tif (view) {\r\n\t\tvar textContent,\r\n\t\t\thref;\r\n\t\tthis.attributes = new CoreTypes.ListOfPairs();//masterNode.attributes);\r\n//\t\tconsole.log(masterNode.textContent);\r\n\t\tif (viewWrapper.textContent.length)\r\n\t\t\tthis.attributes.push(new CoreTypes.Pair(\r\n\t\t\t\t'textContent',\r\n\t\t\t\tviewWrapper.textContent\r\n\t\t\t));\r\n\t\telse if ((textContent = TypeManager.caches.attributes.getItem(view._defUID).getObjectValueByKey('textContent'))) {\r\n\t\t\tthis.attributes.push(new CoreTypes.Pair(\r\n\t\t\t\t'textContent',\r\n\t\t\t\ttextContent\r\n\t\t\t));\r\n\t\t}\r\n\t\telse if ((textContent = view.getTextContent()) !== '') {\r\n\t\t\tthis.attributes.push(new CoreTypes.Pair(\r\n\t\t\t\t'textContent',\r\n\t\t\t\ttextContent\r\n\t\t\t));\r\n\t\t}\r\n\t\t\r\n\t\tif (hierarchicalDepth === 0) {\r\n//\t\t\tconsole.log(_defUID, TypeManager.caches['attributes'].getItem(_defUID).getObjectValueByKey('href'));\r\n\t\t\tif ((href = TypeManager.caches['attributes'].getItem(_defUID).getObjectValueByKey('href')))\r\n\t\t\t\tthis.attributes.push(new CoreTypes.Pair(\r\n\t\t\t\t\t'href',\r\n\t\t\t\t\thref\r\n\t\t\t\t));\r\n\t\t}\r\n//\t\tconsole.log(this.attributes);\r\n\t}\r\n\telse\r\n\t\tthis.attributes = new CoreTypes.ListOfPairs();\r\n\t\r\n//\tthis.computedStyle = null;\r\n\t\r\n\tTypeManager.naiveDOMRegistry.setItem(\r\n\t\tthis._UID,\r\n\t\tthis\r\n\t);\r\n}\r\nNaiveDOMNode.prototype = {};\r\nNaiveDOMNode.prototype.objectType = 'NaiveDOMNode';\r\n\r\nNaiveDOMNode.prototype.hasAttributes = function() {\r\n\treturn this.attributes.length !== 0;\r\n}\r\n\r\nNaiveDOMNode.prototype.getParentView = function(view, hierarchicalDepth, hostNode, hostView, subNodesGroup) {\r\n\tswitch(hierarchicalDepth) {\r\n\t\tcase 0 : \r\n\t\t\treturn null;\r\n\t\tcase 1 :\r\n\t\t\treturn hostNode;\r\n\t\tcase 2 :\r\n\t\t\treturn subNodesGroup.length\r\n\t\t\t\t? subNodesGroup[hostView.subViewsHolder.subSections.indexOf(view.parentView)]\r\n\t\t\t\t: hostNode;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = NaiveDOMNode;",
    "\"use strict\";\n/**\r\n * Constructor SpecialDependencyInjector\r\n * \r\n * Decorates the HierarchicalComponent's ctor\r\n * \tadding it some methods to build a \"DOM looking\" hierarchy.\r\n * \tWe'll be using those methods to construct the NaiveDOM.\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CoreTypes = require('src/core/CoreTypes');\r\nvar Components = require('src/core/Component');\r\nvar UIDGenerator = require('src/core/UIDGenerator').UIDGenerator;\r\n\r\nvar NaiveDOMNode = require('src/_LayoutEngine/NaiveDOMNode');\r\n\r\n\r\n// NOTE: should not be a ctor, but helper functions\r\n// to be conditionnaly required / called in dependencyInjector.js\r\n// (actual implementation is very similar to that, making no use of the following ctor)\r\nvar SpecialDependencyInjector = function() {\r\n\t\r\n}\r\nSpecialDependencyInjector.prototype = {};\r\n\r\nSpecialDependencyInjector.prototype.getNaiveDOM = function() {\r\n\treturn this.getNaiveDOMTree();\r\n}\r\n\r\nSpecialDependencyInjector.prototype.getNaiveDOMTree = function () {\r\n\tvar self= this, nodeUID;\r\n\tfunction getNode(component, parentNode) {\r\n\t\tvar node = {\r\n\t\t\tstyleRefstartIdx : 0,\r\n\t\t\tstyleRefLength : 0,\r\n\t\t\t_UID : component._UID,\r\n\t\t\t_parentNode : parentNode,\r\n\t\t\tisShadowHost : component.view.currentViewAPI ? component.view.currentViewAPI.isShadowHost : false,\r\n\t\t\tname : Object.getPrototypeOf(component).objectType.slice(0),\r\n\t\t\ttextContent : TypeManager.caches.attributes.getItem(component._defUID).getObjectValueByKey('textContent') || '',\r\n\t\t\tviews : {},\r\n\t\t\tchildren : [],\r\n\t\t\tstyleDataStructure : component.styleHook ? component.styleHook.s : null\r\n\t\t};\r\n\t\tnode.views = this.getInDepthViewStructure(component, node);\r\n\t\treturn node;\r\n//\t\tvar meta = this.getViewRelatedNodeDescription(component);\r\n\t}\r\n\tvar ret = getNode.call(this, this);\r\n\tthis.collectNaiveDOMandStyleInDescendants(this, ret, getNode.bind(this));\r\n\treturn ret;\r\n}\r\n\r\nSpecialDependencyInjector.prototype.collectNaiveDOMandStyleInDescendants = function (component, componentTreeParent, getNode) {\r\n\tvar node;\r\n\t\r\n\t// We want to be able to render the \"code\" nodes with syntax highlighting.\r\n\t// (mainly when we get those nodes after having converted markdown to the framework's syntax)\r\n\t// So we're going to use a highlighting lib at its lowest level\r\n\t// in order to add typed node that the layout engine is able to handle\r\n\t// (basically, those nodes shall have a class attribuse which shall be interpreted by our CSS engine)\r\n\t// REMINDER: inject manually the stylesheet of the Prism lib (the external CSS grabber shall include it in our \"inner\" CSS rules)\r\n\t\r\n\tif (component.view.getMasterNode().tagName === 'CODE') {\r\n\t\tif (typeof Prism === 'undefined') {\r\n\t\t\tconsole.warn('The Prism-highlighter lib must be included manually in the HTML header (with the data-manual attribute)');\r\n\t\t\treturn componentTreeParent;\r\n\t\t}\r\n\t\tif (Array.prototype.indexOf.call(component.view.getMasterNode().classList, 'language-javascript') !== -1) {\r\n\t\t\tthis.handleCodeNode(component, componentTreeParent);\r\n\t\t\treturn componentTreeParent;\r\n\t\t}\r\n\t}\r\n\t\r\n\tcomponent._children.forEach(function(child) {\r\n//\t\tconsole.log(child.view.getMasterNode().tagName, child.view.API.nodeName);\r\n\t\tnode = getNode(child, componentTreeParent);\r\n\t\tif (Array.isArray(child._children) && child._children.length) {\r\n\t\t\tcomponentTreeParent.children.push(this.collectNaiveDOMandStyleInDescendants(child, node, getNode));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcomponentTreeParent.children.push(node);\r\n\t\t}\r\n\t}, this);\r\n\r\n\treturn componentTreeParent;\r\n}\r\n\r\nSpecialDependencyInjector.prototype.getInDepthViewStructure = function (component, viewsWrapper) {\r\n\tvar hostNode, subNodesGroup;\r\n\treturn {\r\n\t\tmasterView : (hostNode = new NaiveDOMNode(viewsWrapper, component.view, 0, component._defUID)),\r\n\t\tsubSections : (subNodesGroup = component.view.subViewsHolder.subViews.map(function(view) {\r\n\t\t\treturn new NaiveDOMNode(viewsWrapper, view, 1, component._defUID, hostNode, component.view);\r\n\t\t})),\r\n\t\tmemberViews : component.view.subViewsHolder.memberViews.map(function(view) {\r\n\t\t\treturn new NaiveDOMNode(viewsWrapper, view, 2, component._defUID, hostNode, component.view, subNodesGroup);\r\n\t\t})\r\n\t};\r\n}\r\n\r\nSpecialDependencyInjector.prototype.handleCodeNode = function (component, componentTreeParent) {\r\n\tvar codeNodeTextContent = '', prismTokenStream = [];\r\n\t\r\n\tcodeNodeTextContent = component._children[0].view.getTextContent();\r\n\tprismTokenStream = Prism.tokenize(codeNodeTextContent, Prism.languages.javascript);\r\n\tthis.explorePrismTokenStream(prismTokenStream, componentTreeParent);\r\n}\r\n\r\nSpecialDependencyInjector.prototype.explorePrismTokenStream = function (tokenStream, componentTreeParent) {\r\n\tvar parentNode, tokenTypes = {}, node, textContent = '', lineFeedIdx = 0;\r\n\t\r\n\tfunction getNode(parentNode, textContent, isDisplayBlock, tokenType, isClassName) {\r\n\t\tvar view = {\r\n\t\t\tobjectType : 'NaiveDOMNode',\r\n\t\t\t_UID : UIDGenerator.newUID(),\r\n\t\t\t_parentView : parentNode.views.masterView,\r\n\t\t\tnodeId : '',\r\n\t\t\tnodeName : isDisplayBlock ? 'div' : 'span',\r\n\t\t\tclassNames : [],\t\t\t// the className prop is a shorthand replacing the \"className\" attributes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// => handier when matching selectors\r\n\t\t\tattributes : new CoreTypes.ListOfPairs([\r\n\t\t\t\t{\r\n\t\t\t\t\tname : 'textContent',\r\n\t\t\t\t\tvalue : textContent\r\n\t\t\t\t}\r\n\t\t\t])\r\n\t\t}\r\n\t\tif (tokenType) {\r\n//\t\t\tconsole.log(tokenType, textContent);\r\n\t\t\tview.classNames.push('token', tokenType);\r\n\t\t}\r\n\t\telse  if (isClassName)\r\n\t\t\tview.classNames.push('token', 'class-name');\r\n\t\t\r\n\t\t\r\n//\t\telse if (textContent === 'App' || textContent === 'App.')\r\n//\t\t\tview.classNames.push('token', 'constant');\t// HACK to beautify our main Factory (DOESN'T WORK, as \"host: App.\" is a single string)\r\n\t\r\n\r\n\r\n\t\tvar node = {\r\n\t\t\tstyleRefstartIdx : 0,\r\n\t\t\tstyleRefLength : 0,\r\n\t\t\t_UID : UIDGenerator.newUID(),\r\n\t\t\t_parentNode : parentNode,\r\n\t\t\tisShadowHost : false,\r\n\t\t\tviews : {\r\n\t\t\t\tmasterView : view,\r\n\t\t\t\tsubSections : [],\r\n\t\t\t\tmemberViews : []\r\n\t\t\t},\r\n\t\t\tchildren : [],\r\n\t\t\tstyleDataStructure : null\r\n\t\t};\r\n//\t\tnode.views = this.getInDepthViewStructure(component, node);\r\n\t\r\n\t\tTypeManager.naiveDOMRegistry.setItem(\r\n\t\t\tview._UID,\r\n\t\t\tview\r\n\t\t);\r\n\t\treturn node;\r\n\t}\r\n\t\r\n\tparentNode = getNode(componentTreeParent, textContent, true);\r\n\tcomponentTreeParent.children.push(parentNode);\r\n\t\r\n\t\r\n\tvar handleToken = function(tokenOrString, key, isClassName) {\r\n\t\tif (tokenOrString instanceof Prism.Token) {\r\n\t\t\ttokenTypes[tokenOrString.type] = tokenOrString.content;\r\n\t\t\t\r\n\t\t\t// A class-name token may content a tokenStream inside\r\n\t\t\tif (Array.isArray(tokenOrString.content)) {\r\n\t\t\t\ttokenOrString.content.forEach(function(subTokenOrString) {\r\n\t\t\t\t\thandleToken(subTokenOrString, key, 'isClassName');\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttextContent = tokenOrString.content;\r\n\t\t\tnode = getNode(parentNode, textContent, false, tokenOrString.type, isClassName);\r\n\t\t\t\r\n\t\t\t// Avoid building a new parent if the next token (and last from the stream) is an empty string\r\n\t\t\tif (key === tokenStream.lenngth - 2\r\n\t\t\t\t\t&& textContent === ''\r\n\t\t\t\t\t&& tokenStream[key + 1] === ''\r\n\t\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tparentNode.children.push(node);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttextContent = tokenOrString;\r\n\t\t\tnode = getNode(parentNode, textContent, false, null, isClassName);\r\n\t\t\t\r\n\t\t\t// Don't generate a new \"block\" node if the line feed char is the last of the code as as string\r\n\t\t\tif (key === tokenStream.length - 1\r\n\t\t\t\t\t&& (textContent.indexOf('\\n') === tokenOrString.length - 1 || textContent === '')\r\n\t\t\t\t) {\r\n\t\t\t\tparentNode.children.push(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if ((lineFeedIdx = tokenOrString.indexOf('\\n')) !== -1) {\r\n\t\t\t\ttextContent = textContent.split('\\n');\r\n\t\t\t\tparentNode.children.push(getNode(parentNode, textContent[0], false));\r\n\t\t\t\ttextContent.shift();\r\n\t\t\t\t\r\n\t\t\t\tparentNode = getNode(parentNode, '', true);\r\n\t\t\t\tparentNode.children.push(getNode(parentNode, textContent.join(), false));\r\n\t\t\t\t\r\n\t\t\t\tcomponentTreeParent.children.push(parentNode);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tparentNode.children.push(node);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\ttokenStream.forEach(function(tokenOrString, key) {\r\n\t\t\r\n\t\t// Start a \"block\" node\r\n\t\t// if string matches \"\\n\" => close the block node => start a new one\r\n\t\t// Add every \"inline\" node as child of the curernt \"block\" node\r\n\t\t\r\n\t\thandleToken(tokenOrString, key);\r\n\t});\r\n\t\r\n\t\r\n\t\r\n\t\r\n//\tvar reconstructed = '', chuncksNbr = 0;\r\n//\tcomponentTreeParent.children.forEach(function(child, key){\r\n//\t\tconsole.log(child.views.masterView.nodeName, child.views.masterView.attributes[0].value);\r\n////\t\tif (key === 0 || key === 1) {\r\n//\t\t\tchild.children.forEach(function(test, idx){\r\n//\t\t\t\tconsole.log(test.views.masterView.nodeName, test.views.masterView.attributes[0].value);\t// \r\n//\t\t\t});\r\n////\t\t}\r\n//\t\tchild.children.forEach(function(strObj) {\r\n//\t\t\treconstructed += strObj.textContent;\r\n//\t\t\tchuncksNbr++;\r\n//\t\t})\r\n//\t\treconstructed += '\\n';\r\n//\t})\r\n//\tconsole.log(tokenStream);\r\n}\r\n\r\n/*\r\nblock-comment\r\n\r\npunctuation\r\n\r\nattr-name\r\n\r\nfunction-name\r\n\r\nboolean\r\nfunction\r\nnumber\r\n\r\nclass-name\r\nconstant\r\nproperty\r\n\r\nkeyword\r\n\r\nattr-value\r\nchar\r\nregex\r\nstring\r\nvariable\r\n\r\nentity\r\noperator\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//SpecialDependencyInjector.prototype.getViewRelatedNodeDescription = function (view) {\r\n//\tvar masterNode = view.getMasterNode();\r\n//\t\r\n//\treturn {\r\n//\t\tnodeName : masterNode.nodeName,\r\n//\t\tnodeId : masterNode.Id,\r\n//\t\tclassNames : masterNode.classList\r\n//\t};\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = SpecialDependencyInjector;",
    "\"use strict\";\n/**\n * @module appLauncher\n */\n\n// Get compatibility with node.js and standalone engines\n//if (typeof window === 'undefined') {\n//\tif (typeof global === 'undefined')\n//\t\twindow = this;\n//\telse\n//\t\twindow = global;\n//}\n\n\nif (typeof Object.getOwnPropertyDescriptor(String.prototype, 'escapeRegExp') === 'undefined') { \n\trequire('src/extendedNative/string');\n\trequire('src/extendedNative/array');\n\trequire('src/extendedNative/boolean');\n\trequire('src/extendedNative/object');\n\trequire('src/extendedNative/regexp');\n}\nvar Validate = require('src/integrated_libs_&_forks/Validate');\nvar Hamster = require('src/integrated_libs_&_forks/Hamster');\n//var MasterTimer = require('src/timers/MasterTimer');\nvar NodeResizeObserver = require('src/core/ResizeObserver');\nvar TextSizeGetter = require('src/core/TextSizeGetter');\n\n// TODO: move the main dependancies to permanent include\n// Ensure that ctor is required at least once : it is responsible for dependancy injection (moved to index.js...  shall be moved to browserify permanent include)\n//var rDataset = require('src/core/ReactiveDataset');\n\nvar classConstructor = (function() {\t\n\tvar debugMode = false,\n//\t\tmasterTimer = new MasterTimer(),\n\t\tresizeObserver = new NodeResizeObserver(),\n\t\ttextSizeGetter = new TextSizeGetter(),\n\t\toptions = {\n\t\t\t\n\t\t},\n\t\tbaseAppDefaultOptions = {\n\t\t\tUIDPrefix : '',\n\t\t\tAPIurl : ''\n\t\t},\n\t\tbaseApp = {},\n\t\tcurrentHostPath,\n\t\tbrowserName,\n\t\tknownIDs = {};\n\t\n//\tconsole.log(knownIDs);\n\tvar launch = function(customOptions) {\n\t\t\n\t\tdebugMode = window.location && window.location.href.match(/[\\?&]debug=(.+)&?/)\n\t\tif (debugMode && debugMode[0])\n\t\t\tdebugMode = debugMode[0];\n\t\t\n\t\tObject.assign(options, baseAppDefaultOptions);\n\t\tif (typeof customOptions === 'object' && Object.keys(customOptions).length) {\n\t\t\tfor(var prop in customOptions) {\n\t\t\t\tif (customOptions.hasOwnProperty(prop))\n\t\t\t\t\toptions[prop] = customOptions[prop];\n\t\t\t};\n\t\t}\n\t\t\n\t\t// ensure we have an underscore at the end of the \"app specific\" prefix\n\t\toptions.UIDPrefix = (options.UIDPrefix.lastIndexOf('_') === options.UIDPrefix.length - 1) ? options.UIDPrefix : options.UIDPrefix + '_';\n\t\t\n\t\t// helper styles\n//\t\trequire('src/UI/styles/helperStyles')(context).getInstance();\n\t\t\n\t\t// Validate init\n\t\tValidate.options = {format: \"flat\"};\n\t\t\n\t\tcurrentHostPath = window.location && window.location.href.match(/(.*\\/)[^/]*$/)[1];\n\t\tbrowserName = parseUserAgent();\n\t\t\n//\t\tmasterTimer.startQueue();\n\t}\n\t\n\tvar parseUserAgent = function() {\n\t\tvar UA = window.navigator && window.navigator.userAgent;\n\t\t\n\t\t// Mobile\n\t\tif (/iPad/i.test(UA) || /iPhone/i.test(UA)) {\n\t\t\tvar webkit = /WebKit/i.test(UA);\n\t\t\tif (webkit && !/CriOS/i.test(UA))\n\t\t\t\treturn 'IOSsafari';\n\t\t}\n\t\t// Desktop\n\t\telse if(/Firefox/.test(UA) && !/Seamonkey/.test(UA))\n\t\t\treturn 'Firefox';\n\t\telse if(/Seamonkey/.test(UA))\n\t\t\treturn 'Seamonkey';\n\t\telse if(/Chrome/.test(UA) && !/Chromium/.test(UA))\n\t\t\treturn 'Chrome';\n\t\telse if(/Chromium/.test(UA))\n\t\t\treturn 'Chromium';\n\t\telse if(/Safari/.test(UA) && !/Chrome/.test(UA))\n\t\t\treturn 'Safari';\n\t\telse if(/OPR/.test(UA))\n\t\t\treturn 'Opera15+';\n\t\telse if(/Opera/.test(UA))\n\t\t\treturn 'Opera12-';\n\t\telse if(/MSIE/.test(UA))\n\t\t\treturn 'MSIE';\n\t}\n\t\n\tvar checkSupport = function() {\n\t\tif (this.browserName === 'IOSsafari') {\n\t\t\tconsole.log('This App is not designed for Safari on IOS : Web Audio API support is missing');\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\t\n\tvar getUID = function(uniqueID) {\n\t\tif (knownIDs.hasOwnProperty(options.UIDPrefix + uniqueID)) {\n//\t\t\tconsole.log(options.UIDPrefix + uniqueID);\n\t\t\treturn knownIDs[options.UIDPrefix + uniqueID];\n\t\t}\n\t\telse if (knownIDs.hasOwnProperty(uniqueID)) {\n//\t\t\tconsole.log(uniqueID);\n\t\t\treturn knownIDs[uniqueID];\n\t\t}\n\t\telse if (!knownIDs.hasOwnProperty(options.UIDPrefix + uniqueID) || !uniqueID || !uniqueID.length) {\n\t\t\tuniqueID = uniqueID ? (options.UIDPrefix + uniqueID) : (options.UIDPrefix + (Math.round(Math.random() * 10000)).toString());\n\t\t\tknownIDs[uniqueID] = uniqueID;\n\t\t\treturn knownIDs[uniqueID];\n\t\t}\n\t}\n\t\n\tvar isKnownUID = function(uniqueID) {\n\t\treturn getUID(uniqueID);\n\t}\n\t\n\tvar setUID = function(uniqueID, globalObj) {\n\t\treturn (knownIDs[uniqueID] = globalObj);\n\t}\n\t\n\treturn {\n\t\tdebugMode : debugMode,\n\t\tresizeObserver : resizeObserver,\n\t\ttextSizeGetter : textSizeGetter,\n\t\tTextSizeGetterCtor : TextSizeGetter,\n\t\toptions : options,\n\t\tlaunch : launch,\n\t\tcheckSupport : checkSupport,\n//\t\tlocks : locks,\n//\t\tknownIDs : knownIDs,\n\t\tgetUID : getUID,\n\t\tisKnownUID : isKnownUID,\n\t\tsetUID : setUID,\n\t\tcurrentHostPath : currentHostPath,\n\t\tbrowserName : browserName\n\t}\n})();\n\n//classConstructor.__factory_name = 'appLauncher';\n//var factory = Factory.Maker.getSingletonFactory(classConstructor);\n//module.exports = factory;\n\nmodule.exports = classConstructor;\n",
    "\"use strict\";\n/**\r\n * @injector DependancyInjector\r\n */\r\n\r\nconst App = require('src/core/App');\r\nconst ReactiveDataset = require('src/core/ReactiveDataset');\r\nconst ComponentSet = require('src/core/ComponentSet');\r\n\r\n\r\n\r\n/**\r\n * Dependancy Injection\r\n */\r\nApp.coreComponents.IteratingComponent.prototype.rDataset = ReactiveDataset;\r\nApp.coreComponents.LazySlottedCompoundComponent.prototype.rDataset = ReactiveDataset;\r\nApp.coreComponents.AbstractAccordion.prototype.rDataset = ReactiveDataset;\r\nApp.coreComponents.LazySlottedCompoundComponent.prototype.cSet = ComponentSet;\r\n\r\n\r\nApp.componentTypes.RootViewComponent.prototype.render = function(DOMNodeId) {\r\n\tnew App.DelayedDecoration(null, this);\r\n};\r\nApp.coreComponents.LazySlottedCompoundComponent.prototype.render = function(DOMNodeId, previousListHostDef) {\r\n\tnew App.DelayedDecoration(DOMNodeId, this, previousListHostDef);\r\n};\r\nApp.coreComponents.AbstractTree.prototype.render = function(DOMNodeId) {\r\n\tnew App.DelayedDecoration(DOMNodeId, this, this.listTemplate.getHostDef());\r\n};\r\n\r\n// Is meant as a reminder that the naiveDOM type is naive and should be cleaned in a further update\r\nconst isLayoutEngineON = true;\r\nif (isLayoutEngineON) {\r\n\tvar SpecialDependencyInjector = require('src/_LayoutEngine/SpecialDependencyInjector');\r\n\t// TODO: Object.assign is the ugliest and riskiest way to create a mixin.\r\n\t// \t\t=> if it's \"injection\", please inject via some \"in framework\" existing & tested decoration principle\r\n\tApp.componentTypes.HierarchicalObject.prototype = Object.assign(App.componentTypes.HierarchicalObject.prototype, SpecialDependencyInjector.prototype);\r\n}\r\n\r\n\r\nmodule.exports = App;",
    "\"use strict\";\n/**\r\n * @constructor AppBoundaryComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createAppBoundaryComponentHostDef = require('src/coreComponents/AppBoundaryComponent/coreComponentDefs/AppBoundaryComponentHostDef');\r\n//var createAppBoundaryComponentSlotsDef = require('src/coreComponents/AppBoundaryComponent/coreComponentDefs/AppBoundaryComponentSlotsDef');\r\n\r\nvar AppBoundaryComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'AppBoundaryComponent';\r\n}\r\nAppBoundaryComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nAppBoundaryComponent.prototype.objectType = 'AppBoundaryComponent';\r\nAppBoundaryComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\nAppBoundaryComponent.defaultDef = {\r\n\tnodeName : 'div',\r\n\tattributes : [],\r\n\tstates : [],\r\n\tprops : [],\r\n\treactOnParent : [],\r\n\treactOnSelf : []\r\n}\r\n\r\nAppBoundaryComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createComponentDef(\r\n\t\t\tcreateAppBoundaryComponentHostDef(),\r\n\t\t\t'AppBoundaryComponentDefaultDef',\r\n\t\t\t'rootOnly'\r\n\t\t);\r\n}\r\n\r\nAppBoundaryComponent.prototype.getFirstChild = function() {\r\n\treturn this._children[0];\r\n}\r\n\r\nAppBoundaryComponent.prototype.getChild = function(Idx) {\r\n\treturn this._children[Idx];\r\n}\r\n\r\nAppBoundaryComponent.prototype.getRow = function(rowIdx) {\r\n\treturn this._children[rowIdx];\r\n}\r\n\r\nmodule.exports = AppBoundaryComponent;",
    "\"use strict\";\n/**\r\n * @def AppBoundaryComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AppBoundaryComponentHost/true\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar AppBoundaryComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"column\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"justifyContent\": \"space-evenly\",\n\t\t\"selector\": \":host\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"1px outset #282828\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AppBoundaryComponentHostStyles'\n\t}\r\n\t\r\n\t\r\n\t\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\t\tnodeName : 'app-boundary',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t});\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = AppBoundaryComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor AppOverlayComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createAppOverlayComponentHostDef = require('src/coreComponents/AppOverlayComponent/coreComponentDefs/AppOverlayComponentHostDef');\r\n//var createAppOverlayComponentSlotsDef = require('src/coreComponents/AppOverlayComponent/coreComponentDefs/AppOverlayComponentSlotsDef');\r\n\r\nvar AppOverlayComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'AppOverlayComponent';\r\n}\r\nAppOverlayComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nAppOverlayComponent.prototype.objectType = 'AppOverlayComponent';\r\nAppOverlayComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\nAppOverlayComponent.defaultDef = {\r\n\tnodeName : 'app-overlay',\r\n\tattributes : [],\r\n\tstates : [],\r\n\tprops : [],\r\n\treactOnParent : [],\r\n\treactOnSelf : []\r\n}\r\n\r\nAppOverlayComponent.prototype.createDefaultDef = function() {\r\n\treturn createAppOverlayComponentHostDef();\r\n}\r\n\r\nmodule.exports = AppOverlayComponent;",
    "\"use strict\";\n/**\r\n * @def AppOverlayComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AppOverlayComponentHost/true\r\n * @CSSify styleName : AppOverlayComponentTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar AppOverlayComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"row\",\n\t\t\"flex\": \"1 1 100%\",\n\t\t\"selector\": \":host\",\n\t\t\"position\": \"absolute\",\n\t\t\"width\": \"100%\",\n\t\t\"height\": \"25%\",\n\t\t\"top\": \"74%\",\n\t\t\"padding\": \"38px\",\n\t\t\"boxSizing\": \"border-box\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AppOverlayComponentHostStyles'\n\t}\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\tnodeName : 'app-overlay',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t});\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = AppOverlayComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor ComponentPickingInput\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createComponentPickingInputHostDef = require('src/coreComponents/ComponentPickingInput/coreComponentDefs/ComponentPickingInputHostDef');\r\n//var createComponentPickingInputSlotsDef = require('src/coreComponents/ComponentPickingInput/coreComponentDefs/ComponentPickingInputSlotsDef');\r\n\r\nvar ComponentPickingInput = function(definition, parentView, parent) {\r\n\tif (!definition.getGroupHostDef() || !definition.getGroupHostDef().props.fastHasObjectByKey('inChannel'))\r\n\t\tdefinition = createComponentPickingInputHostDef();\r\n//\tconsole.log(definition);\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'ComponentPickingInput';\r\n}\r\nComponentPickingInput.prototype = Object.create(Components.CompositorComponent.prototype);\r\nComponentPickingInput.prototype.objectType = 'ComponentPickingInput';\r\nComponentPickingInput.prototype.extendsCore = 'CompoundComponent';\r\n\r\n//ComponentPickingInput.defaultDef = {\r\n//\tnodeName : 'div',\r\n//\tattributes : [],\r\n//\tstates : [],\r\n//\tprops : [],\r\n//\treactOnParent : [],\r\n//\treactOnSelf : []\r\n//}\r\n\r\nComponentPickingInput.prototype.createDefaultDef = function() {\r\n\treturn createComponentPickingInputHostDef().getHostDef();\r\n}\r\n\r\nmodule.exports = ComponentPickingInput;",
    "\"use strict\";\n/**\r\n * @def ComponentPickingInput\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : ComponentPickingInputHost/false\r\n * @CSSify styleName : ComponentPickingInputButton/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar ComponentPickingInputDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"selector\": \":host, div\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"none\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t},\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"alignItems\": \"center\",\n\t\t\"justifyContent\": \"space-between\",\n\t\t\"border\": \"1px solid #383838\",\n\t\t\"margin\": \"2px\",\n\t\t\"padding\": \"3px\",\n\t\t\"borderRadius\": \"2px\"\n\t},\n\t{\n\t\t\"selector\": \"label\",\n\t\t\"padding\": \"2px 7px\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : false,\n\t\tnameInCache : 'ComponentPickingInputHostStyles'\n\t}\n\n\tvar buttonStyles = [\n\n\t{\n\t\t\"selector\": \":host, div\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"none\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t},\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"backgroundColor\": \"#3F3F3F\",\n\t\t\"display\": \"flex\",\n\t\t\"alignItems\": \"center\",\n\t\t\"justifyContent\": \"center\",\n\t\t\"width\": \"38px\",\n\t\t\"height\": \"36px\",\n\t\t\"border\": \"1px outset #777\",\n\t\t\"borderRadius\": \"3px\"\n\t},\n\t{\n\t\t\"selector\": \":host(:nth-child(3))\",\n\t\t\"width \": \"31px\",\n\t\t\"height\": \"36px\"\n\t}\n\n\t];\n\tvar buttonStylesUseCache = {\n\t\tuse : false,\n\t\tnameInCache : 'ComponentPickingInputButtonStyles'\n\t}\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComponentPickingInput',\r\n\t\t\tnodeName : 'picking-input',\r\n\t\t\tprops : [\r\n\t\t\t\t{accepts : undefined},\r\n\t\t\t\t{title : undefined},\r\n\t\t\t\t{inChannel : undefined},\r\n\t\t\t\t{outChannel : undefined}\r\n\t\t\t],\r\n\t\t\tstates : [],\r\n\t\t\tsubscribeOnChild : [\r\n\t\t\t\t{\r\n\t\t\t\t\ton : 'update',\r\n\t\t\t\t\tsubscribe : function(e) {\r\n\t\t\t\t\t\tif (e.bubble)\r\n\t\t\t\t\t\t\tthis.trigger('update', e.data, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t}),\r\n\t\tmembers : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'SimpleText',\r\n\t\t\t\tnodeName : 'label',\r\n\t\t\t\treactOnParent : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'title',\r\n\t\t\t\t\t\tto : 'content'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'VisibleStateComponent',\r\n\t\t\t\tnodeName : 'pad-in',\r\n\t\t\t\tprops : [\r\n\t\t\t\t\t\r\n\t\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\tbuttonStylesUseCache.use ? buttonStylesUseCache.nameInCache : null,\n\t\t\t\t\t\tbuttonStyles\n\t\t\t\t\t)\r\n\t\t\t}),\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'FontSwatchComponent',\r\n\t\t\t\tnodeName : 'swatch-section',\r\n//\t\t\t\tprops : [\r\n//\t\t\t\t\t{accepts : undefined}\r\n//\t\t\t\t],\r\n\t\t\t\treactOnParent : [\r\n//\t\t\t\t\t{\r\n//\t\t\t\t\t\tfrom : 'accepts',\r\n//\t\t\t\t\t\tto : 'accepts'\r\n//\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom :  'inChannel',\r\n\t\t\t\t\t\tto : 'updateChannel',\r\n\t\t\t\t\t\tmap : function(val) {return this.adaptDBTypedValue(val);}\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}),\r\n//\t\t\tTypeManager.createComponentDef({\r\n//\t\t\t\thost : TypeManager.createComponentDef({\r\n//\t\t\t\t\ttype : 'TypedListBuilderComponent',\r\n//\t\t\t\t\tnodeName : 'section',\r\n//\t\t\t\t\tprops : [\r\n//\t\t\t\t\t\t{accepts : undefined}\r\n//\t\t\t\t\t],\r\n//\t\t\t\t\treactOnParent : [\r\n//\t\t\t\t\t\t{\r\n//\t\t\t\t\t\t\tfrom : 'accepts',\r\n//\t\t\t\t\t\t\tto : 'accepts'\r\n//\t\t\t\t\t\t},\r\n//\t\t\t\t\t\t{\r\n//\t\t\t\t\t\t\tfrom :  'inChannel',\r\n//\t\t\t\t\t\t\tcbOnly : true,\r\n//\t\t\t\t\t\t\tsubscribe : function(value) {\r\n//\t\t\t\t\t\t\t\tvar self = this;\r\n//\t\t\t\t\t\t\t\tthis.streams.accepts.subscribe(function(val) {\r\n//\t\t\t\t\t\t\t\t\tconsole.log(val, self.typedSlots[0].newItem(value), value, self);\r\n//\t\t\t\t\t\t\t\t\tself.defineHostedComponentDef(val, 1);\r\n//\t\t\t\t\t\t\t\t\tself.typedSlots[0].push(\r\n//\t\t\t\t\t\t\t\t\t\tself.typedSlots[0].newItem(value)\r\n//\t\t\t\t\t\t\t\t\t);\r\n//\t\t\t\t\t\t\t\t})\r\n////\t\t\t\t\t\t\t\tvar type = this.streams.accepts.value;\r\n////\t\t\t\t\t\t\t\tconsole.log(this.streams, type, value);\r\n////\t\t\t\t\t\t\t\t\r\n////\t\t\t\t\t\t\t\tthis.defineHostedComponentDef(type, 1);\r\n//////\t\t\t\t\t\t\t\tthis.typedSlots[0].push(\r\n//////\t\t\t\t\t\t\t\t\tthis.typedSlots[0].newItem(value)\r\n//////\t\t\t\t\t\t\t\t);\r\n//\t\t\t\t\t\t\t}\r\n//\t\t\t\t\t\t}\r\n//\t\t\t\t\t]\r\n//\t\t\t\t})\r\n//\t\t\t}, null, 'rootOnly'),\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'VisibleStateComponent',\r\n\t\t\t\tnodeName : 'pad-out',\r\n\t\t\t\tprops : [\r\n\t\t\t\t\t\r\n\t\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\tbuttonStylesUseCache.use ? buttonStylesUseCache.nameInCache : null,\n\t\t\t\t\t\tbuttonStyles\n\t\t\t\t\t)\r\n\t\t\t}),\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = ComponentPickingInputDef;",
    "\"use strict\";\n/**\r\n * @constructor FlexColumnComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createFlexColumnComponentHostDef = require('src/coreComponents/FlexColumnComponent/coreComponentDefs/FlexColumnComponentHostDef');\r\n//var createFlexColumnComponentSlotsDef = require('src/coreComponents/FlexColumnComponent/coreComponentDefs/FlexColumnComponentSlotsDef');\r\n\r\nvar FlexColumnComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'FlexColumnComponent';\r\n}\r\nFlexColumnComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nFlexColumnComponent.prototype.objectType = 'FlexColumnComponent';\r\nFlexColumnComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\nFlexColumnComponent.defaultDef = {\r\n\tnodeName : 'box-column',\r\n\tattributes : [],\r\n\tstates : [],\r\n\tprops : [],\r\n\treactOnParent : [],\r\n\treactOnSelf : []\r\n}\r\n\r\nFlexColumnComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createComponentDef(\r\n\t\t\tcreateFlexColumnComponentHostDef(),\r\n\t\t\t'FlexColumnComponentDefaultDef',\r\n\t\t\t'rootOnly'\r\n\t\t);\r\n}\r\n\r\nFlexColumnComponent.prototype.getRow = function(rowIdx) {\r\n\treturn this._children[rowIdx];\r\n}\r\n\r\nmodule.exports = FlexColumnComponent;",
    "\"use strict\";\n/**\r\n * @def FlexColumnComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : FlexColumnComponentHost/true\r\n * @CSSify styleName : FlexColumnComponentTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar FlexColumnComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"column\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"selector\": \":host\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'FlexColumnComponentHostStyles'\n\t}\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\tnodeName : 'box-column',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t});\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = FlexColumnComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor FlexGridComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\n//var createFlexGridComponentHostDef = require('src/coreComponents/FlexGridComponent/coreComponentDefs/FlexGridComponentHostDef');\r\n//var createFlexGridComponentSlotsDef = require('src/coreComponents/FlexGridComponent/coreComponentDefs/FlexGridComponentSlotsDef');\r\n\r\nvar FlexGridComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'FlexGridComponent';\r\n}\r\nFlexGridComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nFlexGridComponent.prototype.objectType = 'FlexGridComponent';\r\nFlexGridComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\nFlexGridComponent.defaultDef = {\r\n\tnodeName : 'box-grid',\r\n\tattributes : [],\r\n\tstates : [],\r\n\tprops : [],\r\n\treactOnParent : [],\r\n\treactOnSelf : []\r\n}\r\n\r\nFlexGridComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createComponentDef(\r\n\t\t\tFlexGridComponent.defaultDef,\r\n\t\t\t'FlexGridComponentDefaultDef',\r\n\t\t\t'rootOnly'\r\n\t\t);\r\n}\r\n\r\n// RowOfColumn and ColumnOfRow are identical, cause FlexGrid may host a Row or a Column\r\n// \t\t=> let's use the method that is the most semantically convenient in our app \r\nFlexGridComponent.prototype.getRowOfColumn = function(rowIdx, colIdx) {\r\n\treturn this._children[colIdx]._children[rowIdx];\r\n}\r\n\r\nFlexGridComponent.prototype.getColumnOfRow = function(rowIdx, colIdx) {\r\n\treturn this._children[colIdx]._children[rowIdx];\r\n}\r\n\r\nFlexGridComponent.prototype.getColumn = function(colIdx) {\r\n\treturn this._children[colIdx];\r\n}\r\n\r\n\r\nmodule.exports = FlexGridComponent;",
    "\"use strict\";\n/**\r\n * @constructor FlexRowComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Component = require('src/core/Component');\r\n\r\nvar createFlexRowComponentHostDef = require('src/coreComponents/FlexRowComponent/coreComponentDefs/FlexRowComponentHostDef');\r\n//var createFlexRowComponentSlotsDef = require('src/coreComponents/FlexRowComponent/coreComponentDefs/FlexRowComponentSlotsDef');\r\n\r\nvar FlexRowComponent = function(definition, parentView, parent) {\r\n\tComponent.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'FlexRowComponent';\r\n}\r\nFlexRowComponent.prototype = Object.create(Component.CompositorComponent.prototype);\r\nFlexRowComponent.prototype.objectType = 'FlexRowComponent';\r\nFlexRowComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\n//FlexRowComponent.defaultDef = {\r\n//\tnodeName : 'box-row',\r\n//\tattributes : [],\r\n//\tstates : [],\r\n//\tprops : [],\r\n//\treactOnParent : [],\r\n//\treactOnSelf : []\r\n//}\r\n\r\nFlexRowComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createComponentDef(\r\n\t\t\tcreateFlexRowComponentHostDef(),\r\n\t\t\t'FlexRowComponentDefaultDef',\r\n\t\t\t'rootOnly'\r\n\t\t);\r\n}\r\n\r\nFlexRowComponent.prototype.getColumn = function(colIdx) {\r\n\treturn this._children[colIdx];\r\n}\r\n\r\nmodule.exports = FlexRowComponent;",
    "\"use strict\";\n/**\r\n * @def FlexRowComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : FlexRowComponentHost/true\r\n * @CSSify styleName : FlexRowComponentTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar FlexRowComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"row\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"selector\": \":host\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'FlexRowComponentHostStyles'\n\t}\r\n\t\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\t\tnodeName : 'box-row',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t});\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = FlexRowComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor HToolbarComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createHToolbarComponentHostDef = require('src/coreComponents/HToolbarComponent/coreComponentDefs/HToolbarComponentHostDef');\r\n//var createHToolbarComponentSlotsDef = require('src/coreComponents/HToolbarComponent/coreComponentDefs/HToolbarComponentSlotsDef');\r\n\r\nvar HToolbarComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'HToolbarComponent';\r\n}\r\nHToolbarComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nHToolbarComponent.prototype.objectType = 'HToolbarComponent';\r\nHToolbarComponent.prototype.extendsCore = 'CompoundComponent';\r\n\r\n//HToolbarComponent.defaultDef = {\r\n//\tnodeName : 'h-toolbar',\r\n//\tattributes : [],\r\n//\tstates : [],\r\n//\tprops : [],\r\n//\treactOnParent : [],\r\n//\treactOnSelf : []\r\n//}\r\n\r\nHToolbarComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createComponentDef(\r\n\t\t\tcreateHToolbarComponentHostDef(),\r\n\t\t\t'HToolbarComponentDefaultDef',\r\n\t\t\t'rootOnly'\r\n\t\t);\r\n}\r\n\r\nmodule.exports = HToolbarComponent;",
    "\"use strict\";\n/**\r\n * @def ToolbarComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : ToolbarComponentHost/true\r\n * @CSSify styleName : ToolbarComponentTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar ToolbarComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\tnodeName : 'h-toolbar'/**@CSSify Style componentStyle : ToolbarComponentHost */\r\n\t})\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = ToolbarComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor IFrameComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CoreTypes = require('src/core/CoreTypes');\r\nvar Components = require('src/core/Component');\r\n\r\nvar createIFrameComponentHostDef = require('src/coreComponents/IFrameComponent/coreComponentDefs/IFrameComponentHostDef');\r\n//var createIFrameComponentSlotsDef = require('src/coreComponents/IFrameComponent/coreComponentDefs/IFrameComponentSlotsDef');\r\n\r\n/**\r\n * An IFrameComponent is responsible to instanciate a view\r\n * which holds an IFrame DOM node.\r\n * \r\n * This IFrame DOM node has a property called \"contentWindow\"\r\n * which is a reference to the \"window\" object it holds.\r\n * When instanciating and rendering the view, this remote window object is null at first.\r\n * It's then populated by the browser with the real window object newly instanciated.\r\n * \r\n * At instanciation, the IFrameComponent starts polling the existence of his own view\r\n * and waits until the browser has populated the contentWindow.\r\n * \r\n * It then sends a \"ping\" message, via the postMessage API, to the global window where it resides.\r\n * (we could have simply used local events there, but this mechanism may be used cross-IFrames\r\n * => see below in the code)\r\n * \r\n * In the global window, we suppose it exists an ISocketListener,\r\n * which is passed the instance of the IFrameComponent,\r\n * and is simply a wrapper abstracting the handling of the IFrameComponent's pinging,\r\n * and also abstracting the handling of RPC's.\r\n * \r\n * The IFrameComponent shall instanciate a RPCStackComponent in its contentWindow\r\n * (remote window) on the property called window._recitalRPCStack\r\n * This stack is a holder to regroup the \"locally scoped\" functions in the remote scope.\r\n * And so, via its closure, this locally scoped function may call a method on a component\r\n * that only exists in what we see from here as the remote scope.\r\n * \r\n * Nota: Every IFrameComponent must have a corresponding ISocketListener, \r\n * as the IFrameComponent shall instanciate a\r\n * _RPCStackComponent with the status set to 'isInnerStack'.\r\n * So this component shall start an interval loop that will never end\r\n * unless the ISocketListener passes it a reference to its internal RPCStackComponent\r\n * \r\n */\r\nvar IFrameComponent = function(definition, parentView, parent) {\r\n\tthis._connectionEstablished = false;\r\n\t\r\n\tComponents.ComponentWithView.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'IFrameComponent';\r\n\t\r\n\tthis._globalWindow = window; \t// other way of getting to the global window : ask the IFrame where it resides => self.view.getMasterNode().ownerDocument.defaultView;\r\n\tthis._globalWindowURL = window.location.href;\r\n\t\r\n\tthis._innerWindow;\t\t// In the component's ctor, we don't have yet a complete view with a node element\r\n\tthis._innerWindowURL;\r\n\t\r\n\t// Very temporary system to identify ping requests : we look after something which is the name of a Spip page...\r\n\t// => it won't work for every app...\r\n\tthis._pingIdentifier = definition.getHostDef().attributes.getObjectValueByKey('src').match(/\\?page=([a-zA-Z]+)/)[1];\r\n\t\r\n\t// An ISocketComponent shall handle the communication between the two windows\r\n\t// Its role is to store a reference to the innerWindow, in order to be able to call remote procedures\r\n\t// So it should reside in the global window :\r\n\t// \t=> the global window calls the inner window through RPC\r\n\t// \t=> and the inner windows \"triggers\" callbacks on the global window which shall be listening on an \"update\"\" event\r\n\t\r\n\t// Who should we ping ? From where is the ISocketListerner listening ?\r\n\t// From inside the global window ? From inside the IFrame's window ?\r\n\t// As seen upfront, preferably from the global window.\r\n\t// But let's imagine here another scenario, and also prepare the code for this hypothesis.\r\n\t// => we'll poll both, stop on the first response and log the name of the first responding window\r\n\t\r\n\tthis.listenforISocketResponse();\r\n\t\r\n\tvar self = this, node;\r\n\tvar connect = setInterval(function() {\r\n\t\tnode = self.view.getMasterNode();\r\n\t\t\r\n\t\t// Do we have a view with a node ? AND the node has loaded some content and instanciated an window object ?\r\n\t\t// FIXME : we should not call self.pollWindows() before having reveived the DomContentReady event from the remote window.document\r\n\t\tif (node && node.contentWindow && node.contentWindow.document.location.href && node.contentWindow.document.location.href !== 'about:blank') {\r\n\t\t\tself._innerWindow = node.contentWindow;\r\n\t\t\tself._innerWindowURL = node.contentWindow.document.location.href;\r\n//\t\t\tconsole.log('IFrameComponent', self._innerWindowURL);\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn;\r\n\t\t\r\n//\t\tif (!self._connectionEstablished) {\r\n\t\t\tself._innerWindow.document.addEventListener('DOMContentLoaded', function() {\r\n\t\t\t\t// RPC first\r\n\t\t\t\tself._innerWindow._recitalRPCStack = new Components.RPCStackComponent('isInnerStack');\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('ping/' + self._pingIdentifier + ' sent');\r\n\t\t\t\tself.pollWindows();\r\n\t\t\t});\t\r\n//\t\t}\r\n//\t\telse {\r\n\t\t\tclearInterval(connect);\r\n//\t\t}\r\n\t}, 512);\r\n\t\r\n\r\n}\r\nvar proto_proto = Object.create(Components.ComponentWithHooks.prototype);\r\nObject.assign(proto_proto, CoreTypes.Worker.prototype)\r\nIFrameComponent.prototype = Object.create(proto_proto);\r\nIFrameComponent.prototype.objectType = 'IFrameComponent';\r\nIFrameComponent.prototype.constructor = IFrameComponent;\r\n\r\nIFrameComponent.prototype.createDefaultDef = function() {\r\n\treturn createIFrameComponentHostDef();\r\n}\r\n\r\nIFrameComponent.prototype.createEvents = function() {\r\n\tthis.createEvent('ready');\r\n}\r\n\r\nIFrameComponent.prototype.listenforISocketResponse = function() {\r\n\t// we're listening in the global window, waiting for a response\r\n\t// which should come from the global window\r\n\t// but may either come from the inner window\r\n\tvar self = this;\r\n\twindow.addEventListener(\"message\", function(e) {\r\n\t\tif (e.data === 'pong') {\r\n\t\t\t// There seem to be a latency, IFrameComponent pinging to fast, so the ISocketListener responds multiple times\r\n\t\t\t// => test if we already received a pong\r\n\t\t\tif (self._connectionEstablished === false) {\r\n\t\t\t\tself._connectionEstablished = true;\r\n\t\t\t\tconsole.log('Connection between windows established');\r\n\t\t\t\tself.trigger('ready');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nIFrameComponent.prototype.pollWindows = function() {\r\n\tconsole.log('pollWindows', this._pingIdentifier, this._innerWindowURL);\r\n\tthis._globalWindow.postMessage('ping/' + this._pingIdentifier, this._globalWindowURL);\t// the second parameter is received oas the \"origin\" property on the event object\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// a usefull \"source\" property shall also be passed, because of the \"postMessage\" specification\r\n\tthis._innerWindow.postMessage('ping/' + this._pingIdentifier, this._innerWindowURL);\r\n}\r\n\r\n\r\nmodule.exports = IFrameComponent;",
    "\"use strict\";\n/**\r\n * @def IFrameComponent\r\n * @isGroup false\r\n * \r\n * @CSSify styleName : IFrameComponentHost/true\r\n * @CSSify styleName : IFrameComponentTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar IFrameComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"row\",\n\t\t\"flex\": \"1 1 100%\",\n\t\t\"selector\": \":host\",\n\t\t\"position\": \"absolute\",\n\t\t\"width\": \"100%\",\n\t\t\"height\": \"100%\",\n\t\t\"boxSizing\": \"border-box\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'IFrameComponentHostStyles'\n\t}\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\t\tnodeName : 'iframe',\r\n\t\t\tattributes : [\r\n\t\t\t\t{title : ''}\t// IFrames must have a title ()https://dequeuniversity.com/rules/axe/4.4/frame-title?utm_source=lighthouse&utm_medium=devtools)\r\n\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t\t\r\n\t\t\t// Local App-Root can't be child of the IFrame Component, as it's instanciation\r\n\t\t\t// occurs way later...\r\n//\t\t\tsubscribeOnChild : [\r\n//\t\t\t\t{\r\n//\t\t\t\t\ton : 'update',\r\n//\t\t\t\t\tsubscribe : function(e) {\r\n//\t\t\t\t\t\tif (e.bubble)\r\n//\t\t\t\t\t\t\tthis.trigger('update', e.data);\r\n//\t\t\t\t\t}\r\n//\t\t\t\t}\r\n//\t\t\t]\r\n\t\t});\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = IFrameComponentDef;",
    "\"use strict\";\n/**\r\n * @constructor RPCStackComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CoreTypes = require('src/core/CoreTypes');\r\n\r\n/**\r\n * Extract from the documentation of the IFrameComponent :\r\n * \r\n * \"The contentWindow (remote window) is supposed to reference an instance of a RPCStackComponent\r\n * on the property called window._recitalRPCStack\r\n * This stack is a holder to regroup the \"locally scoped\" functions in the remote scope.\r\n * And so, via its closure, this locally scoped function may call a method on a component\r\n * that only exists in the remote scope.\"\r\n */\r\nvar RPCStackComponent = function(isInnerStack) {\r\n\tCoreTypes.EventEmitter.call(this);\r\n\tthis.objectType = 'RPCStackComponent';\r\n\tthis._reverseScope;\r\n\t\r\n\tthis.shallResolve;\r\n\tvar self = this;\r\n\tthis._asynchronousState = new Promise(function(resolve, reject) {\r\n\t\tself.shallResolve = resolve;\r\n//\t\tif (isInnerStack === 'isInnerStack') {\r\n//\t\t\tvar interval = setInterval(function() {\r\n//\t\t\t\tif (self._reverseScope) {\r\n//\t\t\t\t\tresolve();\r\n//\t\t\t\t\tclearInterval(interval);\r\n//\t\t\t\t}\r\n//\t\t\t}, 512);\r\n//\t\t}\r\n\t});\r\n\tthis.registeredCallbacks = {};\r\n}\r\nRPCStackComponent.prototype = Object.create(CoreTypes.EventEmitter.prototype);\r\nRPCStackComponent.prototype.objectType = 'RPCStackComponent';\r\n\r\nRPCStackComponent.prototype.acquireReverseScope = function(rpcStack) {\r\n\tthis._reverseScope = rpcStack;\r\n\tthis.shallResolve();\r\n}\r\n\r\nRPCStackComponent.prototype.registerProcedure = function(procedureName, closure, scope) {\r\n\tthis.registeredCallbacks[procedureName] = {\r\n\t\tscope : scope || null,\r\n\t\tclosure : closure\r\n\t};\r\n}\r\n\r\nRPCStackComponent.prototype.unRegisterProcedure = function(procedureName) {\r\n\tdelete this.registeredCallbacks[procedureName];\r\n}\r\n\r\nRPCStackComponent.prototype.callProcedure = function(procedureName, ...args) {\r\n\treturn this.registeredCallbacks[procedureName].closure.apply(\r\n\t\tthis.registeredCallbacks[procedureName].scope,\r\n\t\targs\r\n\t);\r\n}\r\n\r\n/**\r\n * This is an alternative to acquiring the -wrapping- IFrameComponent\r\n * by traversing the DOM : it's much cleaner to access the external scope\r\n * through the reference we've acquired in acquireReverseScope().\r\n * this._reverseScope refers to an instance of a RPCStackComponent\r\n * hosted by the ISocketListener which resides in the external scope,\r\n * and which already handled the pinging between this inner scope and the outer scope.\r\n */\r\nRPCStackComponent.prototype.callExternalProcedure = function(procedureName, ...args) {\r\n\tvar self = this;\r\n\treturn this._asynchronousState.then(function() {\r\n\t\treturn self._reverseScope.callProcedure(procedureName, ...args);\r\n\t});\r\n}\r\n\r\nmodule.exports = RPCStackComponent;",
    "\"use strict\";\n/**\r\n * @constructor RootViewComponent\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Components = require('src/core/Component');\r\n\r\n//var createRootViewComponentHostDef = require('src/core/coreComponents/RootViewComponent/coreComponentDefs/RootViewComponentHostDef');\r\n//var createRootViewComponentSlotsDef = require('src/core/coreComponents/RootViewComponent/coreComponentDefs/RootViewComponentSlotsDef');\r\n\r\nvar RootViewComponent = function(definition, parentView, parent) {\r\n\tComponents.CompositorComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'RootViewComponent';\r\n\t\r\n}\r\nRootViewComponent.prototype = Object.create(Components.CompositorComponent.prototype);\r\nRootViewComponent.prototype.objectType = 'RootViewComponent';\r\nRootViewComponent.prototype.extendsCore = 'CompoundComponent';\r\nRootViewComponent.prototype.render = function() {} \t\t\t\t\t\t\t// pure virtual (injected as a dependancy by AppIgnition)\r\n\r\n\r\n\r\nRootViewComponent.prototype.createDefaultDef = function() {\r\n\treturn TypeManager.createDef({\r\n\t\t\thost : TypeManager.createDef({\r\n\t\t\t\tnodeName : 'app-root'\r\n\t\t\t})\r\n\t\t});\r\n}\r\n\r\nRootViewComponent.prototype.getPanel = function(Idx) {\r\n\treturn this._children[Idx];\r\n}\r\n\r\nRootViewComponent.prototype.getHeaderPanel = function() {\r\n\treturn this._children[0];\r\n}\r\n\r\nRootViewComponent.prototype.getPagePanel = function() {\r\n\treturn this._children[1];\r\n}\r\n\r\nRootViewComponent.prototype.getAfterPagePanel = function() {\r\n\treturn this._children[2];\r\n}\r\n\r\nmodule.exports = RootViewComponent;",
    "\"use strict\";\n/**\r\n * @def RootViewComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : RootViewComponentHost/false\r\n * @CSSify styleName : RootViewComponentHeader/false\r\n * @CSSify styleName : RootViewComponentPage/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar RootViewComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must \"stick\" to the annotation (ie. be RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar pageStyles = [\n\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"width\": \"100%\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"flexFlow\": \"row\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"0\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t}\n\n\t];\n\tvar pageStylesUseCache = {\n\t\tuse : false,\n\t\tnameInCache : 'RootViewComponentPageStyles'\n\t}\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"width\": \"100%\",\n\t\t\"height\": \"100%\",\n\t\t\"flex\": \"1 1 100%\",\n\t\t\"flexFlow\": \"column\",\n\t\t\"top\": \"0px\",\n\t\t\"left\": \"0px\",\n\t\t\"overflow\": \"hidden\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"transparent\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t},\n\t{\n\t\t\"selector\": \"iframe\",\n\t\t\"height\": \"75%\",\n\t\t\"border\": \"1px solid #444\",\n\t\t\"backgroundColor\": \"#333\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"margin\": \"0\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : false,\n\t\tnameInCache : 'RootViewComponentHostStyles'\n\t}\n\n\tvar headerStyles = [\n\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"width\": \"100%\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"flexFlow\": \"row\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"0\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t}\n\n\t];\n\tvar headerStylesUseCache = {\n\t\tuse : false,\n\t\tnameInCache : 'RootViewComponentHeaderStyles'\n\t}\r\n\t\r\n\r\n\t \r\n\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComposedCompnent', \t\t\t\t// this is implicit, as we call the CompoundComponent ctor in the ctor\r\n\t\t\tnodeName : 'app-root',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t}),\r\n\t\tmembers : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'ComponentWithView',\r\n\t\t\t\tnodeName : 'app-header',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\theaderStylesUseCache.use ? headerStylesUseCache.nameInCache : null,\n\t\t\t\t\t\theaderStyles\n\t\t\t\t\t)\r\n\t\t\t}),\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'ComponentWithView',\r\n\t\t\t\tnodeName : 'app-body',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\tpageStylesUseCache.use ? pageStylesUseCache.nameInCache : null,\n\t\t\t\t\t\tpageStyles\n\t\t\t\t\t)\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\tvar minimalModuleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComposedCompnent', \t\t\t\t// this is implicit, as we call the CompoundComponent ctor in the ctor\r\n\t\t\tnodeName : 'app-root',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t})\r\n\t}, null, 'rootOnly');\r\n\t\r\n//\tconsole.error(minimalModuleDef);\r\n\t\r\n\treturn {\r\n\t\tmoduleDef : moduleDef,\r\n\t\tminimalModuleDef : minimalModuleDef\r\n\t};\r\n}\r\n\r\nmodule.exports = RootViewComponentDef;",
    "\"use strict\";\n/**\r\n * @def AbstractAccordion\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AbstractAccordionHost/true\r\n * @CSSify styleName : AbstractAccordionPseudoSlot/true\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\n\r\nvar AbstractAccordionDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"selector\": \":host, *\",\n\t\t\"boxSizing\": \"border-box\",\n\t\t\"background\": \"0\",\n\t\t\"border\": \"0\",\n\t\t\"boxShadow\": \"none\",\n\t\t\"margin\": \"0\",\n\t\t\"outline\": \"0\",\n\t\t\"padding\": \"0\",\n\t\t\"verticalAlign\": \"baseline\"\n\t},\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"flexFlow\": \"column\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"margin\": \"0px 0px 9px 0\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AbstractAccordionHostStyles'\n\t}\r\n\t\r\n\tvar template = TypeManager.createComponentDef({\r\n\t\t\ttype : 'ComponentWithView',\r\n\t\t\tnodeName : 'accordion-set',\r\n\t\t\tstates : [\r\n\t\t\t\t{\"accordion-set\" : undefined}\r\n\t\t\t]/**@CSSify Style componentStyle : AbstractAccordionPseudoSlot */\r\n\t});\r\n\t\r\n\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComposedCompnent', \t\t\t\t// this is implicit, as we call the CompoundComponent ctor in the TabPanel ctor\r\n\t\t\tnodeName : 'reactive-accordion',\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t}),\r\n\t\tlists : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\t\ttype : 'ComponentList',\r\n\t\t\t\t\ttemplate : template\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nmodule.exports = AbstractAccordionDef;",
    "\"use strict\";\n/**\r\n * @def AbstractAccordionSlot\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AbstractAccordionSlotTemplate/false\r\n * @CSSifyTheme themeName : basic-light\r\n*/\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar AbstractAccordionSlotDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\r\n\t\r\n\treturn TypeManager.createComponentDef({\r\n\t\t\thost : TypeManager.createComponentDef({\r\n\t\t\t\ttype : 'SomeMandatoryType',\r\n\t\t\t\tnodeName : 'accordion-panel'/**@CSSify Style componentStyle : AbstractAccordionSlotTemplate */\r\n\t\t\t})\r\n\t\t}, null, 'rootOnly');\r\n}\r\n\r\n\r\nmodule.exports = AbstractAccordionSlotDef;",
    "\"use strict\";\n/**\r\n * @def IteratingComponent\r\n * @author : Kinegraphx\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : IteratingComponentHost\r\n * @CSSify styleName : IteratingComponentTemplate\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\nvar TemplateFactory = require('src/core/TemplateFactory');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar IteratingComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// Remove the whitespace between @CSSify and the word DEBUG to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\t\r\n\treturn TemplateFactory.createHostDef({\r\n\t\tnodeName : 'ul',\r\n\t});\r\n}\r\n\r\nmodule.exports = IteratingComponentDef;",
    "\"use strict\";\n/**\r\n * @def IteratingComponentSlots\r\n * @author : Kinegraphx\r\n * @isGroup false\r\n * \r\n * @CSSify styleName : IteratingComponentHeader\r\n * @CSSify styleName : IteratingComponentSection\r\n * @CSSifyTheme themeName : basic-light\r\n */\r\nvar TemplateFactory = require('src/core/TemplateFactory');\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar IteratingComponentSlotsDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */ \t// Remove the whitespace between @CSSify and the word DEBUG to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\t\r\n\tconst slotDef = TemplateFactory.createDef({\r\n\t\thost : TemplateFactory.createDef({\r\n\t\t\ttype : 'SimpleText',\r\n\t\t\tnodeName : 'li'\r\n\t\t})\r\n\t});\r\n\t\r\n\t\r\n\t\r\n\treturn {\r\n\t\tslotDef : slotDef\r\n\t};\r\n}\r\n\r\nmodule.exports = IteratingComponentSlotsDef;",
    "\"use strict\";\n/**\r\n * @def BasicTable\r\n * @isGroup true\r\n * \r\n * @CSSify hostName : abstractTable\r\n * @CSSifyRule rule : host flexBoxColumn/flexGrow\r\n */\r\n\r\n// hostname abstractTable\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\nvar pseudoSlotsStyles = require('src/coreDefs/abstractTablePseudoSlotsStyleDef');\r\n\r\n\r\nvar basicTableDef = function(uniqueID, options, model) {\r\n\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\tvar styles = [\r\n/*@CSSifySlot*/\r\n\t\t];\r\n\t\r\n\t\r\n\tvar slotDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'ComponentWithView',\r\n\t\t\tnodeName : 'pseudo-slot',\r\n\t\t\tstates : [\r\n\t\t\t\t{'slot-id' : undefined},\r\n\t\t\t\t{'is-embedded' : undefined},\r\n\t\t\t\t{'position' : undefined}\r\n\t\t\t\t\r\n\t\t\t],\r\n\t\t\tsubscribeOnChild : [\r\n\t\t\t\t{\r\n\t\t\t\t\ton : 'update',\r\n\t\t\t\t\tsubscribe : function(e) {\r\n\t\t\t\t\t\tif (e.bubble)\r\n\t\t\t\t\t\t\tthis.trigger('update', e.data, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tsWrapper : CreateStyle('shallBeOverriddenForSecondSlot', null, pseudoSlotsStyles()).sWrapper\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComposedCompnent', \t\t\t\t// this is implicit, as we call the CompoundComponent ctor in the TabPanel ctor\r\n\t\t\tnodeName : 'extensible-table',\r\n\t\t\tprops : [\r\n\t\t\t\t{updateChannel : undefined}\r\n\t\t\t],\r\n\t\t\tsWrapper : CreateStyle('abstractTable', null, styles).sWrapper\r\n\t\t}),\r\n\t\tlists : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'ComponentList',\r\n\t\t\t\ttemplate : slotDef\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nbasicTableDef.__factory_name = 'basicTableDef';\r\nmodule.exports = basicTableDef;",
    "\"use strict\";\n/**\r\n * \r\n * @CSSify hostName : abstractTableSlots\r\n * @CSSifyRule rule : host flexBoxRow\r\n * @CSSifyRule rule : tdth inlineBlock/three_columns\r\n * @CSSifyRule rule : tdthspecial special_table\r\n */\r\n\r\n\r\nmodule.exports = function() {\r\n\treturn [\r\n/*@CSSifySlot*/\r\n\t\t\t]\r\n};",
    "\"use strict\";\n/**\r\n * @def BasicTableSlots\r\n * @isGroup false\r\n\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar Component = require('src/core/Component');\r\n\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar basicTableSlotsDef = function(uniqueID, options, model) {\r\n\t\r\n\t// Some CSS stuff\r\n\tvar styles = [\r\n/*@CSSifySlot*/\r\n\t\t];\r\n\t\r\n\tvar headerDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'VaritextButton',\r\n\t\t\tnodeName : 'th',\r\n\t\t\t// this is a big hack of shit (should be an attribute, but not... should be a \"DOM\" attribute... -> setAttribute(). TODO: fix after re-implementation of _arias&glyphs)\r\n\t\t\tstates : [\r\n\t\t\t\t{role : \"heading\"},\r\n\t\t\t\t{sortedasc : undefined},\r\n\t\t\t\t{sorteddesc : undefined}\r\n\t\t\t],\r\n\t\t\tprops : [\r\n\t\t\t\t{headerTitle : undefined}\r\n\t\t\t],\r\n\t\t\treactOnSelf : [\r\n\t\t\t\t{\r\n\t\t\t\t\tfrom : 'headerTitle',\r\n\t\t\t\t\tto : 'content'\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\t\r\n\tvar sectionDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'ComponentWith_FastReactiveText',\r\n\t\t\tnodeName : 'tr',\r\n\t\t\tprops : [\r\n\t\t\t\t{rowContentAsArray : undefined}\r\n\t\t\t],\r\n\t\t\treactOnSelf : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'rowContentAsArray',\r\n\t\t\t\t\t\tcbOnly : true,\r\n\t\t\t\t\t\tsubscribe : Component.ComponentWith_FastReactiveText.prototype.setContentFromArrayOnEachMemberView\r\n\t\t\t\t\t}\r\n\t\t\t]\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\t\r\n\t\r\n\t\r\n\treturn {\r\n\t\theaderDef : headerDef,\r\n\t\tsectionDef : sectionDef\r\n\t};\r\n}\r\n\r\nbasicTableSlotsDef.__factory_name = 'lazySlottedComponentDef';\r\nmodule.exports = basicTableSlotsDef;",
    "\"use strict\";\n/**\r\n * @def AbstractTree\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AbstractTreeHost/true\r\n * @CSSify styleName : AbstractTreeHeader/true\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\n\r\n\r\nvar abstractTreeDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar hostStyles = [\n\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"flex\",\n\t\t\"flex\": \"1 1 0\",\n\t\t\"alignItems\": \"flex-start\",\n\t\t\"boxSizing\": \"border-box\"\n\t},\n\t{\n\t\t\"selector\": \"tree-branch:nth-child(3)\",\n\t\t\"marginLeft\": \"0\"\n\t}\n\n\t];\n\tvar hostStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AbstractTreeHostStyles'\n\t}\r\n\t\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'CompoundComponent',\r\n\t\t\tnodeName : 'folded-tree',\r\n\t\t\tprops : [\r\n\t\t\t\t{selected : undefined},\r\n\t\t\t\t{expanded : true}\r\n\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\thostStylesUseCache.use ? hostStylesUseCache.nameInCache : null,\n\t\t\t\t\t\thostStyles\n\t\t\t\t\t)\r\n\t\t}),\r\n\t\tmembers : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'VaritextButtonWithPicto',\r\n\t\t\t\tnodeName : 'header',\r\n\t\t\t\t// this is a big hack of shit (should be an attribute, but not... should be a \"DOM\" attribute... -> setAttribute(). TODO: fix after re-implementation of _arias&glyphs)\r\n\t\t\t\tstates : [\r\n\t\t\t\t\t{role : \"heading\"},\r\n\t\t\t\t\t{expanded : undefined} \r\n\t\t\t\t],\r\n\t\t\t\tprops : [\r\n\t\t\t\t\t{headerTitle : undefined}\r\n\t\t\t\t],\r\n\t\t\t\treactOnSelf : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'headerTitle',\r\n\t\t\t\t\t\tto : 'content'\r\n\t\t\t\t\t}\r\n\t\t\t\t]/**@CSSify Style componentStyle : AbstractTreeHeader */\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nabstractTreeDef.__factory_name = 'abstractTreeDef';\r\nmodule.exports = abstractTreeDef;",
    "\"use strict\";\n/**\r\n * @def treeBranch\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AbstractTreeBranch/true\r\n * @CSSifyRule rule : host block\r\n * @CSSifyRule rule : header hPadding\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n//var pseudoSlotsStyles = require('src/UI/defs/extraStyles/pseudoSlot');\r\n\r\n\r\nvar treeBranchDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar branchStyles = [\n\n\t{\n\t\t\"selector\": \"header, span\",\n\t\t\"display\": \"inline-block\"\n\t},\n\t{\n\t\t\"selector\": \"[hidden]\",\n\t\t\"visibility\": \"hidden\"\n\t},\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"display\": \"block\",\n\t\t\"marginLeft\": \"34px\",\n\t\t\"overflow\": \"hidden\",\n\t\t\"boxSizing\": \"border-box\"\n\t},\n\t{\n\t\t\"selector\": \":host-context(folded-tree)\",\n\t\t\"marginLeft\": \"0\"\n\t},\n\t{\n\t\t\"selector\": \":host(:not([expanded]))\",\n\t\t\"height\": \"24px\"\n\t},\n\t{\n\t\t\"selector\": \"header\",\n\t\t\"padding\": \"0 7px\"\n\t},\n\t{\n\t\t\"selector\": \"span.json-type, span.bracket\",\n\t\t\"fontSize\": \"12px\",\n\t\t\"padding\": \"0px 1px\",\n\t\t\"cursor\": \"pointer\"\n\t},\n\t{\n\t\t\"selector\": \"header:hover span.bracket\"\n\t},\n\t{\n\t\t\"selector\": \"header[selected] span.bracket\"\n\t},\n\t{\n\t\t\"selector\": \"header[selected], header[selected] span.json-type\",\n\t\t\"backgroundColor\": \"#EFEFEF\"\n\t},\n\t{\n\t\t\"selector\": \"header[selected], header[selected][role]\",\n\t\t\"margin\": \"0px 0px -2px 0px\",\n\t\t\"border\": \"1px dashed #999\"\n\t},\n\t{\n\t\t\"selector\": \"header[selected] .icofont-box:before\",\n\t\t\"color\": \"#777\"\n\t},\n\t{\n\t\t\"display\": \"inline-block\",\n\t\t\"minWidth\": \"18px\",\n\t\t\"maxWidth\": \"18px\",\n\t\t\"maxHeight\": \"24px\",\n\t\t\"fontFamily\": \"Glyphicons Halflings\",\n\t\t\"fontSize\": \"12px\",\n\t\t\"marginRight\": \"-5px\",\n\t\t\"padding\": \"3px\",\n\t\t\"cursor\": \"pointer\",\n\t\t\"selector\": \".glyphicon\"\n\t},\n\t{\n\t\t\"selector\": \".glyphicon:nth-child(2)\",\n\t\t\"marginLeft\": \"-18px\"\n\t},\n\t{\n\t\t\"selector\": \".glyphicon-arrow-right:before\",\n\t\t\"content\": \"'\\\\e080'\"\n\t},\n\t{\n\t\t\"selector\": \".glyphicon-arrow-down:before\",\n\t\t\"content\": \"'\\\\e114'\",\n\t\t\"color\": \"#ffa500\"\n\t},\n\t{\n\t\t\"selector\": \"span.icofont-box, span.icofont-listing-number\",\n\t\t\"fontFamily\": \"IcoFont\",\n\t\t\"fontSize\": \"12px\",\n\t\t\"maxWidth\": \"24px\",\n\t\t\"padding\": \"0px 4px 0 0px\",\n\t\t\"transform\": \"translateY(-4px)\"\n\t},\n\t{\n\t\t\"selector\": \"span.icofont-box[hidden], span.icofont-listing-number[hidden]\",\n\t\t\"display\": \"none\"\n\t},\n\t{\n\t\t\"selector\": \".icofont-box:before\",\n\t\t\"content\": \"'\\\\eec1'\"\n\t},\n\t{\n\t\t\"selector\": \".icofont-listing-number:before\",\n\t\t\"content\": \"'\\\\ef76'\"\n\t},\n\t{\n\t\t\"selector\": \"span.icofont-box:hover:before\",\n\t\t\"content\": \"'\\\\eec2'\"\n\t},\n\t{\n\t\t\"selector\": \"span.icofont-listing-number:hover:before\",\n\t\t\"content\": \"'\\\\eec2'\"\n\t},\n\t{\n\t\t\"selector\": \":host(:not([expanded])) span.icofont-box:before\",\n\t\t\"content\": \"'\\\\eec2'\"\n\t},\n\t{\n\t\t\"selector\": \":host(:not([expanded])) span.icofont-listing-number:before\",\n\t\t\"content\": \"'\\\\eec2'\"\n\t}\n\n\t];\n\tvar branchStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AbstractTreeBranchStyles'\n\t}\r\n\t\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'CompoundComponent',\r\n\t\t\tnodeName : 'tree-branch',\r\n\t\t\tstates : [\r\n\t\t\t\t{expanded : undefined}\r\n\t\t\t],\r\n\t\t\tprops : [\r\n\t\t\t\t{headerTitle : undefined},\r\n\t\t\t\t{displayedas : undefined},\r\n\t\t\t\t{selected : undefined},\r\n\t\t\t\t{branchintree : undefined},\r\n\t\t\t\t{nodeintree : undefined}\r\n\t\t\t],\r\n\t\t\treactOnParent : [\r\n\t\t\t\t{\r\n\t\t\t\t\tfrom : 'selected',\r\n\t\t\t\t\tto : 'selected'\r\n\t\t\t\t}\r\n\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\tbranchStylesUseCache.use ? branchStylesUseCache.nameInCache : null,\n\t\t\t\t\t\tbranchStyles\n\t\t\t\t\t)\r\n\t\t}),\r\n\t\tmembers : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'VaritextButtonWithPictoFirst',\r\n\t\t\t\tnodeName : 'header',\r\n\t\t\t\t// this is a big hack of shit (should be an attribute, but not... should be a \"DOM\" attribute... -> setAttribute(). TODO: fix after re-implementation of _arias&glyphs)\r\n\t\t\t\tstates : [\r\n\t\t\t\t\t{role : \"heading\"},\r\n\t\t\t\t\t{expanded : undefined},\r\n\t\t\t\t\t{displayedas : undefined},\r\n\t\t\t\t\t{selected : undefined},\r\n\t\t\t\t\t{branchintree : undefined},\r\n\t\t\t\t\t{nodeintree : undefined}\r\n\t\t\t\t],\r\n\t\t\t\treactOnParent : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'headerTitle',\r\n\t\t\t\t\t\tto : 'content'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'selected',\r\n\t\t\t\t\t\tcbOnly : true,\r\n\t\t\t\t\t\tsubscribe : function(value) {this.streams.selected.value = value === this._UID ? 'selected' : null;}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'expanded',\r\n\t\t\t\t\t\tto : 'expanded'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'displayedas',\r\n\t\t\t\t\t\tto : 'displayedas'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'branchintree',\r\n\t\t\t\t\t\tto : 'branchintree'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfrom : 'nodeintree',\r\n\t\t\t\t\t\tto : 'nodeintree'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\ntreeBranchDef.__factory_name = 'treeBranchDef';\r\nmodule.exports = treeBranchDef;",
    "\"use strict\";\n/**\r\n * @def LazySlottedCompoundComponent\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : LazySlottedCompoundComponentHost/true\r\n * @CSSify styleName : LazySlottedCompoundComponentPseudoslot/false\r\n * @CSSifyTheme themeName : basic-light\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\n\r\n\r\nvar lazySlottedComponentDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\t\r\n\t\r\n\tvar slotDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'ComponentWithView',\r\n\t\t\tnodeName : 'pseudo-slot',\r\n\t\t\tstates : [\r\n\t\t\t\t{'slot-id' : undefined},\r\n\t\t\t\t{'is-embedded' : undefined},\r\n\t\t\t\t{'position' : undefined}\r\n\t\t\t\t\r\n\t\t\t],\r\n\t\t\tsubscribeOnChild : [\r\n\t\t\t\t{\r\n\t\t\t\t\ton : 'update',\r\n\t\t\t\t\tsubscribe : function(e) {\r\n\t\t\t\t\t\tif (e.bubble)\r\n\t\t\t\t\t\t\tthis.trigger('update', e.data, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]/**@CSSify Style componentStyle : LazySlottedCompoundComponentPseudoslot */\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\t\r\n\t\r\n\t/*\r\n\t * Build the schematic-def of the component: \r\n\t * \r\n\t * this one is pretty special...\r\n\t * \r\n\t * This def is the base-def for any LazySlottedComponent instance\r\n\t * But, CAUTION: In order to implement different -individual- defs for the slots (and/or being able to -reduce- the slots count, if needed, without breaking the execution)\r\n\t * \t\t=> we have to take into account that there is a !second! def obj, which is injected via a closure directly into the LazySlottedComponent ctor\r\n\t * \t\t=> so the LazySlottedComponent must then be extended through prototypal inheritance, and :\r\n\t * \t\t\t-*- eventually, his slotsDef property overridden (pre-defined) in the derived ctor\r\n\t * \t\t\t-*- eventually, his slotsCount property {number} also overridden (pre-defined) in the derived ctor\r\n\t * \t\t\t-*- and if the type of the slots must be different than \"Dataset\", his affectSlots() method must be overridden\r\n\t */\r\n\tvar moduleDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n//\t\t\ttype : 'ComposedCompnent', \t\t\t\t// this is implicit, as we call the CompoundComponent ctor in the TabPanel ctor\r\n\t\t\tnodeName : 'smart-tabs'/**@CSSifyStyle componentStyle : LazySlottedCompoundComponentHost */\r\n\t\t}),\r\n\t\tlists : [\r\n\t\t\tTypeManager.createComponentDef({\r\n\t\t\t\ttype : 'ComponentList',\r\n\t\t\t\ttemplate : slotDef\r\n\t\t\t})\r\n\t\t]\r\n\t}, null, 'rootOnly');\r\n\t\r\n\treturn moduleDef;\r\n}\r\n\r\nlazySlottedComponentDef.__factory_name = 'lazySlottedComponentDef';\r\nmodule.exports = lazySlottedComponentDef;",
    "\"use strict\";\n/**\r\n * @def LazyHostComponentSlots\r\n * @isGroup false\r\n * \r\n * @CSSify styleName : LazySlottedCompoundComponentTabpanel/false\r\n * @CSSifyTheme themeName : basic-light\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar lazySlottedComponentSlotsDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\r\n\t\r\n\tvar headerDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'VaritextButton',\r\n\t\t\tnodeName : 'header',\r\n\t\t\t// this is a big hack of shit (should be an attribute, but not... should be a \"DOM\" attribute... -> setAttribute(). TODO: fix after re-implementation of _arias&glyphs)\r\n\t\t\tstates : [\r\n\t\t\t\t{role : \"heading\"},\r\n\t\t\t\t{highlighted : undefined}\r\n\t\t\t],\r\n\t\t\tprops : [\r\n\t\t\t\t{headerTitle : undefined}\r\n\t\t\t],\r\n\t\t\treactOnSelf : [\r\n\t\t\t\t{\r\n\t\t\t\t\tfrom : 'headerTitle',\r\n\t\t\t\t\tto : 'content'\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\t\r\n\tvar sectionDef = TypeManager.createComponentDef({\r\n\t\thost : TypeManager.createComponentDef({\r\n\t\t\ttype : 'ComponentWithView',\r\n\t\t\tnodeName : 'tab-panel'/**@CSSifyStyle componentStyle : LazySlottedCompoundComponentTabpanel */\r\n\t\t}, null, 'hostOnly')\r\n\t}, null, 'rootOnly');\r\n\t\r\n\t\r\n\t\r\n\treturn {\r\n\t\theaderDef : headerDef,\r\n\t\tsectionDef : sectionDef\r\n\t};\r\n}\r\n\r\nlazySlottedComponentSlotsDef.__factory_name = 'lazySlottedComponentDef';\r\nmodule.exports = lazySlottedComponentSlotsDef;",
    "\"use strict\";\n/**\r\n * @def treeLeafTemplate\r\n * @isGroup true\r\n * \r\n * @CSSify styleName : AbstractTreeLeaf/true\r\n * @CSSifyRule rule : host block\r\n * @CSSifyRule rule : div_2ndChild pointer\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\nvar CreateStyle = require('src/core/GenericStyleConstructor');\r\n\r\n\r\nvar treeLeafTemplateDef = function(uniqueID, options, model) {\r\n\t/**@CSSify DEBUG */\t\t// DEBUG must be stuck (RED and bold) to trigger debug infos\r\n\t\t\r\n\t// Some CSS stuff (styles are directly injected in the main def below)\r\n\t/**@CSSifySlots placeholder */\n\n\tvar leafStyles = [\n\n\t{\n\t\t\"selector\": \"[hidden]\",\n\t\t\"visibility\": \"hidden\"\n\t},\n\t{\n\t\t\"selector\": \":host\",\n\t\t\"marginLeft\": \"57px\",\n\t\t\"boxSizing\": \"border-box\"\n\t},\n\t{\n\t\t\"selector\": \"div:nth-child(3)\"\n\t},\n\t{\n\t\t\"selector\": \"div\",\n\t\t\"display\": \"inline-block\"\n\t},\n\t{\n\t\t\"selector\": \":host(:hover) div:nth-child(3):before, :host(:hover) div:nth-child(3):after\"\n\t},\n\t{\n\t\t\"selector\": \":host([selected]) div:nth-child(3)\",\n\t\t\"fontWeight\": \"bold\"\n\t}\n\n\t];\n\tvar leafStylesUseCache = {\n\t\tuse : true,\n\t\tnameInCache : 'AbstractTreeLeafStyles'\n\t}\r\n\t\r\n\tvar secondSlotDef = TypeManager.createComponentDef({\r\n\t\t\ttype : 'KeyValuePairComponent',\r\n\t\t\tnodeName : 'key-value-pair',\r\n\t\t\tstates : [\r\n\t\t\t\t{selected : undefined}\r\n\t\t\t],\r\n\t\t\treactOnParent : [\r\n\t\t\t\t{\r\n\t\t\t\t\tfrom : 'selected',\r\n\t\t\t\t\tcbOnly : true,\r\n\t\t\t\t\tsubscribe : function(value) {this.streams.selected.value = value === this._UID ? 'selected' : null;}\r\n\t\t\t\t}\r\n\t\t\t],\n\t\t\t\tsWrapper : CreateStyle(\n\t\t\t\t\t\tleafStylesUseCache.use ? leafStylesUseCache.nameInCache : null,\n\t\t\t\t\t\tleafStyles\n\t\t\t\t\t)\r\n\t\t}, 'KeyValuePair');\r\n\t\r\n\t\r\n\treturn secondSlotDef;\r\n}\r\n\r\ntreeLeafTemplateDef.__factory_name = 'treeLeafTemplateDef';\r\nmodule.exports = treeLeafTemplateDef;",
    "\"use strict\";\n/**\r\n * @bootstraper AppIgniter\r\n * @bootstraper ListInjector\r\n */\r\n\r\nconst appConstants = require('src/appLauncher/appLauncher');\r\nconst ElementCreator = require('src/core/GenericElementConstructor');\r\nconst TypeManager = require('src/core/TypeManager');\r\nconst TemplateFactory = require('src/core/TemplateFactory');\r\nconst Registries = require('src/core/Registries');\r\nconst CoreTypes = require('src/core/CoreTypes');\r\nconst Component = require('src/core/Component');\r\nconst CompoundComponent = require('src/core/CompoundComponent');\r\nconst componentTypes = CompoundComponent.componentTypes;\r\nconst coreComponents = CompoundComponent.coreComponents;\r\n\r\nconst elementDecorator_OffsetProp = require('src/core/elementDecorator_Offset');\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor Ignition : this is the abstract class\r\n */\r\nconst Ignition = function(definition, containerIdOrContainerNode) {}\r\nIgnition.prototype = {};\r\nIgnition.prototype.objectType = 'Ignition'; \r\n\r\nIgnition.prototype.decorateComponentsThroughDefinitionsCache = function(listDef) {\r\n//\tconsole.log('decorateComponentsThroughDefinitionsCache');\r\n\t// instanciate DOM objects through cloning : DOM attributes are always static\r\n\t// \t\t\t\t\t=> iterate on the \"views\" register\r\n\tif (typeof document !== 'undefined' && typeof document.ownerDocument !== 'undefined')\r\n\t\tthis.instanciateDOM();\r\n\t\r\n\t// instanciate streams\r\n\tthis.instanciateStreams();\r\n\t\r\n\t// handle reactivity and event subscription : each component holds a \"unique ID from the def\" => retrieve queries from the \"reactivity\" register\r\n\tthis.handleReactivityAndEvents();\r\n\t\r\n\t// decorate DOM Objects with :\r\n\t// * \t\t\t\t\t\t- streams\r\n\t// * \t\t\t\t\t\t- reflexive props\r\n\t// assign reflectedObj to streams\r\n\tthis.lateEventBindingAndBidirectionalReflection(listDef);\r\n\r\n\tthis.cleanRegisters();\r\n}\r\n\r\n\r\n\r\n/*\r\n * INITIALIZATION CHAPTER : instanciate DOM\r\n * \r\n */\r\nIgnition.prototype.instanciateDOM = function() {\r\n\tvar rootNodeIfDOM,\r\n\t\tviews = Registries.viewsRegistry,\r\n\t\tnodes = Registries.nodesRegistry.cache,\r\n\t\tattributesCache = Registries.caches.attributes.cache,\r\n\t\tattributes,\r\n\t\talreadyCloned = false,\r\n\t\tcloneMother,\r\n\t\teffectiveViewAPI,\r\n\t\tmasterNode;\r\n\t\r\n\tviews.forEach(function(view, key) {\r\n\t\tattributes = attributesCache[view._defUID];\r\n\t\teffectiveViewAPI = view.currentViewAPI;\r\n\t\t\r\n//\t\tconsole.log(view);\r\n\t\tif (nodes[view._defUID].cloneMother) {\r\n\t\t\tview.callCurrentViewAPI('setMasterNode', nodes[view._defUID].cloneMother.cloneNode(true));\r\n\t\t\tObject.assign(view.callCurrentViewAPI('getMasterNode'), elementDecorator_OffsetProp);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnodes[view._defUID].cloneMother = ElementCreator.createElement(nodes[view._defUID].nodeName, nodes[view._defUID].isCustomElem, Registries.caches.states.cache[view._defUID]);\r\n\t\t\t\r\n\t\t\talreadyCloned = false;\r\n\t\t\tcloneMother = nodes[view._defUID].cloneMother;\r\n\t\t\tattributes.forEach(function(attrObject) {\r\n\t\t\t\tif (attrObject.getName().indexOf('aria') === 0)\r\n\t\t\t\t\tcloneMother.setAria(attrObject.getName(), attrObject.getValue());\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (attrObject.getName() === 'textContent' && view.currentViewAPI.isShadowHost)\r\n\t\t\t\t\t\tconsole.warn('DOM rendering shall fail: textContent on a DOM custom-element shall be appended outside of the shadowRoot. nodeName is ' + view.currentViewAPI.nodeName + ' & _defUID is ' + view._defUID + '. Consider using a reactive prop instead. For example, the SimpleText Component can handle that case.')\r\n\t\t\t\t\tcloneMother[attrObject.getName()] = attrObject.getValue();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tview.callCurrentViewAPI('setMasterNode', cloneMother.cloneNode(true));\r\n\t\t\tObject.assign(view.callCurrentViewAPI('getMasterNode'), elementDecorator_OffsetProp);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tif (view._parent)\r\n\t\t\tview.callCurrentViewAPI('getMasterNode')._component = view._parent;\r\n\t\t\r\n\t\t// Connect DOM objects \r\n\t\tif (view._sWrapperUID) {\r\n\t\t\tif (Object.prototype.toString.call(appConstants.getUID(view._sWrapperUID)) === '[object Object]') {\r\n\t\t\t\tview.styleHook.s = appConstants.getUID(view._sWrapperUID).clone();\r\n\t\t\t\t\r\n\t\t\t\tif (view.sOverride) {\r\n\t\t\t\t\tview.styleHook.s.overrideStyles(view.sOverride);\r\n\t\t\t\t}\r\n\t\t\t\tview.styleHook.s.shouldSerializeAll();\r\n\t\t\t\t\r\n\t\t\t\t// For style overrides and custom def objects.\r\n\t\t\t\t// the iframe is -no- shadow root => get the first app-root encountered as parent node\r\n\t\t\t\tif (view.currentViewAPI.nodeName === 'iframe') {\r\n\t\t\t\t\tif (rootNodeIfDOM.shadowRoot)\r\n\t\t\t\t\t\trootNodeIfDOM.shadowRoot.prepend(view.styleHook.s.getStyleNode());\r\n\t\t\t\t\t// FIXME: this should be of no use: crappy fallback\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdocument.body.prepend(view.styleHook.s.getStyleNode());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tview.callCurrentViewAPI('getWrappingNode').append(view.styleHook.s.getStyleNode());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(view.parentView && typeof view.parentView.callCurrentViewAPI !== 'function')\r\n\t\t\tconsole.warn('unknown rendering error : view.parentView.callCurrentViewAPI is not a function', view.parentView);\r\n\t\r\n\t\tif (view.parentView && view.parentView.callCurrentViewAPI('getWrappingNode')) {\r\n\t\t\tview.parentView.callCurrentViewAPI('getWrappingNode').append(view.callCurrentViewAPI('getMasterNode'));\r\n\t\t}\r\n\t\t\r\n\t\t// This is quite risky, as for now rootView is instanciated first,\r\n\t\t// but do we have any guarantee this will always be the case ?\r\n\t\tif (!rootNodeIfDOM && view.currentViewAPI.nodeName === 'app-root')\r\n\t\t\trootNodeIfDOM = view.callCurrentViewAPI('getMasterNode');\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n * INITIALIZATION CHAPTER : instanciate Streams\r\n * \r\n */\r\nIgnition.prototype.instanciateStreams = function() {\r\n\tvar typedComponentRegister = Registries.typedHostsRegistry.cache;\r\n\tvar streams = Registries.caches.streams.cache;\r\n\tfor (let defUID in typedComponentRegister) {\r\n\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\tstreams[defUID].forEach(function(stateObj) {\r\n//\t\t\t\tconsole.log(stateObj.getName(), component)\r\n\t\t\t\tcomponent.streams[stateObj.getName()] = new CoreTypes.Stream(stateObj.getName(), stateObj.getValue(), null, null, null, component);\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n * INITIALIZATION CHAPTER : handle reactivity & events\r\n * \r\n */\r\nIgnition.prototype.handleReactivityAndEvents = function() {\r\n\tvar typedComponentRegister = Registries.typedHostsRegistry.cache;\r\n\tvar reactivityQueries, eventQueries, bindingHandler, component;\r\n\t\r\n\tTemplateFactory.reactivityQueries.forEach(function(subscriptionType) {\r\n\t\tbindingHandler = subscriptionType + 'Binding';\r\n\t\t\r\n\t\tfor (let defUID in typedComponentRegister) {\r\n\t\t\treactivityQueries = Registries.caches[subscriptionType].cache[defUID];\r\n\t\t\t\r\n\t\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\t\t// DEBUG HACK: to stop the infinite recursion we had in the DesignSystemManager\r\n//\t\t\t\tif (listDef && (component._children.length >= 3 || reactivityQueries.length > 3)) {\t//typedComponentRegister[defUID].listItemMembersCount\r\n////\t\t\t\t\tconsole.log(reactivityQueries, component);\r\n//\t\t\t\t\treturn;\r\n//\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!reactivityQueries.length)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (component._parent && subscriptionType === 'reactOnParent')\r\n\t\t\t\t\tcomponent[bindingHandler](reactivityQueries, component._parent, subscriptionType);\r\n\t\t\t\telse if (subscriptionType === 'reactOnSelf') {\r\n\t\t\t\t\tcomponent[bindingHandler](reactivityQueries, component._parent, subscriptionType);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t});\r\n\tTemplateFactory.eventQueries.forEach(function(subscriptionType) {\r\n\t\t\r\n\t\tfor (let defUID in typedComponentRegister) {\r\n\t\t\teventQueries = Registries.caches[subscriptionType].cache[defUID];\r\n\t\t\t\r\n\t\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\t\t\r\n\t\t\t\tif (!eventQueries.length)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tswitch(subscriptionType) {\r\n\t\t\t\t\tcase 'subscribeOnParent' :\r\n\t\t\t\t\t\tif (component._parent)\r\n\t\t\t\t\t\t\tcomponent.handleEventSubscriptions(subscriptionType, eventQueries, component._parent);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'subscribeOnChild' :\r\n\t\t\t\t\t\tcomponent.handleEventSubscriptions(subscriptionType, eventQueries);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'subscribeOnSelf' :\r\n\t\t\t\t\t\tcomponent.handleEventSubscriptions(subscriptionType, eventQueries);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n * INITIALIZATION CHAPTER : lateEventBindingAndBidirectionalReflection\r\n * \r\n */\r\nIgnition.prototype.lateEventBindingAndBidirectionalReflection = function(listDef) {\r\n\tif (!listDef)\r\n\t\tthis.streamsBidirectionalReflectionBlank();\r\n\telse\r\n\t\tthis.streamsBidirectionalReflectionFilled(listDef);\r\n\t\r\n}\r\nIgnition.prototype.streamsBidirectionalReflectionBlank = function() {\r\n\tvar typedComponentRegister = Registries.typedHostsRegistry.cache;\r\n\r\n\tfor (let defUID in typedComponentRegister) {\r\n\r\n\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\tif (!component.view)\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tif (component instanceof Component.ComponentWithHooks)\r\n\t\t\t\tcomponent.registerEvents();\r\n\r\n\t\t\tthis.defineStreamsBidirectionalReflection(defUID, component);\r\n\t\t}, this);\r\n\t}\r\n}\r\nIgnition.prototype.streamsBidirectionalReflectionFilled = function(listDef) {\r\n\tvar typedComponentRegister = Registries.typedHostsRegistry.cache;\r\n\tfor (let defUID in typedComponentRegister) {\r\n\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\tif (!component.view)\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\t// TMP Hack: call artificial \"hook\" on LazySlottedCompoundComponent although it's not a \"ComponentWithHooks\"\r\n\t\t\t// (see LazySlottedCompoundComponent & ColorSamplerSetComponent)\r\n\t\t\tif (component instanceof Component.ComponentWithHooks || component instanceof coreComponents.LazySlottedCompoundComponent)\r\n\t\t\t\tcomponent.registerEvents();\r\n\r\n\t\t\tthis.defineStreamsBidirectionalReflection(defUID, component);\r\n\t\t}, this);\r\n\t}\r\n\t\r\n\tvar dataStoreKey;\r\n\tfor (let defUID in typedComponentRegister) {\r\n\t\ttypedComponentRegister[defUID].forEach(function(component) {\r\n\t\t\tif (typeof (dataStoreKey = Registries.dataStoreRegistry.getItem(component._UID)) !== 'undefined')\r\n\t\t\t\tthis.handleReflectionOnModel.call(component, listDef.reflectOnModel, listDef.augmentModel, listDef.each[dataStoreKey]);\r\n\t\t}, this);\r\n\t}\r\n}\r\nIgnition.prototype.defineStreamsBidirectionalReflection = function(defUID, component) {\r\n\t// DOM objects extension : we need 2 custom props to offer a rich \"reactive\" experience\r\n\t// The view's \"hosts\" gains access here to the streams of the component.\r\n\t// It's needed if we want to allow access to the reactivity mechanisms from outside of the framework :\r\n\t// \t\t-> any change to an attribute or a DOM prop shall trigger a full update of the component, following the defined reactivity path (by def obj)\r\n\t// And it may be usefull in some other \"barely legal\" cases... (for example in \"hacky\" implementations that attach listeners directly to the DOM)\r\n\tcomponent.view.getMasterNode().streams = component.streams;\r\n\t\r\n\t// And we reflect the View on each State Stream : \r\n\t// \t\t-> it's a nice & implicit way to declare in the def obj that the reactivity-chain targets an \"exposed\" state\r\n\t// And we define for each State a special prop on the view, that reflects the state of the component\r\n\t// \r\n\t// -*- Regarding the word \"implicit\" : these \"kind of\" tricks are strongly motivated by the philosophy of the DOM custom elements :\r\n\t//\t\t\t=> the global state of the component is held by an attribute on the node : styling uses then \"state dependant\" selectors (through CSS or anything you could use)\r\n\t//\t\t\t=> this reflection mechanism is the second step needed to achieve the goal we've mentioned above,\r\n\t// \t\t\t   say that the reactivity-chain is exposed for anyone to have access to the component's magic, even from outside of the framework    \r\n\tRegistries.caches.states.cache[defUID].forEach(function(stateObj) {\r\n\t\tthis.reflectViewOnAStateStream(component, stateObj);\r\n\t}, this);\r\n}\r\nIgnition.prototype.reflectViewOnAStateStream = function(component, stateObj) {\r\n\t// assign reflectedObj to streams\r\n\tcomponent.streams[stateObj.getName()].acquireHostedInterface(component.view.currentViewAPI.hostedInterface);\r\n\t\r\n\t// set default states\r\n\tif (!component.view.isCustomElem) {\r\n\t\t// define reflexive props on view\r\n\t\tElementCreator.propGetterSetter.call(component.view.getMasterNode(), stateObj.getName());\r\n//\t\tcomponent.streams[stateObj.getName()].value = stateObj.getValue();\r\n\t}\r\n}\r\nIgnition.prototype.handleReflectionOnModel = function(reflectOnModel, augmentModel, item) {\r\n\t// states and props may be automatically reflected on the component and so here on the host of the (Composed)Component (depending on the fact they're declared on the def), but not on the model : define that here\r\n\t//\t\tupdate the model (assigning a getter & setter) in order to get the component's props reflected on the model\r\n\t// else\r\n\t// \t\tupdate the component's reactive props without reflection on the model\r\n\t\r\n\tif (reflectOnModel) {\r\n\t\tif (augmentModel) {\r\n\t\t\tfor (var s in this.streams) {\r\n\t\t\t\titem[this.streams[s].name] = this.streams[s].reflect(this.streams[s].name, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor (var prop in item) {\r\n\t\t\t\tif (!this.streams[prop])\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\titem[prop] = this.streams[prop].reflect(prop, item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tfor (var prop in item) {\r\n\t\t\tif (!this.streams[prop])\r\n\t\t\t\tcontinue;\r\n\t\t\tthis.streams[prop].value = item[prop];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nIgnition.prototype.cleanRegisters = function() {\r\n\tRegistries.viewsRegistry.length = 0;\r\n\tRegistries.typedHostsRegistry.reset();\t\r\n}\r\n\r\n\r\n/**\r\n * @method Ignition.prototype.getUpperWrappingComponentOutsideAppScope\r\n */\r\n\r\nIgnition.prototype.getWrappingComponentOutsideAppScope = function(selector) {\r\n\tif (typeof window.parent === 'undefined') {\r\n\t\tconsole.warn('AppIgnition.getWrappingComponentOutsideAppScope: can only be called from insed an IFrame (no parent window found). Returning...');\r\n\t\treturn;\r\n\t}\r\n\telse if (window.parent.document.querySelector('app-root').shadowRoot === null) {\r\n\t\tconsole.log(window.parent.document.querySelector('app-root'));\r\n\t\tconsole.error('AppIgnition.getWrappingComponentOutsideAppScope: the DOMelem named app-root has no shadowRoot. Returning...');\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tvar matchingFrameElement;\r\n\tif ((matchingFrameElement = window.parent.document.querySelector('app-root').shadowRoot.querySelector(selector))) {\r\n\t\treturn matchingFrameElement._component;\r\n\t}\r\n\telse if (!selector){\r\n\t\tconsole.error('AppIgnition helper method for IFrames: getting a ref on a component outside of the app\\'s scope requires passing a DOM selector');\r\n\t}\r\n\telse {\r\n\t\tconsole.error('AppIgnition helper method for IFrames: no matching IFrame element for the given selector');\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor IgnitionFromDef\r\n */\r\nconst IgnitionFromDef = function(definition, parentView, parent) {\r\n\t\r\n\tvar type = definition.getHostDef().getType() || (definition.getGroupHostDef() && definition.getGroupHostDef().getType());\r\n\tif (type in componentTypes) {\r\n\t\tvar mainComponent = new componentTypes[type](definition, parentView, parent);\r\n\t\tthis.decorateComponentsThroughDefinitionsCache();\r\n\t\treturn mainComponent;\r\n\t}\r\n\telse\r\n\t\tconsole.error('IgnitionFromDef : unknown component type found in the definition : type is ' + type);\r\n}\r\nIgnitionFromDef.prototype = Object.create(Ignition.prototype);\r\nIgnitionFromDef.prototype.objectType = 'IgnitionFromDef'; \r\n\r\n\r\n\r\n/**\r\n * @constructor IgnitionToComposed\r\n */\r\nconst IgnitionToCompound = function(definition, parentView) {\r\n\t\r\n\tvar mainComponent = new CompoundComponent(definition, parentView); \r\n\tthis.decorateComponentsThroughDefinitionsCache();\r\n\treturn mainComponent;\r\n}\r\nIgnitionToCompound.prototype = Object.create(Ignition.prototype);\r\nIgnitionToCompound.prototype.objectType = 'IgnitionToCompound'; \r\n\r\n\r\n\r\n/**\r\n * @constructor IgnitionToExtensible\r\n */\r\nconst IgnitionToExtensible = function(definition, containerIdOrContainerNode) {\r\n\t\r\n\tvar mainComponent = new componentTypes.SinglePassExtensibleCompoundComponent(definition, containerIdOrContainerNode); \r\n\tthis.decorateComponentsThroughDefinitionsCache();\r\n\treturn mainComponent;\r\n}\r\nIgnitionToExtensible.prototype = Object.create(Ignition.prototype);\r\nIgnitionToExtensible.prototype.objectType = 'IgnitionToExtensible'; \r\n\r\n\r\n/**\r\n * @constructor DelayedInit\r\n * @param {String} containerId : A DOM selector, can be body or an id selector without the #\r\n * @param {Component} component : the root component to be injected in the DOM\r\n * @param {HierarchicalDefinition} componentListHostDef : an optional definition for a list of components to be instanciaded /!\\ RESEVERD for the Dataset Type\r\n */\r\nconst DelayedDecoration = function(containerId, component, componentListHostDef) {\r\n\t\r\n\tthis.decorateComponentsThroughDefinitionsCache(componentListHostDef);\r\n\t\r\n\tif (componentListHostDef)\r\n\t\tcomponentListHostDef.each.length = 0;\r\n\t\r\n\tif (typeof containerId !== 'string')\r\n\t\treturn;\r\n\r\n\tdocument.querySelector(containerId !== 'body' ? '#' + containerId : containerId).appendChild(component.view.getMasterNode());\r\n}\r\nDelayedDecoration.prototype = Object.create(Ignition.prototype);\r\nDelayedDecoration.prototype.objectType = 'DelayedDecoration';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @utility renderDOM\r\n * @param {String} containerSelector : A DOM selector, can be body or an id selector without the #\r\n * @param {Component} component : the root component to be injected in the DOM\r\n * @param {HierarchicalDefinition} componentListHostDef : an optional definition for a list of components to be instanciaded /!\\ RESEVERD for the Dataset Type\r\n */\r\nconst renderDOM = function(containerSelector, component, componentListHostDef) {\r\n\tconst app = new Ignition();\r\n\tapp.decorateComponentsThroughDefinitionsCache(componentListHostDef);\r\n\t\r\n\tif (componentListHostDef)\r\n\t\tcomponentListHostDef.each.length = 0;\r\n\t\r\n\tif (typeof containerSelector !== 'string')\r\n\t\treturn component;\r\n\t\r\n\tdocument.querySelector(containerSelector).appendChild(component.view.getMasterNode());\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor RootView\r\n */\r\nconst createRootViewComponentHostDef = require('src/coreComponents/RootViewComponent/coreComponentDefs/RootViewComponentHostDef');\r\n\r\nconst RootView = function(igniterForChild, preparePage, noAppend) {\r\n\tvar component;\r\n\tif (preparePage)\r\n\t\tcomponent = new componentTypes.RootViewComponent(TypeManager.createComponentDef(createRootViewComponentHostDef().moduleDef));\r\n\telse\r\n\t\tcomponent = new componentTypes.RootViewComponent(TypeManager.createComponentDef(createRootViewComponentHostDef().minimalModuleDef));\r\n\t\r\n\tif (igniterForChild && typeof igniterForChild.init === 'function') {\r\n\t\tigniterForChild.init(component.view, component);\r\n\t}\r\n\t\r\n\t// Render in all sitations as we may want a root view whithout children when beginning the creation of an app\r\n\tcomponent.render();\r\n\t\r\n\t// HACK: before we generalize the API for style objects, there's only the DOM...\r\n\t//\t\t=> don't try to append a node to the DOM if we're outside the browser\r\n\tif (typeof document === 'undefined' || typeof document.ownerDocument === 'undefined')\r\n\t\treturn component;\r\n\t\r\n\tif (!noAppend)\r\n\t\tdocument.querySelector('body').appendChild(component.view.getMasterNode());\r\n\treturn component;\r\n}\r\nRootView.prototype = Object.create(Ignition.prototype);\r\nRootView.prototype.objectType = 'RootView';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor List\r\n * This ctor is the effector of the ReactiveDataset\r\n * \t=> tight coupling = mandatory static inclusion in core (Dataset requires App).\r\n */\r\nconst List = function(definition, parent) {\r\n\tthis.create(definition, parent);\r\n}\r\nList.prototype = Object.create(Ignition.prototype);\r\nList.prototype.objectType = 'List'; \r\n\r\nList.prototype.create = function(definition, parent) {\r\n\tnew coreComponents.ComponentList(definition, parent.view, parent);\r\n\tthis.decorateComponentsThroughDefinitionsCache(definition.getHostDef());\r\n\tdefinition.getHostDef().each = [];\r\n}\r\n\r\nconst App = {\r\n\t\tcomponentTypes : componentTypes,\r\n\t\tcoreComponents : coreComponents,\r\n\t\tRootView : RootView,\r\n\t\tIgnitionToCompound : IgnitionToCompound,\r\n\t\tIgnitionFromDef : IgnitionFromDef,\r\n\t\tIgnitionToExtensible : IgnitionToExtensible,\r\n\t\tDelayedDecoration : DelayedDecoration,\r\n\t\trenderDOM : renderDOM,\r\n\t\tList : List,\r\n\t\tdecorateComponentsThroughDefinitionsCache : IgnitionFromDef.prototype.decorateComponentsThroughDefinitionsCache\r\n}\r\n\r\nmodule.exports = App;",
    "\"use strict\";\n/**\r\n * constructor BinarySchemaFactory\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar BinarySlice = require('src/core/BinarySlice');\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar BinarySchemaFactory = function(name, propsList, sizes) {\r\n\t\r\n\tif (!BinarySchemaFactory.schemas[name]) {\r\n\t\tvar objectSize = 0;\r\n\t\tpropsList.forEach(function(propName, key) {\r\n\t\t\tobjectSize += sizes[key];\r\n\t\t}, this);\r\n\t\t\t\r\n\t\tvar schema = function(propertiesList, sizesFromSchema) {\r\n\t\t\tvar size = 0;\r\n\t\t\tpropertiesList.forEach(function(propName, key) {\r\n\t\t\t\tthis[propName] = new BinarySlice(size, sizesFromSchema[key]);\r\n\t\t\t\tsize += sizesFromSchema[key];\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\t\r\n\t\tschema.prototype = {};\r\n\t\tObject.defineProperty(schema.prototype, 'objectType', {\r\n\t\t\tvalue : 'BinarySchema'\r\n\t\t});\r\n\t\tObject.defineProperty(schema.prototype, '_name', {\r\n\t\t\tvalue : name\r\n\t\t});\r\n\t\tObject.defineProperty(schema.prototype, 'size', {\r\n\t\t\tvalue : objectSize\r\n\t\t});\r\n\t\t\r\n\t\tBinarySchemaFactory.schemas[name] = schema;\r\n//\t\tconsole.log(new schema(propsList, sizes));\r\n\t\treturn new schema(propsList, sizes);\r\n\t}\r\n\telse\r\n\t\treturn new BinarySchemaFactory.schemas[name](propsList, sizes);\r\n}\r\n\r\nBinarySchemaFactory.prototype = {};\r\nBinarySchemaFactory.prototype.objectType = 'BinarySchemaFactory';\r\n\r\nBinarySchemaFactory.schemas = {};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = BinarySchemaFactory;",
    "\"use strict\";\n/**\r\n * @consructor BinarySlice\r\n */\r\n\r\n\r\n\r\n\r\n\r\nvar BinarySlice = function(start, length) {\r\n\tthis.start = start;\r\n\tthis.length= length;\r\n}\r\nBinarySlice.prototype = {};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = BinarySlice;",
    "\"use strict\";\n/**\r\n * @factory CachedTypes\r\n */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Node TYPE for typedCache\r\n */\r\nvar CachedNode = function(nodeName, isCustomElem) {\r\n\t\r\n\tthis.nodeName = nodeName;\r\n\tthis.isCustomElem = isCustomElem;\r\n\tthis.cloneMother = null;\r\n}\r\nCachedNode.prototype = {};\r\nObject.defineProperty(CachedNode.prototype, 'objectType', {\r\n\tvalue :  'CachedNode'\r\n});\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tCachedNode : CachedNode\r\n}",
    "\"use strict\";\n/**\r\n * @constructor Component\r\n */\r\n// @ts-nocheck\r\nconst CoreTypes = require('src/core/CoreTypes');\r\nconst TypeManager = require('src/core/TypeManager');\r\nconst TemplateFactory = require('src/core/TemplateFactory');\r\nconst Registries = require('src/core/Registries');\r\nconst ElementDecorator = require('src/core/elementDecorator_HSD');\r\n\r\nvar Logger = require('src/Error&Log/Logger');\r\n\r\n//var Geometry = require('src/tools/Geometry');\r\n\r\n\r\n/**\r\n * @constructor LoggingEventEmmitter\r\n */\r\nvar LoggingEventEmmitter = function(definition, parentView, parent) {\r\n\tCoreTypes.EventEmitter.call(this);\r\n\tthis.objectType = 'LoggingEventEmmitter';\r\n\t\r\n\tthis.logger = new Logger();\r\n\tthis.logger._currentlyCallingObjectType = Object.getPrototypeOf(this).objectType;\r\n\tthis.log = this.logger.log.bind(this.logger);\r\n}\r\nLoggingEventEmmitter.prototype = Object.create(CoreTypes.EventEmitter.prototype);\r\nLoggingEventEmmitter.prototype.objectType = 'LoggingEventEmmitter';\r\n\r\n\r\n\r\n/**\r\n * @constructor HierarchicalObject\r\n */\r\nvar HierarchicalObject = function(definition, parentView, parent) {\r\n\tLoggingEventEmmitter.call(this);\r\n\tthis.objectType = 'HierarchicalObject';\r\n\tthis._key;\r\n\t\r\n\tthis._parent = (parent && parent instanceof HierarchicalObject) \r\n\t\t? (parent.pushChild(this) && parent)\r\n\t\t: parentView instanceof CoreTypes.ComponentView && parentView._parent\r\n\t\t\t? (parentView._parent.pushChild(this) && parentView._parent) \r\n\t\t\t: null;\r\n\t\r\n\tthis._children = [];\r\n\tthis._fastAccessToChildren = {};\r\n}\r\nHierarchicalObject.prototype = Object.create(LoggingEventEmmitter.prototype);\r\nHierarchicalObject.prototype.objectType = 'HierarchicalObject';\r\n/**\r\n * @virtual\r\n */\r\nHierarchicalObject.prototype.onAddChild = function(child, atIndex) {} \t\t\t// virtual\r\n/**\r\n * @virtual\r\n */\r\nHierarchicalObject.prototype.onRemoveChild = function(child) {} \t\t\t\t// virtual\r\n\r\n/**\r\n * \r\n */\r\nHierarchicalObject.prototype.getFirstChild = function() {\r\n\treturn this._children[0];\r\n}\r\n\r\nHierarchicalObject.prototype.getChildAt = function(Idx) {\r\n\treturn this._children[Idx];\r\n}\r\n\r\nHierarchicalObject.prototype.getLastChild = function() {\r\n\treturn this._children[this._children.length - 1];\r\n}\r\n\r\n/**\r\n * \r\n */\r\nHierarchicalObject.prototype.storePathToChild = function(pathName, componentPath) {\r\n\tthis._fastAccessToChildren[pathName] = componentPath;\r\n}\r\n\r\nHierarchicalObject.prototype.getChildFromStoredPath = function(pathName) {\r\n\tvar pathToChild = this._fastAccessToChildren[pathName].slice(0);\r\n\treturn this.getChildFromPath(pathToChild);\r\n}\r\n\r\nHierarchicalObject.prototype.getChildFromPath = function(pathAsArray) {\r\n\tvar result = {\r\n\t\t\tchild : null\r\n\t\t};\r\n\tthis.traverseChildrenAlongPath(pathAsArray, result);\r\n\treturn result.child;\r\n}\r\n\r\nHierarchicalObject.prototype.traverseChildrenAlongPath = function(path, result) {\r\n\tif (path.length > 1) {\r\n\t\tthis._children[path.shift().childKey].traverseChildrenAlongPath(path, result);\r\n\t}\r\n\telse\r\n\t\tresult.child = this._children[path.shift().childKey];\r\n}\r\n\r\n/**\r\n * A method accepting not having created the view\r\n * (used mainly by the present type)\r\n * @param {object} child : an instance of another object of the same type\r\n */\r\nHierarchicalObject.prototype.pushChild = function(child) {\r\n\tchild._parent = this;\r\n\tchild._key = this._children.length;\r\n\tthis._children.push(child);\r\n\tthis.onAddChild(child);\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * A method to be used on the context of a component\r\n * (requires having created a view)\r\n * @param {object} child : an instance of another object of the same type\r\n */\r\nHierarchicalObject.prototype.addChild = function(child) {\r\n\tchild._parent = this;\r\n\t// Assign twice:\r\n\t// The first time we define the view of the parent\r\n\t// The second time, depending ont he view of the parent, we switch to a subView if appropriate\r\n\tchild.view.parentView = this.view;\r\n\tchild.view.parentView = child.view.getEffectiveParentView();\r\n\tchild._key = this._children.length;\r\n\t// onAddChild is an ultra-standard approach wich doesn't support appending to subviews\r\n\t// TODO: See if we can make it smarter\r\n//\tthis.onAddChild(child);\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * @param {object} child : an instance of another object\r\n * @param {number} atIndex : the required index to splice at\r\n */\r\nHierarchicalObject.prototype.addChildAt = function(child, atIndex) {\r\n\tif (atIndex >= this._children.length)\r\n\t\treturn;\r\n\t\t\r\n\tchild._parent = this;\r\n\tchild._key = atIndex;\r\n\tthis._children.splice(atIndex, 0, child);\r\n\tthis.generateKeys(atIndex);\r\n\tthis.onAddChild(child, atIndex);\r\n}\r\n\r\n/**\r\n * @param {string} moduleName\r\n */\r\nHierarchicalObject.prototype.removeChild = function(childKey) {\r\n\tif (childKey >= this._children.length)\r\n\t\treturn;\r\n\t\t\r\n\tvar removedChild;\r\n\r\n\tthis._children[childKey].isAttached = false;\r\n\tif (this._children[childKey].view.getMasterNode())\r\n\t\tthis._children[childKey].view.getMasterNode().remove();\r\n\tremovedChild = this._children.splice(childKey, 1)[0];\r\n//\tthis.onRemoveChild(removedChild);\r\n\t(childKey < this._children.length && this.generateKeys(childKey));\r\n\treturn removedChild;\r\n}\r\n\r\n/**\r\n * @param {number} atIndex : the required index to clear at\r\n */\r\nHierarchicalObject.prototype.removeChildAt = function(atIndex) {\r\n\tif (atIndex >= this._children.length)\r\n\t\treturn;\r\n\tvar removedChild = this._children.splice(atIndex, 1);\r\n\tthis.generateKeys(atIndex);\r\n\tthis.onRemoveChild(removedChild[0]);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nHierarchicalObject.prototype.removeAllChildren = function() {\r\n\tthis._children.forEach(function(child) {\r\n\t\tthis.onRemoveChild(child);\r\n\t}, this);\r\n\tthis._children.length = 0;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nHierarchicalObject.prototype.remove = function() {\r\n\tif (this._parent)\r\n\t\treturn this._parent.removeChild(this._key);\r\n\telse\r\n\t\treturn this.view.getMasterNode().remove();\r\n}\r\n\r\n/**\r\n * @param {number} atIndex : the first _key we need to invalidate\r\n */\r\nHierarchicalObject.prototype.generateKeys = function(atIndex) {\r\n\tfor (let i = atIndex || 0, l = this._children.length; i < l; i++) {\r\n\t\tthis._children[i]._key = i;\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {number} atIndex : the first _key we need to invalidate\r\n */\r\nHierarchicalObject.prototype.getSelfDepth = function() {\r\n\tvar depth = 0, currentLevel = this;\r\n\twhile (currentLevel._parent) {\r\n\t\tcurrentLevel = currentLevel._parent;\r\n\t\tdepth++;\r\n\t}\r\n\treturn depth;\r\n}\r\n\r\n/**\r\n * @param {array} subscriptionType : the type among the TypeManager.eventQueries helper-array\r\n * @param {array} eventQueries : the queries of the type \"subscriptionType\" that the component has recevied from the def\r\n * @param {Component} parentComponent : the parent of the component (optional : used only when subscribeOnParent)\r\n */\r\nHierarchicalObject.prototype.handleEventSubscriptions = function(subscriptionType, eventQueries, parentComponent) {\r\n\tif (subscriptionType === 'subscribeOnParent')\r\n\t\teventQueries.forEach(function(subscription, key) {\r\n\t\t\tsubscription.subscribeToEvent(this, parentComponent);\r\n\t\t}, this);\r\n\telse if (subscriptionType === 'subscribeOnChild') {\r\n\t\tthis._children.forEach(function(child) {\r\n\t\t\teventQueries.forEach(function(subscription, key) {\r\n\t\t\t\tsubscription.subscribeToEvent(child, this);\r\n\t\t\t}, this);\r\n\t\t}, this);\r\n\t}\r\n\telse if (subscriptionType === 'subscribeOnSelf')\r\n\t\teventQueries.forEach(function(subscription, key) {\r\n\t\t\tsubscription.subscribeToEvent(this, this);\r\n\t\t}, this);\r\n}\r\n\r\n/**\r\n * Specialization on the previous one\r\n * @param {array} eventQueries : the queries of the type \"subscribeOnChild\" that the sync-ed Dataset passes from the def of its trackedComponent\r\n */\r\nHierarchicalObject.prototype.handleEventSubsOnChildrenAt = function(eventQueries, atIndex) {\r\n\tthis._children.forEach(function(child, key) {\r\n\t\tif (key >= atIndex) {\r\n\t\t\teventQueries.forEach(function(subscription, key) {\r\n\t\t\t\tsubscription.subscribeToEvent(child, this);\r\n\t\t\t}, this);\r\n\t\t}\r\n\t}, this);\r\n}\r\n\r\n\r\nHierarchicalObject.prototype.getPathToSelfFromRoot = function () {\r\n\tfunction getNode(component) {\r\n\t\treturn {\r\n\t\t\tchildKey : component._key\r\n\t\t};\r\n\t}\r\n\tvar ret = [];\r\n\tthis.traverseAscendants(this, ret, getNode);\r\n\treturn ret.reverse();\r\n}\r\n\r\nHierarchicalObject.prototype.traverseAscendants = function (component, componentPath, getNode) {\r\n\t\r\n\tif (component._parent) {\r\n\t\tcomponentPath.push(getNode(component));\r\n\t\tthis.traverseAscendants(component._parent, componentPath, getNode);\r\n\t}\r\n}\r\n\r\n\r\nHierarchicalObject.prototype.getDescendantsAsNameTree = function (maxStrLen) {\r\n\tfunction getNode(component) {\r\n\t\treturn {\r\n\t\t\tname : Object.getPrototypeOf(component).objectType.slice(0, maxStrLen),\r\n\t\t\tchildren : []\r\n\t\t};\r\n\t}\r\n\tvar ret = getNode(this);\r\n\tthis.traverseDescendants(this, ret, getNode);\r\n\treturn ret;\r\n}\r\n\r\nHierarchicalObject.prototype.getDescendantsAsKeyValueTree = function () {\r\n\tfunction getNode(component) {\r\n\t\tvar node = {};\r\n\t\tnode[Object.getPrototypeOf(component).objectType] = []\r\n\t\treturn node;\r\n\t}\r\n\tvar ret = getNode(this);\r\n\tthis.traverseDescendantsRaw(this, ret, getNode);\r\n\treturn ret;\r\n}\r\n\r\nHierarchicalObject.prototype.traverseDescendants = function (component, componentTree, getNode) {\r\n\tvar node;\r\n\tcomponent._children.forEach(function(child) {\r\n\t\tnode = getNode(child);\r\n\t\tif (Array.isArray(child._children) && child._children.length) {\r\n\t\t\tcomponentTree.children.push(this.traverseDescendants(child, node, getNode));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcomponentTree.children.push(node);\r\n\t\t}\r\n\t}, this);\r\n\r\n\treturn componentTree;\r\n}\r\n\r\nHierarchicalObject.prototype.traverseDescendantsRaw = function (component, componentTree, getNode) {\r\n\tvar node;\r\n\t\r\n\tcomponent._children.forEach(function(child) {\r\n\t\tnode = getNode(child);\r\n\t\tif (Array.isArray(child._children) && child._children.length) {\r\n\t\t\tcomponentTree[Object.getPrototypeOf(component).objectType].push(this.traverseDescendantsRaw(child, node, getNode));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcomponentTree[Object.getPrototypeOf(component).objectType].push(node);\r\n\t\t}\r\n\t}, this);\r\n\r\n\treturn componentTree;\r\n}\r\n\r\n\r\n\r\n\r\nHierarchicalObject.prototype.overrideParent = function (Idx) {\r\n\tif (!this._parent || !this._parent._parent) {\r\n\t\tconsole.warn('Attempt to override the upmost level in the component\\'s hierarchy. Returning.');\r\n\t\treturn;\r\n\t}\r\n\tIdx = Idx || 0;\r\n\t\r\n\tif (this._parent.view) {\r\n\t\tthis._parent.view.getMasterNode().remove();\r\n\t}\r\n\tif (this._parent._subscriptions && this._parent._subscriptions.length) {\r\n\t\tthis._parent._subscriptions.forEach(function(sub) {\r\n\t\t\tsub.unsubscribe();\r\n\t\t});\r\n\t}\r\n\tthis._parent.clearEventListeners();\r\n\t// TODO: selectively remove the right 'onUpdate' listener\r\n//\tthis.clearEventListeners();\r\n\t\r\n\tthis._parent = this._parent._parent;\r\n\tthis._parent._children[Idx] = this;\r\n\t\r\n\tthis.addEventListener('update', function(e) {\r\n\t\tif (e.bubble)\r\n\t\t\tthis.trigger('update', e.data, true);\r\n\t}.bind(this._parent));\r\n\tif (this._parent.streams.selected && this.streams.selected)\r\n\t\tthis._parent.streams.selected.subscribe(this.streams.selected, 'value');\r\n\t\r\n\tif (this._parent.view) {\r\n\t\tthis.view.parentView = this._parent.view;\r\n\t\tthis._parent.view.getRoot().appendChild(this.view.getMasterNode());\r\n\t}\r\n\t\r\n\tthis.generateKeys();\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ExtensibleObject\r\n */\r\nvar ExtensibleObject = function(definition, parentView, parent) {\r\n\tHierarchicalObject.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'ExtensibleObject';\r\n}\r\nExtensibleObject.prototype = Object.create(HierarchicalObject.prototype);\r\nExtensibleObject.prototype.objectType = 'ExtensibleObject';\r\n/**\r\n * @virtual\r\n */\r\nExtensibleObject.prototype.onExtend = function(extension) {} \t\t\t\t// pure virtual implemented below, as a try\r\n//ExtensibleObject.prototype._asyncInitTasks = [];\t\t\t\t\t// pure virtual\r\n//ExtensibleObject.prototype._asyncRegisterTasks = [];\t\t\t\t// pure virtual\r\n/**\r\n * @abstract\r\n */\r\nExtensibleObject.prototype.getCleanDefAfterExtension = function(Constructor) {\r\n\tvar objectType = Constructor.prototype.objectType;\r\n\tvar defaultDef = Constructor.prototype.createDefaultDef();\r\n\tConstructor.prototype.createDefaultDef = function() {\r\n\t\treturn TypeManager.createComponentDef(defaultDef, objectType);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {constructor:ExtensibleObject} base\r\n * @param {constructor:ExtensibleObject} extension\r\n */\r\nExtensibleObject.prototype.addInterface = function(base, extension) {\r\n\t// namingObj was just an attemp... to \"name\" the ctor. Doesn't work, though...\r\n\tvar namingObj = {}, objectType = base.prototype.objectType || '';\r\n\t\r\n\tnamingObj[objectType] = function() {\r\n\t\tbase.apply(this, arguments);\r\n\t\textension.apply(this, arguments);\r\n\t\t\r\n\t\tbase.prototype.onExtend.call(this, extension)\r\n\t\tthis.objectType = 'Extended' + objectType;\r\n\t\tthis._implements.push();\r\n\t};\r\n\r\n\tnamingObj[objectType].prototype = this.mergeOwnProperties(base.prototype, extension.prototype);\r\n\tnamingObj[objectType].prototype.constructor = namingObj[objectType];\r\n\tnamingObj[objectType].prototype.objectType = objectType.indexOf('Extended') === 0 ? objectType : 'Extended' + objectType;\r\n\t(namingObj[objectType].prototype._implements\r\n\t\t? namingObj[objectType].prototype._implements.push(extension.prototype.objectType)\r\n\t\t: namingObj[objectType].prototype._implements = [extension.prototype.objectType]);\r\n\t\r\n\tbase.prototype.onExtend(namingObj[objectType]);\r\n\t\r\n\tif (extension.prototype.queueAsync) {\r\n\t\tvar taskDef = extension.prototype.queueAsync(objectType);\r\n\t\t(namingObj[objectType].prototype._asyncInitTasks\r\n\t\t\t\t? namingObj[objectType].prototype._asyncInitTasks.splice(\r\n\t\t\t\t\t\t(taskDef.index !== null \r\n\t\t\t\t\t\t\t\t? taskDef.index \r\n\t\t\t\t\t\t\t\t: namingObj[objectType].prototype._asyncInitTasks.length),\r\n\t\t\t\t\t\t0,\r\n\t\t\t\t\t\ttaskDef)\r\n\t\t\t\t: namingObj[objectType].prototype._asyncInitTasks = [taskDef]);\r\n\t}\r\n\tif (extension.prototype.queueAsyncRegister) {\r\n\t\tvar taskDef = extension.prototype.queueAsyncRegister(objectType);\r\n\t\t(namingObj[objectType].prototype._asyncRegisterTasks\r\n\t\t\t\t? namingObj[objectType].prototype._asyncRegisterTasks.splice(\r\n\t\t\t\t\t\t(taskDef.index !== null \r\n\t\t\t\t\t\t\t\t? taskDef.index \r\n\t\t\t\t\t\t\t\t: namingObj[objectType].prototype._asyncRegisterTasks.length),\r\n\t\t\t\t\t\t0,\r\n\t\t\t\t\t\ttaskDef)\r\n\t\t\t\t: namingObj[objectType].prototype._asyncRegisterTasks = [taskDef]);\r\n\t}\r\n\t\r\n\treturn namingObj[objectType];\r\n}\r\n\r\n/**\r\n * mergeOwnProperties\r\n * \r\n * This function has multiple signatures,\r\n * the first parameter is optional\r\n * \r\n * @param {Boolean|Object}: keepNonStdProtosOrProto\r\n * @param {Object} proto\r\n * @illimitedParams {Object} proto\r\n */\r\nExtensibleObject.prototype.mergeOwnProperties = function(keepNonStdProtosOrProto, proto) {\r\n\tvar self = this, keepNonStdProtos = false, obj, desc, targetDesc, isArray, isObj, len, testedProto,\r\n\t\t// allow not passing the \"keepNonStdProtosOrProto\" parameter\r\n\t\t// => in that case, the first argument is the target object\r\n\t\ttarget = (typeof arguments[0] === 'boolean'\r\n\t\t\t\t\t&& arguments[0]\r\n\t\t\t\t\t&& (keepNonStdProtos = true))\r\n\t\t\t\t\t\t? arguments[1]\r\n\t\t\t\t\t\t: arguments[0] || {},\r\n\t\ti = keepNonStdProtos ? 2 : 1,\r\n\t\tlength = arguments.length,\r\n\t\ttestObj;\r\n\t\t\r\n\tif (target.prototype === Object.prototype) {\r\n\t\tconsole.error('you\\'re not allowed to extend the native \"Object\" constructor');\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// We may want to merge more than 2 objects : loop on the arguments\r\n\tfor ( ; i < length; i++ ) {\r\n\t\t// Avoid erroneous calls where this function is called with a \"null\" or undefined argument\r\n\t\tif ((obj = arguments[ i ])) {\r\n\t\t\t// As we may be \"mixing\" a constructor, which has its own prototype AND an inherited prototype\r\n\t\t\t// Prepare the case for keepNonStdProtosOrProto :\r\n\t\t\t// We'll set the prototype of the constructor AND the inherited prototype as \"own\" props\r\n\t\t\t// Thus, we shall have sort of a \"doubled\" prototype chain.\r\n\t\t\t// (in reality, the chain will end after the first level, on the inheriting type, for now,\r\n\t\t\t// and we don't need more, as in most cases\r\n\t\t\t// it inherits from the CompositorComponent)\r\n\t\t\ttestObj = Object.getOwnPropertyNames(obj).concat(Object.getOwnPropertyNames(Object.getPrototypeOf(obj)));\r\n\r\n\t\t\t// Extend the target object\r\n\t\t\t// (it is frequently an empty object,\r\n\t\t\t// with its <prototype> key set to the baseClass's protoype we're inheriting from,\r\n\t\t\t// as we have this need for late extensions,\r\n\t\t\t// eg. extension of core Components in the framework)\r\n\t\t\ttestObj.forEach(function(name) {\r\n\t\t\t\t// When keepNonStdProtos is set (as first argument of the function),\r\n\t\t\t\t// this function aims at retrieving the prototype of an instance\r\n\t\t\t\t// by setting its properties at the \"own property\" level\r\n\t\t\t\t// of the target => avoid if not explicitely called\r\n\t\t\t\tif (!keepNonStdProtos && !obj.hasOwnProperty(name))\r\n\t\t\t\t\treturn;\r\n\t\t\t\t// don't merge properties from the prototype of extended natives\r\n\t\t\t\t// even if asked\r\n\t\t\t\telse if (!obj.hasOwnProperty(name) && (target instanceof Array || target instanceof String || target instanceof Object || target instanceof Boolean))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\t\tdesc = Object.getOwnPropertyDescriptor(obj, name);\r\n\t\t\t\t// Case of \"described\"\" properties is handled at the end\r\n\t\t\t\tif (typeof desc === 'undefined') {\r\n\t\t\t\t\tif ((isArray = Array.isArray(obj[name])) || (isObj = (Object.prototype.toString.call(obj[name]) === '[object Object]'))) {\r\n\t\t\t\t\t\tlen = obj[name].length || Object.keys(obj[name]).length;\r\n\t\t\t\t\t\tif (len) {\r\n\t\t\t\t\t\t\t// don't merge object instances that are deeper than the first level : \r\n\t\t\t\t\t\t\t// we don't have a mechanism here to cleanly retrieve their <prototype> key\r\n\t\t\t\t\t\t\t// (Our mechanism would cause object instances from the framework\r\n\t\t\t\t\t\t\t// hosted as a prop on an instance, to have its props from the prototype\r\n\t\t\t\t\t\t\t// as \"own\" properties)\r\n\t\t\t\t\t\t\tif ((testedProto = Object.getPrototypeOf(obj[name])) === Object.prototype || testedProto === Array.prototype)\r\n\t\t\t\t\t\t\t\ttarget[name] = self.mergeOwnProperties(target[name] || (isArray ? [] : {}), obj[name]);\r\n\t\t\t\t\t\t\t// just copy object instances and don't recurse\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\ttarget[name] = obj[name]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\ttarget[name] = isArray ? [] : {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (obj[name] || obj[name] === null) \t// copy null values : null is sometimes explicitly tested\r\n\t\t\t\t\t\ttarget[name] = obj[name];\r\n\t\t\t\t\t// Scalars that resolve to \"falsy\", which are not undefined and not null\r\n\t\t\t\t\telse if (typeof obj[name] !== 'function' && typeof obj[name] !== 'undefined' && obj[name] !== null)\r\n\t\t\t\t\t\ttarget[name] = typeof obj[name] === 'string' ? '' : 0;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttargetDesc = Object.getOwnPropertyDescriptor(target, name);\r\n\t\t\t\t\t// Edge case ? Maybe there are some...\r\n\t\t\t\t\tif (typeof targetDesc !== 'undefined' && (!targetDesc.writable || !targetDesc.configurable))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Getters can't have a value\r\n\t\t\t\t\tif (!desc.get)\r\n\t\t\t\t\t\tObject.defineProperty(target, name, {\r\n\t\t\t\t\t\t\tvalue : obj[name],\r\n\t\t\t\t\t\t\twritable : desc.writable,\r\n\t\t\t\t\t\t\tenumerable : desc.enumerable,\r\n\t\t\t\t\t\t\tconfigurable : desc.configurable\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tObject.defineProperty(target, name, {\r\n\t\t\t\t\t\t\twritable : desc.writable,\r\n\t\t\t\t\t\t\tenumerable : desc.enumerable,\r\n\t\t\t\t\t\t\tconfigurable : desc.configurable,\r\n\t\t\t\t\t\t\tget : desc.get,\r\n\t\t\t\t\t\t\tset : desc.set\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * @abstract_implementation {interface_name_masking_lock:must_be_first} {pure_virtual_on_abstract_type}\r\n */\r\nExtensibleObject.prototype.onExtend = function(namespace) {\r\n\tif (!(namespace.prototype.hasOwnProperty('_asyncInitTasks')))\r\n\t\tnamespace.prototype._asyncInitTasks = [];\r\n\tif (!(namespace.prototype.hasOwnProperty('_asyncRegisterTasks')))\r\n\t\tnamespace.prototype._asyncRegisterTasks = [];\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor AsyncActivableObject\r\n */\r\nvar AsyncActivableObject = function(definition, parentView, parent) {\r\n\tExtensibleObject.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'AsyncActivableObject';\r\n}\r\nAsyncActivableObject.prototype = Object.create(ExtensibleObject.prototype);\r\nAsyncActivableObject.prototype.objectType = 'AsyncActivableObject';\r\n\r\n/**\r\n * @reminder\r\n * Asynchronous tasks are inherited through the prototype during the mixin, but should not be referenced by \"any\" component\r\n */\r\n//AsyncActivableObject.prototype._asyncInitTasks = [];\r\n//AsyncActivableObject.prototype._asyncRegisterTasks = []\r\n\r\n/**\r\n * @virtual\r\n */\r\nAsyncActivableObject.prototype.asyncInit = function() {\r\n\t\r\n\tthis._asyncInitTasks.forEach(function(asyncFunc, key) {\r\n\t\tasyncFunc.call(this);\r\n\t});\r\n}\r\n\r\n/**\r\n * @pure_signature not to be implemented : interfaces must not inherit from a Component type, but may implement a method with this signature\r\n */\r\nAsyncActivableObject.prototype.queueAsync = function() {\r\n\treturn new TypeManager.TaskDefinition({\r\n\t\ttype : '',\r\n\t\ttask : function() {}\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor AbstractComponent\r\n */\r\nvar AbstractComponent = function(definition, parentView, parent) {\r\n\tAsyncActivableObject.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'AbstractComponent';\r\n\t\r\n\tthis._UID = TypeManager.UIDGenerator.newUID().toString();\r\n\t\r\n\tthis._defUID = definition.getHostDef().UID;\r\n\tthis._defComposedUID = '';\r\n\t\r\n//\tconsole.log(definition);\r\n\tif (typeof this._defUID === 'undefined') {\r\n\t\tconsole.warn('No UID found in definition: the hierarchical structure of the def might be wrong. eg: a group def has been defined and its type is not \"CompoundComponent\", etc. Returning...', definition);\r\n\t\treturn;\r\n\t}\r\n\t\r\n//\tconsole.log(definition);\r\n\tif (!Registries.hostsDefinitionsCacheRegistry.getItem(this._defUID))\r\n\t\tthis.populateStores(definition);\r\n\tthis.createEvent('update');\r\n\t\r\n//\tconsole.log(definition.getHostDef().UID, definition.getHostDef().nodeName, definition)\r\n\tRegistries.typedHostsRegistry.getItem(this._defUID).push(this);\r\n}\r\nAbstractComponent.prototype = Object.create(AsyncActivableObject.prototype);\r\nAbstractComponent.prototype.objectType = 'AbstractComponent';\r\n/**\r\n * @virtual\r\n */\r\nAbstractComponent.prototype.createDefaultDef = function() {}\t\t\t// virtual\r\n\r\n/**\r\n * @param {ComponentDefinition}\r\n */\r\nAbstractComponent.prototype.mergeDefaultDefinition = function(definition) {\r\n\tvar defaultDef, defaultHostDef;\r\n//\tconsole.log(this.createDefaultDef());\r\n\tif ((defaultDef = this.createDefaultDef(definition))) {\r\n\t\tdefaultHostDef = defaultDef.getGroupHostDef() ? defaultDef.getGroupHostDef() : defaultDef.getHostDef();\r\n\t\tthis._defComposedUID = defaultHostDef.UID;\r\n//\t\tif (Registries.hostsDefinitionsCacheRegistry.getItem(this._defUID, this._defComposedUID))\r\n//\t\t\treturn;\r\n\t}\r\n\telse\r\n\t\tthis._defComposedUID = this._defUID;\r\n\t\r\n\tvar hostDef = definition.getHostDef();\t// the CompoundComponent's ctor passes here only the received hostDef\r\n\t\r\n//\tconsole.log(definition.getHostDef().UID, definition.getHostDef().nodeName, defaultDef)\r\n//\tif (hostDef.type === 'TextInput')\t\t\r\n//\t\tconsole.error('TextInput', defaultHostDef, hostDef);\r\n\t\t\r\n//\tconsole.log(hostDef.sWrapper === null, Object.getPrototypeOf(this).objectType, defaultHostDef);\r\n\tif (defaultDef) {\r\n\t\tTypeManager.propsAreArray.forEach(function(prop) {\r\n//\t\t\tif(!defaultHostDef[prop])\r\n//\t\t\t\tconsole.log(prop, defaultHostDef);\r\n//\t\t\tif(defaultHostDef[prop].length)\r\n\t\t\t\tArray.prototype.push.apply(hostDef[prop], defaultHostDef[prop]);\r\n\t\t});\r\n\t\tTypeManager.propsArePrimitives.forEach(function(prop) {\r\n\t\t\tif (hostDef[prop] === null)\r\n\t\t\t\thostDef[prop] = defaultHostDef[prop];\r\n\t\t});\r\n\t\t// TODO: At first, we weren't allowing override,\r\n\t\t// => Is it really the right way to do it ?\r\n\t\tif (hostDef.sWrapper === null)\r\n\t\t\thostDef.sWrapper = defaultHostDef.sWrapper;\r\n\t\t// Overrides should not be defined in the  defaultDef:\r\n\t\t// but we met a case were we were wrongly defining it there,\r\n\t\t// and that showed us that users may want to do that and expect it to work\r\n\t\t// => so it's a worst case situation: the default override won't work \r\n\t\t// if there's an explicit override. But users should understand\r\n\t\t// that we won't support fusionning the override and the override. That makes no sense...\r\n\t\tif (hostDef.sOverride === null)\r\n\t\t\thostDef.sOverride = defaultHostDef.sOverride;\r\n\t\tif (hostDef.command === null)\r\n\t\t\thostDef.command = defaultHostDef.command;\r\n\t\t\r\n\t\t\r\n\t\tvar defaultDefContainedSubSectionsViews = defaultDef.getGroupHostDef() ? defaultDef.getHostDef().subSections : defaultDef.subSections;\r\n\t\tvar defaultDefContainedMemberViews = defaultDef.getGroupHostDef() ? defaultDef.getHostDef().members : defaultDef.members;\r\n\t\t// Brutal subSections & members override:\r\n\t\t// => descendant views are easier to define in the Component's class\r\n\t\t// \t\tand should not be different in the runtime immplementation\r\n\t\tif (defaultDefContainedSubSectionsViews.length)\r\n\t\t\tArray.prototype.push.apply(definition.subSections, defaultDefContainedSubSectionsViews);\r\n\t\t\r\n\t\tif (defaultDefContainedMemberViews.length)\r\n\t\t\tArray.prototype.push.apply(definition.members, defaultDefContainedMemberViews);\r\n\t}\r\n\t\r\n//\tif (hostDef.type === 'TextInput')\r\n//\t\tconsole.log(definition);\r\n}\r\n\r\n/**\r\n * @param {ComponentDefinition}\r\n */\r\nAbstractComponent.prototype.populateStores = function(definition) {\r\n\tthis.mergeDefaultDefinition(definition);\r\n\tvar hostDefinition = definition.getHostDef();\r\n//\tconsole.log('populateStores')\r\n//\tconsole.log(hostDefinition);\r\n\t\r\n\tvar title;\r\n\tif ((title = hostDefinition.attributes.getObjectValueByKey('title')) && title.slice(0, 1) === '-')\r\n\t\tElementDecorator['Hyphen-Star-Dash'].decorateAttributes(hostDefinition.nodeName, hostDefinition.attributes);\r\n\t\r\n\tfor (let prop in Registries.caches) {\r\n\t\tRegistries.caches[prop].setItem(this._defUID, hostDefinition[prop]);\r\n\t}\r\n\tRegistries.hostsDefinitionsCacheRegistry.setItem(this._defUID, definition);\r\n\tRegistries.typedHostsRegistry.setItem(this._defUID, []);\r\n\t\r\n\t// HACK\r\n//\t((hostDefinition.sOverride && hostDefinition.sWrapper) && hostDefinition.sWrapper.overrideStyles(hostDefinition.sOverride));\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithObservables\r\n */\r\nvar ComponentWithObservables = function(definition, parentView, parent) {\r\n\tAbstractComponent.call(this, definition, parentView, parent);\r\n\tthis.objectType = 'ComponentWithObservables';\r\n\t\r\n\tthis.streams = {};\r\n\tthis._subscriptions = [];\r\n}\r\nComponentWithObservables.prototype = Object.create(AbstractComponent.prototype);\r\nComponentWithObservables.prototype.objectType = 'ComponentWithObservables';\r\n\r\nComponentWithObservables.prototype.reactOnParentBinding = function(reactOnParent, parentComponent, subscriptionType) {\r\n//\tif (this.objectType === 'MultisetAccordionComponent')\r\n//\t\tconsole.log(reactOnParent, this);\r\n\tvar subscribtion;\r\n\treactOnParent.forEach(function(query, key) {\r\n\t\tsubscribtion = query.subscribeToStream(parentComponent.streams[query.from], this);\r\n\t\tif (subscribtion)\r\n\t\t\tsubscribtion.unAnonymize(this.UID, this.objectType);\r\n\t}, this);\r\n}\r\n\r\nComponentWithObservables.prototype.reactOnSelfBinding = function(reactOnSelf, parentComponent, subscriptionType) {\r\n//\tif (this.objectType === 'MultisetAccordionComponent')\r\n//\t\tconsole.log(reactOnSelf, this);\r\n\t\r\n\tvar subscribtion;\r\n\treactOnSelf.forEach(function(query, key) {\r\n\t\tsubscribtion = query.subscribeToStream(this.streams[query.from || query.to], this);\r\n\t\tif (subscribtion)\r\n\t\t\tsubscribtion.unAnonymize(this.UID, this.objectType);\r\n\t}, this);\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithView\r\n */\r\nvar ComponentWithView = function(definition, parentView, parent, isChildOfRoot) {\r\n//\tconsole.log('ComponentWithView', parentView);\r\n//\tconsole.log('isChildOfRoot', isChildOfRoot);\r\n\t// Let's allow not passing a definition.\r\n\t// This is a common pattern we've used in the documentation\r\n\t// (although we had chosen until now to excplicitely mock the def\r\n\t//  before calling the specialized constructor)\r\n\tif (definition === null) {\r\n\t\tdefinition = TypeManager.mockDef();\r\n//\t\tdefinition.getHostDef().nodeName = 'dummy';\r\n\t}\r\n\telse if (!definition) {\r\n\t\tconsole.warn('A Component received an undefined definition, maybe you wanted to explicitely pass a null definition ? '\r\n\t\t\t+ 'The type is ' + Object.getPrototypeOf(this).objectType + ' '\r\n\t\t\t+ '(this check is here to enforce good practices)');\r\n\t\treturn;\r\n\t}\r\n\t\r\n//\tconsole.log(definition);\r\n\tComponentWithObservables.call(this, definition, parentView, parent);\r\n\t\r\n\tthis.objectType = 'ComponentWithView';\r\n\t\r\n\tthis.command = definition.getHostDef().command;\r\n\tthis.view;\r\n//\tconsole.log(definition);\r\n\t\r\n\tif (definition.getHostDef().nodeName) {\r\n\t\tthis.instanciateView(definition, parentView, this, isChildOfRoot);\r\n\t\tthis.styleHook = this.view.styleHook;\r\n\t}\r\n\telse\r\n\t\tconsole.warn('A ComponentWithView failed to instanciate a view.', 'The _defUID is ', definition.getHostDef().UID, 'The nodeName is ', definition.getHostDef().nodeName)\r\n//\tconsole.log('ComponentWithView', this.view);\r\n}\r\nComponentWithView.prototype = Object.create(ComponentWithObservables.prototype);\r\nComponentWithView.prototype.objectType = 'ComponentWithView';\r\n\r\n/**\r\n * @param {ComponentDefinition} definition\r\n * @param {ComponentView} parentView\r\n */\r\nComponentWithView.prototype.pushChildWithView = function(child) {\r\n\tthis.pushChild(child);\r\n\tchild.view.parentView = this.view;\r\n\tthis.view.subViewsHolder.addMemberView(child.view);\r\n}\r\n\r\n/**\r\n * @param {ComponentDefinition} definition\r\n * @param {ComponentView} parentView\r\n */\r\nComponentWithView.prototype.instanciateView = function(definition, parentView, parent, isChildOfRoot) {\r\n//\tconsole.log(parentView);\r\n\tthis.view = new CoreTypes.ComponentView(definition, parentView, parent, isChildOfRoot);\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWithView.prototype.setContentFromValueOnView = function(value) {\r\n\tif (typeof value !== 'string' && isNaN(parseInt(value)))\r\n\t\treturn;\r\n//\tif (this.view.getWrappingNode().childNodes.length)\r\n//\t\tconsole.warn('setContentFromValueOnView : replacing the content of a node that already has content. Value is :', value)\r\n\tthis.view.value = value.toString();\t\t// this.view.value is a \"special\" setter: it sets textContent OR value, based on the effective node\r\n};\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWithView.prototype.setContentFromValueOnMemberView = function(value, memberViewIdx) {\r\n//\tif (this.view.subViewsHolder.memberAt(memberViewIdx).getWrappingNode().childNodes.length)\r\n//\t\tconsole.warn('setContentFromValueOnView : replacing the content of a node that already has content. Value is :', value)\r\n\tthis.view.subViewsHolder.memberAt(memberViewIdx).setContentNoFail(value.toString());\t\t// this.view.value is a \"special\" setter: it sets textContent OR value, based on the effective node\r\n};\r\n\r\n/**\r\n * @abstract\r\n * @needsRefactoring Here only for ascendant compatibility\r\n */\r\nComponentWithView.prototype.appendContentFromValueOnView = function(value) {\r\n\tthis.appendTextFromValueOnView(value);\r\n};\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWithView.prototype.appendTextFromValueOnView = function(value) {\r\n\tif (typeof value !== 'string' && isNaN(parseInt(value)))\r\n\t\treturn;\r\n\tthis.view.appendText(value.toString());\t\t// this.view.value is a \"special\" setter: it sets textContent OR value, based on the effective node\r\n};\r\n\r\nComponentWithView.prototype.emptyTargetSubView = function() {\r\n\treturn this.view.emptyTargetSubView();\r\n}\r\n\r\nComponentWithView.prototype.resetTargetSubViewContent = function() {\r\n\tthis.targetSubViewContentCache.length = 0;\r\n\tthis.emptyTargetSubView();\r\n\treturn true;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {Component} child\r\n */\r\nComponentWithView.prototype.onRemoveChild = function(child) {\r\n\tif (typeof child === 'undefined') {\r\n//\t\tconsole.log(this.view.subViewsHolder.subViews[1].getMasterNode());\r\n\t\tif (this.view.subViewsHolder.subViews.length) {\r\n\t\t\tthis.view.subViewsHolder.subViews.forEach(function(subView, key) {\r\n\t\t\t\twhile (subView.getMasterNode().firstChild) {\r\n\t\t\t\t\tsubView.getMasterNode().removeChild(subView.getMasterNode().lastChild);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\tthis._children.forEach(function(child, key) {\r\n\t\t\tchild.view.getMasterNode().remove();\r\n\t\t}, this);\r\n\t\tif (this.view.subViewsHolder.memberViews.length) {\r\n\t\t\tthis.view.subViewsHolder.memberViews.forEach(function(member, key) {\r\n\t\t\t\tmember.getMasterNode().remove();\r\n\t\t\t}, this);\r\n\t\t}\r\n//\t\tthis.view.subViewsHolder.subViews[1].getMasterNode().length = 0;\r\n//\t\tthis.view.getMasterNode().remove();\r\n\t}\r\n\telse if (child && child.view.getMasterNode()) {\t\t// check presence of masterNode, as we may be removing a childComponent before the view has been rendered\r\n\t\tif (child.view.subViewsHolder.subViews.length) {\r\n\t\t\tchild.view.subViewsHolder.subViews.forEach(function(subView, key) {\r\n\t\t\t\twhile (subView.getMasterNode().firstChild) {\r\n\t\t\t\t\tsubView.getMasterNode().removeChild(subView.getMasterNode().lastChild);\r\n\t\t\t\t}\r\n\t\t\t}, child);\r\n\t\t}\r\n\t\tchild._children.forEach(function(childOfChild, key) {\r\n\t\t\tchildOfChild.view.getMasterNode().remove();\r\n\t\t}, child);\r\n\t\tif (child.view.subViewsHolder.memberViews.length) {\r\n\t\t\tchild.view.subViewsHolder.memberViews.forEach(function(member, key) {\r\n\t\t\t\tmember.getMasterNode().remove();\r\n\t\t\t}, child);\r\n\t\t}\r\n\t\tchild.view.getMasterNode().remove();\r\n\t}\r\n\telse if (child instanceof ComponentWithObservables){\r\n\t\t// remove a child\r\n\t\t// TODO: should call super(), as the ComponentWithView should neither handle streams, nor subscriptions \r\n\t\tchild._subscriptions.forEach(function(subscription) {\r\n\t\t\tsubscription.unsubscribe();\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {Component} child\r\n * @param {number} atIndex\r\n */\r\nComponentWithView.prototype.onAddChild = function(child, atIndex) {\r\n\t\r\n\tif (typeof atIndex !== 'undefined') {\r\n\t\tif (child.view.parentView)\t\t// try to respect an eventually specifically assigned parentView\r\n\t\t\tchild.view.parentView.addChildAt(child.view, atIndex);\r\n\t\telse\t\t\t\t\t\t\t// else consider the parent view is the main view of the parent\r\n\t\t\tchild._parent.view.addChildAt(child.view, atIndex);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {number} y\r\n */\r\nComponentWithView.prototype.getViewOfChildBasedOnYpos = function(y) {\r\n\tvar self = this;\r\n\tthis.styleHook.getBoundingBox().then(function(boundingBox) {\r\n\t\tself._children.forEach(function(child) {\r\n\t\t\t// boundingBox.offsetX, y, boundingBox.offsetX, boundingBox.offsetY + boundingBox.h\r\n//\t\t\tGeometry.ComponentHitTest(child._key > 1 ? this._children[child._key - 1] : null, child, this._children[child._key + 1]);\r\n\t\t}, self);\r\n\t});\r\n}\r\n\r\n\r\nComponentWithView.prototype.childButtonsHighlightLoop = function(targetIdx) {\r\n\tif (this._children.length === 1)\r\n\t\tthis._children[0].streams.highlighted.value = null;\r\n\telse {\r\n\t\tthis._children.forEach(function(child) {\r\n\t\t\tif (child._key === targetIdx)\r\n\t\t\t\tchild.streams.highlighted.value = 'highlighted';\r\n\t\t\telse\r\n\t\t\t\tchild.streams.highlighted.value = null;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nComponentWithView.prototype.childButtonsSortedLoop = function(targetIdx, order) {\r\n\tthis._children.forEach(function(child) {\r\n\t\tif (child._key === targetIdx) {\r\n\t\t\tchild.streams['sorted' + order].value = 'sorted';\r\n\t\t\tchild.streams['sorted' + (order === 'asc' ? 'desc' : 'asc')].value = null;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchild.streams.sortedasc.value = null;\r\n\t\t\tchild.streams.sorteddesc.value = null;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithHooks\r\n */\r\nvar ComponentWithHooks = function(definition, parentView, parent, isChildOfRoot) {\r\n\tComponentWithView.call(this, definition, parentView, parent, isChildOfRoot);\r\n\tthis.objectType = 'ComponentWithHooks';\r\n\r\n\tthis.viewExtend(definition);\r\n}\r\n/**\r\n * HOOKS\r\n */\r\nComponentWithHooks.prototype = Object.assign(Object.create(ComponentWithView.prototype), {\r\n\tbasicEarlyViewExtend : function() {},\t\t\t\t\t// virtual\r\n\tasyncViewExtend : function() {},\t\t\t\t\t\t// virtual\r\n\tbasicLateViewExtend : function() {},\t\t\t\t\t// virtual\r\n\tlastAddChildren : function() {},\t\t\t\t\t\t// virtual\r\n\tbeforeRegisterEvents : function() {},\t\t\t// virtual\r\n\tregisterClickEvents : function() {},\t\t\t// virtual\r\n\tregisterLearnEvents : function() {},\t\t\t// virtual\r\n\tregisterKeyboardEvents : function() {},\t\t\t// virtual\r\n\tafterRegisterEvents : function() {},\t\t\t// virtual\r\n//\tregisterValidators : function() {},\t\t\t\t// virtual\r\n\texecBindingQueue : function() {}\t\t\t\t// virtual\r\n});\r\nComponentWithHooks.prototype.objectType = 'ComponentWithHooks';\r\n\r\nComponentWithHooks.prototype.viewExtend = function(definition) {\r\n\tthis.basicEarlyViewExtend(definition);\r\n\tif (this._asyncInitTasks)\r\n\t\tthis.asyncViewExtend(definition);\r\n\tthis.basicLateViewExtend(definition);\r\n\tif (this._asyncInitTasks)\r\n\t\tthis.lateAddChildren(definition);\r\n\t\r\n//\tif (definition.getHostDef().targetSlotIndex !== null)\r\n//\t\tconsole.log(this);\r\n\t// Retry after having added more views\r\n\tif (definition.getHostDef().targetSlotIndex !== null && this.view.targetSubView === null) {\r\n\t\tthis.view.getTargetSubView(definition.getHostDef());\r\n\t}\r\n}\r\n\r\nComponentWithHooks.prototype.registerEvents = function() {\r\n\tthis.beforeRegisterEvents();\r\n\tthis.registerClickEvents();\r\n\tthis.registerKeyboardEvents();\r\n\tthis.registerLearnEvents();\r\n\tif (this._asyncRegisterTasks)\r\n\t\tthis.asyncRegister();\r\n\tthis.afterRegisterEvents();\r\n}\r\n\r\n/**\r\n * @hook\r\n */\r\nComponentWithHooks.prototype.asyncViewExtend = function(definition) {\r\n//\tconsole.log('viewExtend', this.view, this._asyncInitTasks);\r\n\tvar asyncTask;\r\n\tfor (let i = 0, l = this._asyncInitTasks.length; i < l; i++) {\r\n\t\tasyncTask = this._asyncInitTasks[i];\r\n\t\tif(asyncTask.type === 'viewExtend') {\r\n\t\t\tasyncTask.execute(this, definition);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @hook\r\n */\r\nComponentWithHooks.prototype.lateAddChildren = function(definition) {\r\n//\tconsole.log('lateAddChildren', this.view, this._asyncInitTasks);\r\n\tvar asyncTask;\r\n\tfor (let i = 0, l = this._asyncInitTasks.length; i < l; i++) {\r\n\t\tasyncTask = this._asyncInitTasks[i];\r\n\t\tif(asyncTask.type === 'lateAddChild' || asyncTask.type === 'lateInit') {\r\n\t\t\tif (typeof asyncTask.execute !== 'function')\r\n\t\t\t\tconsole.log(asyncTask);\r\n\t\t\tasyncTask.execute(this, definition);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @hook\r\n */\r\nComponentWithHooks.prototype.asyncRegister = function() {\r\n\tvar asyncTask;\r\n\tfor (let i = 0, l = this._asyncRegisterTasks.length; i < l; i++) {\r\n\t\tasyncTask = this._asyncRegisterTasks[i];\r\n\t\tif(asyncTask.type === 'lateBinding') {\r\n\t\t\tasyncTask.execute(this);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * @param {ComponentDefinition} componentDefinition\r\n * @param {ComponentDefinition} nodeDefinition\r\n * @param {string} state\r\n */\r\nComponentWithHooks.prototype.addReactiveMemberViewFromFreshDef = function(componentDefinition, nodeDefinition, state) {\r\n\tvar newDef = state ? this.extendDefToStatefull(componentDefinition, nodeDefinition, state) : nodeDefinition;\r\n\t\r\n\tvar view;\r\n\tif (newDef.getHostDef().nodeName) {\r\n\t\tthis.view.subViewsHolder.addMemberViewFromDef(newDef.getHostDef());\r\n\t\t// HACK: the renderer expects a view to cache its \"attributes\" prop\r\n\t\t// NOT WORKING?: caches items are inndexed on the defUID of the component\r\n\t\t// FINAL HYPOTHESIS: not needed...\r\n//\t\tRegistries.caches['attributes'].setItem(newDef.getHostDef().UID, newDef.getHostDef()['attributes']);\r\n\t}\r\n\t\r\n\tif (newDef.members.length) {\r\n\t\tnewDef.members.forEach(function(memberDef) {\r\n\t\t\tthis.view.subViewsHolder.addMemberViewFromDef(memberDef);\r\n\t\t\t// HACK: the renderer expects a view to cache its \"attributes\" prop\r\n\t\t\t// NOT WORKING?: caches items are inndexed on the defUID of the component\r\n\t\t\t// FINAL HYPOTHESIS: not needed...\r\n//\t\t\tRegistries.caches['attributes'].setItem(memberDef.UID, memberDef['attributes']);\r\n\t\t}, this);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {ComponentDefinition} componentDefinition\r\n * @param {ComponentDefinition} nodeDefinition\r\n * @param {string} state\r\n */\r\nComponentWithHooks.prototype.unshiftReactiveMemberViewFromFreshDef = function(componentDefinition, nodeDefinition, state) {\r\n\r\n\tvar newDef = state ? this.extendDefToStatefull(componentDefinition, nodeDefinition, state) : nodeDefinition;\r\n\tthis.view.subViewsHolder.immediateUnshiftMemberView(newDef.getHostDef());\r\n}\r\n\r\n/**\r\n * @param {ComponentDefinition} componentDefinition\r\n * @param {ComponentDefinition} nodeDefinition\r\n * @param {string} state\r\n */\r\nComponentWithHooks.prototype.extendDefToStatefull = function(componentDefinition, nodeDefinition, state) {\r\n\t// This is an illustrative method, a hint for others on the path to catching the \"spirit\" of the extension mechanism of the framework\r\n\t// \t\t=> This is to be implemented as a method on the ComponentWithView.prototype : addReactiveMemberViewFromFreshDef\r\n\t// Delete the UID of the definition and Register a renewed one with fresh UID (unless exists, so register both the original and the fresh one : if the original exists, we already went here)\r\n\t// Define a reactOnSelf on the definition of the HOST with a callback : it shall be bound to the host\r\n\t//\t\t=> maintain a -counter- on the added pictos\r\n\t// \t\t=> the callback shall call the component -> the main view -> the subViewsHost -> the memberViews[ -counter- ].getMasterNode().hidden\r\n\t// Instanciate a view with the host's view as parent view (the view references the UID of the definition)\r\n\t// Add that view to the subViewsHost->memberViews of the main view\r\n\t\r\n\tvar statefullExtendedDef;\r\n\tif (!(statefullExtendedDef = Registries.hostsDefinitionsCacheRegistry.getItem(componentDefinition.host.UID + nodeDefinition.host.attributes.getObjectValueByKey('className')))) {\r\n\t\t// This also is tricky, as we keep all along the call stack that ComponentDef which should be a hostDef.\r\n\t\t// The only reason being that we discriminate the \"grouped\" append in the second test-case above as the one having \"members\" and \"no nodeName on host\"\r\n\t\t// TODO: THAT MUST CHANGE.\r\n\t\tstatefullExtendedDef = TypeManager.createComponentDef(nodeDefinition);\r\n\t\tstatefullExtendedDef.host.UID = componentDefinition.host.UID + nodeDefinition.host.attributes.getObjectValueByKey('className');\r\n\t\t\r\n\t\tRegistries.hostsDefinitionsCacheRegistry.setItem(statefullExtendedDef.host.UID, statefullExtendedDef);\r\n\t\t\r\n\t\t// This approach is realy tricky: everything is crucial and the context is totally blurred:\r\n\t\t// memberViewIdx anticipate on the next member view (the one we are currently building) to be appended ont the component's view: \r\n\t\t// \t\tcould it happen that this idx change suddenly ? no clear sight on that, observed from here\r\n\t\t// state.replace(/Not/i, '') is of a crucial mean, as just below state.indexOf('Not') === -1 means we're defining the conditions (registration form implementation)\r\n\t\t// \t\tfor the picto -NOT- notifying an error (then the green check), to be \"hidden\" (not to show up) when the \"valid\" state is falsy.\r\n\t\t// Ouch...\r\n\t\tvar memberViewIdx = this.view.subViewsHolder.memberViews.length;\r\n\t\tcomponentDefinition.getHostDef().reactOnSelf.push(new TypeManager.ReactivityQueryModel({\r\n\t\t\tcbOnly : true,\r\n\t\t\tfrom : state.replace(/Not/i, ''),\r\n\t\t\tsubscribe : function(value) {\r\n//\t\t\t\t\tconsole.log();\r\n\t\t\t\t\tthis.view.subViewsHolder.memberViews[memberViewIdx].getMasterNode().hidden = (state.indexOf('Not') === -1 ? !value : value) ? 'hidden' : null;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\treturn statefullExtendedDef;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithReactiveText\r\n */\r\nvar ComponentWithReactiveText = function(definition, parentView, parent, isChildOfRoot) {\r\n//\tconsole.log('ComponentWithReactiveText', parentView);\r\n\tComponentWithHooks.call(this, definition, parentView, parent, isChildOfRoot);\r\n//\tconsole.log('ComponentWithReactiveText', this.view);\r\n\tthis.objectType = 'ComponentWithReactiveText';\r\n\tthis.eachMemberContentCache = [];\r\n\tthis.targetSubViewContentCache = [];\r\n}\r\nComponentWithReactiveText.prototype = Object.create(ComponentWithHooks.prototype);\r\nComponentWithReactiveText.prototype.objectType = 'ComponentWithReactiveText';\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWithReactiveText.prototype.setContentFromArrayOnEachMemberView = function(values) {\r\n//\tconsole.log(values);\r\n\tif (!Array.isArray(values) || !values.length) {\r\n\t\tif (typeof value === 'string')\r\n\t\t\tvalues = [values];\r\n\t\telse\r\n\t\t\treturn;\r\n\t}\r\n//\tconsole.log(this);\r\n\tthis.view.subViewsHolder.setEachMemberContent(values);\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWithReactiveText.prototype.setContentFromCacheOnTargetSubview = function() {\r\n\tif (!Array.isArray(this.targetSubViewContentCache) || !this.targetSubViewContentCache.length)\r\n\t\treturn '';\r\n\treturn this.view.setContentFromArrayOnTargetSubview(this.targetSubViewContentCache);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithReactiveText_Fast\r\n */\r\nvar ComponentWith_FastReactiveText = function(definition, parentView, parent, isChildOfRoot) {\r\n\tComponentWithReactiveText.call(this, definition, parentView, parent, isChildOfRoot);\r\n\tthis.objectType = 'ComponentWith_FastReactiveText';\r\n}\r\nComponentWith_FastReactiveText.prototype = Object.create(ComponentWithReactiveText.prototype);\r\nComponentWith_FastReactiveText.prototype.objectType = 'ComponentWith_FastReactiveText';\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentWith_FastReactiveText.prototype.setContentFromArrayOnEachMemberView = function(values) {\r\n\tthis.view.subViewsHolder.setEachMemberContent_Fast(values);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentStrokeAware\r\n */\r\nvar ComponentStrokeAware = function(definition, parentView, parent, isChildOfRoot) {\r\n\tComponentWithHooks.call(this, definition, parentView, parent, isChildOfRoot);\r\n//\tthis.objectType = 'ComponentStrokeAware';\r\n\r\n}\r\nComponentStrokeAware.prototype = Object.create(ComponentWithHooks.prototype);\r\nComponentStrokeAware.prototype.objectType = 'ComponentStrokeAware';\r\n\r\nComponentStrokeAware.prototype.createEvents = function() {\r\n\tthis.createEvent('stroke');\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentStrokeAware.prototype.registerKeyboardEvents = function(e) {\r\n\tvar self = this, input = this.view.subViewsHolder.memberViews[1] || this.view;\r\n//\tconsole.warn('ComponentStrokeAware :', 'where is \"input\"');\r\n\t\r\n\t// Stroke event listener \r\n\tinput.getMasterNode().addEventListener('keyup', function(e) {\r\n\t\te.stopPropagation();\r\n//\t\tvar allowed = [189, 190, 191]; // corresponds to **. , -**\r\n//\t\tallowed.indexOf(e.keyCode) >= 0 && \r\n \r\n\t    if (e.keyCode === 13 || e.keyCode === 27  || (e.keyCode >= 32 && (e.keyCode < 48 || e.keyCode > 57) && e.keyCode <= 191))\r\n\t        self.trigger('stroke', e);\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithViewAbstractingAFeed\r\n */\r\nvar ComponentWithViewAbstractingAFeed = function(definition, parentView, parent, isChildOfRoot) {\r\n\tComponentWithHooks.call(this, definition);\r\n\tthis.objectType = 'ComponentWithViewAbstractingAFeed';\r\n\tthis.createEvent('exportdata');\r\n}\r\n\r\nComponentWithViewAbstractingAFeed.prototype = Object.create(ComponentWithHooks.prototype);\r\nComponentWithViewAbstractingAFeed.prototype.objectType = 'ComponentWithViewAbstractingAFeed';\r\n\r\nComponentWithViewAbstractingAFeed.prototype.exportData = function(data) {\r\n\tthis.trigger('exportdata', data);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentWithCanvas\r\n */\r\nvar ComponentWithCanvas = function(definition, parentView, parent, isChildOfRoot) {\r\n\tComponentWithHooks.call(this, definition, parentView, parent, isChildOfRoot);\r\n\tthis.objectType = 'ComponentWithCanvas';\r\n\t\r\n\tthis.view.getDimensions();\r\n\t\r\n//\tthis.view.h = parseInt(definition.getHostDef().sWrapper.rules.canvas.rule.attributes.height);\r\n//\tthis.view.w = parseInt(definition.getHostDef().sWrapper.rules.canvas.rule.attributes.minWidth);\r\n//\tconsole.log(this.view.w, this.view.h);\r\n}\r\n\r\nComponentWithCanvas.prototype = Object.create(ComponentWithHooks.prototype);\r\nComponentWithCanvas.prototype.objectType = 'ComponentWithCanvas';\r\n\r\n/**\r\n * @param {ComponentDefinition} definition\r\n * @param {ComponentView} parentView\r\n */\r\nComponentWithCanvas.prototype.instanciateView = function(definition, parentView, parent, isChildOfRoot) {\r\n\tthis.view = new CoreTypes.CanvasView(definition, parentView, parent, isChildOfRoot);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor CompositorComponent\r\n */\r\nvar CompositorComponent = function(definition, parentView, parent) {//, argx, argy, arg...\r\n\tif (!this.Compositor)\r\n\t\tconsole.warn('Invalid inheritance through CompositorComponent: it seems you\\'ve tried to extend a non-core component. Were you inheriting from an abstract type through the simple \"extends\" property ? (CompositorComponent is not needed then)')\r\n\tthis.Compositor.apply(this, arguments);\r\n\tthis.objectType = 'CompositorComponent';\r\n}\r\nCompositorComponent.prototype = Object.create(ComponentWithView.prototype);\r\nCompositorComponent.prototype.objectType = 'CompositorComponent';\r\nCompositorComponent.prototype.extendsCore = '';\t\t\t\t\t\t\t// virtual\r\nCompositorComponent.prototype.extends = '';\t\t\t\t\t\t\t\t// virtual\r\n\r\n//CompositorComponent.prototype.Compositor = function() {};\t\t\t\t// virtual (decorated type property)\r\n\r\nCompositorComponent.prototype.acquireCompositor = function() {};\t\t// virtual\r\n\r\nCompositorComponent.prototype.extendFromCompositor = function(inheritingType, inheritedType) {\r\n//\tconsole.log(inheritingType.prototype, inheritedType);\r\n\tvar proto_proto = Object.create(inheritedType.prototype);\r\n//\tconsole.log(Object.hasOwn(inheritingType.prototype, '_asyncRegisterTasks'));\r\n\tObject.assign(proto_proto, inheritingType.prototype);\r\n\tinheritingType.prototype = proto_proto;\r\n//\tconsole.log(proto_proto, inheritingType.prototype);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tExtensibleObject : ExtensibleObject,\r\n\tAbstractComponent : AbstractComponent,\r\n\tHierarchicalObject : HierarchicalObject,\r\n\tComponentWithView : ComponentWithView,\r\n\tComponentWithObservables : ComponentWithObservables,\r\n\tCompositorComponent : CompositorComponent,\r\n\tComponentWithHooks : ComponentWithHooks,\r\n\tComponentWithReactiveText : ComponentWithReactiveText,\r\n\tComponentWith_FastReactiveText : ComponentWith_FastReactiveText,\r\n\tComponentStrokeAware : ComponentStrokeAware,\r\n\tComponentWithViewAbstractingAFeed : ComponentWithViewAbstractingAFeed,\r\n\tComponentWithCanvas : ComponentWithCanvas\r\n};",
    "\"use strict\";\n/**\r\n * @constructor ComponentSet\r\n * This type is a re-implementation of the ReactiveDataset type.\r\n * (it follows the same structure and logic, but hasn't the same purpose)\r\n * Instead of being passed a template to instanciate components,\r\n * it's passed a complete \"launcher\"\" script\r\n */\r\n\r\nvar TemplateFactory = require('src/core/TemplateFactory');\r\nvar App = require('src/core/App');\r\nvar Component = require('src/core/Component');\r\n\r\n\r\nvar ComponentSet = function(rootComponent, slotTemplate) {\r\n\tif (!rootComponent)\r\n\t\treturn;\r\n\tthis.init(rootComponent, slotTemplate)\r\n}\r\nComponentSet.prototype = Object.create(Array.prototype);\r\nComponentSet.prototype.objectType = 'ComponentSet';\r\nObject.defineProperty(ComponentSet.prototype, 'init', {\r\n\tvalue : function(rootComponent, slotTemplate, keywordHandler) {\r\n\t\tObject.defineProperty(this, 'rootComponent', {\r\n\t\t\tvalue : rootComponent\r\n\t\t});\r\n\t\tObject.defineProperty(this, 'Item', {\r\n\t\t\tvalue : this.setItemFactory(),\r\n\t\t\twritable : true\r\n\t\t});\r\n\t\tObject.defineProperty(this, 'slotTemplate', {\r\n\t\t\tvalue : slotTemplate\r\n\t\t});\r\n\t}\r\n});\r\n\r\n/**\r\n * this is a virtual method which overrides the setSchema method of the ReactiveDataset: \r\n * a handy way to let the LazySlottedComponent ctor execute till the end,\r\n * even if an inheriting class has messed up the typedSlots... for example, the tabPanel defines the typedSlot[1] as a ComponentSet...\r\n * And that's why we are here : to let the LazySlottedComponent execute a loop \r\n * that is based on the hypothesis there are as much ReactiveDatasets as there are slotsDef... (and none hase been replaced by a dumb other unknown type, like a ComponentSet...)\r\n */\r\nObject.defineProperty(ComponentSet.prototype, 'setSchema', {\r\n\tvalue : function(factoryPropsArray) {}\r\n});\r\n\r\n/**\r\n * An override for the setItemFactory method of the ReactiveDataset\r\n * It adds the itemLauncher and itemKeyword properties\r\n * as well as references to its env and the _ignited flag\r\n */\r\nObject.defineProperty(ComponentSet.prototype, 'setItemFactory', {\r\n\tvalue : function() {\r\n\r\n\t\tvar factory = function(itemAsArray) {\r\n\t\t\tthis.itemLauncher = itemAsArray[0];\r\n\t\t\tthis.itemKeyword = itemAsArray[1];\r\n\t\t}\r\n\t\tfactory.prototype = Object.create(Object.prototype);\r\n\t\tfactory.prototype.itemLauncher = null;\r\n\t\tfactory.prototype.itemKeyword = null;\r\n\t\tfactory.prototype._parent = null;\r\n\t\tfactory.prototype._key = null;\r\n\t\tfactory.prototype._ignited = null;\r\n\t\t\r\n\t\treturn factory;\r\n\t}\r\n});\r\n\r\n/**\r\n * Not needed : same as the implementatoin of the ReactiveDataset\r\n */\r\nObject.defineProperty(ComponentSet.prototype, 'newItem', {\r\n\tvalue : function() {\r\n\t\treturn (new this.Item(arguments));\r\n\t}\r\n});\r\n\r\nObject.defineProperty(ComponentSet.prototype, 'ignite', {\r\n\tvalue : function(idx) {\r\n\t\tvar injectedComponent;\r\n\t\tthis.forEach(function(item, key) {\r\n\t\t\tif (key === idx) {\r\n\t\t\t\tif (item._ignited !== true) {\r\n//\t\t\t\t\tconsole.log(item);\r\n\t\t\t\t\tinjectedComponent = item.itemLauncher(item.itemKeyword, item._parent.view).init.call(item.itemLauncher.init);\t// , item._parent.view, item._parent\r\n//\t\t\t\t\tconsole.log(injectedComponent);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// The source-code viewer doesn't return a component\r\n\t\t\t\t\tif (injectedComponent instanceof Component.ComponentWithView)\r\n\t\t\t\t\t\tthis.rootComponent._children[key].view.getWrappingNode().appendChild(injectedComponent.view.getMasterNode());\r\n\r\n\t\t\t\t\titem._ignited = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.rootComponent._children[key].view.getMasterNode().style.display = 'flex';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.rootComponent._children[key].view.getMasterNode().style.display = 'none';\r\n\t\t\t}\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(ComponentSet.prototype, 'ignition', {\r\n\tvalue : function() {\r\n\t\tvar keywordHandler;\r\n\t\tthis.forEach(function(componentLauncherItem, idx) {\r\n\t\t\tkeywordHandler = componentLauncherItem.itemLauncher.init.call(componentLauncherItem.itemLauncher.init, componentLauncherItem._parent.view);\r\n\t\t\tif (typeof keywordHandler === 'function')\r\n\t\t\t\tkeywordHandler(componentLauncherItem.itemKeyword, componentLauncherItem._parent.view);\r\n\t\t\tcomponentLauncherItem._ignited = true;\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(ComponentSet.prototype, 'push', {\r\n\tvalue : function(componentLauncherItem) {\r\n\t\tArray.prototype.push.call(this, componentLauncherItem);\r\n//\t\tconsole.log(componentLauncherItem);\r\n//\t\tconsole.log(this.rootComponent.view);\r\n\t\tnew Component.ComponentWithView(this.slotTemplate, this.rootComponent.view);\r\n\t\tcomponentLauncherItem._parent = this.rootComponent._children[this.rootComponent._children.length - 1];\r\n//\t\tconsole.log(this.rootComponent);\r\n//\t\tthis.rootComponent._children[this.rootComponent._children.length - 1].pushChild(componentLauncherItem);\r\n\t\tApp.renderDOM();\r\n\t}\r\n});\r\n\r\n// TODO: each member of the array IS a memberLauncherTupple (so we can't default to Array())\r\nObject.defineProperty(ComponentSet.prototype, 'pushApply', {\r\n\tvalue : function(memberLauncherArray) {\r\n\t\tif (!Array.isArray(memberLauncherArray))\r\n\t\t\tmemberLauncherArray = [memberLauncherArray];\r\n\t\t\r\n\t\tmemberLauncherArray.forEach(function(memberLauncher) {\r\n\t\t\tArray.prototype.push.call(this, memberLauncher);\r\n\t\t\tthis.rootComponent.pushChild(memberLauncher);\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(ComponentSet.prototype, 'splice',  {\r\n\tvalue : function(index, length, replacedBy) {\r\n\t\tvar c1, c2, mBackup;\r\n\r\n\t\tif (typeof replacedBy === 'number') {\r\n\t\t\tif (replacedBy > index) {\r\n\t\t\t\tc2 = this.rootComponent._children[replacedBy].remove();\r\n\t\t\t\tc1 = this.rootComponent._children[index].remove();\r\n\t\t\t\tthis.rootComponent.addChildAt(c2, index);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tc1 = this.rootComponent._children[index].remove();\r\n\t\t\t\tc2 = this.rootComponent._children[replacedBy].remove();\r\n\t\t\t\tthis.rootComponent.addChildAt(c2, index - 1);\r\n\t\t\t}\r\n\t\t\tmBackup = Array.prototype.splice.call(this, index, 1, this[replacedBy])[0];\r\n\t\t\treturn [mBackup, c1];\r\n\t\t}\r\n\t\telse if (typeof replacedBy === 'undefined' || replacedBy === null) {\r\n\t\t\tc1 = this.rootComponent._children[index].remove();\r\n\t\t\tmBackup = Array.prototype.splice.call(this, index, 1)[0];\r\n\t\t\treturn [mBackup, c1];\r\n\t\t}\r\n\t\telse if (Array.isArray(replacedBy)) {\r\n\t\t\tthis.rootComponent.addChildAt(replacedBy[1], index);\r\n\t\t\tArray.prototype.splice.call(this, index, 1, replacedBy[0]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nObject.defineProperty(ComponentSet.prototype, 'resetLength',  {\r\n\tvalue : function() {\r\n\t\tif (this.rootComponent.removeAllChildren())\r\n\t\t\tArray.prototype.splice.call(this, 0, this.length);\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = ComponentSet;",
    "\"use strict\";\n/**\r\n * @constructor CompoundComponent\r\n * \r\n * This ctor is the main effector of the AppIgnition super-class\r\n * \t=> tight coupling = mandatory static inclusion in core (AppIgnition requires CompoundComponent).\r\n */\r\n\r\n\r\nconst TypeManager = require('src/core/TypeManager');\r\nconst TemplateFactory = require('src/core/TemplateFactory');\r\nconst Registries = require('src/core/Registries');\r\nconst CoreTypes = require('src/core/CoreTypes');\r\nconst Components = require('src/core/Component');\r\n\r\n//const componentTypes = require('src/_buildTools/_UIpackages')(null, { UIpackage: '%%UIpackage%%' }).packageList;\r\n\r\nconst componentTypes = {};\r\nconst coreComponents = {};\r\n\r\nComponents.RootViewComponent = require('src/coreComponents/RootViewComponent/RootViewComponent');\r\nComponents.AppOverlayComponent = require('src/coreComponents/AppOverlayComponent/AppOverlayComponent');\r\nComponents.AppBoundaryComponent = require('src/coreComponents/AppBoundaryComponent/AppBoundaryComponent');\r\nComponents.IFrameComponent = require('src/coreComponents/IFrameComponent/IFrameComponent');\r\nComponents.HToolbarComponent = require('src/coreComponents/HToolbarComponent/HToolbarComponent');\r\nComponents.FlexColumnComponent = require('src/coreComponents/FlexColumnComponent/FlexColumnComponent');\r\nComponents.FlexRowComponent = require('src/coreComponents/FlexRowComponent/FlexRowComponent');\r\nComponents.FlexGridComponent = require('src/coreComponents/FlexGridComponent/FlexGridComponent');\r\nComponents.ComponentPickingInput = require('src/coreComponents/ComponentPickingInput/ComponentPickingInput');\r\nComponents.RPCStackComponent = require('src/coreComponents/RPCStackComponent/RPCStackComponent');\r\n//var ChildBoxComponent = require('src/coreComponents/ChildBoxComponent/ChildBoxComponent');\r\n\r\nComponents.SWrapperInViewManipulator = require('src/_DesignSystemManager/SWrapperInViewManipulator')\r\n\r\n//Components.VisibleStateComponent = require('src/UI/categories/basics/VisibleStateComponent/VisibleStateComponent');\r\n//Components.TypedListComponent = require('src/UI/categories/basics/TypedListComponent/TypedListComponent');\r\n//Components.KeyValuePairComponent = require('src/UI/categories/basics/KeyValuePairComponent/KeyValuePairComponent');\r\n//Components.ExtensibleTable = require('src/UI/categories/basics/ExtensibleTable/ExtensibleTable');\r\n//Components.SpecializedTypedListComponent = require('src/UI/categories/basics/SpecializedTypedListComponent/SpecializedTypedListComponent');\r\n//Components.MultisetAccordionComponent = require('src/UI/categories/basics/MultisetAccordionComponent/MultisetAccordionComponent');\r\n//Components.GenericTitledPanelComponent = require('src/UI/categories/basics/GenericTitledPanelComponent/GenericTitledPanelComponent');\r\n//var ColorSamplerSetComponent = require('src/UI/packages/setsForPanels/ColorSamplerSetComponent/ColorSamplerSetComponent');\r\n\r\n//Components.VaritextButtonComponent = require('src/UI/categories/forms/NamedButton/NamedButton');\r\n//Components.VisualSetComponent = require('src/UI/Generics/VisualSetComponent/VisualSetComponent');\r\n//Components.VariablyStatefullComponent = require('src/UI/Generics/VariablyStatefullComponent/VariablyStatefullComponent');\r\n//Components.VisualSetHostComponent = require('src/UI/Generics/VisualSetHostComponent/VisualSetHostComponent');\r\n\r\n// Abstract types & abstract implementations re-injection\r\n\r\n//Components.RootViewComponent = RootViewComponent;\r\n//Components.AppOverlayComponent = AppOverlayComponent;\r\n//Components.AppBoundaryComponent = AppBoundaryComponent;\r\n//Components.HToolbarComponent = HToolbarComponent;\r\n//Components.FlexColumnComponent = FlexColumnComponent;\r\n//Components.FlexRowComponent = FlexRowComponent;\r\n//Components.FlexGridComponent = FlexGridComponent;\r\n//Components.ComponentPickingInput = ComponentPickingInput;\r\n//Components.ChildBoxComponent = ChildBoxComponent;\r\n\r\n//Components.SWrapperInViewManipulator = SWrapperInViewManipulator;\r\n\r\n//Components.VisibleStateComponent = VisibleStateComponent;\r\n//Components.TypedListComponent = TypedListComponent;\r\n//Components.KeyValuePairComponent = KeyValuePairComponent;\r\n//Components.ExtensibleTable = ExtensibleTable;\r\n//Components.SpecializedTypedListComponent = SpecializedTypedListComponent;\r\n//Components.GenericTitledPanelComponent = GenericTitledPanelComponent;\r\n//Components.ColorSamplerSetComponent = ColorSamplerSetComponent;\r\n\r\n//Components.VisualSetComponent = VisualSetComponent;\r\n//Components.VariablyStatefullComponent = VariablyStatefullComponent;\r\n//Components.VaritextButtonComponent = VaritextButtonComponent;\r\n//Components.VisualSetHostComponent = VisualSetHostComponent;\r\n\r\n//Object.assign(Components, require(componentTypes.misc));\r\n//delete componentTypes.misc;\r\n\r\n//for (let type in componentTypes) {\r\n//\t\r\n//\tif (typeof componentTypes[type] === 'string')\r\n//\t\tComponents[type] = require(componentTypes[type]);\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor CompoundComponent\r\n */\r\nconst CompoundComponent = function(definition, parentView, parent, isChildOfRoot) {\r\n//\tconsole.log(definition);\r\n\tthis._firstListUIDSeen = null;\r\n\tvar shouldExtend = false;\r\n\t\r\n\t\r\n\t\r\n\tif (!definition.getGroupHostDef())\r\n\t\tconsole.error('Definition given to CompoundComponent isn\\'t a nested HierachicalDefinition.', definition, 'Type is:', definition.getHostDef().type, this);\r\n\t\t\r\n\tif (definition.getGroupHostDef().type)\r\n\t\tconsole.warn('A type was given to a template instanciated by the CompoundComponent ctor: it\\'ll be ignored. If the component isn\\'t part of a list, it may not be what you meant. Type is', definition.getGroupHostDef().type)\r\n\t\r\n\t// Any custom element must be befined when calling the Def Factory, unless there's no shadow DOM\r\n//\tif (!definition.getGroupHostDef().nodeName) {\r\n//\t\tdefinition.getGroupHostDef().nodeName = 'compound-view';\r\n//\t\tconsole.log(definition.getGroupHostDef());\r\n//\t}\r\n\r\n\t// Let's use an elementary and perf efficient hack right here, at the beginning, and abuse the ascendant component with a symbolic def,\r\n\t// for the view to be instanciated with the correct context (knowing how many subSections we have is crucial when connecting children)\r\n\t// This prevents us from instanciating a Component with subViews as the \"host\" of a composedComponent : No matter at all, cause that case wouldn't make much sense, though.\r\n\t// (It's hard to implement that in the Type factory, as the \"composed\" definition, with its 2 levels of depth on the \"host\", is an exception)\r\n\t// (That shouldn't be a too big issue, seen that building the hierarchy comes before the intensive processing : \r\n\t// \tthe def may be mutated here, given the fact that we pay a strong attention on it not being changed later)\r\n\tdefinition.subSections.forEach(function(section) {\r\n\t\tdefinition.getHostDef().subSections.push(null);\r\n\t});\r\n\r\n//\tif (definition.getGroupHostDef().type === 'FileSelector')\r\n//\t\tconsole.error(def);\r\n\r\n\tif (!TypeManager.hostsDefinitionsCacheRegistry.getItem(definition.getGroupHostDef().UID)) // this shall always fail after having called \"once for all\" the superior ctor (although def is \"explicit+default\", and \"special\" is added afterwards: see extendDefinition())\r\n\t\tshouldExtend = true;\r\n\r\n\t// Another elementary Hack to integrate parts of the \"host\" of the def in that \"composedComponent\" (which is pretty \"unfruity\", not having any \"applicative\" behavior) :\r\n\t// assuming we don't want to instanciate \"in da space\" (i.e. \"in that present ctor\") a whole Component, and have to reflect all of its props on \"self\",\r\n\t// we call the \"superior\" ComponentWithView ctor on the def of solely the host (5 lines below)\r\n\t// BUT beforehand, we reflect on \"self\" the \"createDefaultDef\" method defined on the prototype of the host, then it shall be called by the AbstractComponent ctor\r\n\t// (from which we inherit).\r\n\t// Exception, obviously : if there is -no- createDefaultDef method on that Component which whant to be \"host\" on the throne of the \"host\"...\r\n\t//\r\n\tvar type = definition.getGroupHostDef().getType();\r\n\tif (type && type !== 'CompoundComponent' && Components[type].prototype.createDefaultDef) {\r\n//\t\tconsole.error('Definition overridden', type,  Components[type]);\r\n\t\tthis.createDefaultDef = Components[type].prototype.createDefaultDef;\r\n\t}\r\n//\tconsole.error(parent);\r\n//\tconsole.log(definition);\r\n//\tconsole.log(this.createEvents);\r\n\tComponents.ComponentWithView.call(this, definition.getHostDef(), parentView, parent, isChildOfRoot);  // feed with host def\r\n\tthis.objectType = 'CompoundComponent';\r\n\r\n\t// extend last, so the event bubbling occurs always after the \"explicitly defined in the host's def\" callbacks\r\n\tif (shouldExtend)\r\n\t\tthis.extendDefinition(definition);\r\n\t\r\n\tvar defaultDef = this.createDefaultDef(definition.getHostDef());\r\n\t\r\n\t// When instanciating a CompoundComponent directly from its ctor,  there is no defaultDef : don't try to merge\r\n\tif (defaultDef) {\r\n\t\tif (defaultDef.subSections.length)\r\n\t\t\tArray.prototype.push.apply(definition.subSections, defaultDef.subSections);\r\n\t\tif (defaultDef.members.length)\r\n\t\t\tArray.prototype.push.apply(definition.members, defaultDef.members);\r\n\t}\r\n\t\t\t\r\n\tthis.instanciateSubSections(definition);\r\n\tthis.instanciateMembers(definition);\r\n\tthis.instanciateLists(definition);\r\n\r\n}\r\nCompoundComponent.prototype = Object.create(Components.ComponentWithView.prototype);\r\nCompoundComponent.prototype.objectType = 'CompoundComponent';\r\ncoreComponents.CompoundComponent = CompoundComponent;\r\n\r\n//CompoundComponent.prototype.createDefaultDef = function() {\r\n//\treturn TypeManager.mockDef();\r\n//}\r\n\r\nCompoundComponent.prototype.extendDefinition = function(definition) {\r\n\t// Special case : events of type \"update\" shall have the ability to bubble from CompoundComponent to CompoundComponent\r\n\tdefinition.getGroupHostDef().subscribeOnChild.push(\r\n\t\t(new TypeManager.EventSubscriptionModel({\r\n\t\t\ton: 'update',\r\n\t\t\tsubscribe: function(e) {\r\n\t\t\t\tif (e.bubble)\r\n\t\t\t\t\tthis.trigger('update', e.data, true);\r\n\t\t\t}\r\n\t\t})\r\n\t\t)\r\n\t);\r\n\t//\tTypeManager.caches['subscribeOnChild'].setItem(this._defUID, definition.getGroupHostDef().subscribeOnChild);\r\n}\r\n\r\nCompoundComponent.prototype.instanciateSubSections = function(definition) {\r\n\tvar type, component;\r\n\tdefinition.subSections.forEach(function(subSectionDef) {\r\n\t\tif (!subSectionDef.getHostDef() && (subSectionDef.nodeName || subSectionDef.type)) {\r\n\t\t\tconsole.warn('subSection \"' + (subSectionDef.type || subSectionDef.nodeName) + '\" of a CompoundComponent : Definition given is the definition of a view. It should be wrapped in a HierarchicalComponentDef');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttype = subSectionDef.getHostDef().getType() || (subSectionDef.getGroupHostDef() && subSectionDef.getGroupHostDef().getType());\r\n\t\t//\t\tconsole.log(type, type in Components);\r\n\t\tif (type in Components && type !== 'CompoundComponent' && type !== 'FlexColumnComponent' && type !== 'FlexRowComponent' && type !== 'FlexGridComponent' && type !== 'HToolbarComponent') {\r\n\t\t\tcomponent = new Components[type](subSectionDef, this.view, null, 'isChildOfRoot');\r\n\t\t\t// mandatory, as we need to append memberViews on subViews without accessing the component's scope\r\n\t\t\tthis.view.subViewsHolder.subViews.push(component.view);\r\n\t\t}\r\n\t\telse if (subSectionDef.getGroupHostDef()) {\r\n\t\t\tcomponent = new CompoundComponent(subSectionDef, this.view, null, 'isChildOfRoot');\r\n\t\t\tthis.view.subViewsHolder.subViews.push(component.view);\r\n\t\t}\r\n\t\telse if (subSectionDef.getHostDef().nodeName)\r\n\t\t\tthis.view.subViewsHolder.subViews.push(new CoreTypes.ComponentView(subSectionDef, this.view, this, 'isChildOfRoot'));\r\n\t}, this);\r\n}\r\n\r\nCompoundComponent.prototype.instanciateMembers = function(definition) {\r\n//\tconsole.log(definition.members);\r\n//\tconsole.log(this.view);\r\n\tvar type;\r\n\tdefinition.members.forEach(function(memberDef) {\r\n\t\tif (!memberDef.getHostDef && (memberDef.nodeName || memberDef.type)) {\r\n\t\t\tconsole.warn('Member \"' + (memberDef.type || memberDef.nodeName) + '\" of a CompoundComponent : Definition given is the definition of a view. It should be wrapped in a HierarchicalComponentDef');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttype = memberDef.getHostDef().getType() || (memberDef.getGroupHostDef() && memberDef.getGroupHostDef().getType());\r\n\t\t//\t\tif (type === 'ColorSamplerSetComponentAsClient')\r\n\t\t//\t\t\tconsole.log(type, type in Components, Components);\r\n//\t\tconsole.log(type);\r\n\t\tif (type in Components && type !== 'CompoundComponent') {\r\n\t\t\tnew Components[type](memberDef, this.view, this);\r\n\t\t}\r\n\t\telse if (memberDef.getGroupHostDef()) {\r\n\t\t\tif (Components[type])\r\n\t\t\t\tnew Components[type](memberDef, this.view, this);\r\n\t\t\telse\r\n\t\t\t\tnew CompoundComponent(memberDef, this.view, this);\r\n\t\t}\r\n\t\telse if (memberDef.getHostDef().nodeName)\r\n\t\t\tthis.view.subViewsHolder.memberViews.push(new CoreTypes.ComponentView(memberDef, this.view, this));\r\n\t}, this);\r\n};\r\n\r\nCompoundComponent.prototype.instanciateLists = function(definition) {\r\n\tdefinition.lists.forEach(function(listDef) {\r\n\t\tnew ComponentList(listDef, this.view, this);\r\n\t}, this);\r\n};\r\n\r\n/**\r\n * retrieveListDefinition\r\n * Not used in Core: probably meant to help build very complex apps\r\n */\r\nCompoundComponent.prototype.retrieveListDefinition = function() {\r\n\treturn this._firstListUIDSeen ? TypeManager.listsDefinitionsCacheRegistry.getItem(this._firstListUIDSeen) : false;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentList\r\n */\r\nconst ComponentList = function(definition, parentView, parent) {\r\n\tComponents.HierarchicalObject.call(this);\t// don't register the list as a child ... ', definition, parentView, parent);\r\n\tthis.objectType = 'ComponentList';\r\n\tthis._parent = parent;\r\n\r\n\tthis.iterateOnModel(definition, parentView, parent);\r\n}\r\nComponentList.prototype = Object.create(Components.HierarchicalObject.prototype);\r\nComponentList.prototype.objectType = 'ComponentList';\r\ncoreComponents.ComponentList = ComponentList;\t\t// used in AppIgnition.List (as a \"life-saving\" tool : pretty abstract, but very useful)\r\n\r\nComponentList.prototype.iterateOnModel = function(definition, parentView) {\r\n\tif (definition.getHostDef().each.length) {\r\n\t\t// Debug notice: preventing a frequent case of error,\r\n\t\t// when a def hosting a list is instanciated once and re-used many times.\r\n\t\t// In most cases, the \"each\" property isn't resetted, so we get empty nodes from past iterations\r\n\t\tif (!definition.getHostDef().isInternal && TypeManager.listsDefinitionsCacheRegistry.getItem(definition.getHostDef().UID)) { //  && this._parent._firstListUIDSeen !== null && this._parent._firstListUIDSeen === definition.getHostDef().UID\r\n\t\t\tconsole.warn('ComponentList :', 'Constructing a list from a not-empty definition we\\'ve already seen : There is a possibility that this is unintentional ans may cause unwanted empty nodes to be appended in the DOM.', 'The nodeName is', definition.getHostDef().template.getHostDef().nodeName, 'The \"each\" property is', definition.getHostDef().each);\r\n\t\t}\r\n\t\t// Not used in Core elsewhere than here: probably meant to help build very complex apps\r\n\t\t// (but here, useful to catch the above \"notice\" log)\r\n\t\tTypeManager.listsDefinitionsCacheRegistry.setItem(definition.getHostDef().UID, definition.getHostDef());\r\n\t\tthis._parent._firstListUIDSeen = definition.getHostDef().UID;\r\n\t}\r\n\telse\r\n\t\treturn;\r\n\r\n\tvar templateDef = definition.getHostDef().template,\r\n\t\tcomposedComponent,\r\n\t\ttype;\r\n\r\n\t//\tconsole.log(templateDef);\r\n\tdefinition.getHostDef().each.forEach(function(item, key) {\r\n\r\n\t\tif ((type = templateDef.getHostDef().type)) {\r\n\t\t\tcomposedComponent = new Components[type](templateDef, this._parent.view, this._parent);\r\n\t\t\tRegistries.dataStoreRegistry.setItem(composedComponent._UID, key);\r\n\t\t}\r\n\t\telse if (templateDef.getGroupHostDef()) {\r\n\t\t\tif ((type = templateDef.getGroupHostDef().getType()) && Components[type]) {\r\n\t\t\t\tcomposedComponent = new Components[type](templateDef, this._parent.view, this._parent);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tcomposedComponent = new CompoundComponent(templateDef, this._parent.view, this._parent);\r\n\t\t\tRegistries.dataStoreRegistry.setItem(composedComponent._UID, key);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis._parent.view.subViewsHolder.memberViews.push(new CoreTypes.ComponentView(templateDef, this._parent.view, this._parent));\r\n\t}, this);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor CompoundComponentWithHooks\r\n */\r\nconst CompoundComponentWithHooks = function(definition, parentView, parent, isChildOfRoot) {\r\n\tCompoundComponent.call(this, definition, parentView, parent, isChildOfRoot);\r\n\tthis.objectType = 'CompoundComponentWithHooks';\r\n\tthis.viewExtend(definition);\r\n}\r\nconst CompoundComponentWithHooksProto_proto = Object.create(Components.ComponentWithHooks.prototype);\r\nObject.assign(CompoundComponentWithHooksProto_proto, CompoundComponent.prototype);\r\nCompoundComponentWithHooks.prototype = Object.create(CompoundComponentWithHooksProto_proto);\r\nCompoundComponentWithHooks.prototype.objectType = 'CompoundComponentWithHooks';\r\ncoreComponents.CompoundComponentWithHooks = CompoundComponentWithHooks;\r\n\r\n\r\n/**\r\n * @constructor CompoundComponentWithReactiveText\r\n */\r\nconst CompoundComponentWithReactiveText = function(definition, parentView, parent, isChildOfRoot) {\r\n\tCompoundComponent.call(this, definition, parentView, parent, isChildOfRoot);\r\n\tthis.objectType = 'CompoundComponentWithReactiveText';\r\n\tthis.viewExtend(definition);\r\n}\r\nconst CompoundComponentWithReactiveTextProto_proto = Object.create(Components.ComponentWithReactiveText.prototype);\r\nObject.assign(CompoundComponentWithReactiveTextProto_proto, CompoundComponent.prototype);\r\nCompoundComponentWithReactiveText.prototype = Object.create(CompoundComponentWithReactiveTextProto_proto);\r\nCompoundComponentWithReactiveText.prototype.objectType = 'CompoundComponentWithReactiveText';\r\ncoreComponents.CompoundComponentWithReactiveText = CompoundComponentWithReactiveText;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst createIteratingComponentHostDef = require('src/coreDefs/IteratingComponentHostDef');\r\nconst createIteratingComponentSlotsDef = require('src/coreDefs/IteratingComponentSlotsDef');\r\n\r\nconst IteratingComponent = function(definition, parentView, parent, slotDef) {\r\n\tthis.slotDef = slotDef || createIteratingComponentSlotsDef().slotDef;\r\n\t// Let's allow neither passing a parentView nor a parent.\r\n\t// This is a common pattern we've used in the documentation\r\n\t// (although the standard signature for Components has 3 parameters,\r\n\t// and is useful in more complex cases)\r\n\tif (parentView instanceof TemplateFactory.HierarchicalComponentDefModel)\r\n\t\tthis.slotDef = parentView;\r\n\telse if (parent instanceof TemplateFactory.HierarchicalComponentDefModel)\r\n\t\tthis.slotDef = parent;\r\n\t// Not passing a parentView of type \"ComponentView\"\r\n\t// should fail smoothly in the abstract components\r\n\t// but it's not heavily tested\r\n\tComponents.ComponentWithView.apply(this, arguments);\r\n\tthis.objectType = 'IteratingComponent';\r\n\t\r\n\tthis.typedSlot = new this.rDataset(\r\n\t\tnull,\t\t\t\t\t\t\t\t\t\t// wrapping component\r\n\t\tthis,\t\t\t\t\t\t\t\t\t\t// host component\r\n\t\tthis.slotDef,\t\t\t\t\t\t\t\t\t// list-item template\r\n\t\t['text']\t\t\t\t\t\t\t\t\t// schema of data for reactivity\r\n\t);\r\n}\r\nIteratingComponent.prototype = Object.create(Components.ComponentWithView.prototype);\r\nIteratingComponent.prototype.objectType = 'IteratingComponent';\r\ncoreComponents.IteratingComponent = IteratingComponent;\r\n\r\nIteratingComponent.prototype.createDefaultDef = function() {\r\n\treturn createIteratingComponentHostDef();\r\n}\r\n\r\nIteratingComponent.prototype.acquireData = function(listContentAsArray) {\r\n\tconst conformedList = listContentAsArray.map(\r\n\t\t(item) => this.typedSlot.newItem(item)\r\n\t);\r\n\tthis.typedSlot.pushApply(conformedList);\r\n}\r\n\r\nmodule.exports = IteratingComponent;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor LazySlottedCompoundComponent\r\n*/\r\nconst createLazySlottedComponentDef = require('src/coreDefs/lazySlottedComponentDef');\r\nconst createLazySlottedComponentSlotstDef = require('src/coreDefs/lazySlottedComponentSlotsDef');\r\nconst LazySlottedCompoundComponent = function(definition, parentView, parent, slotsCount, slotsDef) {\r\n\tvar stdDefinition = definition || createLazySlottedComponentDef();\r\n\tthis.typedSlots = [];\r\n\tthis.slotsCount = slotsCount || this.slotsCount || 2;\r\n\t//\tconsole.log(this.slotsDef);\r\n\tthis.slotsDef = slotsDef || this.slotsDef || createLazySlottedComponentSlotstDef();\r\n\r\n\t// Proceeding that way (i.e. not using the complete mixin mechanism : \"addInterface\") allows us to choose in which order the ctors are called\r\n\t// When the base ctor is called, it calls the extension's ctor, and then, and only then, the superClasse's ctor\r\n\t// (which would have been called before the extension's one if we had used the \"addInterface\" mechanism)\r\n\t// Full motivation : as we don't want to define a view twice (the two mixed ctor's both call their superClasse's ctor : ComponentWithView),\r\n\t// we bypassed the call to super() in the LazySlottedCompoundComponent ctor\r\n\t//\r\n\t// We could choose not to call the CompoundComponent ctor, but then we wouldn't be able to define subSections or members (ou would have to explicitly call the methods then)\r\n\t// Other issue : the CompoundComponent ctor would be called with the arguments received by the mergedConstructor(), and they do not include a definition object\r\n\t// Keeping that here makes the code base cleaner\r\n\r\n\t// Get a definition :\r\n\t// Here, the initial def allows an undefined number of tabs\r\n\tthis.updateDefinitionBasedOnSlotsCount(stdDefinition);\r\n\r\n\tCompoundComponentWithHooks.call(this, stdDefinition, parentView, parent);\r\n\r\n\t//\tconsole.log('LazySlottedCompoundComponent - Ctor Rendering \\n\\n\\n');\r\n\t//\tthis.render(null, stdDefinition.lists[0].host);\r\n\r\n\tthis.objectType = 'LazySlottedCompoundComponent';\r\n\r\n\tthis.affectSlots();\r\n\r\n\t// This is an abstract Class\r\n\t// For a \"straight\" TabPanel Class, we would have assumed this.slotsCount is 2\r\n\t// And for an imaginary other implementation of the LazySlottedCompoundComponent class, we should have handled the slotsCount case : it may be defined anteriorly, or fixed, or...\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tthis.typedSlots[i].setSchema(['slotTitle']);\r\n\t}\r\n\r\n\tthis.createEvent('header_clicked');\r\n\r\n\tthis.slotsCache = new TypeManager.PropertyCache('LazySlottedCompoundComponentSlotsCache' + this._UID);\r\n\t\r\n\t// Exception : we want to call an async task, but the prototype of an abstract type CAN'T have a _asyncInitTasks property\r\n\t// ONLY a concrete type may declare it on its prototype, cause if the property already exists,\r\n\t// the prototype of the abstract type will be overridden with an asyncTasks-array coming from a concrete type.\r\n\t// So : => We need to define the _asyncInitTasks in the constructor of the abstract type\r\n\t// in a manner so it won't override the property defined on the prototype of the concrete type,\r\n\t// and the prototype of the concrete type won't override a prop that doen't exist yet on the abstract type\r\n\t// when defining the prototype.\r\n\tif (!Array.isArray(this._asyncInitTasks))\r\n\t\tthis._asyncInitTasks = [];\r\n\tthis._asyncInitTasks.push(new TypeManager.TaskDefinition({\r\n\t\ttype : 'viewExtend',\r\n\t\ttask : function(definition) {\r\n\t\t\tthis.hackDOMAttributes();\r\n\t\t}\r\n\t}));\r\n}\r\nLazySlottedCompoundComponent.prototype = Object.create(CompoundComponentWithHooks.prototype);\r\nLazySlottedCompoundComponent.prototype.objectType = 'LazySlottedCompoundComponent';\r\ncoreComponents.LazySlottedCompoundComponent = LazySlottedCompoundComponent;\r\n\r\n\r\n// TMP Hack: assign DOM attributes on pseudo-slots (though we should do that through reactivity, see \"ColorSamplerSetComponent\")\r\nLazySlottedCompoundComponent.prototype.hackDOMAttributes = function() {\r\n\tconsole.log('hackDOMAttributes');\r\n\tthis._children.forEach(function(child, key) {\r\n\t\tchild.view.getMasterNode().streams = child.streams;\r\n\t\tchild.view.getMasterNode().setAttribute('slot-id', 'slot' + key.toString());\r\n\t}, this);\r\n}\r\n\r\n/**\r\n * updateDefinitionBasedOnSlotsCount\r\n * This method initializes the current definition with as much pseudo-slots as in slotCount\r\n */\r\nLazySlottedCompoundComponent.prototype.updateDefinitionBasedOnSlotsCount = function(definition) {\r\n//\tif (definition.lists[0] && definition.lists[0].host.each.length)\r\n//\t\tconsole.warn(this.objectType, ': Initializing a ReactiveDataset with an inital value. Please ensure this is intentional. (it may result from using the same instance of a definition multiple times)');\r\n\t\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tdefinition.lists[0].host.each.push({ 'slot-id': 'slot' + i });\r\n\t}\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.affectSlots = function() {\r\n\tlet slotsDefs  = Object.values(this.slotsDef);\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tthis.typedSlots.push(new this.rDataset(\r\n\t\t\tnull,\r\n\t\t\tthis._children[i],\r\n\t\t\tslotsDefs[i],\r\n\t\t\t[])\r\n\t\t);\r\n\t}\r\n\t// This method used to return \"true\". As it was obviously a dirty hack, we've deteted that instruction.\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.setSchema = function() {\r\n\tif (arguments.length !== this.slotsCount) {\r\n\t\tconsole.warn('globally setting schema failed : not the right number of args')\r\n\t}\r\n\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tthis.typedSlots[i].setSchema([arguments[i]]);\r\n\t}\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.getSlot = function(Idx) {\r\n\treturn this._children[Idx];\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.getFirstSlot = function() {\r\n\treturn this._children[0];\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.getFirstSlotChildren = function() {\r\n\treturn this._children[0]._children;\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.pushToSlotFromText = function(slotNbr, content) {\r\n\t// Here, newItem() depends on the type given in the ctor... or afterwards with setSchema()\r\n\tthis.typedSlots[slotNbr].push(this.typedSlots[slotNbr].newItem(content));\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.pushApplyToSlot = function(slotNbr, contentAsArray) {\r\n\t// Here, newItem() depends on the type given in the ctor... or afterwards with setSchema()\r\n\tvar cAsArray = contentAsArray.map(function(value, key) {\r\n\t\tif (typeof value !== 'object' || !(value instanceof this.typedSlots[slotNbr].Item))\r\n\t\t\treturn this.typedSlots[slotNbr].newItem(value);\r\n\t\telse\r\n\t\t\treturn value;\r\n\t}, this);\r\n\t//\tconsole.log(cAsArray.slice(0));\r\n\tthis.typedSlots[slotNbr].pushApply(cAsArray);\r\n\t//\treturn contentAsArray;\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.pushDefaultToSlot = function(slotNbr) {\r\n\t// Here, newItem() depends on the type given in the ctor... or afterwards with setSchema()\r\n\tthis.typedSlots[slotNbr].push(this.typedSlots[slotNbr].newItem(''));\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.pushMultipleDefaultToSlot = function(slotNbrArray) {\r\n\tslotNbrArray.forEach(function(slotNbr) {\r\n\t\tthis.pushDefaultToSlot(slotNbr);\r\n\t}, this);\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.addPairedItems = function(slotTextContent) {\r\n\tfor (let i = 0, l = arguments.length; i < l; i++) {\r\n\t\tthis.pushToSlotFromText(0, arguments[i]);\r\n\t\tthis.pushToSlotFromText(1, '');\r\n\t}\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.emptySlots = function() {\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tthis.typedSlots[i].resetLength();\r\n\t}\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.cacheSlots = function(userlandUID) {\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tif (!this.slotsCache.getItem(userlandUID + i.toString())) {\r\n\t\t\tvar savedSlot = {\r\n\t\t\t\tcontent: this.typedSlots[i].slice(0),\r\n\t\t\t\tchildren: this.typedSlots[i].rootComponent._children.slice(0)\r\n\t\t\t}\r\n\t\t\tthis.slotsCache.setItem(userlandUID + i.toString(), savedSlot);\r\n\t\t}\r\n\t\t//\t\tthis.typedSlots[i].resetLength();\r\n\t}\r\n}\r\n\r\nLazySlottedCompoundComponent.prototype.retrieveSlots = function(userlandUID) {\r\n\tvar slot;\r\n\tfor (let i = 0, l = this.slotsCount; i < l; i++) {\r\n\t\tslot = this.slotsCache.getItem(userlandUID + i.toString());\r\n\t\tif (slot) {\r\n\t\t\tArray.prototype.splice.call(this.typedSlots[i], 0, slot.content.length, ...slot.content);\r\n\t\t\tslot.children.forEach(function(child, key) {\r\n\t\t\t\tthis.typedSlots[i].rootComponent.pushChild(child);\r\n\t\t\t\tif (child.view) // this.slotsCache.getItem(userlandUID1) is a pseudo component (an object with an init() method)\r\n\t\t\t\t\tthis.typedSlots[i].rootComponent.view.addChildAt(child.view, slot.children.length); //  (- 1  & slot.children.length) cause 0 would cause an append (see view.addChildAt())\r\n\t\t\t}, this);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst createAbstractTreeDef = require('src/coreDefs/abstractTreeDef');\r\nconst createBranchTemplateDef = require('src/coreDefs/branchTemplateDef');\r\nconst createLeafTemplateDef = require('src/coreDefs/leafTemplateDef');\r\n\r\nconst AbstractTree = function(definition, parentView, parent, jsonData, nodeFilterFunction) {\r\n\t//\tconsole.log(definition, parentView, parent, jsonData);\r\n\tvar stdDefinition = createAbstractTreeDef();\r\n\t// HACK: no solution for now to override the default def : there is no createDefaultDef method on a compound component\r\n\tif  (definition.getGroupHostDef().sOverride)\r\n\t\tstdDefinition.getGroupHostDef().sOverride = definition.getGroupHostDef().sOverride;\r\n\t\r\n\t/**\r\n\t * Standard Implementation :\r\n\t * (this requirements may be overridden through extension. see affectClickEvents())\r\n\t */\r\n\t// Banch Component MUST implement the 'clicked_ok' event (and though inherit from ComponentWithHooks)\r\n\tthis.branchTemplate = this.branchTemplate || createBranchTemplateDef();\r\n\t// Leaf Component MUST at least inherit from ComponentWithHooks\r\n\tthis.leafTemplate = this.leafTemplate || createLeafTemplateDef();\r\n\tthis.pseudoModel = [];\r\n\tthis.listTemplate = TypeManager.createComponentDef({ type: 'ComponentList' });\r\n\tthis.listTemplate.getHostDef().each = this.pseudoModel;\r\n\r\n\tthis.expanded = this.expanded || 'expanded';\r\n\r\n\tCompoundComponent.call(this, stdDefinition, parentView, parent);\r\n\tthis.objectType = 'AbstractTree';\r\n\r\n\tthis.addEventListener('update', function(e) {\r\n\t\t//\t\tconsole.log('abstractTree receives update and sets \"selected\"', e.data);\r\n\t\tthis.streams.selected.value = e.data.self_UID;\r\n\t}.bind(this));\r\n\tthis.createEvent('exportdata');\r\n\t\r\n\tif (jsonData && Object.prototype.toString.call(jsonData) === '[object Object]')\r\n\t\tthis.renderJSON(jsonData, nodeFilterFunction);\r\n}\r\nAbstractTree.prototype = Object.create(CompoundComponentWithHooks.prototype);\r\nAbstractTree.prototype.objectType = 'AbstractTree';\r\ncoreComponents.AbstractTree = AbstractTree;\r\n\r\nAbstractTree.prototype.createMember = function(memberSpec, parent) {\r\n\tvar type = memberSpec.type, componentDef, component;\r\n//\tconsole.log(memberSpec);\r\n\t//\tconsole.log(memberSpec);\r\n\tif (memberSpec.children.length) {\r\n\t\t// When a def isn't already cached, isKnownUID() returns a string : the definitionsCache creates an emty entry and returns the newly added cacheID\r\n\t\tif (typeof (componentDef = TypeManager.definitionsCache.isKnownUID('branchTemplate_' + type)) === 'string') {\r\n\t\t\tcomponentDef = TypeManager.createComponentDef(this.branchTemplate);\r\n\t\t\t//\t\t\tcomponentDef.getGroupHostDef().attributes.push(TypeManager.PropsFactory({textContent : this.getHeaderTitle(type)}));\r\n\t\t}\r\n\r\n\t\tcomponent = new CompoundComponent(componentDef, parent.view, parent);\r\n\t\tRegistries.dataStoreRegistry.setItem(component._UID, this.pseudoModel.length);\r\n\t\tthis.pseudoModel.push(this.getHeaderTitle(memberSpec));\r\n\t}\r\n\telse {\r\n\t\tcomponent = new Components[this.leafTemplate.getHostDef().type](this.leafTemplate, parent.view, parent);\r\n\t\tRegistries.dataStoreRegistry.setItem(component._UID, this.pseudoModel.length);\r\n\t\tthis.pseudoModel.push(this.getKeyValueObj(memberSpec));\r\n\t}\r\n\treturn component;\r\n};\r\n\r\nAbstractTree.prototype.getHeaderTitle = function(memberSpec) {\r\n\tvar len = memberSpec.children.length;\r\n\tif (memberSpec.type === 'array')\r\n\t\treturn {\r\n\t\t\theaderTitle: \"[\".concat(len, \"]\"),\r\n\t\t\tdisplayedas: memberSpec.type,\r\n\t\t\texpanded: this.expanded\r\n\t\t};\r\n\telse if (memberSpec.type === 'object')\r\n\t\treturn {\r\n\t\t\theaderTitle: \"{\".concat(len, \"}\"),\r\n\t\t\tdisplayedas: memberSpec.type,\r\n\t\t\texpanded: this.expanded\r\n\t\t};\r\n}\r\n\r\nAbstractTree.prototype.getKeyValueObj = function(memberSpec) {\r\n\treturn {\r\n\t\tkeyValuePair: ['', memberSpec.key + (memberSpec.children.length ? '&nbsp;:&nbsp;' : ''), (memberSpec.type === 'string' ? ' \"' + memberSpec.value.toString() + '\"' : memberSpec.value.toString())],\r\n\t\tdisplayedas: memberSpec.type\r\n\t};\r\n}\r\n\r\nAbstractTree.prototype._typeof = function(obj) {\r\n\tvar _typeof;\r\n\tif (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\r\n\t\t_typeof = function(obj) {\r\n\t\t\treturn typeof obj;\r\n\t\t};\r\n\t} else {\r\n\t\t_typeof = function(obj) {\r\n\t\t\treturn obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\r\n\t\t};\r\n\t}\r\n\r\n\treturn _typeof(obj);\r\n}\r\n\r\nAbstractTree.prototype.getDataType = function(obj) {\r\n\r\n\tvar type = this._typeof(obj);\r\n\r\n\tif (Array.isArray(obj))\r\n\t\ttype = 'array';\r\n\tif (obj === null)\r\n\t\ttype = 'null';\r\n\r\n\treturn type;\r\n}\r\n\r\nAbstractTree.prototype.createNode = function() {\r\n\tvar opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\r\n\treturn {\r\n\t\tkey: opt.key || null,\r\n\t\tparent: opt.parent || null,\r\n\t\tvalue: opt.hasOwnProperty('value') ? opt.value : null,\r\n\t\tisExpanded: opt.isExpanded || false,\r\n\t\ttype: opt.type || null,\r\n\t\tchildren: opt.children || [],\r\n\t\tel: opt.el || null,\r\n\t\tdepth: opt.depth || 0\r\n\t};\r\n}\r\n\r\nAbstractTree.prototype.createSubnodes = function(data, node) {\r\n\tif (this._typeof(data) === 'object') {\r\n\t\tfor (var key in data) {\r\n\t\t\tvar child = this.createNode({\r\n\t\t\t\tvalue: data[key],\r\n\t\t\t\tkey: key,\r\n\t\t\t\tdepth: node.depth + 1,\r\n\t\t\t\ttype: this.getDataType(data[key]),\r\n\t\t\t\tparent: node\r\n\t\t\t});\r\n\t\t\tnode.children.push(child);\r\n\t\t\tthis.createSubnodes(data[key], child);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nAbstractTree.prototype.createTree = function(jsonData) {\r\n\tvar data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;\r\n\tvar rootNode = this.createNode({\r\n\t\tvalue: data,\r\n\t\tkey: 'root',\r\n\t\ttype: this.getDataType(data)\r\n\t});\r\n\tthis.createSubnodes(data, rootNode);\r\n\treturn rootNode;\r\n}\r\n\r\nAbstractTree.prototype.traverseTree = function(memberDesc, parentComponent, callback) {\r\n\t//console.log(node);\r\n\tvar component = callback(memberDesc, parentComponent);\r\n\t//console.log(node);\r\n\r\n\tif (memberDesc.children.length > 0) {\r\n\t\tmemberDesc.children.forEach(function(child) {\r\n\t\t\tthis.traverseTree(child, component, callback);\r\n\t\t}, this);\r\n\t}\r\n}\r\n\r\nAbstractTree.prototype.instanciateTreeMembers = function(tree, nodeFilterFunction) {\r\n\tvar self = this;\r\n\tthis.traverseTree(tree, this, function(memberDesc, parentComponent) {\r\n\t\tvar component;\r\n\t\tif (typeof nodeFilterFunction !== 'function') {\r\n\t\t\tcomponent = self.createMember(memberDesc, parentComponent);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmemberDesc = nodeFilterFunction(memberDesc);\r\n\t\t\tcomponent = self.createMember(memberDesc, parentComponent);\r\n\t\t}\r\n\t\tself.affectClickEvents(memberDesc, component);\r\n\t\treturn component;\r\n\t});\r\n}\r\n\r\nAbstractTree.prototype.renderJSON = function(jsonData, nodeFilterFunction) {\r\n\t//\tconsole.log(jsonData);\r\n\tvar parsedData = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;\r\n\tvar tree = this.createTree(parsedData);\r\n\t//\tconsole.log(parsedData, tree);\r\n\tthis.instanciateTreeMembers(tree, nodeFilterFunction);\r\n\r\n\tvar DOMNodeId;\r\n\tthis.render(DOMNodeId);\r\n\treturn tree;\r\n}\r\n\r\nAbstractTree.prototype.reset = function() {\r\n\tthis.removeAllChildren();\r\n\tthis.clearEventListeners('exportdata');\r\n}\r\n\r\nAbstractTree.prototype.render = function() { } \t\t\t\t\t\t\t\t\t// pure virtual (injected as a dependancy by AppIgnition)\r\nAbstractTree.prototype.affectClickEvents = function(memberDesc, component) { \t// virtual with default (implemented through override on extension)\r\n\tthis.affectClickEvents_Base(memberDesc, component);\r\n}\r\n\r\nAbstractTree.prototype.affectClickEvents_Base = function(memberDesc, component) {\r\n\tvar self = this;\r\n\r\n\tif (memberDesc.children.length) {\r\n\t\t// Say we have a header node, containing 2 pictos (arrows), and an appended span, key: value\r\n\t\tcomponent._children[0].addEventListener('clicked_ok', function(e) {\r\n\t\t\t// When artificially clicked from outside of the component, there is no e.data.target\r\n\t\t\tif ((!e.data || !e.data.target) || e.data.target === this.view.getWrappingNode().children[2])\r\n\t\t\t\tself.trigger('exportdata', memberDesc.projectedData); // the component shall trigger update and receive the \"selected\" attribute: not needed here\r\n\t\t\telse\r\n\t\t\t\tcomponent.streams.expanded.value = !component.streams.expanded.value ? 'expanded' : null;\r\n\t\t}.bind(component._children[0]));\r\n\t}\r\n\telse {\r\n\t\t// Leaf Component MUST inherit from ComponentWithHooks\r\n\t\tcomponent.registerClickEvents = function() {\r\n\t\t\tif (!component._eventHandlers.clicked_ok)\r\n\t\t\t\tcomponent.createEvent('clicked_ok');\r\n\t\t\t\r\n\t\t\tObject.getPrototypeOf(this).registerClickEvents.call(this);\r\n\r\n\t\t\t// Say we have 2 divs with key : value\r\n\t\t\tthis.view.subViewsHolder.memberViews[1].getWrappingNode().addEventListener('click', function(e) {\r\n\t\t\t\tthis.trigger('clicked_ok', e);\r\n\t\t\t}.bind(component));\r\n\t\t\tcomponent.addEventListener('clicked_ok', function(e) {\r\n\t\t\t\tthis.streams.selected.value = 'selected';\r\n\t\t\t\tthis.trigger('update', { self_UID: component._UID }, true);\r\n\t\t\t\tself.trigger('exportdata', memberDesc.projectedData);\r\n\t\t\t}.bind(component));\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst createAbstractTableDef = require('src/coreDefs/abstractTableDef');\r\nconst createAbstractTableSlotsDef = require('src/coreDefs/abstractTableSlotsDef');\r\n\r\n\r\nconst AbstractTable = function(def, parentView, parent) {\r\n\tthis.slotsCount = 2;\r\n\r\n\tvar stdDef = def || createAbstractTableDef();\r\n\tthis.slotsDef = this.slotsDef || createAbstractTableSlotsDef();\r\n\tthis.columnsCount = this.columnsCount || 2;\r\n\tthis.rowsCount = 0;\r\n\r\n\tLazySlottedCompoundComponent.call(this, stdDef, parentView, parent);\r\n\tthis.typedSlots[0].setSchema(['headerTitle']);\r\n\t// The schema for rows depends \r\n\tthis.typedSlots[1].setSchema(['rowContentAsArray']);\r\n\r\n\t// This concern is left to the implementation discretion\r\n\t//\tthis.setcolumnsCount(this.columnsCount);\r\n}\r\n\r\n/**\r\n * @chained_inheritance AbstractTable <= LazySlottedCompoundComponent <= ComponentWithReactiveText\r\n */\r\nconst AbstractTableProto_proto = Object.create(LazySlottedCompoundComponent.prototype);\r\nObject.assign(AbstractTableProto_proto, Components.ComponentWithReactiveText.prototype);\r\nAbstractTable.prototype = Object.create(AbstractTableProto_proto);\r\nAbstractTable.prototype.objectType = 'AbstractTable';\r\ncoreComponents.AbstractTable = AbstractTable;\r\n\r\n\r\nAbstractTable.prototype.setColumnsCount = function(columnsCount, headerTitles) {\r\n\tthis.columnsCount = columnsCount;\r\n\tthis.typedSlots[0].resetLength();\r\n\t//\tconsole.log(this.typedSlots[0]);\r\n//\tif (!Array.isArray(headerTitles)) {\r\n//\t\theaderTitles = ['idx'];\r\n//\t\tfor (let i = 1; i < columnsCount; i++) {\r\n//\t\t\theaderTitles.push('Column ' + i.toString());\r\n//\t\t}\r\n//\t}\r\n//\telse if (headerTitles[0] !== 'idx')\r\n//\t\theaderTitles.unshift('idx');\r\n\t\t\r\n\tconst {rowDef, tdDef} = this.slotsDef;\r\n\tlet uniqueTdDef;\r\n\tfor (let i = 0; i < columnsCount; i++) {\r\n\t\tuniqueTdDef = TemplateFactory.createDef(tdDef);\r\n\t\trowDef.members.push(uniqueTdDef)\r\n\t};\r\n\treturn this.pushApplyToSlot(0, headerTitles);\r\n}\r\n\r\n\r\nAbstractTable.prototype.pushToSlotFromText = function(slotNbr, content) {\r\n\t// Here, newItem() depends on the type given in the ctor... or afterwards with setSchema()\r\n\tthis.typedSlots[slotNbr].push(this.typedSlots[slotNbr].newItem(content));\r\n\r\n\tif (slotNbr === 0) {\r\n\t\tvar lastChild = this._children[0].getLastChild();\r\n\t\tlastChild.view.getMasterNode().addEventListener('mousedown', function(e) {\r\n\t\t\tthis.trigger('header_clicked', { self_key: lastChild._key });\r\n\t\t\tthis._children[0].childButtonsSortedLoop(lastChild._key);\r\n\t\t}.bind(this));\r\n\t}\r\n}\r\n\r\nAbstractTable.prototype.pushApplyToSlot = function(slotNbr, contentAsArray) {\r\n\tvar lastChildIndex = this._children[0]._children.length;\r\n\t// Here, newItem() depends on the type given in the ctor... or afterwards with setSchema()\r\n\tvar cAsArray = contentAsArray.map(function(value, key) {\r\n\t\tif (typeof value !== 'object' || !(value instanceof this.typedSlots[slotNbr].Item))\r\n\t\t\treturn this.typedSlots[slotNbr].newItem(value);\r\n\t\telse\r\n\t\t\treturn value;\r\n\t}, this);\r\n\t\r\n//\tconsole.log(cAsArray);\r\n\tthis.typedSlots[slotNbr].pushApply(cAsArray);\r\n\r\n\tif (slotNbr === 0) {\r\n\t\tfor (let i = lastChildIndex; i < this._children[0]._children.length; i++) {\r\n\t\t\tthis._children[0]._children[i].view.getMasterNode().addEventListener('mousedown', function(e) {\r\n\t\t\t\tthis.trigger('header_clicked', { self_key: this._children[0]._children[i]._key });\r\n\t\t\t\tthis._children[0].childButtonsSortedLoop(this._children[0]._children[i]._key);\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nAbstractTable.prototype.getRows = function() {\r\n\treturn this._children[1];\r\n}\r\n\r\nAbstractTable.prototype.getRow = function(idx) {\r\n\treturn this._children[1]._children[idx];\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor AbstractAccordion\r\n * \r\n * @similarTo TypedListComponent : a restricted form of LazySlottedCompoundComponent\r\n * \t\t\t\twhere slots are appended to self.\r\n*/\r\nconst createAbstractAccordionDef = require('src/coreDefs/AbstractAccordionDef');\r\nconst createAbstractAccordionSlotDef = require('src/coreDefs/AbstractAccordionSlotsDef');\r\n\r\nconst AbstractAccordion = function(definition, parentView, parent, hostedTypes) {\r\n\tif (!definition.getGroupHostDef().nodeName)\r\n\t\tdefinition = createAbstractAccordionDef();\r\n\r\n\tthis.slotsCount = 0;\r\n\r\n\tthis.typedSlots = [];\r\n\tthis.slotsAssociation = {};\r\n\tthis.slotsDefFactory = this.slotsDefFactory || createAbstractAccordionSlotDef;\r\n\r\n\tif (Array.isArray(hostedTypes) && hostedTypes.length) {\r\n\t\tthis.slotsCount = hostedTypes.length;\r\n\t\tthis.updateDefinitionBasedOnSlotsCouunt(definition, hostedTypes);\r\n\t}\r\n\telse {\r\n\t\tconsole.warn('AbstractAccordion', 'a \"hostedTypes\" arg should be provided, unless the component shall have no child');\r\n\t}\r\n\r\n\tCompoundComponent.call(this, definition || createAbstractAccordionDef(), parentView, parent);\r\n\r\n\tthis.objectType = 'AbstractAccordion';\r\n\tthis.affectSlots(hostedTypes);\r\n\r\n}\r\nAbstractAccordion.prototype = Object.create(CompoundComponent.prototype);\r\nAbstractAccordion.prototype.objectType = 'AbstractAccordion';\r\ncoreComponents.AbstractAccordion = AbstractAccordion;\r\n\r\nAbstractAccordion.prototype.updateDefinitionBasedOnSlotsCouunt = function(definition, hostedTypes) {\r\n\thostedTypes.forEach(function(hostSpec, key) {\r\n\t\tdefinition.lists[0].getHostDef().each.push(\r\n\t\t\t{ \"accordion-set\": 'set_1' }\r\n\t\t);\r\n\t\tthis.slotsAssociation[hostSpec.endPointName] = key;\r\n\t}, this);\r\n}\r\n\r\n/**\r\n * @same_as TypedListComponent\r\n */\r\nAbstractAccordion.prototype.affectSlots = function(hostedTypes) {\r\n\t//\tconsole.log(this._children.length);\r\n\tfor (var i = 0; i < this.slotsCount; i++) {\r\n\t\tthis.typedSlots.push(new this.rDataset(\r\n\t\t\tthis._children[i],\r\n\t\t\tthis._children[i],\r\n\t\t\tthis.slotsDefFactory(),\r\n\t\t\t['updateChannel'])\r\n\t\t);\r\n\t\tthis.typedSlots[i].defaultListDef.getHostDef().template.getGroupHostDef().type = hostedTypes[i].componentType;\r\n\t\t//\t\tconsole.log(this.typedSlots[i].defaultListDef.getHostDef());\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nAbstractAccordion.prototype.stylePanelToFront = function(Idx) {\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//componentTypes.ComponentWithView = Components.ComponentWithView;\r\n//componentTypes.ComponentWithHooks = Components.ComponentWithHooks;\r\n// Extension continues in ReactiveDataset, ComponentSet\r\n//componentTypes.LazySlottedCompoundComponent = LazySlottedCompoundComponent;\r\n//componentTypes.AbstractTable = AbstractTable;\r\n//componentTypes.AbstractTree = AbstractTree;\r\n\r\nComponents.CompoundComponent = CompoundComponent;\t// CompoundComponent may be called as a type\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Some formal implementations rely on Dependancy Injection\r\nComponents.CompositorComponent.prototype.acquireCompositor = function(inheritingType, inheritedType) {\t// special helper\r\n\tif (inheritedType in Components || inheritedType in coreComponents) {\r\n\t\tvar objectType = inheritingType.prototype.objectType;\r\n\t\tinheritingType.prototype.Compositor = coreComponents[inheritedType];\r\n//\t\tconsole.log(inheritingType.prototype.Compositor);\r\n\t\t//\t\tconsole.log(Object.create(coreComponents[inheritedType].prototype));\r\n\t\t//\t\tconsole.log(Components.ExtensibleObject.prototype.mergeOwnProperties(true, Object.create(coreComponents[inheritedType].prototype), inheritingType.prototype));\r\n\t\tinheritingType.prototype = Components.ExtensibleObject.prototype.mergeOwnProperties(true, Object.create(coreComponents[inheritedType].prototype), inheritingType.prototype);\r\n\t\tinheritingType.prototype.objectType = objectType;\r\n\t\tif (!inheritingType.prototype._implements || !inheritingType.prototype._implements.length)\r\n\t\t\tinheritingType.prototype._implements = [inheritedType];\r\n\t\telse\r\n\t\t\tinheritingType.prototype._implements.push(inheritedType);\r\n\t}\r\n}\r\n\r\nComponents.CompositorComponent.createAppLevelExtendedComponent = function() {\r\n\tvar extension2ndPass = {};\r\n//\tconsole.error(typeof Components.GradientGenerator);\r\n\tfor (var componentType in Components) {\r\n\t\tif (Components[componentType].hasOwnProperty('dependancyInjectionDone'))\r\n\t\t\tcontinue;\r\n\t\t// An automatically included component may not really be a component : we have a \"special\" category that we also include\r\n\t\tif (typeof Components[componentType].prototype === 'undefined')\r\n\t\t\tcontinue;\r\n\t\t\t\r\n//\t\tconsole.log(componentType, typeof Components[componentType].prototype, Components[componentType].prototype.hasOwnProperty('extendsCore'));\r\n//\t\tif (!Components[componentType].prototype.hasOwnProperty('extendsCore'))\r\n//\t\t\tconsole.log(Components[componentType].prototype);\r\n//\t\tconsole.log(Components[componentType].prototype.hasOwnProperty('extendsCore'), componentType, Components[componentType]);\r\n\t\t\t\t \r\n\t\tif (Components[componentType].prototype.hasOwnProperty('extendsCore')) {\r\n//\t\t\tconsole.log(Components[componentType]);\r\n\t\t\tComponents.CompositorComponent.prototype.acquireCompositor(Components[componentType], Components[componentType].prototype.extendsCore);\r\n\t\t\tComponents[componentType].dependancyInjectionDone = true;\r\n\t\t}\r\n\t\telse if (Components[componentType].prototype.hasOwnProperty('extends')) {\r\n\t\t\textension2ndPass[componentType] = Components[componentType];\r\n\t\t}\r\n\t\t\t\r\n\t\t\r\n\t}\r\n\tfor (var componentType in extension2ndPass) {\r\n\t\tif (Components[componentType].hasOwnProperty('dependancyInjectionDone'))\r\n\t\t\tcontinue;\r\n\t\tComponents.CompositorComponent.prototype.extendFromCompositor(Components[componentType], Components[Components[componentType].prototype.extends]);\r\n\t\tComponents[componentType].dependancyInjectionDone = true;\r\n\t}\r\n}\r\n\r\n\r\nCompoundComponent.componentTypes = Components;\r\nCompoundComponent.coreComponents = coreComponents;\r\nmodule.exports = CompoundComponent;",
    "\"use strict\";\n/**\r\n * \r\n */\r\n\r\n\r\n\r\nconst appConstants = require('src/appLauncher/appLauncher');\r\n//const TypeManager = require('src/core/TypeManager');\r\nconst TemplateFactory = require('src/core/TemplateFactory');\r\nconst Registries = require('src/core/Registries');\r\nconst SWrapperInViewManipulator = require('src/_DesignSystemManager/SWrapperInViewManipulator');\r\n\r\n\r\nconst UIDGenerator = require('src/core/UIDGenerator');\r\nconst PropertyCache = require('src/core/PropertyCache');\r\nconst CachedTypes = require('src/core/CachedTypes');\r\n//const idGenerator = TemplateFactory.UIDGenerator;\r\nconst nodesRegistry = Registries.nodesRegistry;\r\nconst viewsRegistry = Registries.viewsRegistry;\r\n\r\n//const JSkeyboardMap = require('src/events/JSKeyboardMap');\r\n\r\n\r\n\r\n\r\n\r\n\r\n//console.log(nodesRegistry);\r\n//console.log(viewsRegistry);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor Pair\r\n * \r\n * @param String name\r\n * @param String value\r\n */\r\nvar Pair = function(name, value) {\r\n\tthis.name = name;\r\n\tthis.value = value;\r\n}\r\nPair.prototype = {};\r\n\r\n\r\n\r\n\r\n\r\nvar ListOfPairs = function(pseudoNameValuePairsList) {\r\n\tif (Array.isArray(pseudoNameValuePairsList)) {\r\n\t\tfor (let i = 0, l = pseudoNameValuePairsList.length; i < l; i++) {\r\n\t\t\tthis.push(\r\n\t\t\t\tnew Pair(\r\n\t\t\t\t\tpseudoNameValuePairsList[i].name,\r\n\t\t\t\t\tpseudoNameValuePairsList[i].value\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\nListOfPairs.prototype = Object.create(Array.prototype);\r\nObject.defineProperty(ListOfPairs.prototype, 'objectType', {\r\n\tvalue : 'ListOfPairs'\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar DimensionsPair = function(initialValues) {\r\n\tthis.inline = initialValues ? initialValues[0] : 0;\r\n\tthis.block = initialValues ? initialValues[1] : 0;\r\n}\r\nDimensionsPair.prototype = {};\r\nDimensionsPair.prototype.objectType = 'DimensionsPair';\r\n\r\nDimensionsPair.prototype.set = function(valuesPair) {\r\n\tthis.inline = valuesPair[0];\r\n\tthis.block = valuesPair[1];\r\n\treturn this;\r\n}\r\nDimensionsPair.prototype.add = function(valuesPair) {\r\n\tthis.inline += valuesPair[0];\r\n\tthis.block += valuesPair[1];\r\n\treturn this;\r\n}\r\nDimensionsPair.prototype.substract = function(valuesPair) {\r\n\tthis.inline -= valuesPair[0];\r\n\tthis.block -= valuesPair[1];\r\n\treturn this;\r\n}\r\n//dimensionsPair.prototype.getInlineValue = function() {\r\n//\treturn this.inline;\r\n//}\r\n//dimensionsPair.prototype.getBlockValue = function() {\r\n//\treturn this.block;\r\n//}\r\n//dimensionsPair.prototype.setInlineValue = function(inline) {\r\n//\tthis.inline = inline;\r\n//}\r\n//dimensionsPair.prototype.setBlockValue = function(block) {\r\n//\tthis.block = block;\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor EventEmitter\r\n */\r\nvar EventEmitter = function() {\r\n\tthis.objectType = 'EventEmitter';\r\n\tthis._eventHandlers = {};\r\n\tthis._one_eventHandlers = {};\r\n\tthis._identified_eventHandlers = {};\r\n\t\r\n\tthis.createEvents();\r\n}\r\nEventEmitter.prototype = {};\r\nEventEmitter.prototype.objectType = 'EventEmitter';\r\n\r\n/**\r\n * @virtual\r\n */\r\nEventEmitter.prototype.createEvents = function() {}\t\t\t\t// virtual\r\n\r\n/**\r\n * Creates a listenable event : generic event creation (onready, etc.)\r\n * \r\n * @param {string} eventType\r\n */\r\nEventEmitter.prototype.createEvent = function(eventType) {\r\n\tvar self = this;\r\n\tthis._eventHandlers[eventType] = [];\r\n\tif (!Object.getOwnPropertyDescriptor(this, 'on' + eventType)) {\r\n\t\tvar propDescriptor = {};\r\n\t\tpropDescriptor['on' + eventType] = {\r\n\t\t\tset : function(callback) {\r\n\t\t\t\tself.addEventListener(eventType, callback);\r\n\t\t\t}\r\n\t\t}\r\n\t\tObject.defineProperties(this, propDescriptor);\r\n\t}\r\n\telse {\r\n\t\tconsole.warn(this.objectType, ': this.createEvent has been called twice with the same eventType =>', eventType);\r\n\t}\r\n\t\r\n\tthis._one_eventHandlers[eventType] = [];\r\n\t// identified event handlers are meant to be disposable\r\n\tthis._identified_eventHandlers[eventType] = [];\r\n}\r\n/**\r\n * Deletes... an event\r\n * \r\n * @param {string} eventType\r\n */\r\nEventEmitter.prototype.deleteEvent = function(eventType) {\r\n\tdelete this['on' + eventType];\r\n}\r\n\r\nEventEmitter.prototype.hasStdEvent = function(eventType) {\r\n\t\r\n\treturn (typeof this._eventHandlers[eventType] !== 'undefined');\r\n}\r\n\r\n/**\r\n * @param {string} eventType\r\n * @param {function} handler : the handler to remove (the associated event stays available) \r\n */\r\nEventEmitter.prototype.removeEventListener = function(eventType, handler) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tfor(var i = 0, l = this._eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._eventHandlers[eventType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tfor(var i = 0, l = this._one_eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._one_eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._one_eventHandlers[eventType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tfor(var i = 0, l = this._identified_eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._identified_eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._identified_eventHandlers[even-tType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * These methods are only able to add \"permanent\" handlers : \"one-shot\" handlers must be added by another mean \r\n * @param {string} eventType\r\n * @param {function} handler : the handler to add \r\n * @param {number} index : where to add\r\n */\r\nEventEmitter.prototype.addEventListener = function(eventType, handler) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].push(handler);\r\n}\r\n\r\nEventEmitter.prototype.addEventListenerAt = function(eventType, handler, index) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].splice(index, 0, handler);\r\n}\r\n\r\nEventEmitter.prototype.removeEventListenerAt = function(eventType, index) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tif (typeof index === 'number' && index < this._eventHandlers[eventType].length) {\r\n\t\tthis._eventHandlers[eventType].splice(index, 1);\r\n\t}\r\n}\r\n\r\nEventEmitter.prototype.clearEventListeners = function(eventType) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].length = 0;\r\n\tthis._one_eventHandlers[eventType].length = 0;\r\n}\r\n\r\n/**\r\n * Generic Alias for this['on' + eventType].eventCall : this alias can be called rather than the eventCall property\r\n * @param {string} eventType\r\n * @param {any} payload \r\n */ \r\nEventEmitter.prototype.trigger = function(eventType, payload, eventIdOrBubble, eventID) {\r\n\tif (!this._eventHandlers[eventType] && !this._one_eventHandlers[eventType] && !this._identified_eventHandlers[eventType]) {\r\n\t\tconsole.warn(this.objectType, 'Event : ' + eventType + ' triggered although it doesn\\'t exist. Returning...');\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tvar bubble = false;\r\n\tif (typeof eventIdOrBubble === 'boolean')\r\n\t\tbubble = eventIdOrBubble;\r\n\telse\r\n\t\teventID = eventIdOrBubble;\r\n\t\r\n\tfor(var i = 0, l = this._eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (typeof this._eventHandlers[eventType][i] === 'function')\r\n\t\t\tthis._eventHandlers[eventType][i]({type : eventType, data : payload, bubble : bubble});\r\n\t}\r\n\r\n\tfor(var i = this._one_eventHandlers[eventType].length - 1; i >= 0; i--) {\r\n\t\tif (typeof this._one_eventHandlers[eventType][i] === 'function') {\r\n\t\t\tthis._one_eventHandlers[eventType][i]({type : eventType, data : payload, bubble : bubble});\r\n\t\t\tdelete this._one_eventHandlers[eventType][i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar deleted = 0;\r\n\tif (typeof eventID !== 'undefined' && eventID !== 0) {\r\n\t\tfor(var i = this._identified_eventHandlers[eventType].length - 1; i >= 0; i--) {\r\n\t\t\tif (typeof this._identified_eventHandlers[eventType][i] === 'undefined')\r\n\t\t\t\tdeleted++;\r\n\t\t\telse if (eventID === this._identified_eventHandlers[eventType][i]['id']) {\r\n\t\t\t\tif (typeof this._identified_eventHandlers[eventType][i] === 'object') {\r\n\t\t\t\t\tthis._identified_eventHandlers[eventType][i].f({type : eventType, data : payload, bubble : bubble})\r\n\t\t\t\t\tdelete this._identified_eventHandlers[eventType][i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._one_eventHandlers[eventType] = [];\r\n\tif (deleted === this._identified_eventHandlers[eventType].length)\r\n\t\tthis._identified_eventHandlers[eventType] = [];\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * An abstract class based on a pattern similar to the Command pattern\r\n * \r\n * new Command(\r\n\t\tfunction() {\t\t\t\t\t// action\r\n\t\t\t// code here //\r\n\t\t\tthis.trigger('action');\r\n\t\t},\r\n\t\tfunction() {\t\t\t\t\t// canAct\r\n\t\t\t\r\n\t\t},\r\n\t\tfunction() {\t\t\t\t\t// undo\r\n\t\t\t\r\n\t\t}\r\n\t)\r\n * \r\n */\r\n\r\nvar Command = function(action, canAct, undo) {\r\n\r\n\tthis.objectType = 'Command ' + action.name;\r\n\tthis.canActQuery = false;\r\n\tthis.action = action;\r\n\tthis.canAct = canAct || null;\r\n\tthis.undo = undo;\r\n}\r\n\r\nCommand.prototype.objectType = 'Command';\r\nCommand.prototype.constructor = Command;\r\n\r\nCommand.prototype.act = function() {\r\n\tvar self = this, canActResult, args = Array.prototype.slice.call(arguments);\r\n\t\r\n\tif (this.canAct === null) {\r\n\t\tthis.action.apply(null, args);\r\n\t\tthis.canActQuery = Promise.resolve();\r\n\t}\r\n\telse {\r\n\t\tthis.canActQuery = this.canAct.apply(null, args); \r\n\t\tif (typeof this.canActQuery === 'object' && this.canActQuery instanceof Promise) {\r\n\t\t\tthis.canActQuery.then(\r\n\t\t\t\t\tfunction(queryResult) {\r\n\t\t\t\t\t\targs.push(queryResult);\r\n\t\t\t\t\t\tself.action.apply(null, args);\r\n\t\t\t\t\t\treturn queryResult;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(queryResult) {\r\n\t\t\t\t\t\treturn queryResult;\r\n\t\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if (this.canActQuery) {\r\n\t\t\tthis.canActQuery = Promise.resolve(this.canActQuery);\r\n\t\t\tthis.action.apply(null, args);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.canActQuery = Promise.reject(this.canActQuery);\r\n\t\t}\r\n\t}\r\n\treturn this.canActQuery;\r\n}\r\n\r\n\r\nCommand.__factory_name = 'Command';\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A constructor for STREAMS : streams may be instanciated by the implementation at \"component\" level (observableComponent automates the stream creation),\r\n * \t\t\t\t\tor as standalones when a view needs a simple \"internal\" reference to a stream (may also be totally elsewhere)\r\n */\r\n\r\nvar Stream = function(name, value, hostedInterface, transform, lazy, component) {\r\n\tthis._hostComponent = component;\r\n\tthis.forward = true;\r\n\tthis.name = name;\r\n\tthis.lazy = lazy || false;\r\n\tthis.hostedInterface = hostedInterface;\r\n\tthis.transform = transform || (value => value);\r\n\tthis.inverseTransform;\r\n\tthis.subscriptions = [];\r\n\t\r\n\tthis._value;\r\n\tthis.dirty;\r\n\tif (typeof value !== 'undefined')\r\n\t\tthis.value = (hostedInterface && typeof hostedInterface.getProp === 'function') ? hostedInterface.getProp(name) : value;\r\n}\r\nStream.prototype = {};\r\nStream.prototype.objectType = 'Stream';\r\nStream.prototype.constructor = Stream;\r\nObject.defineProperty(Stream.prototype, 'value', {\r\n\tget : function() {\r\n//\t\tconsole.log(this.lazy, this.dirty, this.transform);\r\n\t\tif (this.lazy && this.dirty) {\r\n\t\t\tthis.lazyUpdate();\r\n\t\t}\r\n\t\t\r\n\t\treturn this.get();\r\n\t},\r\n\t\r\n\tset : function(value) {\r\n//\t\tconsole.log(value);\r\n//\t\tconsole.log(this.hostedInterface);\r\n\t\tvar val = this.transform(value);\r\n//\t\tconsole.log(this.name, val);\r\n\t\tthis.setAndUpdateConditional(val);\r\n\t\tthis.set(val);\r\n\t}\r\n});\r\n\r\nStream.prototype.acquireHostedInterface = function(hostedInterface) {\r\n\thostedInterface.setProp(this.name, this._value);\r\n\tthis.hostedInterface = hostedInterface;\r\n}\r\n\r\nStream.prototype.get = function() {\r\n\treturn this._value;\r\n}\r\n\r\nStream.prototype.set = function(value) {\r\n//\tif (this.name === 'className')\r\n//\t\tconsole.log(this.forward, this.hostedInterface, value);\r\n\tif (this.forward && this.hostedInterface) {\r\n\t\tthis.forward = false;\r\n\t\tthis.hostedInterface.setProp(this.name, value);\r\n\t\tthis.forward = true;\r\n\t}\r\n\telse\r\n\t\tthis.forward = true;\r\n}\r\n\r\n/**\r\n * @method setAndUpdateConditional\r\n * \t\tAvoid infinite recursion when setting a prop on a custom element : \r\n * \t\t\t- when set from outside : update and set the prop on the custom element\r\n *\t\t\t- after updating a prop on a custom element : update only\r\n * \t\t\t- don't update when set from downward (reflected stream shall only call \"set\")\r\n */\r\nStream.prototype.setAndUpdateConditional = function(value) {\r\n\tthis._value = value;\r\n\tif (!this.lazy) {\r\n\t\tif (this.forward) {\r\n\t\t\tif (!this.transform)\r\n\t\t\t\tthis.update();\r\n\t\t\telse if (typeof this.transform === 'function') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// try/catch as the transform function is likely to always be outside of our scope\r\n\t\t\t\t\tthis._value = this.transform(this._value);\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e) {\r\n\t\t\t\t\tconsole.log('Exception thrown while the transform function was executing on self data: ', e, this._value);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.dirty = true;\r\n\t}\r\n}\r\n\r\nStream.prototype.update = function() {\r\n\tthis.subscriptions.forEach(function(subscription) {\r\n\t\tsubscription.execute(this._value);\r\n\t}, this);\r\n}\r\n\r\nStream.prototype.lazyUpdate = function() {\r\n\tif (typeof this.transform === 'function') {\r\n\t\ttry {\r\n\t\t\t// try/catch as the transform function is likely to always be outside of our scope\r\n\t\t\tthis._value = this.transform(this._value);\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tconsole.log('Exception thrown while the transform function was executing on self data: ', e, this._value);\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tthis.update();\r\n\tthis.dirty = false;\r\n}\r\n\r\nStream.prototype.react = function(prop, reflectedHost) {\r\n\tthis.get = function() {\r\n\t\treturn reflectedHost[prop];\r\n\t}\r\n\tthis.subscribe(prop, reflectedHost);\r\n}\r\n\r\n/**\r\n * reflect method  :\r\n *\ttriggers the local update loop when the reflectedHost updates\r\n *\tAND\r\n *\t\tsimply sets a reflection mecanism if the reflectedHost[prop] was a literal\r\n *\t\tOR\r\n *\t\tlazy \"sets\" the reflectedHost (no infinite recursion, but no change propagation neither on the host) and triggers the given event when the local stream updates\r\n */ \r\nStream.prototype.reflect = function(prop, reflectedHost, transform, inverseTransform, event) {\r\n\tthis._value = reflectedHost[prop];// ? reflectedHost[prop] : this._value;\r\n\t\r\n\tif (transform && this.transform)\r\n\t\tconsole.warn('Bad transform assignment : this.transform already exists');\r\n\telse if (!this.transform)\r\n\t\tthis.transform = transform;\r\n\t\r\n\tvar desc = Object.getOwnPropertyDescriptor(reflectedHost, prop);\r\n\tvar stdDesc = Object.getOwnPropertyDescriptor(Stream.prototype, 'value');\r\n\tvar propertyDescriptor = {\r\n\t\t\tget : stdDesc.get.bind(this),\r\n\t\t\tset : stdDesc.set.bind(this)\r\n\t};\r\n\t\r\n\tif (!desc || (!desc.get && desc.writable))\r\n\t\tObject.defineProperty(reflectedHost, prop, propertyDescriptor);\r\n\t\r\n\telse if (reflectedHost.streams && reflectedHost.streams[prop]) {\r\n\t\tthis._value = reflectedHost.streams[prop].get(); // we need transformed value if lazy\r\n\t\t\r\n\t\treflectedHost.streams[prop].subscribe(this);\r\n\t\t\r\n//\t\tif (typeof reflectedHost.trigger === 'function')\r\n//\t\t\tthis.subscribe(reflectedHost.trigger.bind(reflectedHost, event));\r\n\t\t\r\n\t\treturn this.subscribe(reflectedHost.streams[prop].set, null, inverseTransform);\r\n\t}\r\n\treturn this._value;\r\n}\r\n\r\n/**\r\n * subscribe method  :\r\n *\tinstanciates and registers a new subscription, and returns it for the caller to define the refinement functions (filter & map)\r\n */ \r\nStream.prototype.subscribe = function(handlerOrHost, prop, transform, inverseTransform) {\r\n\tif (!handlerOrHost || (typeof handlerOrHost !== 'function' && typeof handlerOrHost !== 'object')) {\r\n\t\tconsole.warn('Bad observable handlerOrHost assigned : handler type is ' + typeof handler + ' instead of \"function or getter/setter\"', 'StreamName ' + this.name);\r\n\t\treturn;\r\n\t}\r\n\telse {\r\n\t\tif (typeof transform === 'function')\r\n\t\t\tthis.transform = transform;\r\n\t\treturn this.addSubscription(handlerOrHost, prop, inverseTransform);//.subscribe();\r\n\t}\r\n}\r\n\r\n/**\r\n * filter method (syntactic sugar) :\r\n *\tinstanciates and registers a new subscription, and returns it for the caller to define the refinement functions (map) and the effective subscribtion\r\n */ \r\nStream.prototype.filter = function(handlerOrHost, prop, filterFunc) {\r\n\treturn this.addSubscription(handlerOrHost, prop).filter(filterFunc);\r\n}\r\n\r\n/**\r\n * map method (syntactic sugar) :\r\n *\tinstanciates and registers a new subscription, and returns it for the caller to define the refinement functions (filter) and the effective subscribtion\r\n */ \r\nStream.prototype.map = function(handlerOrHost, prop, mapFunc) {\r\n\treturn this.addSubscription(handlerOrHost, prop).map(mapFunc);\r\n}\r\n\r\nStream.prototype.addSubscription = function(handlerOrHost, prop, inverseTransform, subscribingComponent) {\r\n\tthis.subscriptions.push(new Subscription(handlerOrHost, prop, this, inverseTransform));\r\n\treturn this.subscriptions[this.subscriptions.length - 1];\r\n}\r\n\r\nStream.prototype.unsubscribe = function(subscriptionOrStream) {\r\n\r\n\tfor(let i = this.subscriptions.length - 1; i >= 0; i--) {\r\n\t\tif (this.subscriptions[i] === subscriptionOrStream || this.subscriptions[i].obj === subscriptionOrStream) {\r\n\t\t\tthis.subscriptions.splice(i, 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * An Abstract Class to be used by the Stream Ctor\r\n * \r\n * returns chainable callback assignment functions on subscription\r\n * e.g. : childModules make use of this mecanism when automatically subscribing to streams on their parent :\r\n * \t\tthis.streams[parentState].subscribe(candidate.hostElem, childState).filter(desc.filter).map(desc.map);\r\n */\r\nvar Subscription = function(subscriberObjOrHandler, subscriberProp, parent, inverseTransform) {\r\n\tthis.subscriber = {\r\n\t\t\tprop : subscriberProp || null,\r\n\t\t\tobj : typeof subscriberObjOrHandler === 'object' ? subscriberObjOrHandler : null,\r\n\t\t\tcb : typeof subscriberObjOrHandler === 'function' ? subscriberObjOrHandler : function defaultCb() {return this._stream._value},\r\n\t\t\tinverseTransform : inverseTransform || function(value) {return value;},\r\n\t\t\t_subscription : this,\r\n\t\t\t_stream : parent,\r\n\t\t\t_parentHost : parent._hostComponent,\r\n\t\t\thost : null\r\n\t}\r\n//\ttypeof subscriberProp === 'string' ?\r\n\tthis._stream = parent;\r\n\tthis._subscriberUID = '';\r\n\tthis._subscriberType = '';\r\n\t\r\n\tthis._firstPass = true;\r\n}\r\n//\r\n//Subscription.prototype.subscribe = function(subscriberObjOrHandler, subscriberProp, inverseTransform) {\r\n////\tif (typeof subscriberObjOrHandler !== 'function' && typeof subscriberObjOrHandler !== 'object' && !this.subscriber.obj && !this.subscriber.cb) {\r\n////\t\tconsole.warn('Bad observableHandler given : handler type is ' + typeof subscriberObjOrHandler + ' instead of \"function or object\"', 'StreamName ' + this._parent.name);\r\n////\t\treturn;\r\n////\t}\r\n//\tif (typeof subscriberObjOrHandler === 'object')\r\n//\t\tthis.subscriber.obj = subscriberObjOrHandler;\r\n//\telse if (typeof subscriberObjOrHandler === 'function')\r\n//\t\tthis.subscriber.cb = subscriberObjOrHandler;\r\n//\t\r\n//\tif (subscriberProp)\r\n//\t\tthis.subscriber.prop = subscriberProp;\r\n//\t\r\n//\treturn this;\r\n//}\r\n\r\nSubscription.prototype.unsubscribe = function() {\r\n\tthis._stream.unsubscribe(this);\r\n}\r\n\r\nSubscription.prototype.filter = function(filterFunc, hostComponent) {\r\n\tif (!filterFunc)\r\n\t\treturn this;\r\n\t\t\r\n\t// when cbOnly, we bind the cb on the component\r\n\t// but when reacting from a streamon a stream\r\n\t// we only have a ref on the parent stream\r\n\t// => we need to acquire a ref on the component somehow\r\n\tif (!this.subscriber.host)\r\n\t\tthis.subscriber.host = hostComponent;\r\n\r\n\t// Optimize by breaking the reference : not sure it shall be faster (at least there is only one closure, which is internal to \"this\" : benchmark shows a slight improvement, as timings are identical although there is an overhaed with defineProperty)\r\n\tvar f = new Function('value', 'return (' + filterFunc.toString() + ').call(this.subscriber.host, value) === true ? true : false;');\r\n\tObject.defineProperty(this, 'filter', {\r\n\t\tvalue : f,\r\n\t\tenumerable : true\r\n\t});\r\n//\tthis.filter = filterFunc;\r\n\treturn this;\r\n}\r\n\r\nSubscription.prototype.map = function(mapFunc, hostComponent) {\r\n\tif (!mapFunc)\r\n\t\treturn this;\r\n\t\t\r\n\t// when cbOnly, we bind the cb on the component\r\n\t// but when reacting from a streamon a stream\r\n\t// we only have a ref on the parent stream\r\n\t// => we need to acquire a ref on the component somehow\r\n\tif (!this.subscriber.host)\r\n\t\tthis.subscriber.host = hostComponent;\r\n\r\n\t// Optimize by breaking the reference : not sure it shall be faster (at least there is only one closure, which is internal to \"this\" : benchmark shows a slight improvement, as timings are identical although there is an overhaed with defineProperty)\r\n\tvar f = new Function('value', 'return (' + mapFunc.toString() + ').call(this.subscriber.host, value);');\r\n\tObject.defineProperty(this, 'map', {\r\n\t\tvalue : f,\r\n\t\tenumerable : true\r\n\t});\r\n//\tthis.map = mapFunc;\r\n\treturn this;\r\n}\r\n\r\nSubscription.prototype.reverse = function(inverseTransform) {\r\n\tif(typeof inverseTransform !== 'function')\r\n\t\treturn this;\r\n\r\n\t// Optimize by breaking the reference : not sure it shall be faster (at least there is only one closure, which is internal to \"this\" : benchmark needed)\r\n\tthis.subscriber.inverseTransform = new Function('return (' + inverseTransform.toString() + ').apply(null, arguments);');\r\n//\tthis.subscriber.inverseTransform = inverseTransform;\r\n\treturn this;\r\n}\r\n\r\nObject.defineProperty(Subscription.prototype, 'execute', {\r\n\tvalue : function(value) {\r\n//\t\tconsole.log('%c %s %c %s', 'color:coral', 'Subscription \"execute\"', 'color:firebrick', 'Stream : ' + this._stream.name, 'value', value);\r\n\t\tvar flag = true, val, desc;\r\n\t\tif (value !== undefined) {\r\n\t\t\tif (this.hasOwnProperty('filter'))\r\n\t\t\t\tflag = this.filter(value);\r\n\t\t\tif (flag && this.hasOwnProperty('map'))\r\n\t\t\t\tval = this.map(value);\r\n\t\t\telse if (flag)\r\n\t\t\t\tval = value;\r\n\t\t\telse\r\n\t\t\t\treturn;\r\n//\t\t\tconsole.log('val', this._stream.name, val);\r\n\t\t\t\r\n\t\t\tif (this.subscriber.obj !== null && this.subscriber.prop !== null)\r\n\t\t\t\tthis.subscriber.obj[this.subscriber.prop] = val;\r\n\t\t\t// second case shall only be reached if no prop is given : on a \"reflected\" subscription by a child component\r\n\t\t\telse if (this.subscriber.obj && (desc = Object.getOwnPropertyDescriptor(this.subscriber.obj, 'value')) && typeof desc.set === 'function')\r\n\t\t\t\tthis.subscriber.obj.value = val;\r\n\t\t\telse if (this.subscriber.obj === null)\r\n\t\t\t\tthis.subscriber.cb(this.subscriber.inverseTransform(val)); // inverseTransform may be a transparent function (is not when reflecting : we must not reflect the child state \"as is\" : the parent value may be \"mapped requested\" by the child)   \r\n\t\t}\r\n\t\tthis._firstPass = false;\r\n\t},\r\n\tenumerable : true\r\n});\r\n\r\nSubscription.prototype.unAnonymize = function(subscriberUID, subscriberType) {\r\n\tthis._subscriberUID = subscriberUID;\r\n\tthis._subscriberType = subscriberType;\r\n\t\r\n\treturn this;\r\n}\r\n\r\nSubscription.prototype.registerTransition = function(parent_UID) {\r\n\tRegistries.stateMachineCache.registerTransition(\r\n\t\tthis._subscriberUID,\r\n\t\tthis._subscriberType,\r\n\t\t{\r\n\t\t\tfrom : this._stream.name,\r\n\t\t\tto : this.subscriber.prop,\r\n\t\t\tmap : this.map,\r\n\t\t\tfilter : this.filter,\r\n\t\t\tsubscribe : this.subscriber.cb\r\n\t\t},\r\n\t\tparent_UID\r\n\t);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A constructor for STREAMS more specifically used by providers objects\r\n */\r\n\r\nvar LazyResettableColdStream = function(name, transform, value) {\r\n\r\n\tthis.forward = true;\r\n\tthis.name = name;\r\n\tthis.transform = transform || (value => value);\r\n\tthis.inverseTransform;\r\n\tthis.subscriptions = [];\r\n\t\r\n\tthis._value;\r\n\tthis._previousValues = [];\r\n\tthis.lazy = true;\r\n\tthis.dirty;\r\n\tthis.lastIndexProvided = -1;\r\n\tif (typeof value !== 'undefined')\r\n\t\tthis.value = value;\r\n}\r\nLazyResettableColdStream.prototype = Object.create(Stream.prototype);\r\nLazyResettableColdStream.prototype.objectType = 'LazyResettableColdStream';\r\nLazyResettableColdStream.prototype.constructor = LazyResettableColdStream;\r\nObject.defineProperty(LazyResettableColdStream.prototype, 'value', {\r\n\tget : function() {\r\n\t\t\r\n\t\tif (this.lazy && this.dirty) {\r\n\t\t\tthis.lazyUpdate();\r\n\t\t}\r\n\t\t\r\n\t\treturn this.get();\r\n\t},\r\n\t\r\n\tset : function(value) {\r\n\t\tvar val = this.transform(value);\r\n\t\tthis.setAndUpdateConditional(val);\r\n\t\tthis.forward = true;\r\n\t}\r\n});\r\n\r\n/**\r\n * @method setAndUpdateConditional\r\n * \t\tAvoid infinite recursion when setting a prop on a custom element : \r\n * \t\t\t- when set from outside : update and set the prop on the custom element\r\n *\t\t\t- after updating a prop on a custom element : update only\r\n * \t\t\t- don't update when set from downward (reflected stream shall only call \"set\")\r\n */\r\nLazyResettableColdStream.prototype.setAndUpdateConditional = function(value) {\r\n//\tconsole.trace(value);\r\n\tthis._value = value;\r\n\tthis._previousValues.push(value);\r\n\t\r\n\tif (this.forward && !this.lazy) {\r\n\t\tif (!this.transform) {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t\telse if (typeof this.transform === 'function') {\r\n\t\t\ttry {\r\n\t\t\t\t// try/catch as the transform function is likely to always be outside of our scope\r\n\t\t\t\tthis._value = this.transform(this._value);\r\n\t\t\t\tthis._previousValues.splice(this._previousValues.length - 1, 1, this._value);\r\n\t\t\t}\r\n\t\t\tcatch(e) {\r\n\t\t\t\tconsole.log('Exception thrown while the transform function was executing on self data: ', e, this._value);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.dirty = true;\r\n\t}\r\n}\r\n\r\nLazyResettableColdStream.prototype.update = function() {\r\n\t\r\n\tthis.subscriptions.forEach(function(subscription) {\r\n\t\tsubscription.execute(this._previousValues);\r\n//\t\tconsole.log(this._previousValues[0]);\r\n\t}, this);\r\n\tthis.lastIndexProvided = this._previousValues.length - 1;\r\n}\r\n\r\nLazyResettableColdStream.prototype.lazyUpdate = function() {\r\n//\tif (typeof this.transform === 'function') {\r\n//\t\ttry {\r\n//\t\t\t// try/catch as the transform function is likely to always be outside of our scope\r\n//\t\t\tthis._value = this.transform(this._value);\r\n//\t\t\tthis._previousValues.splice(this._previousValues.length - 1, 1, this._value);\r\n//\t\t}\r\n//\t\tcatch(e) {\r\n//\t\t\tconsole.log('Exception thrown while the transform function was executing on self data: ', e, this._value);\r\n//\t\t\treturn;\r\n//\t\t}\r\n//\t}\r\n\tthis.update();\r\n\tthis.dirty = false;\r\n}\r\n\r\nLazyResettableColdStream.prototype.addSubscription = function(handlerOrHost, prop, inverseTransform) {\r\n//\tconsole.log(handlerOrHost, prop);\r\n\tthis.subscriptions.push(new ColdSubscription(handlerOrHost, prop, this, inverseTransform));\r\n\treturn this.subscriptions[this.subscriptions.length - 1];\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * An Abstract Class to be used by the Stream Ctor\r\n * \r\n * returns chainable callback assignment functions on subscription\r\n * e.g. : childModules make use of this mecanism when automatically subscribing to streams on their parent :\r\n * \t\tthis.streams[parentState].subscribe(candidate.hostElem, childState).filter(desc.filter).map(desc.map);\r\n */\r\nvar ColdSubscription = function(subscriberObjOrHandler, subscriberProp, parent, inverseTransform) {\r\n//\tconsole.log(parent.lastIndexProvided);\r\n\tthis.subscriber = {\r\n\t\tcurrentIndex : parent.lastIndexProvided,\r\n\t\tprop : subscriberProp || null,\r\n\t\tobj : typeof subscriberObjOrHandler === 'object' ? subscriberObjOrHandler : null,\r\n\t\tcb : typeof subscriberObjOrHandler === 'function' ? subscriberObjOrHandler : function defaultCb(val) {return val},\r\n\t\tinverseTransform : inverseTransform || function(value) {return value;},\r\n\t\t_subscription : this,\r\n\t\t_stream : parent\r\n\t}\r\n//\ttypeof subscriberProp === 'string' ?\r\n\tthis._stream = parent;\r\n\tthis._firstPass = true;\r\n}\r\nColdSubscription.prototype = Object.create(Subscription.prototype);\r\nColdSubscription.prototype.objectType = 'ColdSubscription';\r\n\r\nObject.defineProperty(ColdSubscription.prototype, 'execute', {\r\n\tvalue : function(valuesFromStack) {\r\n//\t\tconsole.log(valuesFromStack);\r\n\t\tvaluesFromStack.forEach(function(val, key) {\r\n\t\t\tif (key > this.subscriber.currentIndex) {\r\n\t\t\t\tthis.executeSingle(val);\r\n\t\t\t\tthis.subscriber.currentIndex++;\r\n//\t\t\t\tconsole.log(this.subscriber.currentIndex);\r\n\t\t\t}\r\n\t\t}, this);\r\n\t}\r\n})\r\n\r\nObject.defineProperty(ColdSubscription.prototype, 'executeSingle', {\r\n\tvalue : function(value) {\r\n//\t\tconsole.log('%c %s %c %s', 'color:coral', 'Subscription \"execute\"', 'color:firebrick', 'Stream : ' + this._stream.name, 'value:', value);\r\n\t\tvar flag = true, val, desc;\r\n\t\tif (value !== undefined) {\r\n\t\t\tif (this.hasOwnProperty('filter'))\r\n\t\t\t\tflag = this.filter(value);\r\n\t\t\tif (flag && this.hasOwnProperty('map'))\r\n\t\t\t\tval = this.map(value);\r\n\t\t\telse if (flag)\r\n\t\t\t\tval = value;\r\n\t\t\telse\r\n\t\t\t\treturn;\r\n//\t\t\tconsole.log('val', this._stream.name, val);\r\n\t\t\t\r\n//\t\t\tconsole.log(this.subscriber.obj !== null && this.subscriber.prop !== null);\r\n\t\t\tif (this.subscriber.obj !== null && this.subscriber.prop !== null)\r\n\t\t\t\tthis.subscriber.obj[this.subscriber.prop] = val;\r\n\t\t\t// second case shall only be reached if no prop is given : on a \"reflected\" subscription by a child component\r\n\t\t\telse if (this.subscriber.obj && (desc = Object.getOwnPropertyDescriptor(this.subscriber.obj, 'value')) && typeof desc.set === 'function')\r\n\t\t\t\tthis.subscriber.obj.value = val;\r\n\t\t\telse if (this.subscriber.obj === null)\r\n\t\t\t\tthis.subscriber.cb(this.subscriber.inverseTransform(val)); // inverseTransform may be a transparent function (is not when reflecting : we must not reflect the child state \"as is\" : the parent value may be \"mapped requested\" by the child)   \r\n\t\t}\r\n\t\tthis._firstPass = false;\r\n\t},\r\n\tenumerable : true\r\n});\r\n\r\nObject.defineProperty(ColdSubscription.prototype, 'setPointerToStart', {\r\n\tvalue : function() {\r\n\t\tthis.subscriber.currentIndex = 0;\r\n\t}\r\n})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A constructor for NUMBERED STREAMS : numbered streams should be part of a StreamPool\r\n */\r\n\r\nvar NumberedStream = function(key, component, name, value) {\r\n\tthis._key = key;\r\n\tthis._parent = component;\r\n\tStream.call(this, name, value);\r\n}\r\nNumberedStream.prototype = Object.create(Stream.prototype);\r\nNumberedStream.prototype.objectType = 'NumberedStream';\r\nNumberedStream.prototype.constructor = NumberedStream;\r\n\r\nObject.defineProperty(NumberedStream.prototype, 'value', {\r\n\tget : function() {\r\n\t\tif (this.lazy) {\r\n\t\t\tthis.dirty = false;\r\n\t\t}\r\n\t\t\r\n\t\treturn this.get();\r\n\t},\r\n\t\r\n\tset : function(value) {\r\n\t\tthis.setAndUpdateConditional(value);\r\n\t\tthis.set(value);\r\n\t}\r\n});\r\n\r\nNumberedStream.prototype.get = function() {\r\n\treturn this._value;\r\n}\r\n\r\nNumberedStream.prototype.set = function(value) {\r\n\tif (this.forward && this.hostedInterface) {\r\n\t\tthis.forward = false;\r\n//\t\tthis.hostedInterface.setProp(this.name, value);\r\n\t\tthis.forward = true;\r\n\t}\r\n\telse\r\n\t\tthis.forward = true;\r\n}\r\n\r\n/**\r\n * @method setAndUpdateConditional\r\n * \t\tAvoid infinite recursion when setting a prop on a custom element : \r\n * \t\t\t- when set from outside : update and set the prop on the custom element\r\n *\t\t\t- after updating a prop on a custom element : update only\r\n * \t\t\t- don't update when set from downward (reflected stream shall only call \"set\")\r\n */\r\nNumberedStream.prototype.setAndUpdateConditional = function(value) {\r\n\tthis._value = value;\r\n\tif (!this.lazy) {\r\n\t\tif (this.forward) {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.dirty = true;\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n */\r\nNumberedStream.prototype.remove = function() {\r\n\tif (this._parent)\r\n\t\treturn this._parent.removeChild(this._key);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A constructor for STREAMS POOL : numbered streams should be part of a StreamPool\r\n */\r\n\r\nvar StreamPool = function(component) {\r\n\tthis._parent = component;\r\n\tthis._streamsArray  = [];\r\n}\r\nStreamPool.prototype = Object.create(EventEmitter.prototype);\r\nStreamPool.prototype.objectType = 'StreamPool';\r\nStreamPool.prototype.constructor = StreamPool;\r\n\r\n/**\r\n * @param {number} idx : the _key of the member Stream\r\n */\r\nStreamPool.prototype.getFirst = function() {\r\n\treturn this._streamsArray[0];\r\n}\r\n\r\n/**\r\n * @param {number} idx : the _key of the member Stream\r\n */\r\nStreamPool.prototype.getStreamAt = function(idx) {\r\n\treturn this._streamsArray[idx];\r\n}\r\n\r\n/**\r\n * @param {number} idx : the _key of the member Stream\r\n */\r\nStreamPool.prototype.getLast = function() {\r\n\treturn this._streamsArray[this._streamsArray.length - 1];\r\n}\r\n\r\n/**\r\n * @param {object} child : an instance of another object\r\n */\r\nStreamPool.prototype.pushChild = function(child) {\r\n\tchild._parent = this;\r\n\tchild._key = this._streamsArray.length;\r\n\tthis._streamsArray.push(child);\r\n}\r\n\r\n/**\r\n * @param {object} child : an instance of another object\r\n * @param {number} atIndex : the required index to splice at\r\n */\r\nStreamPool.prototype.addChildAt = function(child, atIndex) {\r\n\tchild._parent = this;\r\n\tchild._key = atIndex;\r\n\tthis._streamsArray.splice(atIndex, 0, child);\r\n\tthis.generateKeys(atIndex);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nStreamPool.prototype.removeChild = function(childKey) {\r\n\tvar removed = this._streamsArray.splice(childKey, 1);\r\n\t(childKey < this._streamsArray.length && this.generateKeys(childKey));\r\n\treturn removed;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nStreamPool.prototype.removeLastChild = function() {\r\n\tvar removed = this._streamsArray.pop();\r\n\treturn removed;\r\n}\r\n\r\n/**\r\n * @param {number} atIndex : the required index to clear at\r\n */\r\nStreamPool.prototype.removeChildAt = function(atIndex) {\r\n\tvar removedChild = this._streamsArray.splice(atIndex, 1);\r\n\tthis.generateKeys(atIndex);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nStreamPool.prototype.removeAllChildren = function() {\r\n\tthis._streamsArray.length = 0;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * @param {number} atIndex : the first _key we need to invalidate\r\n */\r\nStreamPool.prototype.generateKeys = function(atIndex) {\r\n\tfor (let i = atIndex || 0, l = this._streamsArray.length; i < l; i++) {\r\n\t\tthis._streamsArray[i]._key = i;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor SavableStore\r\n * @param {Function} onUpdateCallback\r\n * @param {Array<String>} valueNamesList\r\n */\r\nvar SavableStore = function(onUpdateCallback, valueNamesList = []) {\r\n\tthis.onUpdateCallback = onUpdateCallback;\r\n\tthis.valueNames = Array();\r\n\tthis.values = Array();\r\n\tif (valueNamesList && valueNamesList.length) {\r\n\t\tvalueNamesList.forEach(function(valueName) {\r\n\t\t\tthis.addValue(valueName);\r\n\t\t}, this);\r\n\t}\r\n}\r\n\r\n/**\r\n * @method addValue\r\n * @param {String} valueName\r\n */\r\nSavableStore.prototype.addValue = function(valueName) {\r\n\tthis.valueNames.push(valueName);\r\n\tthis.values.push(new TemplateFactory.PropModel({[valueName] : undefined}))\r\n}\r\n\r\n/**\r\n * @method removeValue\r\n * @param {String} valueName\r\n */\r\nSavableStore.prototype.removeValue = function(valueName) {\r\n\t// FIXME: we should make use of the valueNames index\r\n\tvar valuePos = this.valueNames.indexOf(valueName);\r\n\tthis.values.splice(valuePos, 1);\r\n\tthis.valueNames.splice(valuePos, 1);\r\n}\r\n\r\nSavableStore.prototype.clearValues = function() {\r\n\tthis.values.length = 0;\r\n}\r\n\r\n/**\r\n * @method update\r\n * @param {String} valueName\r\n * @param {String|Boolean} value\r\n */\r\nSavableStore.prototype.update = function(valueName, value) {\r\n\t// FIXME: we should make use of the valueNames index\r\n\tvar valueObj = this.values[this.valueNames.indexOf(valueName)];\r\n\tvalueObj[valueName] = value;\r\n\t\r\n\t/** @type {{[key : String] : String|Boolean}} */\r\n\tlet returnValue = {};\r\n\tthis.valueNames.forEach(function(name, key) {\r\n\t\treturnValue[name] = this.values[key][name];\r\n\t}, this);\r\n\tthis.onUpdateCallback(JSON.stringify(returnValue));\r\n}\r\n\r\nSavableStore.prototype.empty = function() {\r\n\tthis.valueNames.forEach(function(valueName, key) {\r\n\t\tthis.values[key][valueName] = undefined;\r\n\t}, this);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * An interface to be implemented by a module based on a worker\r\n */\r\nvar WorkerInterface = function(workerName, stringifiedWorker, url) {\r\n\tEventEmitter.call(this);\r\n\tthis.objectType = workerName || 'WorkerInterface';\r\n\tthis._responseHandler = {};\r\n\tthis.createEvent('message');\r\n\tthis.name = workerName;\r\n\t\r\n\tvar blob = new Blob([stringifiedWorker /*https://www.npmjs.com/package/stringify*/], {type: 'application/javascript'});\r\n\tvar blobURL = window.URL.createObjectURL(blob);\r\n\turl = typeof blobURL === 'string' ? blobURL : url;\r\n\tthis.worker = new Worker(url);\r\n\tthis.worker.onmessage = this.handleResponse.bind(this); \r\n}\r\nWorkerInterface.prototype = Object.create(EventEmitter.prototype);\r\nWorkerInterface.prototype.objectType = 'WorkerInterface';\r\nWorkerInterface.prototype.constructor = WorkerInterface;\r\n\r\nWorkerInterface.prototype.postMessage = function(action, e) { \t// e.data = File Object (blob)\r\n\t// syntax [(messageContent:any)arg0, (transferableObjectsArray:[transferable, transferable, etc.])arg1]\r\n\r\n\tif (typeof e === 'undefined')\r\n\t\tthis.worker.postMessage.call(this.worker, [action]);\r\n\telse if (e.data instanceof ArrayBuffer)\r\n\t\tthis.worker.postMessage.call(this.worker, [action, e.data], [e.data]);\r\n\telse\r\n\t\tthis.worker.postMessage.call(this.worker, [action, e.data]);\r\n}\r\n\r\nWorkerInterface.prototype.addResponseHandler = function(handlerName, handler) {\r\n\tif (typeof handler === 'function')\r\n\t\tthis._responseHandler[handlerName] = handler;\r\n}\r\n\r\nWorkerInterface.prototype.handleResponse = function(response) {\r\n//\tconsole.log(response);\r\n\t\r\n\tif (!this.handleError(response))\r\n\t\treturn;\r\n\t\r\n\tif (typeof this._responseHandler[response.data[0]] === 'function') {\r\n\t\tif (response.data.length > 1) {\r\n\t\t\tvar args = Array.prototype.slice.call(response.data, 1);\r\n\t\t\tthis._responseHandler[response.data[0]].apply(this, args);\r\n\t\t\tthis.trigger('message', response.data, ['string', 'number'].indexOf(typeof args[0]) !== -1 ? args[0] : ''); // only pass strings or numbers as eventID\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._responseHandler[response.data[0]]();\r\n\t\t\tthis.trigger('message', response.data);\r\n\t\t}\r\n\t}\r\n\t\r\n}\r\n\r\nWorkerInterface.prototype.handleError = function(response) {\r\n\tif (response.data.constructor !== Array) {\r\n\t\tconsole.log([this.name + ' error generic', '']);\r\n\t\treturn;\r\n\t}\r\n\r\n\tswitch (response.data[0]) {\r\n\t\tcase 'error' :\r\n\t\tcase 'warning' :\r\n\t\t\tconsole.log(this.name + ' ' + response.data[0], response.data[1]);\r\n\t\t\treturn;\r\n\t}\r\n\t\r\n\treturn true;\r\n}\r\n\r\nWorkerInterface.__factory_name = 'WorkerInterface';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @singleton PixiStage\r\n */\r\nvar PixiStage = {\r\n\t \r\n}\r\n\r\nPixiStage.renderer = null;\r\nPixiStage.stage = null;\r\n\r\nPixiStage.createRenderer = function() {\r\n\tthis.renderer = new PIXI.CanvasRenderer(window.innerWidth, window.innerHeight, {transparent:true, antialias : true, autoResize : true});\r\n}\r\n\r\nPixiStage.createStage = function() {\r\n\tthis.stage = new PIXI.Container();\r\n\t\r\n\tTweenMax.ticker.addEventListener(\"tick\", function() {\r\n\t\trenderer.render(stage);\r\n\t});\r\n}\r\n\r\nPixiStage.getStage = function() {\r\n\treturn this.stage;\r\n}\r\n\r\nPixiStage.addChild = function(shape) {\r\n\tthis.stage.addChild(shape);\r\n}\r\n\r\n\r\n\r\n\r\n/*\r\nlayerwidth = paddingLeft + marginLeft + nodeWidth\r\nlayerHeight = paddingTop + marginTop + nodeHeigth\r\n\r\nposition = {\r\n\tx : this.getParentView.currentAPI.getOffset().x + layerWidth,\r\n\ty : this.getParentView.currentAPI.getOffset().y + layerHeigth * this._parent._key\r\n}\r\n\r\n\t\t=> extrapolate radial pos from domain = xMax - xMin, alpha = (x - xMin) * 2PI / domain, x = cos(alpha), y = sin(alpha)\r\n\t\t\r\ngetHandlePos is a pure function(entering||exiting, nodeSize, _Key)\r\n\r\n\t=> could we use some lib to have complete DOM -> xy conversion ?\r\n\t\t=> gl-html.js\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor PixiView\r\n */\r\nvar PixiViewAPI = function(def) {\r\n\t\r\n\tthis.nodeName = def.nodeName;\r\n\tthis.templateNodeName = def.templateNodeName;\r\n\t\r\n\tthis.hostElem;\r\n\tthis.rootElem;\r\n\tthis.hostedInterface = {\r\n\t\tsetProp : PixiViewAPI.hostedInterface.setProp.bind(this),\r\n\t\tgetProp : PixiViewAPI.hostedInterface.getProp.bind(this)\r\n\t};\r\n\tthis.presenceAsAProp = 'flex';\r\n\t\r\n\tthis.objectType = 'PixiViewAPI';\r\n}\r\nPixiViewAPI.prototype = Object.create(EventEmitter.prototype);\r\nPixiViewAPI.prototype.objectType = 'PixiViewAPI';\r\nPixiViewAPI.prototype.constructor = PixiViewAPI;\r\n\r\nPixiViewAPI.hostedInterface = {\r\n\tsetProp : function(propName, value) {\r\n//\t\tthis.hostElem[propName] = value;\r\n\t},\r\n\tgetProp : function(propName, value) {\r\n//\t\treturn this.hostElem[propName];\r\n\t}\r\n};\r\n\r\n\r\nPixiViewAPI.prototype.setPresence = function(bool) {\r\n\tthis.hostElem.style.display = bool ? this.presenceAsAProp : 'none';\r\n}\r\n\r\nPixiViewAPI.prototype.addEventListener = function(eventName, handler) {\r\n\tthis.hostElem.addEventListener(eventName, handler);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.setMasterNode = function(node) {\r\n\tthis.hostElem = node;\r\n\tthis.rootElem = node.shadowRoot;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.getMasterNode = function() {\r\n\treturn this.hostElem;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.getWrappingNode = function() {\r\n\treturn this.rootElem || this.hostElem;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.isTextInput = function() {\r\n\treturn this.nodeName.toUpperCase() === 'INPUT';\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.getLowerIndexChildNode = function() {\r\n\ttry {\r\n\t\treturn this.getWrappingNode().children[atIndex - 1];\r\n\t}\r\n\tcatch(e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.setContentNoFail = function(value) {\r\n\tif (this.isTextInput())\r\n\t\tthis.hostElem.value = value;\r\n\telse\r\n\t\tthis.setNodeContent(value);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.setTextContent = function(text) {\r\n\tthis.getWrappingNode().textContent = text;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.setNodeContent = function(contentAsString) {\r\n\tthis.getWrappingNode().innerHTML = contentAsString;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nPixiViewAPI.prototype.appendTextNode = function(text) {\r\n\tvar elem = document.createElement('span');\r\n\telem.innerHTML = text;\r\n\tthis.getWrappingNode().appendChild(elem);\r\n}\r\n\r\n/**\r\n * @param {Component} childNode\r\n * @param {number} atIndex\r\n */\r\nPixiViewAPI.prototype.addChildNodeAt = function(childNode, atIndex) {\r\n\tvar lowerIndexChild;\r\n\tif (lowerIndexChild = this.getLowerIndexChildNode(atIndex))\r\n\t\tlowerIndexChild.insertAdjacentElement('afterend', childNode);\r\n\telse\r\n\t\tthis.getWrappingNode().appendChild(childNode);\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nPixiViewAPI.prototype.empty = function() {\r\n\tthis.getWrappingNode().innerHTML = null;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * @param {array[string]} contentAsArray\r\n * @param {string} templateNodeName\r\n */\r\nPixiViewAPI.prototype.getMultilineContent = function(contentAsArray) {\r\n\treturn this.getFragmentFromContent(contentAsArray, this.templateNodeName);\r\n}\r\n\r\n/**\r\n * @param {array[string]} contentAsArray\r\n * @param {string} templateNodeName\r\n */\r\nPixiViewAPI.prototype.getFragmentFromContent = function(contentAsArray, templateNodeName) {\r\n\r\n\tvar fragment = document.createDocumentFragment(), elem;\r\n\tcontentAsArray.forEach(function(val) {\r\n\t\tvar elem = document.createElement(templateNodeName);\r\n\t\telem.id = 'targetSubViewElem-' + TemplateFactory.UIDGenerator.newUID();\r\n\t\tif (val instanceof HTMLElement) {\r\n\t\t\telem.appendChild(val);\r\n\t\t\tfragment.appendChild(elem);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\telem.innerHTML = val;\r\n\t\tfragment.appendChild(elem);\r\n\t}, this);\r\n\treturn fragment;\r\n}\r\n\r\nPixiViewAPI.prototype.setContentFromArray = function(contentAsArray) {\r\n\tthis.empty();\r\n\tthis.getWrappingNode().appendChild(this.getMultilineContent(contentAsArray));\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor DOMView\r\n */\r\nvar DOMViewAPI = function(def) {\r\n\tthis.isShadowHost = def.isCustomElem;\r\n\tthis.nodeName = def.nodeName;\r\n\tthis.templateNodeName = def.templateNodeName;\r\n\t\r\n\tthis.hostElem;\r\n\tthis.rootElem;\r\n\tthis.hostedInterface = {\r\n\t\tsetProp : DOMViewAPI.hostedInterface.setProp.bind(this),\r\n\t\tgetProp : DOMViewAPI.hostedInterface.getProp.bind(this)\r\n\t};\r\n\tthis.presenceAsAProp = 'flex';\r\n\t\r\n\tthis.objectType = 'DOMViewAPI';\r\n}\r\nDOMViewAPI.prototype = Object.create(EventEmitter.prototype);\r\nDOMViewAPI.prototype.objectType = 'DOMViewAPI';\r\nDOMViewAPI.prototype.constructor = DOMViewAPI;\r\n\r\nDOMViewAPI.hostedInterface = {\r\n\tsetProp : function(propName, value) {\r\n\t\tthis.hostElem[propName] = value;\r\n//\t\tconsole.log(this.hostElem[propName]);\r\n\t},\r\n\tgetProp : function(propName, value) {\r\n\t\treturn this.hostElem[propName];\r\n\t}\r\n};\r\n\r\n\r\nDOMViewAPI.prototype.setPresence = function(bool) {\r\n\tthis.hostElem.style.display = bool ? this.presenceAsAProp : 'none';\r\n}\r\n\r\nDOMViewAPI.prototype.addEventListener = function(eventName, handler) {\r\n\tthis.hostElem.addEventListener(eventName, handler);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.setMasterNode = function(node) {\r\n\tthis.hostElem = node;\r\n\tthis.rootElem = node.shadowRoot;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getMasterNode = function() {\r\n\treturn this.hostElem;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getWrappingNode = function() {\r\n\treturn this.rootElem || this.hostElem;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.isTextInput = function() {\r\n\treturn this.nodeName.toUpperCase() === 'INPUT' || this.nodeName.toUpperCase() === 'TEXTAREA';\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getTextInputValue = function() {\r\n\treturn this.getMasterNode().value;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getLowerIndexChildNode = function(atIndex) {\r\n\ttry {\r\n\t\treturn this.getWrappingNode().children[atIndex - 1];\r\n\t}\r\n\tcatch(e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getTextContent = function() {\r\n\t// It may seem weird to return all the texts ignoring the real HTMLElements\r\n\t// Let'st try this for now...\r\n\t\r\n\tvar realTextContent = '';\r\n\tthis.getWrappingNode().childNodes.forEach(function(elem) {\r\n\t\tif (elem instanceof Text)\r\n\t\t\trealTextContent += elem.wholeText;\r\n\t});\r\n\treturn realTextContent;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.setContentNoFail = function(value) {\r\n\tif (this.isTextInput())\r\n\t\tthis.hostElem.value = value;\r\n\telse\r\n\t\tthis.setNodeContent(value);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.getContentNoFail = function(value) {\r\n\tif (this.isTextInput())\r\n\t\treturn this.hostElem.value;\r\n\telse\r\n\t\treturn this.getTextContent(); \r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.setTextContent = function(text) {\r\n\tthis.getWrappingNode().textContent = text;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.setNodeContent = function(contentAsString) {\r\n\tthis.getWrappingNode().innerHTML = contentAsString;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nDOMViewAPI.prototype.appendTextNode = function(text) {\r\n\tvar elem = document.createTextNode(text);\r\n\tthis.getWrappingNode().appendChild(elem);\r\n}\r\n\r\n/**\r\n * @param {Component} childNode\r\n * @param {number} atIndex\r\n */\r\nDOMViewAPI.prototype.addChildNodeAt = function(childNode, atIndex) {\r\n\tvar lowerIndexChild;\r\n\tif ((lowerIndexChild = this.getLowerIndexChildNode(atIndex)))\r\n\t\tlowerIndexChild.insertAdjacentElement('afterend', childNode);\r\n\telse\r\n\t\tthis.getWrappingNode().appendChild(childNode);\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nDOMViewAPI.prototype.empty = function() {\r\n\tthis.getWrappingNode().innerHTML = null;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * @param {array[string]} contentAsArray\r\n * @param {string} templateNodeName\r\n */\r\nDOMViewAPI.prototype.getMultilineContent = function(contentAsArray) {\r\n\treturn this.getFragmentFromContent(contentAsArray, this.templateNodeName);\r\n}\r\n\r\n/**\r\n * @param {array[string]} contentAsArray\r\n * @param {string} templateNodeName\r\n */\r\nDOMViewAPI.prototype.getFragmentFromContent = function(contentAsArray, templateNodeName) {\r\n\r\n\tvar fragment = document.createDocumentFragment(), elem;\r\n\tcontentAsArray.forEach(function(val) {\r\n\t\tvar elem = document.createElement(templateNodeName);\r\n\t\telem.id = 'targetSubViewElem-' + TemplateFactory.UIDGenerator.newUID();\r\n\t\tif (val instanceof HTMLElement) {\r\n\t\t\telem.appendChild(val);\r\n\t\t\tfragment.appendChild(elem);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\telem.innerHTML = val;\r\n\t\tfragment.appendChild(elem);\r\n\t}, this);\r\n\treturn fragment;\r\n}\r\n\r\nDOMViewAPI.prototype.setContentFromArray = function(contentAsArray) {\r\n\tthis.empty();\r\n\tthis.getWrappingNode().appendChild(this.getMultilineContent(contentAsArray));\r\n}\r\n\r\nDOMViewAPI.prototype.updateBGColor = function(color) {\r\n\tthis.getMasterNode().style.backgroundColor = color;\r\n}\r\n\r\n/**\r\n * These methods are implemented as a reminder and a potentially needed fallback,\r\n * but in most cases of hiding/showing, we should prefer the reactive states-based mechanism:\r\n * states : [{hidden : 'hidden'}} will be automagically reflected on the DOM node\r\n */\r\nDOMViewAPI.prototype.hide = function() {\r\n\tthis.getMasterNode().hidden = 'hidden';\t\r\n}\r\n\r\nDOMViewAPI.prototype.show = function() {\r\n\tthis.getMasterNode().hidden = null;\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentView\r\n */\r\nvar ComponentView = function(definition, parentView, parent, isChildOfRoot) {\r\n//\tconsole.error(definition);\r\n\tvar def = (definition.getHostDef && definition.getHostDef()) || definition;\r\n//\tif (definition.getHostDef() && definition.getHostDef().nodeName === 'smart-select')\r\n//\t\tconsole.log(def);\r\n\tthis._defUID = def.UID;\r\n\tthis.isCustomElem = def.isCustomElem;\r\n\tthis._sWrapperUID = def.sWrapper ? def.sWrapper.getName() : null;\r\n\t// TODO: styleHook.s refers to the AbstractStylesheet => change that, it's not at all explicit\r\n\tthis.styleHook;\r\n//\tconsole.log(def);\r\n\tthis.sOverride = def.sOverride;\r\n\t\r\n\tthis.objectType = 'ComponentView';\r\n\tif (!def.nodeName) {\r\n\t\tconsole.error('no nodeName given to a componentView : returning...', def);\r\n\t\treturn;\r\n\t}\r\n\telse if (!(parentView instanceof ComponentView) && def.nodeName !== 'app-root') {\r\n//\t\tconsole.log(parentView, ComponentView);\r\n\t\tconsole.warn('no parentView given to a componentView : nodeName is', def.nodeName, '& type is', def.type);\r\n\t}\r\n\t\t\r\n\tthis.API = this.currentViewAPI = new DOMViewAPI(def);\r\n\tthis.section = def.section;\r\n\t\r\n\tif (!nodesRegistry.getItem(this._defUID))\r\n\t\tnodesRegistry.setItem(this._defUID, (new CachedTypes.CachedNode(def.nodeName, def.isCustomElem)));\r\n\t\r\n\tif (!Registries.caches.attributes.getItem(this._defUID))\r\n\t\tRegistries.caches.attributes.setItem(this._defUID, def.attributes);\r\n\t\t\r\n\tviewsRegistry.push(this);\r\n\r\n\tif (def !== definition) {\r\n\t\tthis._parent = parent;\r\n\t\tthis.targetSubView = null;\r\n//\t\tif (def.sOverride) {\r\n//\t\t\t\r\n//\t\t}\r\n\t\tthis.styleHook = new SWrapperInViewManipulator(this);\r\n\t\t\r\n//\t\tif (definition.getHostDef() && definition.getHostDef().type === 'Fieldset')\r\n//\t\t\tconsole.log(definition);\r\n\t\tthis.subViewsHolder;\r\n\t\tif ((definition.subSections.length && definition.subSections[0] !== null) || definition.members.length) {\r\n\t\t\tthis.subViewsHolder = new ComponentSubViewsHolder(definition, this);\r\n\t\t\t// this shall be retried after calling the hooks, as the interfaces may have added subViews\r\n\t\t\tthis.getTargetSubView(def);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.subViewsHolder = new ComponentSubViewsHolder(null, this);\r\n\t}\r\n\t\r\n\tvar hadParentView = this.parentView = parentView instanceof ComponentView ? parentView : null;\r\n\tif (this.parentView && !isChildOfRoot) {\r\n\t\tthis.parentView = this.getEffectiveParentView();\r\n//\t\tconsole.log('hadParentView', parentView, this.parentView);\r\n\t}\r\n\t\t\r\n\tif (hadParentView && !this.parentView)\r\n\t\tconsole.warn('Lost parentView => probable section number missing in definition obj :', def.nodeName);\r\n}\r\nComponentView.prototype = {};\r\nComponentView.prototype.objectType = 'ComponentView';\r\nComponentView.prototype.constructor = ComponentView;\r\n\r\n/**\r\n * Main helper to access the effective implementation of the View\r\n */\r\nComponentView.prototype.callCurrentViewAPI = function(methodName, ...args) {\r\n\treturn this.currentViewAPI[methodName](...args);\r\n}\r\n\r\n/**\r\n * @abstract\r\n * HELPER : => when appending a child, should we append to rootNode or to a subSection ?\r\n * \r\n */\r\nComponentView.prototype.getEffectiveParentView = function() {\r\n\treturn (this.parentView.subViewsHolder && this.parentView.subViewsHolder.subViews.length) \r\n\t\t\t\t\t? this.parentView.subViewsHolder.subViews[this.section]\r\n\t\t\t\t\t: this.parentView;\r\n}\r\n\r\nComponentView.prototype.getTargetSubView = function(def) {\r\n\tthis.targetSubView = (def.targetSlotIndex !== null && this.subViewsHolder.memberViews.length > def.targetSlotIndex)\r\n\t\t? this.subViewsHolder.memberAt(def.targetSlotIndex)\r\n\t\t: null;\t\r\n}\r\n\r\n/**\r\n * \r\n * TODO: remove the this alias after having checked the historical code\r\n * (this method has become \"getWrappingNode\")\r\n */\r\nComponentView.prototype.getRoot = function() {\r\n\treturn this.getWrappingNode();\r\n}\r\n\r\n/**\r\n * Shorthand method on the currentViewAPI\r\n */\r\nComponentView.prototype.getMasterNode = function() {\r\n\treturn this.callCurrentViewAPI('getMasterNode');\r\n}\r\n\r\n/**\r\n * Shorthand method on the currentViewAPI\r\n */\r\nComponentView.prototype.getWrappingNode = function() {\r\n\treturn this.callCurrentViewAPI('getWrappingNode');\r\n}\r\n\r\n/**\r\n * These shorthands methods are only useful when we explicitly need\r\n * to update the -stylesheet- associated with a (shadowed, obviously) web-component\r\n */\r\nComponentView.prototype.hide = function() {\r\n\tif (this.view.styleHook.s)\r\n\t\tthis.styleHook.s.updateRule({visibility : 'hidden'}, ':host')\r\n\telse\r\n\t\tthis.currentViewAPI.hide();\r\n}\r\nComponentView.prototype.show = function() {\r\n\tif (this.view.styleHook.s)\r\n\t\tthis.styleHook.s.updateRule({visibility : 'visible'}, ':host')\r\n\telse\r\n\t\tthis.currentViewAPI.show();\r\n}\r\n\r\n\r\n/**\r\n * @param {boolean | innerEvent} boolOrEvent\r\n * might be direclty passed an event obj (a \"framework event-type\")\r\n */\r\nComponentView.prototype.setPresence = function(boolOrEvent) {\r\n\tvar bool;\r\n\tif (typeof boolOrEvent === 'object' && typeof boolOrEvent.data !== 'undefined')\r\n\t\tbool = boolOrEvent.data;\r\n\telse\r\n\t\tbool = boolOrEvent;\r\n\tthis.callCurrentViewAPI('setPresence', bool);\r\n}\r\n\r\n/**\r\n * @param {string} eventName\r\n * @param {function} handler\r\n * \r\n * TODO: remove the addEventListener alias after having checked the historical code\r\n */\r\nComponentView.prototype.addEventListenerOnNode = ComponentView.prototype.addEventListener = function(eventName, handler) {\r\n\tthis.callCurrentViewAPI('addEventListener', eventName, handler);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nComponentView.prototype.getTextContent = function() {\r\n\treturn this.callCurrentViewAPI('getTextContent');\r\n}\r\n\r\n/**\r\n * @abstract\r\n * \r\n * @needsGlobalRefactoring\r\n */\r\nObject.defineProperty(ComponentView.prototype, 'value', { \t\t// ComponentWithReactiveText.prototype.populateSelf makes good use of that\r\n\tget : function() {\r\n\t\treturn this.callCurrentViewAPI('getContentNoFail');\r\n\t},\r\n\tset : function(value) {\r\n\t\tthis.callCurrentViewAPI('setContentNoFail', value);\r\n\t}\r\n});\r\n\r\n/**\r\n * \r\n */\r\nComponentView.prototype.setTextContent = function(text) {\r\n\tthis.callCurrentViewAPI('setTextContent', text);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nComponentView.prototype.setContentNoFail = function(text) {\r\n\tthis.callCurrentViewAPI('setContentNoFail', text);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nComponentView.prototype.setNodeContent = function(contentAsString) {\r\n\tthis.callCurrentViewAPI('setNodeContent', contentAsString);\r\n}\r\n\r\n/**\r\n * \r\n * \r\n * @needsGlobalRefactoring (becomes appendAsTextNode)\r\n */\r\nComponentView.prototype.appendText = function(textContent) {\r\n\tthis.appendAsTextNode(textContent);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nComponentView.prototype.appendAsTextNode = function(textContent) {\r\n\tthis.callCurrentViewAPI('appendTextNode', textContent);\r\n}\r\n\r\n/**\r\n * @param {Component} childView\r\n * @param {number} atIndex\r\n * \r\n * @needsGlobalRefactoring\r\n */\r\nComponentView.prototype.addChildAt = function(childView, atIndex) {\r\n\tthis.subViewsHolder.addMemberView(childView);\r\n\tchildView.parentView = this;\r\n\tthis.addChildNodeFromViewAt(childView, atIndex);\r\n}\r\n\r\n/**\r\n * @param {Component} childView\r\n * @param {number} atIndex\r\n */\r\nComponentView.prototype.addChildNodeFromViewAt = function(childView, atIndex) {\r\n\tif (!childView.getMasterNode())\t\t// check presence of masterNode, as we may be adding a childComponent before the view has been rendered\r\n\t\treturn;\r\n\tthis.callCurrentViewAPI('addChildNodeAt', childView.getMasterNode(), atIndex);\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentView.prototype.empty = function() {\r\n\treturn this.callCurrentViewAPI('empty');\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nComponentView.prototype.emptyTargetSubView = function() {\r\n\treturn this.targetSubView.empty();\r\n}\r\n\r\nComponentView.prototype.setContentFromArray = function(contentAsArray) {\r\n\tthis.callCurrentViewAPI('empty');\r\n\tthis.callCurrentViewAPI('setContentFromArray', contentAsArray);\r\n}\r\n\r\n/**\r\n * @param {array[string]} contentAsArray\r\n */\r\nComponentView.prototype.setContentFromArrayOnTargetSubview = function(contentAsArray) {\r\n//\tconsole.log(this._parent.objectType);\r\n\treturn this.targetSubView.setContentFromArray(contentAsArray);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentSubView\r\n */\r\nvar ComponentSubView = function(definition, parentView) {\r\n\tComponentView.call(this, definition, parentView);\r\n\t\r\n\tthis.objectType = 'ComponentSubView';\r\n\t\r\n}\r\nComponentSubView.prototype = Object.create(ComponentView.prototype);\r\nComponentSubView.prototype.objectType = 'ComponentSubView';\r\nComponentSubView.prototype.constructor = ComponentSubView;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentSubViewsHolder\r\n */\r\nvar ComponentSubViewsHolder = function(definition, parentView) {\r\n\r\n\tthis.parentView = parentView || null;\r\n\tthis.subViews = [];\r\n\tthis.memberViews = [];\r\n\t\r\n\t// subViewsHolder exists even if there is no subViews (and we pass a definition as null if there is neither memberViews nor subViews)\r\n\tif (definition)\r\n\t\tthis.instanciateSubViews(definition);\r\n}\r\nComponentSubViewsHolder.prototype = {};\r\nComponentSubViewsHolder.prototype.objectType = 'ComponentSubViewsHolder';\r\nComponentSubViewsHolder.prototype.constructor = ComponentSubViewsHolder;\r\n\r\nComponentSubViewsHolder.prototype.instanciateSubViews = function(definition) {\r\n\tdefinition.subSections.forEach(function(def) {\r\n\t\tthis.subViews.push((new ComponentSubView(def, this.parentView)));\r\n\t}, this);\r\n\tdefinition.members.forEach(function(def) {\r\n\t\tif(typeof def.section === 'undefined') {\r\n\t\t\tif (typeof def.host !== 'undefined')\r\n\t\t\t\tconsole.warn('A component\\'s definition contains \"members\" which seem to be Components (they have a \"host\" property), but have no \"type\" property (so they\\'re being instanciated as views, and it failed). If you menat to define a view, you must define a template without hierarchy (the nodeName & section properties must be defined at the first level). nodeName is ' + def.host.nodeName + ' & defUID is ' + def.host.UID);\r\n\t\t\telse\r\n\t\t\t\tconsole.warn('A member view\\'s definition doesn\\'t contain a \"section\" prop at first level, you may have defined it wrongly. You must define a template without hierarchy (the nodeName & section properties must be defined at the first level). nodeName is ' + def.nodeName + ' & defUID is ' + def.UID);\r\n\t\t}\r\n\t\tthis.memberViews.push((new ComponentSubView(def, def.section !== null ? this.subViews[def.section] : this.parentView)));\r\n\t}, this);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.firstMember = function() {\r\n\treturn this.memberViews[0];\r\n}\r\n\r\nComponentSubViewsHolder.prototype.lastMember = function() {\r\n\treturn this.memberViews[this.memberViews.length - 1];\r\n}\r\n\r\nComponentSubViewsHolder.prototype.memberAt = function(idx) {\r\n\treturn this.memberViews[idx];\r\n}\r\n\r\nComponentSubViewsHolder.prototype.immediateAddMemberAt = function(idx, memberView) {\r\n\tvar backToTheFutureAmount = this.memberViews.length - idx;\r\n\tRegistries.viewsRegistry.splice(Registries.viewsRegistry.length - backToTheFutureAmount, 0, memberView);\r\n\tthis.memberViews.splice(idx, 1, memberView);\r\n}\r\n\r\n// Should not be used: \r\n// We need the mecanism defined in ComponentView \r\n// to define the correct parentView\r\nComponentSubViewsHolder.prototype.addMemberView = function(view) {\r\n\tthis.memberViews.push(view);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.addMemberViewFromDef = function(definition) {\r\n\tvar view = new ComponentSubView(definition, this.parentView);\r\n\tthis.memberViews.push(view);\r\n\treturn view;\r\n}\r\n\r\nComponentSubViewsHolder.prototype.moveMemberViewFromTo = function(from, to, viewsRegistryIdx, offset) {\r\n\tthis.memberViews.splice(to, 0, this.memberViews.splice(from, 1)[0]);\r\n\tif (offset && typeof viewsRegistryIdx === 'number')\r\n\t\tthis.immediateAscendViewAFewStepsHelper(offset, viewsRegistryIdx);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.moveLastMemberViewTo = function(to, offset, viewsRegistryIdx) {\r\n\tvar from = this.memberViews.length - 1\r\n\tif (offset && viewsRegistryIdx)\r\n\t\tthis.moveMemberViewFromTo(from, to, offset, viewsRegistryIdx);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.immediateUnshiftMemberView = function(definition) {\r\n\tvar lastView = Registries.viewsRegistry.pop();\r\n\tvar view = new ComponentSubView(definition, this.parentView);\r\n\tthis.memberViews.unshift(view);\r\n\t\r\n\tRegistries.viewsRegistry.push(lastView);\r\n\treturn view;\r\n}\r\n\r\nComponentSubViewsHolder.prototype.immediateAscendViewAFewStepsHelper = function(stepsCount, effectiveViewIdx) {\r\n\tvar ourLatelyAppendedView = Registries.viewsRegistry.splice(effectiveViewIdx, 1)[0];\r\n//\tconsole.log(Registries.viewsRegistry.length, stepsCount, Registries.viewsRegistry[Registries.viewsRegistry.length - 1 - stepsCount]);\r\n\tRegistries.viewsRegistry.splice(effectiveViewIdx - stepsCount, 0, ourLatelyAppendedView);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.resetMemberContent = function(idx, textContent) {\r\n\tthis.memberViews[idx].reset();\r\n}\r\n\r\nComponentSubViewsHolder.prototype.setMemberContent = function(idx, textContent) {\r\n\tthis.memberViews[idx].setContentNoFail(textContent);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.setMemberContent_Fast = function(idx, textContent) {\r\n\tthis.memberViews[idx].setTextContent(textContent);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.appendContentToMember = function(idx, textContent) {\r\n\tthis.memberViews[idx].appendAsTextNode(textContent);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.appendAsMemberContent = function(idx, textContent) {\r\n\tthis.memberViews[idx].empty();\r\n\tthis.memberViews[idx].appendAsTextNode(textContent);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.setEachMemberContent = function(contentAsArray) {\r\n\tcontentAsArray.forEach(function(val, key) {\r\n\t\tif (typeof val !== 'string')\r\n\t\t\treturn;\r\n\t\tthis.setMemberContent(key, val);\r\n\t}, this);\r\n}\r\n\r\nComponentSubViewsHolder.prototype.setEachMemberContent_Fast = function(contentAsArray) {\r\n\tcontentAsArray.forEach(function(val, key) {\r\n\t\tif (typeof val !== 'string')\r\n\t\t\treturn;\r\n\t\tthis.setMemberContent_Fast(key, val);\r\n\t}, this);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar DOMCanvasAccessor = function(definition, view) {\r\n\tDOMViewAPI.call(this, definition);\r\n\tthis.objectType = 'DOMCanvasAccessor';\r\n//\tconsole.log(definition.members);\r\n\tthis.view = view;\r\n\tthis.ctx;\r\n\t\r\n//\tvar found = false;\r\n//\tdefinition.members.forEach(function(member, idx) {\r\n//\t\tif (!found && ((member.getHostDef() && member.getHostDef().nodeName === 'canvas') || member.nodeName === 'canvas')) {\r\n//\t\t\tthis.canvasLocation = view.subViewsHolder.memberAt(idx);\r\n//\t\t\tfound = true;\r\n//\t\t}\r\n//\t}, this);\r\n}\r\nDOMCanvasAccessor.prototype = Object.create(DOMViewAPI.prototype);\r\nDOMCanvasAccessor.prototype.objectType = 'DOMCanvasAccessor';\r\n\r\nDOMCanvasAccessor.prototype.setMasterNode = function(node) {\r\n\tvar self = this, canvas;\r\n\tDOMViewAPI.prototype.setMasterNode.call(this, node);\r\n\t\r\n\tthis.view.nodeAsAPromise.then(function(boundingBox) {\r\n//\t\tconsole.log(boundingBox);\r\n\t\tcanvas = self.view.subViewsHolder.memberAt(0).getMasterNode();\r\n\t\tcanvas.width = boundingBox.w;\r\n\t\tcanvas.height = boundingBox.h;\r\n\t\tself.ctx = canvas.getContext('2d');\t\r\n\t\treturn boundingBox;\r\n\t});\r\n}\r\n\r\nDOMCanvasAccessor.prototype.setFillColor = function(color) {\r\n\tvar self = this;\r\n//\tthis.view.nodeAsAPromise.then(function() {\r\n\t\tself.ctx.fillStyle = color;\r\n//\t});\r\n}\r\n\r\nDOMCanvasAccessor.prototype.drawPoint = function(x, y) {\r\n\tvar self = this;\r\n//\tthis.view.nodeAsAPromise.then(function() {\r\n\t\tself.ctx.fillRect(x, y, 1, 1);\r\n//\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CanvasView = function(definition, parentView) {\r\n\tComponentView.call(this, definition, parentView);\r\n\t\r\n\tthis.objectType = 'CanvasView';\r\n\tthis.currentViewAPI = new DOMCanvasAccessor(definition, this);\r\n\t\r\n\tthis.w = 0;\r\n\tthis.h = 0;\r\n\tthis.nodeAsAPromise;\r\n}\r\n\r\nCanvasView.prototype = Object.create(ComponentView.prototype);\r\nCanvasView.prototype.objectType = 'CanvasView';\r\n\r\nCanvasView.prototype.getDimensions = function() {\r\n\tvar self = this;\r\n\tthis.nodeAsAPromise = new Promise(function(resolve, reject) {\r\n\t\tvar inter = setInterval(function() {\r\n\t\t\tif (self.subViewsHolder.memberAt(0).getMasterNode()) {\r\n\t\t\t\tclearInterval(inter);\t\t\t\t\r\n\t\t\t\tappConstants.resizeObserver.observe(self.subViewsHolder.memberAt(0).getMasterNode(), self.storeDimensions.bind(self, resolve));\r\n\t\t\t}\r\n\t\t}, 512);\r\n\t});\r\n\treturn this.nodeAsAPromise;\r\n}\r\n\r\nCanvasView.prototype.storeDimensions = function(resolve, e) {\r\n\r\n\tthis.w = e.data.boundingBox.w;\r\n\tthis.h = e.data.boundingBox.h;\r\n\tresolve(e.data.boundingBox);\r\n\tappConstants.resizeObserver.unobserve(this.subViewsHolder.memberAt(0).getMasterNode());\r\n}\r\n\r\nCanvasView.prototype.gradientFill = function(colorScale) {\r\n\tvar length = colorScale.max();\r\n\tthis.callCurrentViewAPI('gradientFill', colorScale[0], colorScale[length], 0, 0, this.w, this.h);\r\n}\r\n\r\nCanvasView.prototype.partialGradientFill = function(boundaries, colorScale) {\r\n\tvar length = colorScale.max();\r\n\tthis.callCurrentViewAPI('gradientFill', colorScale[0], colorScale[length], boundaries.x, boundaries.y, boundaries.w, boundaries.h);\r\n}\r\n\r\nCanvasView.prototype.manualGradientFill = function(colorScale, boundaries) {\r\n\tvar self = this;\r\n\tvar length = 1; //colorScale.max();\r\n\t\r\n\t\r\n\tthis.nodeAsAPromise.then(function(boundingBox) {\r\n//\t\tconsole.log(boundingBox);\r\n\t\tif (typeof boundaries === 'undefined') {\r\n\t\t\tboundaries = {\r\n\t\t\t\tw : boundingBox ? boundingBox.w : self.w,\r\n\t\t\t\th  : boundingBox ? boundingBox.h : self.h,\r\n\t\t\t\tx : 0,\r\n\t\t\t\ty : 0\r\n\t\t\t};\r\n\t\t}\r\n//\t\tconsole.log(boundingBox);\r\n//\t\tconsole.log('canvas promise');\r\n\t\tfor (let x = boundaries.x, l = boundaries.w + boundaries.x; x < l; x++) {\r\n\t\t\tfor (let y = boundaries.y, L = boundaries.h + boundaries.y; y < L; y++) {\r\n\t\t\t\tself.callCurrentViewAPI('setFillColor', colorScale((x - boundaries.x) * length / boundaries.w).hex());\r\n\t\t\t\tself.callCurrentViewAPI('drawPoint', x, y);\t\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * A static definition of some DOM attributes :\r\n * \t\treminded here as useful for storing a component's \"persistent state\" (although it's only \"persisted\" through the Stream interface)\r\n * \t\tused by the visibleStateComponent to map glyphs on states\r\n */\r\nvar commonStates = {\r\n\t\thidden : false,\r\n\t\tdisabled : false,\r\n\t\tchecked : false,\r\n\t\tfocused : false,\r\n\t\tselected : false,\r\n\t\thighlighted : false,\r\n\t\tblurred : false,\r\n\t\tvalid : false,\r\n\t\trecent : false, \t// boolean otherwise handled by specific mecanism (component should be referenced in a list, etc.)\r\n\t\tbranchintree : '',\t// replaces CSS classes : enum ('root', 'branch', 'leaf')\r\n\t\tleafintree : '',\r\n\t\tnodeintree : false,\r\n\t\texpanded : false,\r\n\t\tsortable : false,\r\n\t\tsortedasc : false,\r\n\t\tsorteddesc :false,\r\n\t\tposition : 0,\t\t// position as a state : degrees, 'min', 'man', nbr of pixels from start, etc. \r\n\t\tsize : 0,\t\t\t// size as a state : length, height, radius\r\n\t\ttabIndex : 0,\r\n\t\t'delete' : false,\t\t// isn't a -persistent- state (cause it removes the node, hm) but deserves a glyph\r\n\t\tshallreceivefile : true,\r\n\t\thandlesvideo : true\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tPair : Pair,\r\n\tListOfPairs : ListOfPairs,\r\n\tDimensionsPair : DimensionsPair,\r\n\tEventEmitter : EventEmitter,\r\n\tCommand : Command,\r\n\tWorker : WorkerInterface,\r\n\tStream : Stream,\r\n\tLazyResettableColdStream : LazyResettableColdStream,\r\n\tNumberedStream : NumberedStream,\r\n\tStreamPool : StreamPool,\r\n\tSavableStore : SavableStore,\r\n\tComponentView : ComponentView,\r\n\tComponentSubView : ComponentSubView,\r\n\tComponentSubViewsHolder : ComponentSubViewsHolder,\r\n\tCanvasView : CanvasView,\r\n\tcommonStates : commonStates\r\n}",
    "\"use strict\";\n/**\r\n * @factory ElementFactory\r\n * \r\n */\r\n\r\n\r\n//var AGDef = require('src/UI/categories/_configurationFiles/_arias&glyphsDef');\r\n\r\nvar elementConstructorDecorator_HSD = require('src/core/elementDecorator_HSD');\r\n//var elementDecorator_Offset = require('src/core/elementDecorator_Offset');\r\n\r\n\r\nvar customElems;\r\n\t\r\n\tfunction ElementFactory () {\r\n\t\tthis.implements = [];\r\n//\t\tthis.defaultNodesDecorator = 'Hyphen-Star-Dash';\r\n\t}\r\n\tElementFactory.prototype.objectType = 'ElementFactory';\r\n\tElementFactory.prototype['Hyphen-Star-Dash'] = elementConstructorDecorator_HSD['Hyphen-Star-Dash'];\r\n\t\r\n\tElementFactory.prototype.createElement = function (nodeName, isCustomElem, states) {\r\n//\t\tconsole.log(nodeName, isCustomElem);\r\n\t\tif (isCustomElem)\r\n\t\t\treturn this.registerAndCreateElement(nodeName, states);\r\n\t\telse {\r\n\t\t\tvar elem = document.createElement(nodeName);\r\n\t\t\telem.setAria = ElementFactory.prototype.setAria;\r\n\t\t\treturn elem;\r\n\t\t}\r\n\t}\r\n\t\r\n\tElementFactory.prototype.createCollection = function (def, states) {\r\n\t\tvar collection = document.createDocumentFragment();\r\n\t\tdef.fragment.forEach(function(nodeDef, key) {\r\n\t\t\tnodeDef = nodeDef.getHostDef() || nodeDef;\r\n\t\t\t\r\n\t\t\tif (nodeDef.isCustomElem)\r\n\t\t\t\telem = this.registerAndCreateElement(nodeDef, states);\r\n\t\t\telse\r\n\t\t\t\telem = document.createElement(nodeDef.nodeName); \r\n//\t\t\telem = this.setAttributes(nodeDef.attributes, elem);\r\n\t\t\tcollection.appendChild(elem);\r\n\t\t}, this);\r\n\t\treturn collection\r\n\t}\r\n\t\r\n\tElementFactory.prototype.registerAndCreateElement = function (nodeName, states) {\r\n\t\tif (!customElements.get(nodeName)) {\r\n//\t\t\tconsole.log('CustomElement ' + nodeName + ' shall be defined');\r\n\t\t\tthis.defineCustomElem(nodeName, states);\r\n\t\t}\r\n\t\treturn document.createElement(nodeName);\r\n\t}\r\n\t\r\n\tElementFactory.prototype.defineCustomElem = function(nodeName, componentStates) {\r\n\t\tvar values = [], states = componentStates ? componentStates.map(function(stateObject, key) {\r\n\t\t\tvalues[key] = stateObject.getValue();\r\n\t\t\treturn stateObject.getName();\r\n\t\t}) : [];\r\n\t\t\r\n\t\tclass HTMLExtendedElement extends HTMLElement {\r\n\t\t\tconstructor() {\r\n\t\t\t\tsuper();\r\n\t\t\t\tthis.attachShadow({mode : 'open'});\r\n\t\t\t\tstates.forEach(function(stateName) {\r\n\t\t\t\t\tElementFactory.prototype.propGetterSetter.call(this, stateName);\r\n\t\t\t\t}, this);\r\n\t\t\t\tthis.setAria = ElementFactory.prototype.setAria;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// declare observables\r\n\t\t\tstatic get observedAttributes() {\r\n\t\t\t\treturn states;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconnectedCallback() {\r\n//\t\t\t\tstates.forEach(function(stateName, key) {\r\n//\t\t\t\t\t// Init on forced state by the states obj (this allows to have no propagation on first prop setting)\r\n//\t\t\t\t\t// connectedCallback doesn't call attributeChangeCallback\r\n//\t\t\t\t\tif (this.streams[stateName]) {\r\n//\t\t\t\t\t\tthis.streams[stateName].reflectedObj = this;\r\n//\t\t\t\t\t\tthis[stateName] = values[key] === 'undefined' ? undefined : values[key];\r\n//\t\t\t\t\t}\r\n//\t\t\t\t}, this);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// mutation observer\r\n\t\t\tattributeChangedCallback(attrName, oldVal, newVal) {\r\n\t\t\t\tif (oldVal === newVal)\r\n\t\t\t\t\treturn;\r\n//\t\t\t\tvar arias = AGDef.getArias(this.componentType);\r\n//\t\t\t\tfor(var aria in arias) {\r\n//\t\t\t\t\tif (aria.indexOf(attrName) !== -1)\r\n//\t\t\t\t\t\t(function(a) {this.setAttribute(a, newVal);})(aria);\r\n//\t\t\t\t}\r\n\t\t\t\tif (this.streams[attrName] && this.streams[attrName].get() !== newVal)\r\n\t\t\t\t\tthis.streams[attrName].value = this.getTypedValue(newVal);\r\n\t\t\t\t\t\r\n\t\t\t\t//Hack hidden behavior not inherited by custom elements (may be related to the presence of an explicit \"diplay\" in the CSS)\r\n\t\t\t\tif (attrName === 'hidden') {\r\n\t\t\t\t\tif (this.getTypedValue(newVal) === true)\r\n\t\t\t\t\t\tthis.style.visibility = 'hidden';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis.style.visibility = 'visible';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// helper methods\r\n\t\t\tgetTypedValue(attrValue) {\r\n\t\t\t\treturn ElementFactory.prototype.getTypedValue(attrValue);\r\n\t\t\t}\r\n\t\t}\r\n//\t\tconsole.log('CustomElement ' + nodeName + ' has been defined');\r\n\t\tcustomElements.define(nodeName, HTMLExtendedElement);\r\n\t}\r\n\t\r\n\tElementFactory.prototype.setAria = function(ariaName, ariaValue) {\r\n\t\tthis.setAttribute(ariaName.dromedarToHyphens(), ariaValue);\r\n\t}\r\n\t\r\n\tElementFactory.prototype.setAttributes = function(attributes, node) {\r\n\t\tattributes.forEach(function(attrObject) {\r\n\t\t\tnode[attrObject.getName()] = attrObject.getValue();\r\n\t\t});\r\n\t}\r\n\t\r\n\tElementFactory.prototype.propGetterSetter = function(prop) {\r\n\t\t\r\n\t\t// FIXME: Big code duplication. Multi-test the override of native DOM getter-setters, and refactor\r\n\t\tvar desc = (Object.getOwnPropertyDescriptor(this, prop) || Object.getPropertyDescriptor(this, prop));\r\n\t\t\r\n//\t\tconsole.log(prop, desc)\r\n\t\tif (typeof desc !== 'undefined' && desc.configurable && desc.get) {\r\n\t\t\tdesc.get = function() {\r\n\t\t\t\t\treturn this.hasAttribute(prop) ? (this.getTypedValue ? this.getTypedValue(this.getAttribute(prop)) : ElementFactory.prototype.getTypedValue.call(this, this.getAttribute(prop))) : null;\r\n\t\t\t\t};\r\n\t\t\tdesc.set = function(value) {\r\n\t\t\t\t// We're setting an attribute:  don't if the propName is camelCase \r\n\t\t\t\tif (prop.toLowerCase() !== prop)\r\n\t\t\t\t\tconsole.warn('Reflected streams must have a lowercase name :', prop);\r\n\t\t\t\t\r\n\t\t\t\t// For litteral values, Updating the Stream is handled by onAttributeChangeCallback\r\n\t\t\t\tif (prop !== 'content' && prop.toLowerCase() === prop && typeof value !== 'undefined' && typeof value !== 'object' && !Array.isArray(value)) {\r\n\t\t\t\t\tif (this.streams[prop].value !== value && this.nodeName.indexOf('-') === -1) {\r\n\t\t\t\t\t\t// special case for non-custom elements : attributeChange doesn't trigger the stream update\r\n\t\t\t\t\t\tthis.streams[prop].value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// case of double update on the attr can't be avoided when :\r\n\t\t\t\t\t// \t\t- we're reflecting the attr on the prop through the stream (marginal case of someone absolutely wanting to mutate the obj targetting the attr)\r\n\t\t\t\t\t// the stream won't update twice though : forward is set to false\r\n\t\t\t\t\tthis.setAttribute(prop, value);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this.streams[prop].value !== value)\r\n\t\t\t\t\t\tthis.streams[prop].value = value;\r\n\t\t\t\t\t((value === null || value === undefined) && this.removeAttribute(prop));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\telse {\r\n\t\t\tObject.defineProperty(this, prop, {\r\n\t\t\t\tget : function() {\r\n\t\t\t\t\treturn this.hasAttribute(prop) ? (this.getTypedValue ? this.getTypedValue(this.getAttribute(prop)) : ElementFactory.prototype.getTypedValue.call(this, this.getAttribute(prop))) : null;\r\n\t\t\t\t},\r\n\t\t\t\tset : function(value) {\r\n\t\t\t\t\t// We're setting an attribute:  don't if the propName is camelCase\r\n\t\t\t\t\tif (prop.toLowerCase() !== prop)\r\n\t\t\t\t\t\tconsole.warn('Reflected streams must have a lowercase name :', prop);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// For litteral values, Updating the Stream is handled by onAttributeChangeCallback\r\n\t\t\t\t\tif (prop !== 'content' && prop.toLowerCase() === prop && typeof value !== 'undefined' && typeof value !== 'object' && !Array.isArray(value)) {\r\n\t\t\t\t\t\tif (this.streams[prop].value !== value && this.nodeName.indexOf('-') === -1) {\r\n\t\t\t\t\t\t\t// special case for non-custom elements : attributeChange doesn't trigger the stream update\r\n\t\t\t\t\t\t\tthis.streams[prop].value = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// case of double update on the attr can't be avoided when :\r\n\t\t\t\t\t\t// \t\t- we're reflecting the attr on the prop through the stream (marginal case of someone absolutely wanting to mutate the obj targetting the attr)\r\n\t\t\t\t\t\t// the stream won't update twice though : forward is set to false\r\n\t\t\t\t\t\tthis.setAttribute(prop, value);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (this.streams[prop].value !== value)\r\n\t\t\t\t\t\t\tthis.streams[prop].value = value;\r\n\t\t\t\t\t\t((value === null || value === undefined) && this.removeAttribute(prop));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tElementFactory.prototype.getTypedValue = function(attrValue) {\r\n\t\tvar ret;\r\n\t\tif (typeof attrValue === 'string')\r\n\t\t\treturn Boolean.prototype.tryParse(attrValue);\r\n\t\telse if (!isNaN((ret = parseInt(attrValue))))\r\n\t\t\treturn ret;\r\n\t\telse\r\n\t\t\treturn attrValue;\r\n\t}\r\n\t\r\n\r\n\r\nmodule.exports = (new ElementFactory());",
    "\"use strict\";\n/**\r\n * @programmatic_style Generics\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar appConstants = require('src/appLauncher/appLauncher');\r\nvar StylesheetWrapper = require('src/editing/AbstractStylesheet');\r\n\r\nvar styleDef = function(uniqueID, styles) {\r\n//\tif (styles === null)\r\n//\t\tconsole.trace(styles);\r\n//\t\t\r\n\tif (Array.isArray(uniqueID) && uniqueID[0].selector) {\r\n\t\tstyles = uniqueID;\r\n\t\tuniqueID = undefined;\r\n\t}\r\n\t\r\n\tvar obj,\r\n\t\tcachedStylesheet,\r\n\t\tname = (uniqueID || 'Automatic_CSS_ID_' + TypeManager.UIDGenerator.newUID()),\r\n\t\tdebug;\r\n\t\r\n\tif (uniqueID) {\r\n//\t\tconsole.log(uniqueID);\r\n\t\tcachedStylesheet = appConstants.isKnownUID(uniqueID);\r\n\t}\r\n\r\n\tif (Object.prototype.toString.call(cachedStylesheet) === '[object Object]')\r\n\t\treturn cachedStylesheet;\r\n\telse if (typeof cachedStylesheet === 'string') {\r\n\t\tobj = new StylesheetWrapper(styles, cachedStylesheet); // cachedStylesheet may be a string (the future key of the object in the cache)\r\n\t\tappConstants.setUID(cachedStylesheet, obj);\r\n\t}\r\n\telse {\r\n\t\tobj = new StylesheetWrapper(styles, name);\r\n\t\tdebug = appConstants.setUID(obj.getName(), obj);\r\n//\t\tconsole.log(name, debug);\r\n\t}\r\n\r\n\treturn obj;\r\n}\r\n\r\nmodule.exports = styleDef;",
    "\"use strict\";\n/**\r\n * constructor MemoryBufferStack\r\n */\r\n\r\n//var TypeManager = require('src/core/TypeManager');\r\n//var CSSSelectorsList = require('src/editing/CSSSelectorsList');\r\nvar _functionalStyleHelpers = require('src/core/_functionalStyleHelpers');\r\n\r\n\r\nvar MemoryBufferStack = function(itemSize, itemCount, isAbsoluteSize) {\r\n\tthis.objectType = 'MemoryBufferStack';\r\n\t\r\n\tthis.itemSize = itemSize;\r\n\tthis._byteLength = 0;\r\n\tthis._buffer = new Uint8Array(itemSize * itemCount);\r\n\tthis.occupancy = new Uint8Array(itemCount / 8);\r\n\t\r\n\tthis.traverseAndJumpFunction = this.setLogicForTraverseAndJump();\r\n\tthis.branchlessLoop = this.getBranchlessLoop();\r\n\t\r\n//\tthis.bytePointer = 0;\r\n}\r\n\r\nMemoryBufferStack.prototype = Object.create(Uint8Array.prototype);\r\nMemoryBufferStack.prototype.objectType = 'MemoryBufferStack';\r\n\r\nMemoryBufferStack.eightBitsMasks = [\r\n\t0x01,\r\n\t0x02,\r\n\t0x04,\r\n\t0x08,\r\n\t0x10,\r\n\t0x20,\r\n\t0x40,\r\n\t0x80\r\n]\r\n\r\nMemoryBufferStack.prototype.setLogicForTraverseAndJump = function() {\r\n\tvar self = this;\r\n\tvar getBuffer = this.getBuffer;\r\n\tvar bufferCount = this._byteLength / this.itemSize;\r\n\tvar jumperHost = new this.JumperHost();\r\n\tvar occupancySolver = new this.OccupancySolver(this.occupancy, this.itemSize);\r\n\t\r\n\tvar doArrayMin = new this.DoArrayMinFunction();\r\n\tvar shouldJump = function(bufferIdx) {\r\n//\t\tconsole.log((jumperHost.jumper + bufferIdx) < bufferCount);\r\n\t\treturn (jumperHost.jumper + bufferIdx) < bufferCount\r\n\t\t\t&& !doArrayMin.do(jumperHost.jumper, occupancySolver.getOccupancyFromBufferIdx(bufferIdx))\r\n\t\t\t&& !!++jumperHost.jumper;\r\n\t};\r\n\t\r\n\tvar shouldRecurse = function(bufferIdx) {\r\n\t\treturn jumpDecisionBranches[+(shouldJump(bufferIdx))];\r\n\t};\r\n\t\r\n\tvar jumpDecisionBranches = new this.BranchesAsArray(shouldRecurse);\r\n\t\r\n\treturn function(bufferIdx) {\r\n\t\tjumperHost.reset();\r\n\t\tshouldRecurse(bufferIdx)(bufferIdx);\r\n\t\t\r\n\t\treturn jumperHost.jumper;\r\n\t};\r\n}\r\n\r\nMemoryBufferStack.prototype.getBranchlessLoop = function() {\r\n\r\n\tvar branchlessLoop = function(callback, startBufferIdx, endBufferIdx) {\r\n//\t\tconsole.log(startBufferIdx, endBufferIdx, this.itemSize);\r\n\t\tif (startBufferIdx >= endBufferIdx)\r\n\t\t\treturn;\r\n\t\t\r\n\t\tcallback(this._buffer, startBufferIdx * this.itemSize);\r\n\t\tstartBufferIdx += this.traverseAndJumpFunction(startBufferIdx);\r\n\t\tbranchlessLoop(callback, startBufferIdx, endBufferIdx);\r\n//\t\tconsole.log(startBufferIdx);\r\n\t}.bind(this);\r\n\t\r\n\treturn branchlessLoop;\r\n}\r\n\r\nMemoryBufferStack.prototype.getOffsetForBuffer = function(bufferIndex) {\r\n\r\n\treturn bufferIndex * this.itemSize;\r\n}\r\n\r\nMemoryBufferStack.prototype.getBuffer = function(bufferIndex) {\r\n//\treturn this._buffer;\r\n\treturn new Uint8Array(this._buffer.buffer, bufferIndex * this.itemSize, this.itemSize);\r\n}\r\n\r\nMemoryBufferStack.prototype.set = function(val, offset) {\r\n\t// offsets for occupancy map\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tif (this._buffer.byteLength >= offset) {\r\n\t\tconsole.warn('MemoryBufferStack', 'Setting a value at an offset longer than the buffer.', val, idx, ' Returning...');\r\n\t\treturn;\r\n\t}\r\n\telse if (this._buffer.byteLength <= offset)\r\n\t\tthis._buffer.buffer.append(new ArrayBuffer(this.itemSize));\r\n\t\r\n\tthis._byteLength = this._buffer.byteLength;\r\n\tthis._buffer.set(val, offset);\r\n\tthis.occupancy.set(this.occupancy[Math.floor(startOffset / 8)] | MemoryBufferStack.eightBitsMasks[onAlignementOffset]);\r\n}\r\n\r\nMemoryBufferStack.prototype.setFromIndex = function(val, idx) {\r\n\t// offsets for occupancy map\r\n\tvar offset = this.itemSize * idx;\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tif (this._buffer.byteLength >= offset) {\r\n\t\tconsole.warn('MemoryBufferStack', 'Setting a value at an offset longer than the buffer.', val, idx, ' Returning...');\r\n\t\treturn;\r\n\t}\r\n\telse if (this._buffer.byteLength === offset)\r\n\t\tthis._buffer.buffer.append(new ArrayBuffer(this.itemSize));\r\n\t\r\n\tthis._byteLength = this._buffer.byteLength;\r\n\tthis._buffer.set(val, offset);\r\n\tthis.occupancy.set(this.occupancy[Math.floor(startOffset / 8)] | MemoryBufferStack.eightBitsMasks[onAlignementOffset]);\r\n}\r\n\r\nMemoryBufferStack.prototype.invalidate = function(offset) {\r\n\t// offsets for occupancy map\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tthis.occupancy.set(this.occupancy[Math.floor(startOffset / 8)] & ~MemoryBufferStack.eightBitsMasks[onAlignementOffset]);\r\n}\r\n\r\nMemoryBufferStack.prototype.invalidateFromIndex = function(idx) {\r\n\t// offsets for occupancy map\r\n\tvar offset = this.itemSize * idx;\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tthis.occupancy.set(this.occupancy[Math.floor(startOffset / 8)] & ~MemoryBufferStack.eightBitsMasks[onAlignementOffset]);\r\n}\r\n\r\n/**\r\n * @function MemoryBufferStack.prototype.append\r\n * \r\n * @param editing val\r\n */\r\nMemoryBufferStack.prototype.append = function(val) {\r\n\r\n\tif  (!val._byteLength)\r\n\t\treturn;\r\n\t\r\n\t// offsets for occupancy map\r\n\tvar offset = this._byteLength;\r\n\t\r\n\tif (this._byteLength + val._byteLength > this._buffer.byteLength) {\r\n\t\tthis._buffer = new Uint8Array(this._buffer.buffer.append(new ArrayBuffer(val._byteLength)));\r\n\t\tthis.occupancy = new Uint8Array(this.occupancy.buffer.append(new ArrayBuffer(Math.ceil((val._byteLength) / (this.itemSize * 8)))));\r\n\t}\r\n\t\r\n\t// update data buffer\r\n\tthis._buffer.set(val._buffer, this._byteLength);\t\r\n\tthis._byteLength += val._byteLength;\r\n\t\r\n\t// Update occupancy buffer\r\n\tvar occupancyValues = [], initialBufferIdx = offset / this.itemSize, occupancyPointer, currentOccupancyPointer;\r\n\tfor (let bufferIdx = offset / this.itemSize, max = this._byteLength / this.itemSize; bufferIdx < max; bufferIdx++) {\r\n//\t\tconsole.log(bufferIdx, bufferIdx % 8, Math.floor((bufferIdx - initialBufferIdx) / 8));\r\n\t\toccupancyPointer = Math.floor((bufferIdx - initialBufferIdx) / 8);\r\n\t\tcurrentOccupancyPointer = Math.floor(bufferIdx / 8);\r\n\t\toccupancyValues[occupancyPointer] = this.occupancy[currentOccupancyPointer] | MemoryBufferStack.eightBitsMasks[ bufferIdx % 8 ];\r\n\t}\r\n\t\r\n//\tconsole.log(occupancyValues, Math.floor((offset / this.itemSize) / 8));\r\n\tthis.occupancy.set(occupancyValues, Math.floor((offset / this.itemSize) / 8));\r\n\t\r\n}\r\n\r\n//MemoryBufferStack.prototype.getExpAsFunc = function(exp) {\r\n//\tconsole.log(\"exp : ' + exp + '\", ' + 'curriedFunction, inParam' + ', ' + exp + '); \r\n//\treturn new Function('doRecurseFunction', 'inParam', 'return ' + exp + ';');\r\n//}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nMemoryBufferStack.prototype.BranchesAsArray = function(ifCallClause) {\r\n\treturn [\r\n\t\t_functionalStyleHelpers.noOp,\r\n\t\tifCallClause\r\n\t];\r\n}\r\nMemoryBufferStack.prototype.BranchesAsArray.prototype = {};\r\n\r\n\r\n\r\n\r\n\r\n\r\nMemoryBufferStack.prototype.JumperHost = function() {\r\n\tthis.jumper = 1;\r\n\t\r\n}\r\nMemoryBufferStack.prototype.JumperHost.prototype.reset = function() {\r\n\tthis.jumper = 1;\r\n}\r\n\r\n\r\n\r\nMemoryBufferStack.prototype.OccupancySolver = function(occupancyBuffer, itemSize) {\r\n\tthis._buffer = occupancyBuffer;\r\n\tthis._itemSize = itemSize;\r\n}\r\nMemoryBufferStack.prototype.OccupancySolver.prototype.getOccupancyFromBufferIdx = function(bufferIdx) {\r\n\tvar bitFieldOffset = bufferIdx % 8;\r\n// \tconsole.log((this._buffer[Math.floor(bufferIdx / 8)] & MemoryBufferStack.eightBitsMasks[bitFieldOffset]) >> bitFieldOffset);\r\n\treturn (this._buffer[Math.floor(bufferIdx / 8)] & MemoryBufferStack.eightBitsMasks[bitFieldOffset]) >> bitFieldOffset;\r\n}\r\nMemoryBufferStack.prototype.OccupancySolver.prototype.getOccupancyFromAbsoluteIdx = function(absoluteIdx) {\r\n\tvar bitFieldOffset = (absoluteIdx / this.itemSize) % 8;\r\n\treturn (this._buffer[Math.floor((absoluteIdx / this.itemSize) / 8)] & MemoryBufferStack.eightBitsMasks[bitFieldOffset]) >> bitFieldOffset;\r\n}\r\n\r\n\r\n\r\n\r\nMemoryBufferStack.prototype.arrayMin = function(arr) {\r\n\treturn Math.min.apply(arr);\r\n}\r\n\r\nMemoryBufferStack.prototype.DoArrayMinFunction = function() {\r\n\t// Let's see that as a hint for the optimizer: capture a unique instance of the arrayMin func in the closure\r\n\tthis.arrMin = MemoryBufferStack.prototype.arrayMin.bind(null);\r\n\tthis.cachedArr = [];\r\n}\r\nMemoryBufferStack.prototype.DoArrayMinFunction.prototype.do = function(val0, val1) {\r\n\tthis.cachedArr[0] = val0;\r\n\tthis.cachedArr[1] = val1;\r\n\treturn this.arrMin(this.cachedArr);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = MemoryBufferStack;",
    "\"use strict\";\n/**\r\n * @constructor MemoryMapBuffer\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar MemoryBufferStack= require('src/core/MemoryBufferStack');\r\n\r\nvar MemoryMapBuffer = function(itemSize, initialContent) {\r\n\tthis.objectType = 'MemoryMapBuffer';\r\n\t\r\n\tvar propsCount = this.propertiesStaticArray.length;\r\n\tthis.propAddresses = (new Uint8Array(propsCount)).fill(255);\r\n\tthis.itemSize = itemSize;\r\n\tthis._buffer = new Uint8Array(propsCount * itemSize);\r\n\t\r\n\tthis.traverseAndJumpFunction = this.setLogicForTraverseAndJump();\r\n\tthis.branchlessLoop = this.getBranchlessLoop();\r\n\t\r\n}\r\nMemoryMapBuffer.prototype = {};\r\nMemoryMapBuffer.prototype.objectType = 'MemoryMapBuffer';\r\n\r\nMemoryMapBuffer.prototype.propertiesStaticArray= [];\t\t\t\t// virtual\r\nMemoryMapBuffer.prototype.propertiesAccessGroupsBoudaries = {};\t\t// virtual\r\n\r\nMemoryMapBuffer.prototype.setLogicForTraverseAndJump = MemoryBufferStack.prototype.setLogicForTraverseAndJump;\r\nMemoryMapBuffer.prototype.getBranchlessLoop = MemoryBufferStack.prototype.getBranchlessLoop;\r\nMemoryMapBuffer.prototype.BranchesAsArray = MemoryBufferStack.prototype.BranchesAsArray ;\r\nMemoryMapBuffer.prototype.JumperHost = MemoryBufferStack.prototype.JumperHost;\r\nMemoryMapBuffer.prototype.OccupancySolver = MemoryBufferStack.prototype.OccupancySolver;\r\nMemoryMapBuffer.prototype.arrayMin = MemoryBufferStack.prototype.arrayMin;\r\nMemoryMapBuffer.prototype.DoArrayMinFunction = MemoryBufferStack.prototype.DoArrayMinFunction;\r\n\r\n//MemoryMapBuffer.prototype.get = function(propertyIdx) {\r\n//\t\r\n//}\r\n//\r\n//MemoryMapBuffer.prototype.set = function(propertyIdx, propertyValue) {\r\n//\t\r\n//}\r\n\r\nMemoryMapBuffer.prototype.getProperty = function(propertyName) {\r\n\t\r\n\tif (typeof this.propertiesStaticMap[propertyName] === 'undefined') {\r\n\t\tconsole.warn('MemoryMapBuffer:get', 'The requested property ' + propertyName + 'is not implemented', 'Returning...');\r\n\t\treturn;\t\r\n\t}\r\n\t\t\r\n\treturn this.occupancySolver(propertyName)\r\n\t\t&& this._buffer[this.propAddresses[this.propertiesStaticMap[propertyName]] * this.itemSize];\r\n}\r\n\r\nMemoryMapBuffer.prototype.setProperty = function(propertyName, propertyValue) {\r\n\tif (typeof this.propertiesStaticMap[propertyName] === 'undefined') {\r\n\t\tconsole.warn('MemoryMapBuffer:set', 'The requested property ' + propertyName + 'is not implemented', 'Returning...');\r\n\t\treturn;\t\r\n\t}\r\n\t\r\n\tif (this._byteLength >= 254) {\r\n\t\tconsole.error('CSSPropertyIdx in the MapBuffer would have been out of bounds.', 'Operation Cancelled...');\r\n\t\treturn;\r\n\t}\r\n\tthis.occupancySetter(propertyName, true);\r\n\tthis._buffer[this.propAddresses[this.propertiesStaticMap[propertyName]] * this.itemSize] = propertyValue;\r\n\t\r\n\tthis._byteLength += this.itemSize;\r\n}\r\n\r\nMemoryMapBuffer.prototype.occupancySolver = function(propertyName) {\r\n\treturn this.propAddresses[this.propertiesStaticMap[propertyName]] !== 255;\r\n}\r\n\r\nMemoryMapBuffer.prototype.occupancySetter = function(propertyName, isSet) {\r\n\tthis.propAddresses[this.propertiesStaticMap[propertyName]] = isSet ? this._byteLength : (this.unfragmentBuffer(1) && 255);\r\n}\r\n\r\nMemoryMapBuffer.prototype.unfragmentBuffer = function(removedCount) {\r\n\t// Loop over occupancy and collect all props that have an address smaller than (this._byteCount - removedCOunt)\r\n\treturn true;\t\r\n}\r\n\r\n\r\n\r\n \r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = MemoryMapBuffer;",
    "\"use strict\";\n/**\r\n * constructor BufferFromSchema\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar BinarySlice = require('src/core/BinarySlice');\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar BufferFromSchema = function(binarySchema, initialLoad) {\r\n\tthis.objectType = 'BufferFromSchema';\r\n\t\r\n\tthis.binarySchema = {};\r\n\tvar offset = 0;\r\n\tfor (var prop in binarySchema) {\r\n\t\tif (!binarySchema.hasOwnProperty(prop))\r\n\t\t\treturn;\r\n\t\tthis.binarySchema[prop] = new BinarySlice(\r\n\t\t\tbinarySchema[prop].start,\r\n\t\t\tbinarySchema[prop].length\r\n\t\t);\r\n\t\toffset += binarySchema[prop].length;\r\n\t}\r\n//\tconsole.log(binarySchema.size);\r\n\tthis._buffer = new Uint8Array(binarySchema.size);\r\n\tthis.occupancy = new Uint8Array(binarySchema.size / 8);\r\n\tthis._byteLength = 0;\r\n\t\r\n\tif (initialLoad)\r\n\t\tthis.set(initialLoad, 0);\r\n\t\r\n//\tconsole.log(this.binarySchema);\r\n}\r\n\r\nBufferFromSchema.prototype = Object.create(Uint8Array.prototype);\r\nBufferFromSchema.prototype.objectType = 'BufferFromSchema';\r\n\r\nBufferFromSchema.eightBitsMasks = [\r\n\t0x01,\r\n\t0x02,\r\n\t0x04,\r\n\t0x08,\r\n\t0x10,\r\n\t0x20,\r\n\t0x40,\r\n\t0x80\r\n]\r\n\r\n// TODO: retrieve the binary length from the BinarySchema\r\n// TODO: benchmark resolving integers that are longer than 8bits\r\n// using a DataView or another TypedArray\r\nBufferFromSchema.prototype.get = function(idx, binaryLength) {\r\n\tif (!binaryLength)\r\n\t\treturn this._buffer[idx];\r\n\telse {\r\n\t\t// we unpack 16 and 32 bits integers here\r\n\t\tvar ret = 0, bitwiseOffset = 0;\r\n\t\tfor (let i = idx, l = idx + binaryLength; i < l; i++) {\r\n\t\t\tret = ret | (this._buffer[i] << bitwiseOffset * 8);\r\n\t\t\tbitwiseOffset++;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nBufferFromSchema.prototype.getOffsetForProp = function(propName) {\r\n\tvar offset = 0;\r\n\tthis.propRef.forEach(function(propAsArray) {\r\n\t\tif (propAsArray[0] === propName)\r\n\t\t\toffset = propAsArray[1]; \r\n\t});\r\n\treturn offset;\r\n}\r\n\r\nBufferFromSchema.prototype.set = function(val, offset) {\r\n\tval = (Array.isArray(val) || Object.getPrototypeOf(val) === Uint8Array.prototype) ? val : [val];\r\n\t// offsets for occupancy map\r\n\toffset = typeof offset !== 'number' ? this._byteLength : offset;\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tthis._buffer.set(val, offset);\r\n\tthis.occupancy.set([this.occupancy[startOffset] | BufferFromSchema.eightBitsMasks[onAlignementOffset]]);\r\n\tthis._byteLength = (offset && Math.max(offset + val.length, this._byteLength)) || val.length;\r\n//\tconsole.log(this._byteLength);\r\n}\r\n\r\nBufferFromSchema.prototype.invalidate = function(offset) {\r\n\t// offsets for occupancy map\r\n\tvar onAlignementOffset = offset % 8;\r\n\tvar startOffset = offset - onAlignementOffset;\r\n\t\r\n\tthis.occupancy.set(this.occupancy[startOffset] & ~BufferFromSchema.eightBitsMasks[onAlignementOffset]);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = BufferFromSchema;",
    "\"use strict\";\n/**\r\n * store propertyCache\r\n * \r\n */\r\n\r\nvar unkownTypesCount = 0;\r\n\r\n/**\r\n * @constructor ObjectCache\r\n * \r\n */\r\nvar ObjectCache = function(name) {\r\n\tthis.name = name;\r\n\tthis.cache = {};\r\n\tthis.firstID = null;\r\n}\r\n\r\nObjectCache.prototype.hasItem = function(mainID, composedWithID) {\r\n\tif (!composedWithID)\r\n\t\treturn (typeof this.cache[mainID.toString()] !== 'undefined');\r\n\telse\r\n\t\treturn (typeof this.cache[mainID.toString() + '-' + composedWithID.toString()] !== 'undefined');\r\n}\r\n\r\nObjectCache.prototype.getItem = function(mainID, composedWithID) {\r\n\tif (!composedWithID)\r\n\t\treturn this.cache[mainID.toString()];\r\n\telse\r\n\t\treturn this.cache[mainID.toString() + '-' + composedWithID.toString()];\r\n}\r\n\r\nObjectCache.prototype.setItem = function(mainID, mainValue, composedWithID) {\r\n\tif (!composedWithID)\r\n\t\treturn this.newItem(mainID.toString(), mainValue);\r\n\telse\r\n\t\treturn this.newItem(mainID.toString() + '-' + composedWithID.toString(), mainValue);\r\n}\r\n\r\nObjectCache.prototype.deleteItem = function(mainID, composedWithID) {\r\n\tif (!composedWithID)\r\n\t\tdelete this.cache[mainID.toString()];\r\n\telse\r\n\t\tdelete this.cache[mainID.toString() + '-' + composedWithID.toString()];\r\n}\r\n\r\nObjectCache.prototype.newItem = function(UID, value) {\r\n\tthis.cache[UID] = value;\r\n\tif (this.firstID === null)\r\n\t\tthis.firstID = UID;\r\n\treturn value;\r\n}\r\n\r\nObjectCache.prototype.reset = function() {\r\n\tfor (let UID in this.cache) {\r\n\t\tif (Array.isArray(this.cache[UID]))\r\n\t\t\tthis.cache[UID].length = 0;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar RequestCache = function(name) {\r\n\t\r\n\tObjectCache.call(this, name);\r\n\tthis.currentlyLiveRequests = [];\r\n}\r\nRequestCache.prototype = Object.create(ObjectCache.prototype);\r\n\r\nRequestCache.prototype.setItem = function(UID, requestObj, addToLiveSet) {\r\n\tvar req;\r\n\t\r\n\tif (addToLiveSet && (typeof this.getItem(UID) === 'undefined' || req.idxInChache === null)) {\r\n\t\treq =  this.newItem(UID.toString(), requestObj);\r\n\t\treq.idxInCache = this.currentlyLiveRequests.length;\r\n\t\tthis.currentlyLiveRequests.push(this.getPromiseFromRequest(req));\r\n\t\treturn Promise.all(this.currentlyLiveRequests.map(function(liveRequest) {\r\n\t\t\t\treturn liveRequest.promise;\r\n\t\t\t}, this));\r\n\t}\r\n\telse if (addToLiveSet && typeof this.getItem(UID) !== 'undefined') {\r\n\t\treq =  this.newItem(UID.toString(), requestObj);\r\n\t\tthis.currentlyLiveRequests.splice(req.idxInChache, 1, this.getPromiseFromRequest(req));\r\n\t\treturn Promise.all(this.currentlyLiveRequests.map(function(liveRequest) {\r\n\t\t\t\treturn liveRequest.promise;\r\n\t\t\t}, this));\r\n\t}\r\n\treq =  this.newItem(UID.toString(), requestObj);\r\n\treturn req;\r\n}\r\n\r\nRequestCache.prototype.getPromiseFromRequest = function(req) {\r\n//\tvar self = this;\r\n\treturn {\r\n\t\t\t\trequest : req,\r\n\t\t\t\tpromise : new Promise(function(resolve, reject) {\r\n\t\t\t\t\treq.subscribe(function cachedSubDeletedAfterCachedPromiseResolve() {\r\n//\t\t\t\t\t\tconsole.log('subscription executed');\r\n\t\t\t\t\t\tresolve();\t// req.getResult()\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// TODO: Find a way to unsubscribe\r\n//\t\t\t\t\t\tthis.subscriptions[this.subscriptions.length - 1].unsubscribe();\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t};\r\n}\r\n\r\nRequestCache.prototype.getLiveRequests = function(endPointNamesArray) {\r\n\treturn Promise.all(\r\n\t\tthis.currentlyLiveRequests\r\n\t\t\t.filter(function(liveRequest) {\r\n\t\t\t\treturn endPointNamesArray.indexOf(liveRequest.request.name) !== -1;\r\n\t\t\t}).map(function(liveRequest) {\r\n\t\t\t\treturn this.getPromiseFromRequest(liveRequest.request).promise\r\n\t\t\t}, this)\r\n\t);\t\r\n}\r\n\r\nRequestCache.prototype.filterLiveRequests = function(endPointNamesArray) {\r\n//\treturn Promise.all(this.currentlyLiveRequests);\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar StateMachineCache = function(name) {\r\n\t\r\n\tObjectCache.call(this, name);\r\n\tthis.objectType = 'StateMachineCache';\r\n\t\r\n\tthis.cache = [];\r\n\tthis._orthogonalRegistry = {};\r\n}\r\nStateMachineCache.prototype = Object.create(ObjectCache.prototype);\r\n\r\nStateMachineCache.prototype.stateDefExists = function(UID) {\r\n\treturn this._orthogonalRegistry[UID];\r\n}\r\n\r\nStateMachineCache.prototype.newStateDef = function(UID, componentType, bindingDef, parentUID) {\r\n\treturn [\r\n\t\t{\r\n\t\t\tsourceEvent : (bindingDef.from || bindingDef.to),\r\n\t\t\tonSelf : ((!bindingDef.from \r\n\t\t\t\t\t\t|| !bindingDef.to \r\n\t\t\t\t\t\t|| bindingDef.from === bindingDef.to) && true),\r\n\t\t\tcomponentType : componentType || ('undeclaredType_' + unkownTypesCount++),\r\n\t\t\tcomponentUID : UID,\r\n\t\t\ttargetState : (bindingDef.to || bindingDef.from),\r\n\t\t\thasConstraints : ('[' + (bindingDef.map && 'map') + ',' + (bindingDef.filter && 'filter') + ']'),\r\n\t\t\thasSideEffects : (bindingDef.subscribe === null && true),\r\n\t\t\tbindingsCount : 0,\r\n\t\t\tbindingIsInError : false,\r\n\t\t\tparentUID : parentUID\r\n\t\t},\r\n\t\t[]\r\n\t]\r\n}\r\n\r\nStateMachineCache.prototype.newItem = function(UID, value, parentUID) {\r\n\tif (value[0].onSelf) {\r\n\t\tif (!this._orthogonalRegistry[value[0].componentUID]) {\r\n\t\t\tthis.cache.push(value);\r\n\t\t\tthis._orthogonalRegistry[value[0].componentUID] = value;\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._orthogonalRegistry[value[0].componentUID][1].push(value);\r\n\t\t\tthis._orthogonalRegistry[value[0].componentUID][0].bindingsCount++;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif (!this._orthogonalRegistry[parentUID]) {\r\n\t\t\tvar parentStateCache = this.newStateDef(\r\n\t\t\t\tparentUID,\r\n\t\t\t\t'_InitialStateSource',\r\n\t\t\t\t{\r\n\t\t\t\t\tfrom : '',\r\n\t\t\t\t\tto : '',\r\n\t\t\t\t\tmap : null,\r\n\t\t\t\t\tfilter : null,\r\n\t\t\t\t\tsubscribe : null\r\n\t\t\t\t},\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t\tthis.cache.push(parentStateCache);\r\n\t\t\tthis._orthogonalRegistry[parentUID] = parentStateCache;\r\n\t\t}\r\n\t\t\r\n\t\tif  (!this._orthogonalRegistry[value[0].componentUID])\r\n\t\t\tthis._orthogonalRegistry[value[0].componentUID] = value;\t\r\n\t\t\r\n\t\tthis._orthogonalRegistry[parentUID][1].push(value);\r\n\t\tthis._orthogonalRegistry[value[0].componentUID][0].bindingsCount++;\r\n\t}\r\n\t\r\n\t\r\n\r\n//\t\tthis._orthogonalRegistry[value[0].componentUID] = value;\r\n//\t\tconsole.warn(this.objectType, 'Property binding for component [', value[0].componentUID, '] happened twice. Binding State toggled to \"Error\"');\r\n\r\n\t\t\r\n//\t\tthis._orthogonalRegistry[value[0].componentUID].bindingIsInError = true;\r\n\t\t\r\n\tif (this.firstID === null)\r\n\t\tthis.firstID = UID;\r\n\treturn value;\r\n}\r\n\r\nStateMachineCache.prototype.registerTransition = function(UID, componentType, bindingDef, parentUID) {\r\n\treturn this.newItem(UID, this.newStateDef(UID, componentType, bindingDef, parentUID), parentUID);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tObjectCache : ObjectCache,\r\n\tRequestCache : RequestCache,\r\n\tStateMachineCache : StateMachineCache\r\n};",
    "\"use strict\";\n/**\r\n * @constructor RecitalDataset\r\n * \r\n * => tight coupling with AppIgnition = mandatory static inclusion in core (Dataset requires App).\r\n * \t\tApp.List is coupled with [Dataset.push(), pushApply(), splice(), & more]\r\n */\r\n\r\nconst TemplateFactory = require('src/core/TemplateFactory');\r\nconst Registries = require('src/core/Registries');\r\nconst App = require('src/core/App');\r\n\r\n\r\n\r\nvar RecitalDataset = function(rootComponent, trackedComponent, template, factoryPropsArray, arrayFunctions) {\r\n\tif (typeof rootComponent === 'undefined' || !trackedComponent || !template || !factoryPropsArray) {\r\n\t\tconsole.error('ReactiveDataset initialization failed: Missing parameters. Returning...', rootComponent, trackedComponent, template, factoryPropsArray);\r\n\t\treturn;\r\n\t}\r\n\tthis.init(rootComponent, trackedComponent, template, factoryPropsArray);\r\n\tif (typeof arrayFunctions !== 'undefined') {\r\n\t\tif (Array.isArray(arrayFunctions))\r\n\t\t\tthis.getFunctionList(arrayFunctions);\r\n\t\telse if (Object.keys(arrayFunctions || {}).length)\t\t// allows\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// passing null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// instead of an\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// object\r\n\t\t\tthis.setArrayFunctions(arrayFunctions);\r\n\t}\r\n}\r\nRecitalDataset.prototype = Object.create(Array.prototype);\r\nRecitalDataset.prototype.objectType = 'ReactiveDataset'; \r\nObject.defineProperty(RecitalDataset.prototype, 'arrayFunc', {\r\n\tvalue : {\r\n\t\ttrackedProp : 'active',\r\n\t\tevery : function(item) {return item[this.trackedProp];},\r\n\t\tnone : function(item) {return !item[this.trackedProp];},\r\n\t\tsome : function(item) {return item[this.trackedProp];},\r\n\t\tsomeNot : function(item) {return !item[this.trackedProp];},\r\n\t\tfilter : function(item) {return item[this.trackedProp];},\r\n\t\tfilterNot : function(item) {return !item[this.trackedProp];}\r\n\t}\r\n});\r\nObject.defineProperty(RecitalDataset.prototype, 'getDefaultListDef', {\r\n\tvalue : function() {\r\n\t\t\t\treturn TemplateFactory.createDef({\r\n\t\t\t\t\ttype : 'ComponentList',\r\n\t\t\t\t\teach : [],\r\n\t\t\t\t\titem : null,\r\n\t\t\t\t\ttemplate : null,\r\n\t\t\t\t\tisInternal : true\r\n\t\t\t\t});\r\n\t\t\t}\r\n});\r\nObject.defineProperty(RecitalDataset.prototype, 'init', {\r\n\tvalue : function(rootComponent, trackedComponent, template, factoryPropsArray) {\r\n\t\tObject.defineProperty(this, 'rootComponent', {\r\n\t\t\tvalue : rootComponent\r\n\t\t});\r\n\t\tObject.defineProperty(this, 'trackedComponent', {\r\n\t\t\tvalue : trackedComponent\r\n\t\t});\r\n\t\tObject.defineProperty(this, 'defaultListDef', {\r\n\t\t\tvalue : this.getDefaultListDef()\r\n\t\t});\r\n\t\tthis.defaultListDef.host.template = template;\r\n\t\tObject.defineProperty(this, 'funcList', {\r\n\t\t\tvalue : []\r\n\t\t});\r\n\t\tObject.defineProperty(this, 'Item', {\r\n\t\t\tvalue : this.setItemFactory(factoryPropsArray),\r\n\t\t\twritable : true\r\n\t\t});\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'getFunctionList', {\r\n\tvalue : function(arrayFunc) {\r\n\t\tArray.prototype.push.apply(this.funcList, arrayFunc);\r\n\t}\r\n});\r\nObject.defineProperty(RecitalDataset.prototype, 'setArrayFunctions', {\r\n\tvalue : function(arrayFunctions) {\r\n\t\tthis.getFunctionList(Object.keys(arrayFunctions));\r\n\t\tObject.defineProperty(this, 'arrayFunc', {\r\n\t\t\tvalue : arrayFunctions\r\n\t\t});\r\n\t}\r\n});\r\nObject.defineProperty(RecitalDataset.prototype, 'setItemFactory', {\r\n\tvalue : function(factoryPropsArray) {\r\n\t\tif (!factoryPropsArray) {\r\n\t\t\tconsole.warn('factoryPropsArray is ' + (typeof factoryPropsArray) + ' : This changes the \"newItem()\" method\\'s signature (arg0 is now Object). Nevertheless, that shouldn\\'t have any other repercussion.');\r\n\t\t\treturn function() {return arguments[0][0];};\r\n\t\t}\r\n\t\tvar factory = function() {\r\n\t\t\t[...arguments[0]].forEach(function(arg, key) {\r\n\t\t\t\tthis[factoryPropsArray[key]] = arg;\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\tfactory.prototype = Object.create(Object.prototype);\r\n\t\tfactoryPropsArray.forEach(function(propName) {\r\n\t\t\tfactory.prototype[propName] = null; \r\n\t\t});\r\n\t\tObject.defineProperty(factory.prototype, 'keys', {value : factoryPropsArray.slice(0)});\r\n\t\treturn factory;\r\n\t}\r\n});\r\nObject.defineProperty(RecitalDataset.prototype, 'setSchema', {\r\n\tvalue : function(factoryPropsArray) {\r\n\t\tthis.Item = this.setItemFactory(factoryPropsArray);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'newItem', {\r\n\tvalue : function() {\r\n\t\treturn (new this.Item(arguments));\r\n\t}\r\n});\r\n\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'updateDatasetState', {\r\n\tvalue : function() {\r\n\t\tif (!this.rootComponent)\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\tthis.funcList.forEach(function(prop) {\r\n\t\t\tif (prop === 'filter' || prop === 'filterNot')\r\n\t\t\t\tthis.rootComponent.streams[prop].value = Array.prototype.filter.call(this, this.arrayFunc[prop], this.arrayFunc).length;\r\n\t\t\telse {\r\n\t\t\t\tthis.rootComponent.streams[prop].value = Array.prototype[prop] \r\n\t\t\t\t\t? Array.prototype[prop].call(this, this.arrayFunc[prop], this.arrayFunc)\r\n\t\t\t\t\t\t: (prop === 'none' \r\n\t\t\t\t\t\t\t? Array.prototype.every.call(this, this.arrayFunc[prop], this.arrayFunc)\r\n\t\t\t\t\t\t\t\t: Array.prototype.some.call(this, this.arrayFunc[prop], this.arrayFunc));\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\tif (this.rootComponent.streams['length'])\r\n\t\t\tthis.rootComponent.streams['length'].value = this.length;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'setDatasetState', {\r\n\tvalue : function(stateName, value, setSingle) {\r\n\t\tthis.rootComponent.streams[stateName].value = value;\r\n\t\tif (!setSingle)\r\n\t\t\tthis.updateDatasetState();\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'getDatasetState', {\r\n\tvalue : function(stateName) {\r\n\t\treturn this.rootComponent.streams[stateName].value;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'push',  {\r\n\tvalue : function(item) {\r\n\t\tvar souldForceEventSubscriptions = false,\r\n\t\t\tlastIndex = this.trackedComponent._children.length;\r\n\t\t// There is a case where we add children -before- the appIgnition has been done\r\n\t\t// so the trackedCompenent, already has children, and shall already have subscribed to its children,\r\n\t\t// so handling event subs on children shall subscribe a seconde time starting at child index 0\r\n\t\t// => test if the tracked component has a master node, and only force subscriptions if it has been rendered\r\n\t\tif (this.trackedComponent.view.getMasterNode())\r\n\t\t\tsouldForceEventSubscriptions = true;\r\n\t\t\t\r\n\t\tthis.defaultListDef.host.each = [item];\r\n\t\tnew App.List(this.defaultListDef, this.trackedComponent);\r\n\t\t\r\n\t\tif (souldForceEventSubscriptions)\r\n\t\t\tthis.trackedComponent.handleEventSubsOnChildrenAt(Registries.caches['subscribeOnChild'].cache[this.trackedComponent._defUID], lastIndex);\r\n// this.trackedComponent.addModules(this.defaultListDef,\r\n// this.trackedComponent._children.length);\r\n\t\tArray.prototype.push.call(this, item);\r\n\t\tthis.updateDatasetState();\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'pushApply',  {\r\n\tvalue : function(itemArray) {\r\n\t\tif (!itemArray.length)\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\tvar souldForceEventSubscriptions = false,\r\n\t\t\tlastIndex = this.trackedComponent._children.length;\r\n\t\t// There is a case where we add children -before- the appIgnition has been done\r\n\t\t// so the trackedCompenent, already has children, and shall already have subscribed to its children,\r\n\t\t// so handling event subs on children shall subscribe a second time starting at child index 0\r\n\t\t// => test if the tracked component has a master node, and only force subscriptions if it has been rendered\r\n\t\tif (this.trackedComponent.view.getMasterNode())\r\n\t\t\tsouldForceEventSubscriptions = true;\r\n\t\t\t\r\n\t\tthis.defaultListDef.host.each = itemArray;\r\n\t\tnew App.List(this.defaultListDef, this.trackedComponent);\r\n\t\t\r\n\t\tif (souldForceEventSubscriptions)\r\n\t\t\tthis.trackedComponent.handleEventSubsOnChildrenAt(Registries.caches['subscribeOnChild'].cache[this.trackedComponent._defUID], lastIndex);\r\n// this.trackedComponent.addModules(this.defaultListDef,\r\n// this.trackedComponent._children.length);\r\n\t\tArray.prototype.push.apply(this, itemArray);\r\n\t\tthis.updateDatasetState();\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'flush',  {\r\n\tvalue : function() {\r\n\t\tnew App.DelayedDecoration(null, this.trackedComponent, this.defaultListDef.getHostDef());\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'splice',  {\r\n\tvalue : function(index, length, replacedBy) {\r\n\t\tvar c1, c2, mBackup;\r\n\r\n\t\tif (typeof replacedBy === 'number') {\r\n\t\t\tif (replacedBy > index) {\r\n\t\t\t\tc2 = this.trackedComponent._children[replacedBy].remove();\r\n\t\t\t\tc1 = this.trackedComponent._children[index].remove();\r\n\t\t\t\tthis.trackedComponent.addChildAt(c2, index);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tc1 = this.trackedComponent._children[index].remove();\r\n\t\t\t\tc2 = this.trackedComponent._children[replacedBy].remove();\r\n\t\t\t\tthis.trackedComponent.addChildAt(c2, index - 1);\r\n\t\t\t}\r\n\r\n\t\t\tmBackup = Array.prototype.splice.call(this, index, 1, this[replacedBy])[0];\r\n\t\t\tthis.updateDatasetState();\r\n\t\t\treturn [mBackup, c1];\r\n\t\t}\r\n\t\telse if (typeof replacedBy === 'undefined' || replacedBy === null) {\r\n\t\t\tc1 = this.trackedComponent._children[index].remove();\r\n\t\t\tmBackup = Array.prototype.splice.call(this, index, 1)[0];\r\n\t\t\tthis.updateDatasetState();\r\n\t\t\treturn [mBackup, c1];\r\n\t\t}\r\n\t\telse if (Array.isArray(replacedBy)) {\r\n\t\t\tthis.trackedComponent.addChildAt(replacedBy[1], index);\r\n\t\t\tArray.prototype.splice.call(this, index, 1, replacedBy[0]);\r\n\t\t\tthis.updateDatasetState();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'spliceOnProp',  {\r\n\tvalue : function(prop, value) {\r\n\t\tif (this.trackedComponent._children.length) {\r\n\t\t\tvar module;\r\n\t\t\tfor (let i = this.trackedComponent._children.length - 1; i >= 0; i--) {\r\n\t\t\t\tmodule = this.trackedComponent._children[i];\r\n\t\t\t\tif (module.streams[prop] && module.streams[prop].value === value) {\r\n\t\t\t\t\tmodule.remove();\r\n\t\t\t\t\tArray.prototype.splice.call(this, i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.updateDatasetState();\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn false;\r\n\t}\t\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'spliceOnPropInverse',  {\r\n\tvalue : function(prop, value) {\r\n\t\tif (this.trackedComponent._children.length) {\r\n\t\t\tvar module;\r\n\t\t\tfor (let i = this.trackedComponent._children.length - 1; i >= 0; i--) {\r\n\t\t\t\tmodule = this.trackedComponent._children[i];\r\n\t\t\t\tif (module.streams[prop] && module.streams[prop].value !== value) {\r\n\t\t\t\t\tmodule.remove();\r\n\t\t\t\t\tArray.prototype.splice.call(this, i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.updateDatasetState();\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn false;\r\n\t}\t\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'resetLength',  {\r\n\tvalue : function() {\r\n\t\tfor (var i = this.length - 1; i >= 0; i--) {\r\n\t\t\tthis.trackedComponent.removeChildAt(this.trackedComponent._children.length - 1);\r\n\t\t};\r\n//\t\tif (this.trackedComponent.removeAllChildren())\r\n\t\tArray.prototype.splice.call(this, 0, this.length);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'serialize', {\r\n\tvalue : function() {\r\n\t\treturn JSON.stringify(Array.from(this));\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'childToFront', {\r\n\tvalue : function(idx) {\r\n\t\tthis.forEach(function(item, key) {\r\n\t\t\tif (key === idx)\r\n\t\t\t\tthis.trackedComponent._children[key].view.setPresence(true);\r\n\t\t\telse\r\n\t\t\t\tthis.trackedComponent._children[key].view.setPresence(false);\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'parentToFront', {\r\n\tvalue : function(bool) {\r\n\t\tthis.trackedComponent.view.setPresence(bool);\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'targetContainerDeploy', {\r\n\tvalue : function(idx) {\r\n\t\tthis.forEach(function(item, key) {\r\n//\t\t\tconsole.log(key === idx);\r\n\t\t\tif (key === idx) {\r\n\t\t\t\tthis.trackedComponent._children[key].view.styleHook.setFlex(':host', '1 1 0');\r\n//\t\t\t\tthis.trackedComponent._children[key].streams.unfolded.value = 'unfolded';\r\n//\t\t\t\tthis.trackedComponent._children[key].view.styleHook.setMaxHeight('ul', 'max-content');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.trackedComponent._children[key].view.styleHook.setFlex(':host', 'none');\r\n//\t\t\t\tthis.trackedComponent._children[key].streams.unfolded.value = null;\r\n//\t\t\t\tthis.trackedComponent._children[key].view.styleHook.setMaxHeight('ul', '0px');\r\n\t\t\t}\r\n\t\t\t\r\n//\t\t\tconsole.log(this.trackedComponent._children[key].view.getWrappingNode().firstChild, this.trackedComponent._children[key].view.sWrapper.styleElem);\r\n//\t\t\tif (this.trackedComponent._children[key].view.getWrappingNode().firstChild !== this.trackedComponent._children[key].view.sWrapper.styleElem) {\r\n//\t\t\t\tif (key === 0)\r\n//\t\t\t\t\tthis.trackedComponent._children[key].view.getWrappingNode().firstChild.replaceWith(this.trackedComponent._children[key].view.sWrapper.styleElem);\r\n//\t\t\t\telse\r\n//\t\t\t\t\tthis.trackedComponent._children[key].view.getWrappingNode().firstChild.replaceWith(this.trackedComponent._children[key].view.sWrapper.styleElem.cloneNode(true));\r\n//\t\t\t}\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'sortForPropHostingArrayOnArrayIdx',  {\r\n\tvalue : function(prop, idx, invert) {\r\n\t\tvar tmpThis = [];\r\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\r\n\t\t\ttmpThis.push(this[i][prop].slice(0));\r\n\t\t}\r\n\t\t\r\n\t\tif (invert)\r\n\t\t\ttmpThis.sort(Array.prototype.inverseSortOnObjectProp.bind(null, idx));\r\n\t\telse\r\n\t\t\ttmpThis.sort(Array.prototype.sortOnObjectProp.bind(null, idx));\r\n\t\t\r\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\r\n\t\t\tthis[i][prop] = tmpThis[i];\r\n\t\t}\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'clone', {\r\n\tvalue : function() {\r\n\t\tvar clone = new RecitalDataset(\r\n\t\t\tthis.rootComponent,\r\n\t\t\tthis.trackedComponent,\r\n\t\t\tthis.defaultListDef.host.template,\r\n\t\t\t[]\r\n\t\t);\r\n\t\tArray.prototype.push.apply(clone, this);\r\n//\t\tconsole.log(clone);\r\n\t\treturn clone;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(RecitalDataset.prototype, 'reNewComponents',  {\r\n\tvalue : function() {\r\n\t\tvar lastIndex = this.trackedComponent._children.length;\r\n\t\tthis.defaultListDef.host.each = this;\r\n\t\tnew App.List(this.defaultListDef, this.trackedComponent);\r\n\t\tthis.trackedComponent.handleEventSubsOnChildrenAt(Registries.caches['subscribeOnChild'].cache[this.trackedComponent._defUID], lastIndex);\r\n\t\tthis.updateDatasetState();\r\n\t}\r\n});\r\n\r\n//Object.defineProperty(RecitalDataset.prototype, 'sortStringsAsNumbers',  {\r\n//\tvalue : function(a, b) {\r\n//\t\treturn (parseInt(a, 10) > parseInt(b, 10)\r\n//\t\t\t\t\t? 1 \r\n//\t\t\t\t\t: (parseInt(a, 10) === parseInt(b, 10)\r\n//\t\t\t\t\t\t? 0\r\n//\t\t\t\t\t\t: -1));\r\n//\t}\r\n//});\r\n//\r\n//Object.defineProperty(RecitalDataset.prototype, 'invertSortStringsAsNumbers',  {\r\n//\tvalue : function(a, b) {\r\n//\t\treturn (parseInt(a, 10) < parseInt(b, 10)\r\n//\t\t\t\t\t? 1 \r\n//\t\t\t\t\t: (parseInt(a, 10) === parseInt(b, 10)\r\n//\t\t\t\t\t\t? 0\r\n//\t\t\t\t\t\t: -1));\r\n//\t}\r\n//});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = RecitalDataset;",
    "\"use strict\";\n/**\r\n * @Singletons : Registries to cache useful objects in the global scope\r\n */\r\n\r\nconst PropertyCache = require('src/core/PropertyCache').ObjectCache;\r\nconst RequestCache = require('src/core/PropertyCache').RequestCache;\r\nconst StateMachineCache = require('src/core/PropertyCache').StateMachineCache;\r\nconst stateMachineCache = new StateMachineCache('stateMachineCache');\r\n\r\nvar exportedObjects = {};\r\n\r\n/**\r\n * PROPS CACHES : for performance concerns, allows retrieving a prop on the def from anywhere\r\n * \t\tUsefull when instanciating components from a list, as reactivity doesn't change through iterations.\r\n * \r\n * \t\tInternal workflow of the framework :\r\n * \t\t\t- first ensure the def is complete, and store constants : \r\n * \t\t\t\t- the \"reactivity\" register stores reactivity queries\r\n * \t\t\t\t- the \"nodes\" register stores DOM attributes : relation are uniques, each ID from the def is bound to an attributes-list \r\n * \t\t\t\t\t\t=> fill the \"nodes\" register ( {ID : {nodeName : nodeName, attributes : attributes, cloneMother : DOMNode -but not yet-} )\r\n * \t\t\t- then compose components, creating streams and views\r\n * \t\t\t\t- create static views without instanciating the DOM objects : parentView of the view is either a \"View\" or a \"ChildView\"\r\n * \t\t\t\t\t\t=> assign parentView\r\n * \t\t\t\t\t\t=> fill the \"views\" register ( {ID : [view] } )\r\n * \t\t\t\t\t- instanciate streams : if it has streams, it's a host\r\n * \t\t\t\t\t\t=> fill the \"hosts\" register ( {ref : Component} ) // alternatively, the \"definitionRegister\" already holds all \"Components\"\r\n * \t\t\t\t- on composition :\r\n * \t\t\t\t\t- handle reactivity and event subscription : each component as a \"unique ID from the def\" => retrieve queries from the \"reactivity\" register\r\n * \t\t\t- then instanciate DOM objects through cloning : DOM attributes are always static\r\n * \t\t\t\t\t=> iterate on the \"views\" register\r\n * \t\t\t- then get back to hosts elem : they're in the \"hosts\" register\r\n * \t\t\t\t\t- accessing to the component's view, decorate DOM Objects with :\r\n * \t\t\t\t\t\t- streams\r\n * \t\t\t\t\t\t- reflexive props\r\n * \t\t\t\t\t- assign reflectedObj to streams\r\n * \t\t\t- finally reflect streams on the model\r\n */\r\n\r\n/**\r\n * @constructor ComponentDefCache\r\n * \r\n */\r\nvar ComponentDefCache = function() {\r\n\tthis.knownIDs = {};\r\n\tthis.randomUID = 0;\r\n}\r\nComponentDefCache.prototype = {};\r\nComponentDefCache.prototype.getUID = function(uniqueID) {\r\n\tif (uniqueID in this.knownIDs)\r\n\t\treturn this.knownIDs[uniqueID];\r\n\telse if (!(uniqueID in this.knownIDs) || !uniqueID || !uniqueID.length) {\r\n\t\tuniqueID = uniqueID ? uniqueID : (this.randomUID++).toString();\r\n\t\tthis.knownIDs[uniqueID] = uniqueID;\r\n\t\treturn this.knownIDs[uniqueID];\r\n\t}\r\n}\r\n\r\nComponentDefCache.prototype.isKnownUID = function(uniqueID) {\r\n\treturn this.getUID(uniqueID);\r\n}\r\n\r\nComponentDefCache.prototype.setUID = function(uniqueID, globalObj) {\r\n\treturn (this.knownIDs[uniqueID] = globalObj);\r\n}\r\n\r\n/**\r\n * CORE CACHES\r\n */\r\n/** Duplicated code from Template Factory (otherwise we would cause an include loop) */\r\nvar propsAreArray = [\r\n\t'attributes',\r\n\t'states',\r\n\t'props',\r\n\t'streams',\r\n\t'reactOnParent',\r\n\t'reactOnSelf',\r\n\t'subscribeOnParent',\r\n\t'subscribeOnChild',\r\n\t'subscribeOnSelf'//,\r\n//\t'keyboardSettings',\t\t\t// TODO: FIX that bypass : implement keyboard handling in the context of the v0.2\r\n//\t'keyboardEvents'\r\n];\r\nvar caches = {};\r\n(function initCaches() {\r\n\tpropsAreArray.forEach(function(prop) {\r\n\t\tcaches[prop] = new PropertyCache(prop);\r\n\t});\r\n})();\r\n\r\nvar hostsDefinitionsCacheRegistry = new PropertyCache('hostsDefinitionsCacheRegistry');\r\nvar listsDefinitionsCacheRegistry = new PropertyCache('listsDefinitionsCacheRegistry');\r\nvar permanentProvidersRegistry = new RequestCache('permanentProvidersRegistry');\r\nvar boundingBoxesCache = new PropertyCache('boundingBoxesCache');\r\n\r\n// MAYBE TODO: this cache is used by the RichComponenentInternalsPicker, \r\n// to resolve the sWrapper associated with a component out of its UID (? to be confirmed/precised), but\r\n// we also need a MasterStyleCache, to store each CSS rule at global level,\r\n// and resolve the binding between a matched rules and a (pseudo-)DOM node, from any outer scope.\r\n// \t\t=> could we enhance this cache so it would allow to retrieve a whole sWrapper\r\n//\t\tal well as a single CSS rule, in order -not- to duplicate the caches used for CSS ?\r\n// \t=> think of that deeply, and validate any choice regarding performances.\r\nvar sWrappersCache = new PropertyCache('sWrappersCache');\r\n\r\nvar typedHostsRegistry = new PropertyCache('typedHostsRegistry');\r\n\r\n/**\r\n * @typedCache {CachedNode} {UID : {nodeName : nodeName, isCustomElem : isCustomElem, cloneMother : DOMNode -but not yet-}}\r\n */\r\nvar nodesRegistry = new PropertyCache('nodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredView} {UID : view}\r\n */\r\nvar viewsRegistry = [];\r\n\r\n/**\r\n * @typedStore {StoredAssocWithModel} {UID : keyOnModel}\r\n */\r\nvar dataStoreRegistry = new PropertyCache('dataStoreRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheOpitimizedSelectorBuffer}\r\n */\r\nvar masterStyleRegistry = new PropertyCache('masterStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheViewIdentifiedAsNeedingUpdate}\r\n */\r\nvar pendingStyleRegistry = new PropertyCache('pendingStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheViewIdentifiedAsNeedingUpdate}\r\n */\r\nvar UApendingStyleRegistry = new PropertyCache('UApendingStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredNodeFromNaiveDOM} {UID : nodeUID}\r\n */\r\nvar naiveDOMRegistry = new PropertyCache('naiveDOMRegistry');\r\n\r\n/**\r\n * @typedStore {StoredLayoutNode} {UID : nodeUID}\r\n */\r\nvar layoutNodesRegistry = new PropertyCache('layoutNodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredTextNode} {UID : nodeUID}\r\n */\r\nvar textNodesRegistry = new PropertyCache('textNodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredRasterShape} {UID : nodeUID}\r\n */\r\nvar rasterShapesRegistry = new PropertyCache('rasterShapesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredFlexCtx} {UID : nodeUID}\r\n */\r\nvar flexCtxRegistry = new PropertyCache('flexCtxRegistry');\r\n\r\n/**\r\n * @typedStore {StoredLayoutCallback} {UID : nodeUID}\r\n */\r\nvar layoutCallbacksRegistry = new PropertyCache('layoutCallbacksRegistry');\r\n\r\n/**\r\n * @typedStore {FontSizeCache} {UID : nodeUID}\r\n */\r\nvar fontSizeBuffersCache = new PropertyCache('fontSizeBuffersCache');\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @aliases\r\n */\r\nObject.assign(exportedObjects, {\r\n\tPropertyCache : PropertyCache,\r\n\thostsDefinitionsCacheRegistry : hostsDefinitionsCacheRegistry,\t// Object PropertyCache\r\n\tlistsDefinitionsCacheRegistry : listsDefinitionsCacheRegistry,\t// Object PropertyCache\r\n\tpermanentProvidersRegistry : permanentProvidersRegistry,\t\t// Object RequestCache\r\n\tboundingBoxesCache : boundingBoxesCache,\t\t\t\t\t\t// Object PropertyCache\r\n\tstateMachineCache : stateMachineCache,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tsWrappersCache : sWrappersCache,\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\ttypedHostsRegistry : typedHostsRegistry,\t\t\t\t\t\t// Object PropertyCache {defUID : [Components]}\r\n\tnaiveDOMRegistry : naiveDOMRegistry,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tmasterStyleRegistry : masterStyleRegistry,\t\t\t\t\t\t// Object PropertyCache\r\n\tUApendingStyleRegistry : UApendingStyleRegistry,\t\t\t\t// Object PropertyCache\r\n\tpendingStyleRegistry : pendingStyleRegistry,\t\t\t\t\t// Object PropertyCache\r\n\trasterShapesRegistry : rasterShapesRegistry,\t\t\t\t\t// Object PropertyCache\r\n\tlayoutNodesRegistry :layoutNodesRegistry,\t\t\t\t\t\t// Object PropertyCache\r\n\ttextNodesRegistry : textNodesRegistry,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tflexCtxRegistry : flexCtxRegistry,\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\tlayoutCallbacksRegistry : layoutCallbacksRegistry,\t\t\t\t// Object PropertyCache\r\n\tfontSizeBuffersCache : fontSizeBuffersCache,\t\t\t\t\t// Object PropertyCache\r\n\tcaches : caches,\t\t\t\t\t\t\t\t\t\t\t\t// Object {prop : PropertyCache}\r\n\tnodesRegistry : nodesRegistry,\t\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\tviewsRegistry : viewsRegistry,\t\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\tdataStoreRegistry : dataStoreRegistry,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tdefinitionsCache : new ComponentDefCache(),\t\t\t\t\t\t// Object ComponentDefCache\r\n});\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\nmodule.exports = exportedObjects;",
    "\"use strict\";\n/**\r\n * @constructor NodeResizeObserver\r\n * \r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n/**\r\n * @constructor EventEmitter\r\n */\r\nvar EventEmitter = function() {\r\n\tthis.objectType = 'EventEmitter';\r\n\tthis._eventHandlers = {};\r\n\tthis._one_eventHandlers = {};\r\n\tthis._identified_eventHandlers = {};\r\n\t\r\n\tthis.createEvents();\r\n}\r\nEventEmitter.prototype = {};\r\nEventEmitter.prototype.objectType = 'EventEmitter';\r\n// complete proto follows at end of page\r\n// REPLACES CoreTypes = require('src/core/CoreTypes');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\nvar NodeResizeObserver = function() {\r\n\tEventEmitter.call(this);\r\n\tthis.objectType = 'NodeResizeObserver';\r\n\t\t\r\n\tthis.resizeObserver;\r\n\tif (typeof ResizeObserver !== 'undefined')\r\n\t\tthis.resizeObserver = new ResizeObserver(this.getSize.bind(this));\r\n}\r\n\r\nNodeResizeObserver.prototype = Object.create(EventEmitter.prototype);\r\nNodeResizeObserver.prototype.objectType = 'NodeResizeObserver';\r\n\r\nNodeResizeObserver.prototype.observe = function(node, cb, forceObserve) {\r\n\t\r\n\tif (!this.resizeObserver)\r\n\t\treturn;\r\n\r\n\tif (!node.id || this._eventHandlers[node.id]) {\r\n\t\tnode.id = node.id + '-asStyleSource-' + TypeManager.UIDGenerator.newUID();\r\n//\t\tconsole.warn('resizeObserver: ambiguous observed node : ' + node.id + '. Please give it a unique DOM id to disambiguate the event callback.' + (!node.id ? '  Given node is: ' : ''), (!node.id ? node : ''));\r\n//\t\treturn;\r\n\t}\r\n\tthis.createEvent(node.id);\r\n\tthis.addEventListener(node.id, cb);\r\n\t\r\n\t// Due to some race condition the \"resize\" event may not be fired for already connected nodes...\r\n\t// \t\t=> emulate it...\r\n\t// TODO: study that more carefully... (related to the layout being already resolved in the browser, etc.)\r\n\tif (node.ownerDocument && !forceObserve) {\r\n//\t\tconsole.log(node);\r\n\t\tvar bBox = node.getBoundingClientRect();\r\n//\t\tconsole.log(bBox);\r\n\t\tvar boundingBox = {\r\n\t\t\th : bBox.height,\r\n\t\t\tw : bBox.width\r\n\t\t};\r\n\t\tthis.trigger(node.id, {boundingBox : boundingBox});\r\n\t}\r\n\t\r\n\tthis.resizeObserver.observe(node, {box : 'border-box'});\r\n}\r\n\r\nNodeResizeObserver.prototype.unobserve = function(node) {\r\n\tif (!this.resizeObserver)\r\n\t\treturn;\r\n\t\t\r\n\tthis.deleteEvent(node.id);\r\n\tthis.clearEventListeners(node.id);\r\n\tthis.resizeObserver.unobserve(node);\r\n\t\r\n\tnode.id = node.id.replace(/-asStyleSource-\\d+/, '');\r\n\tif (!node.id)\r\n\t\tnode.removeAttribute('id');\r\n}\r\n\r\nNodeResizeObserver.prototype.getSize = function(observerEntries) {\r\n\tvar boundingBox = {};\r\n\t\r\n\t\r\n\tobserverEntries.forEach(function(entry) {\r\n\t\tif (!this.hasStdEvent(entry.target.id))\r\n\t\t\treturn;\r\n\t\tif(entry.contentBoxSize) {\r\n\t\t\t// Checking for chrome as using a non-standard array\r\n\t\t\tif (entry.contentBoxSize[0]) {\r\n\t\t\t\tboundingBox.h = entry.contentBoxSize[0].blockSize; \r\n\t\t\t\tboundingBox.w = entry.contentBoxSize[0].inlineSize;\r\n\t\t\t} else {\r\n\t\t\t\tboundingBox.h = entry.contentBoxSize.blockSize; \r\n\t\t\t\tboundingBox.w = entry.contentBoxSize.inlineSize;\r\n\t\t\t}          \r\n\t\t} else {\r\n\t\t\tboundingBox.h = entry.contentRect.height; \r\n\t\t\tboundingBox.w = entry.contentRect.width;\r\n\t\t}\r\n//\t\tconsole.log('boundingBox', boundingBox);\r\n\t\tthis.trigger(entry.target.id, {boundingBox : boundingBox});\r\n\t\t\r\n\t}, this);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @virtual\r\n */\r\nEventEmitter.prototype.createEvents = function() {}\t\t\t\t// virtual\r\n\r\n/**\r\n * Creates a listenable event : generic event creation (onready, etc.)\r\n * \r\n * @param {string} eventType\r\n */\r\nEventEmitter.prototype.createEvent = function(eventType) {\r\n\tthis._eventHandlers[eventType] = [];\r\n\tthis._one_eventHandlers[eventType] = [];\r\n\t// identified event handlers are meant to be disposable\r\n\tthis._identified_eventHandlers[eventType] = [];\r\n}\r\n/**\r\n * Deletes... an event\r\n * \r\n * @param {string} eventType\r\n */\r\nEventEmitter.prototype.deleteEvent = function(eventType) {\r\n\tdelete this['on' + eventType];\r\n}\r\n\r\nEventEmitter.prototype.hasStdEvent = function(eventType) {\r\n\t\r\n\treturn (typeof this._eventHandlers[eventType] !== 'undefined');\r\n}\r\n\r\n/**\r\n * @param {string} eventType\r\n * @param {function} handler : the handler to remove (the associated event stays available) \r\n */\r\nEventEmitter.prototype.removeEventListener = function(eventType, handler) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tfor(var i = 0, l = this._eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._eventHandlers[eventType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tfor(var i = 0, l = this._one_eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._one_eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._one_eventHandlers[eventType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n\tfor(var i = 0, l = this._identified_eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (this._identified_eventHandlers[eventType][i] === handler) {\r\n\t\t\tthis._identified_eventHandlers[even-tType].splice(i, 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * These methods are only able to add \"permanent\" handlers : \"one-shot\" handlers must be added by another mean \r\n * @param {string} eventType\r\n * @param {function} handler : the handler to add \r\n * @param {number} index : where to add\r\n */\r\nEventEmitter.prototype.addEventListener = function(eventType, handler) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].push(handler);\r\n}\r\n\r\nEventEmitter.prototype.addEventListenerAt = function(eventType, handler, index) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].splice(index, 0, handler);\r\n}\r\n\r\nEventEmitter.prototype.removeEventListenerAt = function(eventType, index) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tif (typeof index === 'number' && index < this._eventHandlers[eventType].length) {\r\n\t\tthis._eventHandlers[eventType].splice(index, 1);\r\n\t}\r\n}\r\n\r\nEventEmitter.prototype.clearEventListeners = function(eventType) {\r\n\tif (typeof this._eventHandlers[eventType] === 'undefined')\r\n\t\treturn;\r\n\tthis._eventHandlers[eventType].length = 0;\r\n\tthis._one_eventHandlers[eventType].length = 0;\r\n}\r\n\r\n/**\r\n * Generic Alias for this['on' + eventType].eventCall : this alias can be called rather than the eventCall property\r\n * @param {string} eventType\r\n * @param {any} payload \r\n */ \r\nEventEmitter.prototype.trigger = function(eventType, payload, eventIdOrBubble, eventID) {\r\n\tif (!this._eventHandlers[eventType] && this._one_eventHandlers[eventType] && this._identified_eventHandlers[eventType])\r\n\t\treturn;\r\n\t\r\n\tvar bubble = false;\r\n\tif (typeof eventIdOrBubble === 'boolean')\r\n\t\tbubble = eventIdOrBubble;\r\n\telse\r\n\t\teventID = eventIdOrBubble;\r\n\t\r\n\tfor(var i = 0, l = this._eventHandlers[eventType].length; i < l; i++) {\r\n\t\tif (typeof this._eventHandlers[eventType][i] === 'function')\r\n\t\t\tthis._eventHandlers[eventType][i]({type : eventType, data : payload, bubble : bubble});\r\n\t}\r\n\r\n\tfor(var i = this._one_eventHandlers[eventType].length - 1; i >= 0; i--) {\r\n\t\tif (typeof this._one_eventHandlers[eventType][i] === 'function') {\r\n\t\t\tthis._one_eventHandlers[eventType][i]({type : eventType, data : payload, bubble : bubble});\r\n\t\t\tdelete this._one_eventHandlers[eventType][i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar deleted = 0;\r\n\tif (typeof eventID !== 'undefined' && eventID !== 0) {\r\n\t\tfor(var i = this._identified_eventHandlers[eventType].length - 1; i >= 0; i--) {\r\n\t\t\tif (typeof this._identified_eventHandlers[eventType][i] === 'undefined')\r\n\t\t\t\tdeleted++;\r\n\t\t\telse if (eventID === this._identified_eventHandlers[eventType][i]['id']) {\r\n\t\t\t\tif (typeof this._identified_eventHandlers[eventType][i] === 'object') {\r\n\t\t\t\t\tthis._identified_eventHandlers[eventType][i].f({type : eventType, data : payload, bubble : bubble})\r\n\t\t\t\t\tdelete this._identified_eventHandlers[eventType][i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._one_eventHandlers[eventType] = [];\r\n\tif (deleted === this._identified_eventHandlers[eventType].length)\r\n\t\tthis._identified_eventHandlers[eventType] = [];\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\nmodule.exports = NodeResizeObserver;",
    "\"use strict\";\n/**\r\n * @Singletons & @Factories : Core Template Ctor\r\n */\r\n\r\nvar UIDGenerator = require('src/core/UIDGenerator');\r\nvar exportedObjects = {};\r\n\r\n\r\n\r\n/**\r\n * @typedef {import(\"src/core/CoreTypes\").Stream} Stream\r\n * @typedef {import(\"src/core/CoreTypes\").EventEmitter} EventEmitter\r\n * @typedef {import(\"src/core/CoreTypes\").Command} Command\r\n * @typedef {import(\"src/core/Component\").HierarchicalObject} HierarchicalObject\r\n * @typedef {import(\"src/core/Component\").ComponentWithObservables} ComponentWithObservables\r\n * @typedef {import(\"src/editing/AbstractStylesheet\")} AbstractStylesheet\r\n * @typedef {import(\"src/events/JSKeyboardMap\")} KeyboardMap\r\n */\r\n\r\n\r\n/**\r\n * @constructor ValueObject\r\n * @param {ViewTemplate|HierarchicalTemplate} defObj\r\n * @param {String} isSpecial\r\n */\r\nvar ValueObject = function(defObj, isSpecial) {\r\n\t// @ts-ignore : \"Expression not callable: {} has no signature\" => seems calling a function defined as \"described property\" isn't supported\r\n\tthis.set(defObj, isSpecial);\r\n}\r\nValueObject.prototype.objectType = 'ValueObject';\r\nexportedObjects.ValueObject = ValueObject;\r\nObject.defineProperty(ValueObject.prototype, 'model', {value : null});\t\t\t// virtual\r\nObject.defineProperty(ValueObject.prototype, 'get',{\r\n\tvalue : function() {}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'isEmpty', {\r\n\t/**\r\n\t * @param {Object} obj\r\n\t */\r\n\tvalue : function(obj) {\r\n\t\tfor(var prop in obj) {\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\treturn true;\r\n\t}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'set', {\r\n\t/**\r\n\t * @param {ViewTemplate|HierarchicalTemplate} def\r\n\t * @param {String} isSpecial\r\n\t */\r\n\tvalue : function(def, isSpecial) {\r\n\t\tconst keys = Object.keys(def);\r\n\t\tkeys.forEach((/** @type {keyof (ViewTemplate|HierarchicalTemplate)} */p) => {\r\n\t\t\tif (isSpecial === 'rootOnly' && def[p])\r\n\t\t\t\tthis[p] = def[p];\r\n\t\t\telse {\r\n\t\t\t\tconst n = p + 'Model';\r\n\t\t\t\tif (n in exportedObjects) {\r\n\t\t\t\t\tif (Array.isArray(def[p])) {\r\n\t\t\t\t\t\t// @ts-ignore : \"string cannot index {typeof exportedObjects}\" : \r\n\t\t\t\t\t\t// => but we already tested \"n in exportedObjects\" 2 lines above\r\n\t\t\t\t\t\tif (exportedObjects[n] === PropFactory) {\r\n\t\t\t\t\t\t\t// @ts-ignore : \"property length does not exist on type never\" : \r\n\t\t\t\t\t\t\t// => but we already tested \"Array.isArray(def[p])\" 2 lines above\r\n\t\t\t\t\t\t\tfor(let i = 0, l = def[p].length; i < l; i++) {\r\n\t\t\t\t\t\t\t\t// @ts-ignore : \"property push does not exist on type never\" : \r\n\t\t\t\t\t\t\t\t// => but attributes, props & states are initialized as array in the child-ctor\r\n\t\t\t\t\t\t\t\tthis[p].push(PropFactory(def[p][i]));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// @ts-ignore : \"property length does not exist on type never\" : \r\n\t\t\t\t\t\t\t// => but we already tested \"Array.isArray(def[p])\" a few lines above\r\n\t\t\t\t\t\t\tfor(let i = 0, l = def[p].length; i < l; i++) {\r\n\t\t\t\t\t\t\t\t// @ts-ignore : \"property push does not exist on type never\" : \r\n\t\t\t\t\t\t\t\t// => we can rely here on the fact that the object passed by the user is already type-checked\r\n\t\t\t\t\t\t\t\t// so a prop passed as array DO correspond to an array initialized in the child-ctor\r\n\t\t\t\t\t\t\t\tthis[p].push(\r\n\t\t\t\t\t\t\t\t\t// @ts-ignore : \"string cannot index {typeof exportedObjects}\" : \r\n\t\t\t\t\t\t\t\t\t// => but we already tested \"n in exportedObjects\" a few lines above\r\n\t\t\t\t\t\t\t\t\tnew exportedObjects[n](def[p][i], isSpecial)\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// @ts-ignore : \"property host does not exist on type never\" : \r\n\t\t\t\t\t// => but we're indeed testing if it exists\r\n\t\t\t\t\telse if (def[p] && def[p].host)\r\n\t\t\t\t\t\t//@ts-ignore : \"type HierarchicalComponentDefModel is not assignable to type never\" : \r\n\t\t\t\t\t\t// Here, we recurse depending on what the user gave us: if the user wants it, we must do it\r\n\t\t\t\t\t\tthis[p] = new HierarchicalComponentDefModel(def[p], isSpecial);\r\n\t\t\t\t\t// @ts-ignore : \"property type does not exist on type never\" : \r\n\t\t\t\t\t// => but we're indeed testing if it exists\t\t\t\t\t\t\r\n\t\t\t\t\telse if (def[p] && def[p].type === 'ComponentList')\r\n\t\t\t\t\t\t//@ts-ignore : \"type ComponentListDefModel is not assignable to type never\" : \r\n\t\t\t\t\t\t// Here, we recurse depending on what the user gave us: if the user wants it, we must do it\r\n\t\t\t\t\t\tthis[p] = new ComponentListDefModel(def[p], isSpecial);\r\n\t\t\t\t\telse if (def[p] !== null)\r\n\t\t\t\t\t\t// @ts-ignore : \"string cannot index {typeof exportedObjects}\" & \"type exportedObjects[p] is not assignable to type never\" : \r\n\t\t\t\t\t\t// => but we already tested \"n in exportedObjects\" a few lines above\r\n\t\t\t\t\t\tthis[p] = new exportedObjects[n](def[p], isSpecial);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tthis[p] = def[p];\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n});\r\n\r\n\r\n\r\n/**\r\n * @constructor \r\n * @param {Object} obj\r\n * @param {String} isSpecial\r\n */\r\nvar OptionsModel = function(obj, isSpecial) {\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nOptionsModel.prototype = Object.create(ValueObject.prototype);\r\nObject.defineProperty(OptionsModel.prototype, 'objectType', {value :  'AttributesList'});\r\nexportedObjects.OptionsModel = OptionsModel;\r\n\r\n\r\n/**\r\n * @constructor KeyboardHotkeysModel\r\n * @param {Object} obj\t\t\t\t\t// KeyboardHotkeysTemplate\r\n * @param {String} isSpecial\r\n */\r\nvar KeyboardHotkeysModel = function(obj, isSpecial) {\r\n\tthis.ctrlKey = false;\t\t\t\t\t\t// Boolean\r\n\tthis.shiftKey = false;\t\t\t\t\t\t// Boolean\r\n\tthis.altKey = false;\t\t\t\t\t\t// Boolean\r\n\tthis.keyCode = 0;\t\t\t\t\t\t\t// Number\r\n\tValueObject.call(this, obj, isSpecial);\r\n};\r\nKeyboardHotkeysModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.KeyboardHotkeysModel = KeyboardHotkeysModel;\r\nObject.defineProperty(KeyboardHotkeysModel.prototype, 'objectType', {value : 'KeyboardHotkeys'});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor PropFactory\r\n * @param {Object} obj\r\n */\r\nvar PropFactory = function(obj) {\r\n\t\r\n\tvar key = typeof obj === 'string' \r\n\t\t? obj\r\n\t\t// @ts-ignore : \"property getName does not exist on type Object\" : \r\n\t\t// we're indeed allowing to pass already typed object or native objects\r\n\t\t: (obj.getName \r\n\t\t\t// @ts-ignore : \"property getName does not exist on type Object\" : idem\r\n\t\t\t? obj.getName() \r\n\t\t\t: AbstractProp.prototype.getName.call(obj));\r\n\t\r\n\tif (!(key in PropFactory.props)) {\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" :\r\n\t\t//  => accessing an object defined as a \"described property\" isn't supported\r\n\t\tPropFactory.props[key] = new Function('obj', 'this[\"' + key + '\"] = obj[\"' + key + '\"];');\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\tPropFactory.props[key].prototype = {};\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'getName', {\r\n\t\t\tvalue :  new Function('return \"' + key + '\";')\r\n\t\t});\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'getValue', {\r\n\t\t\tvalue :  new Function('return this[\"' + key + '\"];')\r\n\t\t});\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'key', {\r\n\t\t\tvalue :  key\r\n\t\t});\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'objectType', {\r\n\t\t\tvalue :  'AbstractProp'\r\n\t\t});\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\treturn (new PropFactory.props[key](obj));\r\n\t}\r\n\telse {\r\n\t\t// @ts-ignore : \"Expression of type any can't be used to index type {}\" : idem\r\n\t\treturn (new PropFactory.props[key](obj));\r\n\t}\r\n\t\t\r\n}\r\nPropFactory.prototype = Object.create(ValueObject.prototype);\r\nPropFactory.props = {};\r\nexportedObjects.PropFactory = PropFactory;\r\n\r\n\r\n\r\n/**\r\n * @constructor AbstractProp\r\n * @param {Object} obj\r\n */\r\nvar AbstractProp = function(obj){\r\n\tvar key = typeof obj === 'string' \r\n\t\t? obj\r\n\t\t// @ts-ignore : \"property getName does not exist on type Object\" : \r\n\t\t// we're indeed allowing to pass a native object or just a string representing the name of the prop\r\n\t\t: this.getName.call(obj);\r\n\t// @ts-ignore : \"Expression of type any can't be used to index type AbstractProp\" : \r\n\t// naming the propos is indeed at discretion of the user\r\n\tthis[key] = obj[key];\r\n}\r\nAbstractProp.prototype = Object.create(ValueObject.prototype);\r\nObject.defineProperty(AbstractProp.prototype, 'getName', {\r\n\tvalue :  function() {\r\n\t\tfor(let name in this)\r\n\t\t\treturn name; \r\n}});\r\nObject.defineProperty(AbstractProp.prototype, 'getValue', {\r\n\tvalue :  function() {\r\n\t\tfor(let name in this)\r\n\t\t\t return this[name]; \r\n}});\r\n\r\n\r\n/**\r\n * @constructor AttributeModel\r\n * @param {Object} obj\r\n */\r\nvar AttributeModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n}\r\nAttributeModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.AttributeModel = AttributeModel;\r\nObject.defineProperty(AttributeModel.prototype, 'objectType', {value :  'Attribute'});\r\n\r\n\r\n/**\r\n * @constructor StateModel\r\n * @param {Object} obj\r\n */\r\nvar StateModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n};\r\nStateModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.StateModel = StateModel;\r\nObject.defineProperty(StateModel.prototype, 'objectType', {value : 'States'});\r\n\r\n\r\n/**\r\n * @constructor PropModel\r\n * @param {Object} obj\r\n */\r\nvar PropModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n};\r\nPropModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.PropModel = PropModel;\r\nObject.defineProperty(PropModel.prototype, 'objectType', {value : 'Props'});\r\n\r\n\r\n/**\r\n * @typedef {Object} ReactivityQueryTemplate\r\n * @prperty {Boolean} cbOnly\r\n * @prperty {String} from \r\n * @prperty {String} to\r\n * @prperty {HTMLElement|Stream} obj\r\n * @prperty {Function} filter\r\n * @prperty {Function} map\r\n * @prperty {Function} subscribe\r\n * @prperty {Function} inverseTransform\r\n */\r\n\r\n/**\r\n * @constructor ReactivityQuery\r\n * @param {ReactivityQueryTemplate} obj\r\n * @param {String} isSpecial\r\n */\r\nvar ReactivityQueryModel = function(obj, isSpecial) {\r\n\tthis.cbOnly = false;\t\t\t\t\t\t// Boolean\r\n\tthis.from = null;\t\t\t\t\t\t\t// String\r\n\tthis.to = null;\t\t\t\t\t\t\t\t// String\r\n\tthis.obj = null,\t\t\t\t\t\t\t// Object [HTMLElement; Stream]\r\n\tthis.filter = null;\t\t\t\t\t\t\t// function (Glorified Pure Function)\r\n\tthis.map = null;\t\t\t\t\t\t\t// function (Glorified Pure Function)\r\n\tthis.subscribe = null;\t\t\t\t\t\t// function CallBack\r\n\tthis.inverseTransform = null;\t\t\t\t// function CallBack\r\n\t\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nReactivityQueryModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.ReactivityQueryModel = ReactivityQueryModel;\r\nObject.defineProperty(ReactivityQueryModel.prototype, 'objectType', {value : 'ReactivityQuery'});\r\nObject.defineProperty(ReactivityQueryModel.prototype, 'subscribeToStream', {\r\n\t/**\r\n\t * @param {Stream} stream\r\n\t * @param {ComponentWithObservables} queriedOrQueryingObj\r\n\t */\r\n\tvalue : function(stream, queriedOrQueryingObj) {\r\n\t\tif (!this.cbOnly\r\n\t\t\t// @ts-ignore : \"expression of type any can't be used to type {}\"\r\n\t\t\t// queriedOrQueryingObj.streams isn't typed cause naming the streams is at the discretion of the user\r\n\t\t\t// => We're indeed testing if that name exists\r\n\t\t\t&& !queriedOrQueryingObj.streams[this.to] \r\n\t\t\t&& !this.subscribe) {\r\n\t\t\tconsole.warn('missing stream or subscription callback on child subscribing from ' + stream.name + ' to ' + this.to);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if (typeof stream === 'undefined') {\r\n\t\t\tconsole.error('no stream object passed for subscription', queriedOrQueryingObj, this.from, this.to);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cbOnly) {\r\n\t\t\tqueriedOrQueryingObj._subscriptions.push(\r\n\t\t\t\tstream.subscribe(this.subscribe.bind(queriedOrQueryingObj))\r\n\t\t\t\t\t.filter(this.filter, queriedOrQueryingObj)\r\n\t\t\t\t\t.map(this.map, queriedOrQueryingObj)\r\n\t\t\t\t\t.reverse(this.inverseTransform)\r\n\t\t\t);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tqueriedOrQueryingObj._subscriptions.push(\r\n\t\t\t\t// @ts-ignore : \"expression of type any can't be used to type {}\"\r\n\t\t\t\t// queriedOrQueryingObj.streams isn't typed cause naming the streams is at the discretion of the user\r\n\t\t\t\t// => We've indeed already tested if that name exists\r\n\t\t\t\tstream.subscribe(queriedOrQueryingObj.streams[this.to], 'value')\r\n\t\t\t\t\t.filter(this.filter, queriedOrQueryingObj)\r\n\t\t\t\t\t.map(this.map, queriedOrQueryingObj)\r\n\t\t\t\t\t.reverse(this.inverseTransform)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tvar subscription = queriedOrQueryingObj._subscriptions[queriedOrQueryingObj._subscriptions.length - 1];\r\n\t\t\r\n\t\tif (stream._value)\r\n\t\t\tstream.subscriptions[stream.subscriptions.length - 1].execute(stream._value);\r\n\t\t\t\r\n\t\treturn subscription;\r\n}});\r\n\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} EventSubscriptionTemplate\r\n * @prperty {String} on \r\n * @prperty {Function} subscribe\r\n */\r\n\r\n/**\r\n * @constructor EventSubscription\r\n * @param {EventSubscriptionTemplate} obj\r\n * @param {String} isSpecial\r\n */\r\nvar EventSubscriptionModel = function(obj, isSpecial) {\r\n\r\n\tthis.on = null;\t\t\t\t\t\t\t\t// String\r\n\tthis.subscribe = null;\t\t\t\t\t\t// function CallBack\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nEventSubscriptionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.EventSubscriptionModel = EventSubscriptionModel;\r\nObject.defineProperty(EventSubscriptionModel.prototype, 'objectType', {value : 'EventSubscription'});\r\nObject.defineProperty(EventSubscriptionModel.prototype, 'subscribeToEvent', {\r\n\t/**\r\n\t * @param {EventEmitter} targetComponent\r\n\t * @param {EventEmitter} requestingComponent\r\n\t */\r\n\tvalue : function(targetComponent, requestingComponent) {\r\n\t\ttargetComponent.addEventListener(this.on, this.subscribe.bind(requestingComponent));\r\n}});\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} TaskDefinitionTemplate\r\n * @prperty {String} type\r\n * @prperty {Function} task \r\n * @prperty {Number} index\r\n */\r\n\r\n/**\r\n * @constructor TaskDefinition\r\n * @param {TaskDefinitionTemplate} obj\r\n * @param {String} isSpecial\r\n */\r\nvar TaskDefinitionModel = function(obj, isSpecial) {\r\n\r\n\tthis.type = null;\t\t\t\t\t\t// String\r\n\tthis.task = null;\t\t\t\t\t\t// function CallBack\r\n\tthis.index = null;\t\t\t\t\t\t// number\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nTaskDefinitionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.TaskDefinitionModel = TaskDefinitionModel;\r\nObject.defineProperty(TaskDefinitionModel.prototype, 'objectType', {value : 'asyncTaskSubscription'});\r\nObject.defineProperty(TaskDefinitionModel.prototype, 'execute', {\r\n\t/**\r\n\t * @param {HierarchicalObject} thisArg\r\n\t * @param {HierarchicalComponentDefModel} definition\r\n\t */\r\n\tvalue : function(thisArg, definition) {\r\n\t\tthis.task.call(thisArg, definition);\r\n}});\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} PublisherDefinitionTemplate\r\n * @prperty {String} _name\r\n * @property {Array<>} exportedTypes\r\n * @prperty {Stream} stream \r\n * @prperty {String} _publisherUID\r\n */\r\n\r\n/**\r\n * @constructor PublisherDefinitionModel (GlobalyReacheableStream)\r\n * @param {PublisherDefinitionTemplate} obj\r\n * @param {String} isSpecial\r\n */\r\nvar PublisherDefinitionModel = function(obj, isSpecial) {\r\n\t\r\n\tthis._name = null;\t\t\t\t\t\t// String\r\n\tthis.exportedTypes = null;\t\t\t\t// Array\r\n\tthis.stream = null;\t\t\t\t\t\t// Stream\r\n\tthis._publisherUID = null;\t\t\t\t// String\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nPublisherDefinitionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.PublisherDefinitionModel = PublisherDefinitionModel;\r\nObject.defineProperty(PublisherDefinitionModel.prototype, 'objectType', {value : 'GlobalyReacheableStream'});\r\n\r\n/*\r\n * I don't know what was the purpose of this\r\n * It seems completely fake\r\n */\r\n//Object.defineProperty(PublisherDefinitionModel.prototype, 'tryReceiveConnection', {\r\n//\tvalue : function(subscriber) {\r\n//\t\t\tthis.exportedTypes.forEach(function(type, sub) {\r\n//\t\t\t\tif (sub.acceptedTypes.indexOf(type) !== -1) {\r\n//\t\t\t\t\tthis.stream.subscribe(sub.streams.updateChannel, 'value');\r\n//\t\t\t\t}\r\n//\t\t\t}.bind(this, subscriber));\r\n//}});\r\n//// Should not be used in the context of \"single-provider\" subscribers (the same DefinitionModel may be used in various types of registers)\r\n//Object.defineProperty(PublisherDefinitionModel.prototype, 'tryLateReceiveConnection', {\r\n//\tvalue : function(publisherList) {\r\n//\t\tvar publisher;\r\n//\t\tfor(let publisherName in publisherList) {\r\n//\t\t\tpublisher = publisherList[publisherName];\r\n//\t\t\tthis.exportedTypes.forEach(function(type, pub) {\r\n//\t\t\t\tif (pub.exportedTypes.indexOf(type) !== -1) {\r\n//\t\t\t\t\tpub.stream.subscriptions.forEach(function(sub) {\r\n//\t\t\t\t\t\tthis.stream.subscribe(sub.subscriber.obj, sub.subscriber.prop);\r\n//\t\t\t\t\t}, this);\r\n//\t\t\t\t}\r\n//\t\t\t}.bind(this, publisher));\r\n//\t\t}\r\n//}});\r\n// TODO (we must evaluate this use case in real world, first): \r\n// => should also be able to lateDisconnect:\r\n// when queried, answers true if it already holds a subscription\r\n// for the currently handled type and for the currently handled subscriber\r\n// (the register is responsible of passing those as args).\r\n// \t=> case of a subscriber which should only have -one- provider for a given type (color, font, padding, etc.) \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} ViewTemplate\r\n * @property {String|null} [UID]\r\n * @property {String|null} [type]\r\n * @property {Boolean} [isCompound]\r\n * @property {String|null} [nodeName]\r\n * @property {String|null} [n]\r\n * @property {Boolean|null} [isCustomElem]\r\n * @property {String} [templateNodeName]\r\n * @property {Array<AttributeModel>} [attributes]\r\n * @property {Number} [section]\r\n * @property {Array<PropModel>} [props]\r\n * @property {Array<StateModel>} [states]\r\n * @property {Array<PropModel|StateModel>} [streams]\r\n * @property {Number|null} [targetSlotIndex]\r\n * @property {AbstractStylesheet|null} [sWrapper]\r\n * @property {AbstractStylesheet|null} [sOverride]\r\n * @property {Command|null} [command]\r\n * @property {Array<ReactivityQueryModel>} [reactOnParent]\r\n * @property {Array<ReactivityQueryModel>} [reactOnSelf]\r\n * @property {Array<EventSubscriptionModel>} [subscribeOnParent]\r\n * @property {Array<EventSubscriptionModel>} [subscribeOnChild]\r\n * @property {Array<EventSubscriptionModel>} [subscribeOnSelf]\r\n * @property {Array<KeyboardMap>} [keyboardSettings] \t<-- this is wrong, but not used until now\r\n * @property {Array<KeyboardHotkeysModel>} [keyboardEvents]\r\n * @property {Boolean} [isDummy]\r\n */\r\n\r\n\r\n/**\r\n * @constructor SingleLevelComponentDefModel\r\n * @param {ViewTemplate | SingleLevelComponentDefModel | 'bare'} obj\r\n * @param {String} isSpecial\r\n * @param {ViewTemplate|null} givenDef\r\n */\r\nvar SingleLevelComponentDefModel = function(obj, isSpecial = '', givenDef = null) {\r\n\tif (givenDef)\r\n\t\tObject.assign(this, givenDef);\r\n\telse {\r\n\t\tthis.UID = null\t\t\t\t\t\t\t\t// String (overridden at function end)\r\n\t\tthis.type = null,\t\t\t\t\t\t\t// String\r\n\t\tthis.isCompound = false;\t\t\t\t\t// Boolean\r\n\t\tthis.nodeName = null;\t\t\t\t\t\t// String\r\n\t\tthis.n = null;\t\t\t\t\t\t\t\t// String\r\n\t\tthis.isCustomElem = null;\t\t\t\t\t// Boolean\r\n\t\tthis.templateNodeName = null;\t\t\t\t// String\r\n\t\tthis.attributes = Array();\t\t\t\t\t// Array [AttributeDesc]\r\n\t\tthis.section = null;\t\t\t\t\t\t// Number\r\n\t\tthis.props = Array();\t\t\t\t\t\t// Array [Prop]\r\n\t\tthis.states = Array();\t\t\t\t\t\t// Array [State]\r\n\t\tthis.streams = Array();\t\t\t\t\t\t// Array [Prop, States]\r\n\t\tthis.targetSlotIndex = null;\t\t\t\t// Number\r\n\t\tthis.sWrapper = null;\t\t\t\t\t\t// Object StylesheetWrapper\r\n\t\tthis.sOverride = null;\t\t\t\t\t\t// Object StylesheetWrapper\r\n\t\tthis.command = null;\t\t\t\t\t\t// Object Command\r\n\t\tthis.reactOnParent = Array();\t\t\t\t// Array [ReactivityQuery]\r\n\t\tthis.reactOnSelf = Array();\t\t\t\t\t// Array [ReactivityQuery]\r\n\t\tthis.subscribeOnParent = Array();\t\t\t// Array [EventSubscription]\r\n\t\tthis.subscribeOnChild = Array();\t\t\t// Array [EventSubscription]\r\n\t\tthis.subscribeOnSelf = Array();\t\t\t\t// Array [EventSubscription]\r\n\t\tthis.keyboardSettings = Array();\t\t\t// Array [KeyboardHotkeys]\r\n\t\tthis.keyboardEvents = Array();\t\t\t\t// Array [KeyboardListeners]\r\n\t\tthis.isDummy = false;\t\t\t\t\t\t// Boolean\r\n\t}\r\n\r\n\tif (obj !== 'bare')\r\n\t\tValueObject.call(this, obj, isSpecial);\r\n\t\r\n\tthis.UID = UIDGenerator.DefUIDGenerator.newUID().toString();\r\n\t\r\n\t// Fast-access props\r\n\tthis.streams = this.props.concat(this.states);\r\n\tthis.isCustomElem = this.nodeName !== null\r\n\t\t// @ts-ignore: \"object is possibly null\" : we just tested it isn't null\r\n\t\t? this.nodeName.indexOf('-') !== -1\r\n\t\t: null;\r\n};\r\nSingleLevelComponentDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.SingleLevelComponentDefModel = SingleLevelComponentDefModel;\r\nSingleLevelComponentDefModel.prototype.objectType = 'SComponentDef';\r\nSingleLevelComponentDefModel.prototype.getType = function() {return this.type;}\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} HierarchicalTemplate\r\n * @property {ViewTemplate|SingleLevelComponentDefModel|HierarchicalTemplate|HierarchicalComponentDefModel|ComponentListDefModel} host\r\n * @property {ViewTemplate[]|HierarchicalTemplate[]} [subSections]\r\n * @property {ViewTemplate[]|HierarchicalTemplate[]} [members]\r\n * @property {ListTemplate[]} [lists]\r\n * @property {OptionsModel} [options]\r\n */\r\n\r\n\r\n/**\r\n * @constructor HierarchicalComponentDefModel\r\n * @param {HierarchicalTemplate|HierarchicalComponentDefModel|SingleLevelComponentDefModel} obj\r\n * @param {String} isSpecial\r\n */\r\nvar HierarchicalComponentDefModel = function(obj, isSpecial) {\r\n\r\n\tthis.host = null;\t\t\t\t\t\t\t\t// Object SingleLevelComponentDef\r\n\tthis.subSections = Array();\t\t\t\t\t\t// Array [SingleLevelComponentDef]\r\n\tthis.members = Array();\t\t\t\t\t\t\t// Array [SingleLevelComponentDef]\r\n\tthis.lists = Array();\t\t\t\t\t\t\t// Array [ComponentListDef]\r\n\tthis.options = null;\t\t\t\t\t\t\t// Object : plain\r\n\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nHierarchicalComponentDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.HierarchicalComponentDefModel = HierarchicalComponentDefModel;\r\nObject.defineProperty(HierarchicalComponentDefModel.prototype, 'objectType', {value : 'MComponentDef'});\r\n\r\nHierarchicalComponentDefModel.prototype.getGroupHostDef = function() {\r\n\treturn (this.host && this.host.host);\r\n}\r\nHierarchicalComponentDefModel.prototype.getHostDef = function() {\r\n\treturn this.host;\r\n}\r\nHierarchicalComponentDefModel.prototype.getSection = function() {\r\n\t// @ts-ignore : \"Expression not callable: {} has no signature\" => seems calling a function defined as \"described property\" isn't supported\r\n\treturn this.getHostDef().section !== null\r\n\t\t// @ts-ignore : \"Expression not callable: {} has no signature\" => seems calling a function defined as \"described property\" isn't supported\r\n\t\t? this.getHostDef().section\r\n\t\t: (\r\n\t\t\t// @ts-ignore : \"Expression not callable: {} has no signature\" => seems calling a function defined as \"described property\" isn't supported\r\n\t\t\t(this.getGroupHostDef() && this.getGroupHostDef().section)\r\n\t\t\t|| -1\r\n\t\t);\r\n}\r\n\r\n\r\n\r\n/**\r\n * @typedef {Object} ListTemplate\r\n * @property {String} UID\r\n * @property {String} type\r\n * @property {Boolean} reflectOnModel\r\n * @property {Boolean} augmentModel\r\n * @property {Array<any>} each\r\n * @prperty {Object} item\r\n * @prperty {HierarchicalComponentDefModel} template\r\n * @prperty {Number} section\r\n * @prperty {Boolean} isInternal\r\n */\r\n\r\n/**\r\n * @constructor ComponentListDef\r\n * @param {ListTemplate} obj\r\n * @param {String} isSpecial\r\n */\r\nvar ComponentListDefModel = function(obj, isSpecial = '') {\r\n\r\n\tthis.UID = typeof obj.UID === 'string' ? obj.UID : UIDGenerator.DefUIDGenerator.newUID().toString();\r\n\tthis.type = 'ComponentList';\t\t\t\t// String\r\n\tthis.reflectOnModel = true;\t\t\t\t\t// Boolean\r\n\tthis.augmentModel = false;\t\t\t\t\t// Boolean\r\n\tthis.each = Array();\t\t\t\t\t\t\t\t// Array [unknown_type] (model to iterate on)\r\n\tthis.item = null;\t\t\t\t\t\t\t// Object (an item of the model)\r\n\tthis.template = null;\t\t\t\t\t\t// Object HierarchicalComponentDef\r\n\tthis.section = null;\t\t\t\t\t\t// Number\r\n\tthis.isInternal = false;\t\t\t\t\t// Boolean\r\n\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nComponentListDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.ComponentListDefModel = ComponentListDefModel;\r\nObject.defineProperty(ComponentListDefModel.prototype, 'objectType', {value : 'ComponentListDef'});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @factory MockedDefModel\r\n * @param {ViewTemplate} obj\r\n */\r\nvar mockDef = function(obj) {\r\n\tvar dummyObj = {UID : 'dummy'};\r\n\treturn new HierarchicalComponentDefModel(\r\n\t\t{\r\n\t\t\thost : new SingleLevelComponentDefModel(\r\n\t\t\t\t(obj && Object.prototype.toString.call(obj) === '[object Object]')\r\n\t\t\t\t\t? Object.assign(dummyObj, obj)\r\n\t\t\t\t\t: dummyObj)\r\n\t\t},\r\n\t\t'rootOnly');\r\n}\r\nexportedObjects.mockDef = mockDef;\r\n\r\n/**\r\n * @factory MockedGroupDefModel\r\n */\r\nvar mockGroupDef = function() {\r\n\t/** @type {ViewTemplate} */\r\n\tconst dummyTemplate =  {};\r\n\treturn new HierarchicalComponentDefModel(\r\n\t\t{\r\n\t\t\thost : new HierarchicalComponentDefModel({\r\n\t\t\t\thost : new SingleLevelComponentDefModel(dummyTemplate)\r\n\t\t\t}, 'rootOnly')\r\n\t}, 'rootOnly');\r\n}\r\nexportedObjects.mockGroupDef = mockGroupDef;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @helper setAcceptsProp\r\n * @param {HierarchicalComponentDefModel} definition\r\n * @param {String} accepts\r\n * @param {String} title\r\n * @param {Number} onMember\r\n */\r\nvar setAcceptsProp = function(definition, accepts, title, onMember) {\r\n\tvar acceptsObj = {accepts : accepts};\r\n\tvar titleObj = {title : title};\r\n\tif (definition.getGroupHostDef()) {\r\n\t\tif (title) {\r\n\t\t\tif (typeof onMember === 'number') {\r\n\t\t\t\tdefinition.members[onMember].getHostDef().attributes.push(\r\n\t\t\t\t\tnew PropFactory(titleObj)\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tdefinition.getGroupHostDef().props.push(\r\n\t\t\t\t\tnew PropFactory(titleObj)\r\n\t\t\t\t)\r\n\t\t}\r\n\t\tdefinition.getGroupHostDef().props.push(\r\n\t\t\tnew PropFactory(\r\n\t\t\t\tacceptsObj\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n\telse if (definition.getHostDef()) {\r\n\t\tif (title) {\r\n\t\t\tif (typeof onMember === 'number')\r\n\t\t\t\tdefinition.members[onMember].getHostDef().attributes.push(\r\n\t\t\t\t\tnew PropFactory(titleObj)\r\n\t\t\t\t)\r\n\t\t\telse\r\n\t\t\t\tdefinition.getHostDef().props.push(\r\n\t\t\t\t\tnew PropFactory(titleObj)\r\n\t\t\t)\r\n\t\t}\r\n\t\t\r\n\t\tdefinition.getHostDef().props.push(\r\n\t\t\tnew PropFactory(acceptsObj)\r\n\t\t)\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @factory HierarchicalComponentDefModel\r\n * @param {ViewTemplate & SingleLevelComponentDefModel & HierarchicalTemplate & HierarchicalComponentDefModel & ComponentListDefModel} defObj\r\n */\r\nvar createDef = function(defObj) {\r\n\t// MASTER VIEW OF A COMPOUND COMPONENT\r\n\tif ((defObj.type && defObj.type === 'CompoundComponent') || defObj.isCompound) {\r\n\t\treturn (new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n\t}\r\n\t// COMPONENT LIST\r\n\telse if (!defObj.host && defObj.type === 'ComponentList')\r\n\t\treturn (new HierarchicalComponentDefModel({host : new ComponentListDefModel(defObj)}, 'rootOnly'));\r\n\t// VIEW DEF || HOST or VIEW OF A SIMPLE COMPONENT\r\n\telse if (!defObj.host) {\r\n\t\t// nodeName may be aliased as \"n\"\"\r\n\t\tif (defObj.n && !defObj.type) {\r\n\t\t\tdefObj.nodeName = defObj.n;\r\n\t\t\tdelete defObj.n;\r\n\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n\t\t}\r\n\t\telse if ((defObj.nodeName && !defObj.type) || !defObj.isCompound) {\r\n\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n\t\t}\r\n\t}\r\n\t// COMPLETE COMPONENT\r\n\telse if (defObj.host) {\r\n\t\treturn (new HierarchicalComponentDefModel(defObj, 'rootOnly'));\r\n\t}\r\n}\r\nexportedObjects.createDef = createDef;\r\n\r\n/**\r\n * @helper creates a hierarchical def even without a \"host\" prop\r\n * @param {ViewTemplate & SingleLevelComponentDefModel & HierarchicalTemplate & HierarchicalComponentDefModel & ComponentListDefModel} defObj\r\n */\r\nvar createHostDef = function(defObj) {\r\n\treturn (new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n}\r\nexportedObjects.createHostDef = createHostDef;\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * PRECIOUS HELPERS : for performance concerns, allows looping only on props that are arrays\r\n */\r\nvar propsAreArray = [\r\n\t'attributes',\r\n\t'states',\r\n\t'props',\r\n\t'streams',\r\n\t'reactOnParent',\r\n\t'reactOnSelf',\r\n\t'subscribeOnParent',\r\n\t'subscribeOnChild',\r\n\t'subscribeOnSelf'//,\r\n//\t'keyboardSettings',\t\t\t// TODO: FIX that bypass : implement keyboard handling in the context of the v0.2\r\n//\t'keyboardEvents'\r\n];\r\nvar reactivityQueries = [\r\n\t'reactOnParent',\r\n\t'reactOnSelf'\r\n];\r\nvar eventQueries = [\r\n\t'subscribeOnParent',\r\n\t'subscribeOnChild',\r\n\t'subscribeOnSelf'\r\n];\r\nvar propsArePrimitives = [\r\n\t'type',\r\n\t'nodeName',\r\n\t'isCustomElem',\r\n\t'templateNodeName',\r\n\t'targetSlotIndex',\r\n\t'section'\r\n];\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @aliases\r\n */\r\nObject.assign(exportedObjects, {\r\n\tattributesModel : PropFactory,\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tstatesModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tpropsModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tstreamsModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tTaskDefinition : TaskDefinitionModel,\t\t\t\t\t\t\t// Object TaskDefinition\r\n\tPublisherDefinition : PublisherDefinitionModel,\t\t\t\t\t// Object PublisherDefinition\r\n\toptionsModel : OptionsModel,\t\t\t\t\t\t\t\t\t// Object OptionsModel\r\n\tlist : ComponentListDefModel,\t\r\n\treactOnParentModel : ReactivityQueryModel,\t\t\t\t\t\t// Object ReactivityQueryList\r\n\treactOnSelfModel : ReactivityQueryModel,\t\t\t\t\t\t// Object ReactivityQueryList\r\n\tsubscribeOnParentModel : EventSubscriptionModel,\t\t\t\t// Object EventSubscriptionsList\r\n\tsubscribeOnChildModel : EventSubscriptionModel,\t\t\t\t\t// Object EventSubscriptionsList\r\n\tsubscribeOnSelfModel : EventSubscriptionModel,\t\t\t\t\t// Object EventSubscriptionsList\r\n\tcreateSimpleComponentDef : HierarchicalComponentDefModel,\t\t// Object HierarchicalComponentDef\r\n\tsetAcceptsProp : setAcceptsProp,\t\t\t\t\t\t\t\t// function : Helper\r\n\t\r\n\tUIDGenerator : UIDGenerator.UIDGenerator,\r\n\tStyleUIDGenerator : UIDGenerator.StyleUIDGenerator,\r\n\tDefUIDGenerator : UIDGenerator.DefUIDGenerator,\r\n\t\r\n\tpropsAreArray : propsAreArray,\t\t\t\t\t\t\t\t\t// Array\r\n\treactivityQueries : reactivityQueries,\t\t\t\t\t\t\t// Array\r\n\teventQueries : eventQueries,\t\t\t\t\t\t\t\t\t// Array\r\n\tpropsArePrimitives : propsArePrimitives,\t\t\t\t\t\t// Array\r\n\tHierarchicalTemplate : HierarchicalComponentDefModel,\r\n\tViewTemplate : SingleLevelComponentDefModel\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = exportedObjects",
    "\"use strict\";\n/**\r\n * @constructor TextSizeGetter\r\n * \r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar NodeResizeObserver = require('src/core/ResizeObserver');\r\n//var appConstants = require('src/appLauncher/appLauncher');\r\n\r\n\r\nvar TextSizeGetter = function(fontStyle) {\r\n\t\r\n\tif (typeof document === 'undefined' || typeof document.ownerDocument === 'undefined')\r\n\t\treturn;\r\n\t\t\r\n\t// width calculation\r\n\tthis.initCb;\r\n\tthis.textWidthCanvas = document.createElement(\"canvas\");\r\n\tthis.textWidthCanvasCtx = this.textWidthCanvas.getContext('2d');\r\n\tthis.fontStyle = fontStyle;\r\n\tthis.textWidthCanvasCtx.font = this.fontStyle;\r\n\tthis.lineHeight = 0;\r\n\r\n\tthis.objectType = 'TextSizeGetter';\r\n\tthis.resizeObserver = new NodeResizeObserver();\r\n}\r\nTextSizeGetter.prototype = {};\r\nTextSizeGetter.prototype.objectType = 'TextSizeGetter';\r\n\r\nTextSizeGetter.prototype.init = function(sampleNode, cb) {\r\n\tthis.sampleNode = sampleNode;\r\n\tthis.initCb = cb;\r\n\tthis.resizeObserver.observe(sampleNode, this.initWidthCompute.bind(this));\r\n}\r\n\r\nTextSizeGetter.prototype.oneShot = function(sampleNode, cb) {\r\n\tsampleNode.id = sampleNode.id + '-asStyleSource-' + TypeManager.UIDGenerator.newUID();\r\n\tthis.resizeObserver.observe(sampleNode, this.onOneShot.bind(this, sampleNode, cb));\r\n}\r\n\r\nTextSizeGetter.prototype.onOneShot = function(sampleNode, cb) {\r\n\tvar style = window.getComputedStyle(sampleNode);\r\n\tsampleNode.id = sampleNode.id.replace(/-asStyleSource-\\d+/, '');\r\n\tif (!sampleNode.id)\r\n\t\tsampleNode.removeAttribute('id');\r\n\tif (cb)\r\n\t\tcb(style);\r\n}\r\n\r\nTextSizeGetter.prototype.initWidthCompute = function(e) {\r\n\tvar self = this;\r\n\r\n\tvar style = window.getComputedStyle(this.sampleNode);\r\n\tthis.fontStyle = style.fontSize + ' ' + style.fontFamily;\r\n\t\r\n\tthis.lineHeight = Number(style.lineHeight.slice(0, -2));\r\n\t\r\n\tthis.textWidthCanvasCtx.font = this.fontStyle;\r\n\t\r\n\tif (e.data.boundingBox.h > 0) {\r\n\t\tif (this.initCb)\r\n\t\t\tthis.initCb(this.fontStyle);\r\n\t\tthis.resizeObserver.unobserve(this.sampleNode);\r\n\t\tthis.initCb = undefined;\r\n\t} \r\n}\r\n\r\nTextSizeGetter.prototype.getTextWidth = function(string) {\r\n\tif (typeof string === 'undefined')\r\n\t\treturn;\r\n    return this.textWidthCanvasCtx.measureText(string).width;\r\n}\r\n\r\nTextSizeGetter.prototype.getTextSizeDependingOnStyle = function(string, fontStyle) {\r\n\tif (typeof string === 'undefined')\r\n\t\treturn;\r\n\tif (fontStyle)\r\n\t\tthis.textWidthCanvasCtx.font = fontStyle;\r\n\t\t\r\n\tvar textSize = this.textWidthCanvasCtx.measureText(string);\r\n\t\r\n    return [\r\n\t\t\ttextSize.width,\r\n\t\t\ttextSize.actualBoundingBoxAscent + textSize.actualBoundingBoxDescent\r\n\t\t\t];\r\n}\r\n\r\nmodule.exports = TextSizeGetter;",
    "\"use strict\";\n/**\r\n * @Singleton : Core Definitions Ctor\r\n * KEPT FOR HISTORICAL COMPATIBILITY : SHOULD NOT BE INCLUDED ANYMORE\r\n */\r\n//var appConstants = require('src/appLauncher/appLauncher');\r\nvar UIDGenerator = require('src/core/UIDGenerator');\r\nvar PropertyCache = require('src/core/PropertyCache').ObjectCache;\r\nvar RequestCache = require('src/core/PropertyCache').RequestCache;\r\nvar StateMachineCache = require('src/core/PropertyCache').StateMachineCache;\r\nvar CachedTypes = require('src/core/CachedTypes');\r\nvar stateMachineCache = new StateMachineCache('stateMachineCache');\r\nvar exportedObjects = {};\r\n\r\n\r\n/**\r\n * @constructor ValueObject\r\n */\r\nvar ValueObject = function(defObj, isSpecial) {\r\n\tthis.set(defObj, isSpecial);\r\n}\r\nValueObject.prototype.objectType = 'ValueObject';\r\nexportedObjects.ValueObject = ValueObject;\r\nObject.defineProperty(ValueObject.prototype, 'model', {value : null});\t\t\t// virtual\r\nObject.defineProperty(ValueObject.prototype, 'get',{\r\n\tvalue : function() {}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'getGroupHostDef',{\r\n\tvalue : function() {return (this.host && this.host.host);}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'getHostDef',{\r\n\tvalue : function() {return this.host;}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'getType',{\r\n\tvalue : function() {return this.type;}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'getSection',{\r\n\tvalue : function() {\r\n\t\treturn this.getHostDef().section !== null\r\n\t\t\t\t? this.getHostDef().section\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t\t(this.getGroupHostDef() && this.getGroupHostDef().section)\r\n\t\t\t\t\t\t\t\t|| -1\r\n\t\t\t\t\t\t\t);\r\n\t}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'fromArray',{\r\n\tvalue : function(arr) {\r\n\t\tvar i = 0;\r\n\t\tfor (let p in this.model) {\r\n\t\t\tthis[p] = arr[i++];\r\n\t\t}\r\n\t}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'isEmpty', {\r\n\tvalue : function(obj) {\r\n\t\tfor(var prop in obj) {\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\treturn true;\r\n\t}\r\n});\r\nObject.defineProperty(ValueObject.prototype, 'set', {\r\n\tvalue : function(def, isSpecial) {\r\n//\t\tvar objectType = Object.getPrototypeOf(this).objectType;\r\n//\t\tconsole.trace(def, isSpecial);\r\n\t\tfor (let p in def) {\r\n//\t\t\tconsole.log(p, this[p], def[p]);\r\n\t\t\tif (isSpecial === 'rootOnly' && def[p])\r\n\t\t\t\tthis[p] = def[p];\r\n\t\t\telse {\r\n\t\t\t\tconst n = p + 'Model';\r\n\t\t\t\tif (n in exportedObjects) {\r\n\t\t\t\t\tif (Array.isArray(def[p])) {\r\n\t\t\t\t\t\tif (exportedObjects[n] === PropFactory) {\r\n\t\t\t\t\t\t\tfor(let i = 0, l = def[p].length; i < l; i++) {\r\n\t\t\t\t\t\t\t\tthis[p].push(PropFactory(def[p][i]));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tfor(let i = 0, l = def[p].length; i < l; i++) {\r\n\t\t\t\t\t\t\t\tthis[p].push(new exportedObjects[n](def[p][i], isSpecial));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (def[p] && def[p].host)\r\n\t\t\t\t\t\tthis[p] = new HierarchicalComponentDefModel(def[p], isSpecial);\r\n\t\t\t\t\telse if (def[p] && def[p].type === 'ComponentList')\r\n\t\t\t\t\t\tthis[p] = new ComponentListDefModel(def[p], isSpecial);\r\n\t\t\t\t\telse if (def[p] !== null)\r\n\t\t\t\t\t\tthis[p] = new exportedObjects[n](def[p], isSpecial);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tthis[p] = def[p];\r\n\t\t\t}\r\n//\t\t\tconsole.log(p, this[p], def[p]);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n\r\n/**\r\n * @constructor OptionsListModel\r\n * @extends ValueObject\r\n */\r\nvar OptionsListModel = function(obj, isSpecial) {\r\n//\tObject.assign(this, {});\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nOptionsListModel.prototype = Object.create(ValueObject.prototype);\r\nObject.defineProperty(OptionsListModel.prototype, 'objectType', {value :  'AttributesList'});\r\nexportedObjects.OptionsListModel = OptionsListModel;\r\n\r\n\r\n/**\r\n * @constructor KeyboardHotkeysModel\r\n * @extends ValueObject\r\n */\r\nvar KeyboardHotkeysModel = function(obj, isSpecial) {\r\n//\tObject.assign(this, {\r\n\t\tthis.ctrlKey = false;\t\t\t\t\t\t// Boolean\r\n\t\tthis.shiftKey = false;\t\t\t\t\t\t// Boolean\r\n\t\tthis.altKey = false;\t\t\t\t\t\t// Boolean\r\n\t\tthis.keyCode = 0;\t\t\t\t\t\t\t// Number\r\n//\t});\r\n\tValueObject.call(this, obj, isSpecial);\r\n};\r\nKeyboardHotkeysModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.KeyboardHotkeysModel = KeyboardHotkeysModel;\r\nObject.defineProperty(KeyboardHotkeysModel.prototype, 'objectType', {value : 'KeyboardHotkeys'});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @factory PropFactory\r\n * \r\n */\r\nvar PropFactory = function(obj) {\r\n\t\r\n\tvar key = typeof obj === 'string' ? obj : (obj.getName ? obj.getName() : AbstractProp.prototype.getName.call(obj));\r\n\t\r\n\tif (!(key in PropFactory.props)) {\r\n\t\tPropFactory.props[key] = new Function('obj', 'this[\"' + key + '\"] = obj[\"' + key + '\"];');\r\n//\t\tPropFactory.props[key].name = 'AbstractProp'; \t// read only\r\n\t\tPropFactory.props[key].prototype = {};\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'getName', {\r\n\t\t\tvalue :  new Function('return \"' + key + '\";')\r\n\t\t});\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'getValue', {\r\n\t\t\tvalue :  new Function('return this[\"' + key + '\"];')\r\n\t\t});\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'key', {\r\n\t\t\tvalue :  key\r\n\t\t});\r\n\t\tObject.defineProperty(PropFactory.props[key].prototype, 'objectType', {\r\n\t\t\tvalue :  'AbstractProp'\r\n\t\t});\r\n//\t\tconsole.log(obj, PropFactory.props[key]);\r\n\t\treturn (new PropFactory.props[key](obj));\r\n\t}\r\n\telse {\r\n//\t\tconsole.log(obj, PropFactory.props[key]);\r\n\t\treturn (new PropFactory.props[key](obj));\r\n\t}\r\n\t\t\r\n}\r\nPropFactory.props = {};\r\nexportedObjects.PropFactory = PropFactory;\r\n\r\n\r\n\r\n/**\r\n * @constructor AbstractProp\r\n * @extends ValueObject\r\n */\r\nvar AbstractProp = function(obj){\r\n\tvar key = typeof obj === 'string' ? obj : this.getName.call(obj);\r\n//\tif (model = dictionary.solveFromDictionary('attributes', key))\r\n//\t\tObject.assign(this, model);\r\n\tthis[key] = obj[key];\r\n}\r\nAbstractProp.prototype = Object.create(ValueObject.prototype);\r\nObject.defineProperty(AbstractProp.prototype, 'getName', {\r\n\tvalue :  function() {\r\n\t\tfor(let name in this)\r\n\t\t\treturn name; \r\n}});\r\nObject.defineProperty(AbstractProp.prototype, 'getValue', {\r\n\tvalue :  function() {\r\n\t\tfor(let name in this)\r\n\t\t\t return this[name]; \r\n}});\r\n\r\n\r\n/**\r\n * @constructor AttributeModel\r\n * @extends AbstractProp\r\n */\r\nvar AttributeModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n}\r\nAttributeModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.AttributeModel = AttributeModel;\r\nObject.defineProperty(AttributeModel.prototype, 'objectType', {value :  'Attribute'});\r\n\r\n\r\n/**\r\n * @constructor StateModel\r\n * @extends AbstractProp\r\n */\r\nvar StateModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n};\r\nStateModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.StateModel = StateModel;\r\nObject.defineProperty(StateModel.prototype, 'objectType', {value : 'States'});\r\n\r\n\r\n/**\r\n * @constructor PropModel\r\n * @extends AbstractProp\r\n */\r\nvar PropModel = function(obj) {\r\n\tAbstractProp.call(this, obj);\r\n};\r\nPropModel.prototype = Object.create(AbstractProp.prototype);\r\nexportedObjects.PropModel = PropModel;\r\nObject.defineProperty(PropModel.prototype, 'objectType', {value : 'Props'});\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ReactivityQuery\r\n * @extends ValueObject\r\n */\r\nvar ReactivityQueryModel = function(obj, isSpecial) {\r\n\tthis.cbOnly = false;\t\t\t\t\t\t// Boolean\r\n\tthis.from = null;\t\t\t\t\t\t\t// String\r\n\tthis.to = null;\t\t\t\t\t\t\t\t// String\r\n\tthis.obj = null,\t\t\t\t\t\t\t// Object [HTMLElement; Stream]\r\n\tthis.filter = null;\t\t\t\t\t\t\t// function (GlorifiedPureFunction ;)\r\n\tthis.map = null;\t\t\t\t\t\t\t// function (GlorifiedPureFunction ;)\r\n\tthis.subscribe = null;\t\t\t\t\t\t// function CallBack\r\n\tthis.inverseTransform = null;\t\t\t\t// function CallBack\r\n\t\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nReactivityQueryModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.ReactivityQueryModel = ReactivityQueryModel;\r\nObject.defineProperty(ReactivityQueryModel.prototype, 'objectType', {value : 'ReactivityQuery'});\r\nObject.defineProperty(ReactivityQueryModel.prototype, 'subscribeToStream', {\r\n\tvalue : function(stream, queriedOrQueryingObj) {\r\n//\t\tconsole.log(this.cbOnly, stream, queriedOrQueryingObj, this);\r\n\t\tif (!this.cbOnly && !queriedOrQueryingObj.streams[this.to] && !this.subscribe) {\r\n\t\t\tconsole.warn('missing stream or subscription callback on child subscribing from ' + stream.name + ' to ' + this.to);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if (typeof stream === 'undefined') {\r\n\t\t\tconsole.error('no stream object passed for subscription', queriedOrQueryingObj, this.from, this.to);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cbOnly) {\r\n\t\t\tqueriedOrQueryingObj._subscriptions.push(\r\n\t\t\t\tstream.subscribe(this.subscribe.bind(queriedOrQueryingObj))\r\n\t\t\t\t\t.filter(this.filter)\r\n\t\t\t\t\t.map(this.map)\r\n\t\t\t\t\t.reverse(this.inverseTransform)\r\n\t\t\t);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tqueriedOrQueryingObj._subscriptions.push(\r\n\t\t\t\tstream.subscribe(queriedOrQueryingObj.streams[this.to], 'value')\r\n\t\t\t\t\t.filter(this.filter)\r\n\t\t\t\t\t.map(this.map)\r\n\t\t\t\t\t.reverse(this.inverseTransform)\r\n\t\t\t);\r\n\t\t}\r\n//\t\tif (!queriedOrQueryingObj._parent)\r\n//\t\t\tconsole.log(queriedOrQueryingObj);\r\n\r\n\t\tvar subscription = queriedOrQueryingObj._subscriptions[queriedOrQueryingObj._subscriptions.length - 1];\r\n//\t\tstateMachineCache.registerTransition(queriedOrQueryingObj._UID, queriedOrQueryingObj.objectType, this, queriedOrQueryingObj._parent._UID);\r\n\t\t\r\n//\t\tconsole.warn(this.from, this.to, stream.subscriptions.length, stream._value, stream);\r\n\t\tif (stream._value)\r\n\t\t\tstream.subscriptions[stream.subscriptions.length - 1].execute(stream._value);\r\n\t\t\t\r\n\t\treturn subscription;\r\n}});\r\n\r\n\r\n\r\n/**\r\n * @constructor EventSubscription\r\n * @extends ValueObject\r\n */\r\nvar EventSubscriptionModel = function(obj, isSpecial) {\r\n\r\n\tthis.on = null;\t\t\t\t\t\t\t\t// String\r\n\tthis.subscribe = null;\t\t\t\t\t\t// function CallBack\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nEventSubscriptionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.EventSubscriptionModel = EventSubscriptionModel;\r\nObject.defineProperty(EventSubscriptionModel.prototype, 'objectType', {value : 'EventSubscription'});\r\nObject.defineProperty(EventSubscriptionModel.prototype, 'subscribeToEvent', {\r\n\tvalue : function(targetComponent, requestingComponent) {\r\n\t\ttargetComponent.addEventListener(this.on, this.subscribe.bind(requestingComponent));\r\n}});\r\n\r\n/**\r\n * @constructor TaskDefinition\r\n * @extends ValueObject\r\n */\r\nvar TaskDefinitionModel = function(obj, isSpecial) {\r\n\r\n\tthis.type = null;\t\t\t\t\t\t// String\r\n\tthis.task = null;\t\t\t\t\t\t// function CallBack\r\n\tthis.index = null;\t\t\t\t\t\t// number\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nTaskDefinitionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.TaskDefinitionModel = TaskDefinitionModel;\r\nObject.defineProperty(TaskDefinitionModel.prototype, 'objectType', {value : 'asyncTaskSubscription'});\r\nObject.defineProperty(TaskDefinitionModel.prototype, 'execute', {\r\n\tvalue : function(thisArg, definition) {\r\n\t\tthis.task.call(thisArg, definition);\r\n}});\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor PublisherDefinition\r\n * @extends ValueObject\r\n */\r\nvar PublisherDefinitionModel = function(obj, isSpecial) {\r\n\t\r\n\tthis._name = null;\t\t\t\t\t\t// String\r\n\tthis.exportedTypes = null;\t\t\t\t// Array\r\n\tthis.stream = null;\t\t\t\t\t\t// Stream\r\n\tthis._publisherUID = null;\t\t\t\t// String\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nPublisherDefinitionModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.PublisherDefinitionModel = PublisherDefinitionModel;\r\nObject.defineProperty(PublisherDefinitionModel.prototype, 'objectType', {value : 'GlobalyReacheableStream'});\r\nObject.defineProperty(PublisherDefinitionModel.prototype, 'tryReceiveConnection', {\r\n\tvalue : function(subscriber) {\r\n\t\t\tthis.exportedTypes.forEach(function(type, sub) {\r\n\t\t\t\tif (sub.acceptedTypes.indexOf(type) !== -1) {\r\n\t\t\t\t\tthis.stream.subscribe(sub.streams.updateChannel, 'value');\r\n\t\t\t\t}\r\n\t\t\t}.bind(this, subscriber));\r\n}});\r\n// Should not be used in the context of \"single-provider\" subscribers (the same DefinitionModel may be used in various types of registers)\r\nObject.defineProperty(PublisherDefinitionModel.prototype, 'tryLateReceiveConnection', {\r\n\tvalue : function(publisherList) {\r\n\t\tvar publisher;\r\n\t\tfor(let publisherName in publisherList) {\r\n\t\t\tpublisher = publisherList[publisherName];\r\n\t\t\tthis.exportedTypes.forEach(function(type, pub) {\r\n\t\t\t\tif (pub.exportedTypes.indexOf(type) !== -1) {\r\n\t\t\t\t\tpub.stream.subscriptions.forEach(function(sub) {\r\n\t\t\t\t\t\tthis.stream.subscribe(sub.subscriber.obj, sub.subscriber.prop);\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this, publisher));\r\n\t\t}\r\n}});\r\n// TODO: should also be able to lateDisconnect:\r\n// when queried, answers true if it already holds a subscription\r\n// for the currently handled type and for the currently handled subscriber\r\n// (the register is responsible of passing those as args).\r\n// \t=> case of a subscriber which should only have -one- provider for a given type (color, font, padding, etc.) \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor SingleLevelComponentDefModel\r\n * @extends ValueObject\r\n */\r\nvar SingleLevelComponentDefModel = function(obj, isSpecial, givenDef) {\r\n\tif (givenDef)\r\n\t\tObject.assign(this, givenDef);\r\n\telse {\r\n\t\tthis.UID = null\t\t\t\t\t\t\t\t// overridden at function end\r\n\t\tthis.type = null,\t\t\t\t\t\t\t// String\r\n\t\tthis.isCompound = false;\t\t\t\t\t// Boolean\r\n\t\tthis.nodeName = null;\t\t\t\t\t\t// String\r\n\t\tthis.isCustomElem = null;\t\t\t\t\t// Boolean\r\n\t\tthis.templateNodeName = null;\t\t\t\t// String\r\n\t\tthis.attributes = [];\t\t\t\t\t\t// Array [AttributeDesc]\r\n\t\tthis.section = null;\t\t\t\t\t\t// Number\r\n\t\tthis.props = [];\t\t\t\t\t\t\t// Array [Prop]\r\n\t\tthis.states = [];\t\t\t\t\t\t\t// Array [State]\r\n\t\tthis.streams = [];\t\t\t\t\t\t\t// Array [Prop, States]\r\n\t\tthis.targetSlotIndex = null;\t\t\t\t// Number\r\n\t\tthis.sWrapper = null;\t\t\t\t\t\t// Object StylesheetWrapper\r\n\t\tthis.sOverride = null;\t\t\t\t\t\t// Object StylesheetWrapper\r\n\t\tthis.command = null;\t\t\t\t\t\t// Object Command\r\n\t\tthis.reactOnParent = [];\t\t\t\t\t// Array [ReactivityQuery]\r\n\t\tthis.reactOnSelf = [];\t\t\t\t\t\t// Array [ReactivityQuery]\r\n\t\tthis.subscribeOnParent = [];\t\t\t\t// Array [EventSubscription]\r\n\t\tthis.subscribeOnChild = [];\t\t\t\t\t// Array [EventSubscription]\r\n\t\tthis.subscribeOnSelf = [];\t\t\t\t\t// Array [EventSubscription]\r\n\t\tthis.keyboardSettings = [];\t\t\t\t\t// Array [KeyboardHotkeys]\r\n\t\tthis.keyboardEvents = [];\t\t\t\t\t// Array [KeyboardListeners]\r\n\t\tthis.isDummy = false;\r\n\t}\r\n\r\n\tif (obj !== 'bare')\r\n\t\tValueObject.call(this, obj, isSpecial);\r\n\t\r\n\tthis.UID = UIDGenerator.DefUIDGenerator.newUID().toString();\r\n\t\r\n\t// Fast-access props\r\n\tthis.streams = this.props.concat(this.states);\r\n\tthis.isCustomElem = this.nodeName !== null ? this.nodeName.indexOf('-') !== -1 : null;\r\n//\tconsole.error(this.nodeName, this, obj);\r\n//\tconsole.log(\"this.isCustomElem\", this.isCustomElem, this.nodeName !== null, this.nodeName.indexOf('-') !== -1);\r\n};\r\nSingleLevelComponentDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.SingleLevelComponentDefModel = SingleLevelComponentDefModel;\r\nObject.defineProperty(SingleLevelComponentDefModel.prototype, 'objectType', {value : 'SComponentDef'});\r\n\r\n\r\n\r\n/**\r\n * @constructor HierarchicalComponentDefModel\r\n * @extends ValueObject\r\n */\r\nvar HierarchicalComponentDefModel = function(obj, isSpecial) {\r\n\r\n\tthis.host = null;\t\t\t\t\t\t\t// Object SingleLevelComponentDef\r\n\tthis.subSections = [];\t\t\t\t\t\t// Array [SingleLevelComponentDef]\r\n\tthis.members = [];\t\t\t\t\t\t\t// Array [SingleLevelComponentDef]\r\n\tthis.lists = [];\t\t\t\t\t\t\t// Array [ComponentListDef]\r\n\tthis.options = null;\t\t\t\t\t\t// Object : plain\r\n\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nHierarchicalComponentDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.HierarchicalComponentDefModel = HierarchicalComponentDefModel;\r\nObject.defineProperty(HierarchicalComponentDefModel.prototype, 'objectType', {value : 'MComponentDef'});\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentListDef\r\n * @extends ValueObject\r\n */\r\nvar ComponentListDefModel = function(obj, isSpecial) {\r\n\r\n\tthis.UID = typeof obj.UID === 'string' ? obj.UID : UIDGenerator.DefUIDGenerator.newUID().toString();\r\n\tthis.type = 'ComponentList';\t\t\t\t// String\r\n\tthis.reflectOnModel = true;\t\t\t\t\t// Boolean\r\n\tthis.augmentModel = false;\t\t\t\t\t// Boolean\r\n\tthis.each = [];\t\t\t\t\t\t\t\t// Array [unknown_type] (model to iterate on)\r\n\tthis.item = null;\t\t\t\t\t\t\t// Object (an item of the model)\r\n\tthis.template = null;\t\t\t\t\t\t// Object HierarchicalComponentDef\r\n\tthis.section = null;\t\t\t\t\t\t// Number\r\n\r\n\tValueObject.call(this, obj, isSpecial);\r\n}\r\nComponentListDefModel.prototype = Object.create(ValueObject.prototype);\r\nexportedObjects.ComponentListDefModel = ComponentListDefModel;\r\nObject.defineProperty(ComponentListDefModel.prototype, 'objectType', {value : 'ComponentListDef'});\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor ComponentDefCache\r\n * \r\n */\r\nvar ComponentDefCache = function() {\r\n\tthis.knownIDs = {};\r\n\tthis.randomUID = 0;\r\n}\r\nComponentDefCache.prototype = {};\r\nComponentDefCache.prototype.getUID = function(uniqueID) {\r\n\tif (uniqueID in this.knownIDs)\r\n\t\treturn this.knownIDs[uniqueID];\r\n\telse if (!(uniqueID in this.knownIDs) || !uniqueID || !uniqueID.length) {\r\n\t\tuniqueID = uniqueID ? uniqueID : (this.randomUID++).toString();\r\n\t\tthis.knownIDs[uniqueID] = uniqueID;\r\n\t\treturn this.knownIDs[uniqueID];\r\n\t}\r\n}\r\n\r\nComponentDefCache.prototype.isKnownUID = function(uniqueID) {\r\n\treturn this.getUID(uniqueID);\r\n}\r\n\r\nComponentDefCache.prototype.setUID = function(uniqueID, globalObj) {\r\n\treturn (this.knownIDs[uniqueID] = globalObj);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor createComponentDef\r\n * @factory\r\n * HISTORICAL - DO NOT USE ANYMORE\r\n */\r\nvar createComponentDef = function(defObj, useCache, isSpecial) {\r\n\tvar def, UID;\r\n//\tconsole.log(useCache);\r\n\tif (useCache) {\r\n\t\tUID = exportedObjects.definitionsCache.isKnownUID(useCache);\r\n\t}\r\n\t\r\n\tif (!UID || typeof UID === 'string') {\r\n\t\t// shorthand to create defs with just a \"type\", maybe an attributesList, but only the first props in the model...\r\n\t\tif (typeof defObj === 'string') {\r\n\t\t\tvar c = new SingleLevelComponentDefModel('bare');\r\n\t\t\tValueObject.prototype.fromArray.call(c, arguments);\r\n\t\t\tdef = new HierarchicalComponentDefModel({host : c}, 'rootOnly');\r\n\t\t}\r\n\t\tif (typeof defObj === 'object' && defObj.host) {\r\n//\t\t\tconsole.log('HierarchicalComponentDefModel', defObj, isSpecial);\r\n\t\t\tdef = new HierarchicalComponentDefModel(defObj, isSpecial);\r\n\t\t\tif (isSpecial === 'isDummy')\r\n\t\t\t\tdef.getHostDef().isDummy = 'isDummy';\r\n//\t\t\tconsole.log(def);\r\n\t\t}\r\n\t\telse if (typeof defObj === 'object' && defObj.type === 'ComponentList')\r\n\t\t\tdef = new HierarchicalComponentDefModel({host : new ComponentListDefModel(defObj, isSpecial)}, 'rootOnly');\r\n\t\telse if (typeof defObj === 'object' && defObj.nodeName || defObj.type || defObj.UID || defObj.sWrapper || (defObj.attributes || defObj.states || defObj.props)) {\r\n\t\t\tif (isSpecial !== 'hostOnly')\r\n\t\t\t\tdef = new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, isSpecial)}, 'rootOnly');\r\n\t\t\telse\r\n\t\t\t\tdef = new SingleLevelComponentDefModel(defObj);\r\n\t\t}\r\n\t}\r\n//\tconsole.log(def);\r\n\tif (typeof UID === 'string')\r\n\t\treturn exportedObjects.definitionsCache.setUID(UID, def);\r\n\telse if (typeof UID !== 'undefined')\r\n\t\treturn UID;\r\n\telse\r\n\t\treturn def;\r\n};\r\nexportedObjects.createComponentDef = createComponentDef;\r\n\r\n\r\n/**\r\n * @constructor MockedDefModel\r\n * @factory\r\n */\r\nvar mockDef = function(obj) {\r\n\tvar dummyObj = {UID : 'dummy'};\r\n\treturn new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(\r\n\t\t(obj && Object.prototype.toString(obj) === '[object Object]') ? Object.assign(dummyObj, obj) : dummyObj\r\n\t)}, 'rootOnly');\r\n}\r\nexportedObjects.mockDef = mockDef;\r\n\r\nvar mockGroupDef = function() {\r\n//\tvar dummyObj = {UID : 'dummy'};\r\n\treturn new HierarchicalComponentDefModel({host : new HierarchicalComponentDefModel({\r\n\t\thost : new SingleLevelComponentDefModel()\r\n\t}, 'rootOnly'\r\n//\t\t(obj && Object.prototype.toString(obj) === '[object Object]') ? Object.assign(dummyObj, obj) : dummyObj\r\n\t)}, 'rootOnly');\r\n}\r\nexportedObjects.mockGroupDef = mockGroupDef;\r\n//console.log(mockGroupDef());\r\n\r\nvar setAcceptsProp = function(definition, accepts, title, onMember) {\r\n\tvar acceptsObj = {accepts : accepts};\r\n\tvar titleObj = {title : title};\r\n\tif (definition.getGroupHostDef()) {\r\n\t\tif (title) {\r\n\t\t\tif (typeof onMember === 'number')\r\n\t\t\t\tdefinition.members[onMember].getHostDef().attributes.push(\r\n\t\t\t\t\tnew PropFactory(\r\n\t\t\t\t\t\ttitleObj\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\telse\r\n\t\t\t\tdefinition.getGroupHostDef().props.push(\r\n\t\t\t\t\tnew PropFactory(\r\n\t\t\t\t\t\ttitleObj\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t}\r\n\t\tdefinition.getGroupHostDef().props.push(\r\n\t\t\tnew PropFactory(\r\n\t\t\t\tacceptsObj\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n\telse if (definition.getHostDef()) {\r\n\t\tif (title) {\r\n\t\t\tif (typeof onMember === 'number')\r\n\t\t\t\tdefinition.members[onMember].getHostDef().attributes.push(\r\n\t\t\t\t\tnew PropFactory(\r\n\t\t\t\t\t\ttitleObj\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\telse\r\n\t\t\t\tdefinition.getHostDef().props.push(\r\n\t\t\t\tnew PropFactory(\r\n\t\t\t\t\ttitleObj\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t}\r\n\t\t\r\n\t\tdefinition.getHostDef().props.push(\r\n\t\t\tnew PropFactory(\r\n\t\t\t\tacceptsObj\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @typedef {(HierarchicalComponentDefModel|SingleLevelComponentDefModel)} ComponentDef\r\n */\r\n\r\n/**\r\n * @constructor createDef\r\n * @factory\r\n * @param {object} defObj \r\n * @return {ComponentDef}\r\n */\r\n//var createDef = function(defObj) {\r\n////\tconsole.log(defObj);\r\n//\t// MASTER VIEW OF A COMPOUND COMPONENT\r\n//\tif ((defObj.type && defObj.type === 'CompoundComponent') || defObj.isCompound) {\r\n////\t\tif (defObj.nodeName === 'big-modalbox')\r\n////\t\t\tconsole.log('big-modalbox host', new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n//\t\treturn (new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n//\t}\r\n//\t// COMPLETE COMPONENT (without host shorthand)\r\n//\telse if (defObj.type) {\r\n//\t\treturn (new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n//\t}\r\n//\t// COMPLETE COMPONENT (host given)\r\n//\telse if (defObj.host) {\r\n////\t\tif (!defObj.host.host)\r\n////\t\t\tconsole.log(defObj);\r\n////\t\tif (defObj.host.host && defObj.host.host.nodeName === 'big-modalbox')\r\n////\t\t\tconsole.log('big-modalbox complete', new HierarchicalComponentDefModel(defObj, 'rootOnly'));\r\n//\t\treturn (new HierarchicalComponentDefModel(defObj, 'rootOnly'));\r\n//\t}\r\n//\t// VIEW DEF || HOST or VIEW OF A SIMPLE COMPONENT\r\n//\telse if (!defObj.host) {\r\n//\t\tif (defObj.n && !defObj.type) {\r\n//\t\t\tdefObj.nodeName = defObj.n;\r\n//\t\t\tdelete defObj.n;\r\n//\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n//\t\t}\r\n//\t\telse if ((defObj.nodeName && !defObj.type) || !defObj.isCompound) {\r\n////\t\t\tconsole.log(new SingleLevelComponentDefModel(defObj));\r\n//\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n//\t\t}\r\n//\t}\r\n//}\r\nvar createDef = function(defObj) {\r\n//\tconsole.log(defObj);\r\n\t// MASTER VIEW OF A COMPOUND COMPONENT\r\n\tif ((defObj.type && defObj.type === 'CompoundComponent') || defObj.isCompound) {\r\n//\t\tif (defObj.sOverride)\r\n//\t\t\tconsole.log((new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly')));\r\n//\t\tif (defObj.nodeName === 'big-modalbox')\r\n//\t\t\tconsole.log('big-modalbox host', new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n\t\treturn (new HierarchicalComponentDefModel({host : new SingleLevelComponentDefModel(defObj, 'hostOnly')}, 'rootOnly'));\r\n\t}\r\n\t// VIEW DEF || HOST or VIEW OF A SIMPLE COMPONENT\r\n\telse if (!defObj.host) {\r\n\t\tif (defObj.n && !defObj.type) {\r\n\t\t\tdefObj.nodeName = defObj.n;\r\n\t\t\tdelete defObj.n;\r\n\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n\t\t}\r\n\t\telse if ((defObj.nodeName && !defObj.type) || !defObj.isCompound) {\r\n//\t\t\tconsole.log(new SingleLevelComponentDefModel(defObj));\r\n\t\t\treturn (new SingleLevelComponentDefModel(defObj));\r\n\t\t}\r\n\t}\r\n\t// COMPLETE COMPONENT\r\n\telse if (defObj.host) {\r\n//\t\tif (!defObj.host.host)\r\n//\t\t\tconsole.log(defObj);\r\n//\t\tif (defObj.host.host && defObj.host.host.nodeName === 'big-modalbox')\r\n//\t\t\tconsole.log('big-modalbox complete', new HierarchicalComponentDefModel(defObj, 'rootOnly'));\r\n\t\treturn (new HierarchicalComponentDefModel(defObj, 'rootOnly'));\r\n\t}\r\n}\r\n\r\nexportedObjects.createDef = createDef;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @dictionary\r\n */\r\nvar Dictionary = function() {\r\n\t\tthis.attributes = {};\r\n\t\tthis.states = {};\r\n\t\tthis.props = {};\r\n}\r\nDictionary.prototype.solveFromDictionary = function(type, key) {\r\n\t\t\r\n\tif (!(this[type] && this[type][key])) {\r\n\t\tif (!this[type]) {\r\n\t\t\tthis[type] = {};\r\n\t\t\tif (!this[type][key]) {\r\n\t\t\t\tthis[type][key] = {};\r\n\t\t\t\tthis[type][key][key] = type === 'states' ? undefined : null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn this[type][key];\r\n}\r\nvar dictionary = new Dictionary();\r\n\r\n/**\r\n * @finder function\r\n */\r\nexportedObjects.findProp = function(name, item) {\r\n\tfor(let prop in item)\r\n\t\treturn prop === name;\r\n}\r\n\r\n/**\r\n * PRECIOUS HELPERS : for performance concerns, allows looping only on props that are arrays\r\n */\r\nvar propsAreArray = [\r\n\t'attributes',\r\n\t'states',\r\n\t'props',\r\n\t'streams',\r\n\t'reactOnParent',\r\n\t'reactOnSelf',\r\n\t'subscribeOnParent',\r\n\t'subscribeOnChild',\r\n\t'subscribeOnSelf'//,\r\n//\t'keyboardSettings',\t\t\t// TODO: FIX that bypass : implement keyboard handling in the context of the v0.2\r\n//\t'keyboardEvents'\r\n];\r\nvar reactivityQueries = [\r\n\t'reactOnParent',\r\n\t'reactOnSelf'\r\n];\r\nvar eventQueries = [\r\n\t'subscribeOnParent',\r\n\t'subscribeOnChild',\r\n\t'subscribeOnSelf'\r\n];\r\nvar propsArePrimitives = [\r\n\t'type',\r\n\t'nodeName',\r\n\t'isCustomElem',\r\n\t'templateNodeName',\r\n\t'targetSlotIndex',\r\n\t'section'\r\n];\r\n\r\n/**\r\n * PROPS CACHES : for performance concerns, allows retrieving a prop on the def from anywhere\r\n * \t\tUsefull when instanciating components from a list, as reactivity doesn't change through iterations :\r\n * \t\t\t- first ensure the def is complete, and store constants : \r\n * \t\t\t\t- the \"reactivity\" register stores reactivity queries\r\n * \t\t\t\t- the \"nodes\" register stores DOM attributes : relation are uniques, each ID from the def is bound to an attributes-list \r\n * \t\t\t\t\t\t=> fill the \"nodes\" register ( {ID : {nodeName : nodeName, attributes : attributes, cloneMother : DOMNode -but not yet-} )\r\n * \t\t\t- then compose components, creating streams and views\r\n * \t\t\t\t- create static views without instanciating the DOM objects : parentView of the view is either a \"View\" or a \"ChildView\"\r\n * \t\t\t\t\t\t=> assign parentView\r\n * \t\t\t\t\t\t=> fill the \"views\" register ( {ID : [view] } )\r\n * \t\t\t\t\t- instanciate streams : if it has streams, it's a host\r\n * \t\t\t\t\t\t=> fill the \"hosts\" register ( {ref : Component} ) // alternatively, the \"definitionRegister\" already holds all \"Components\"\r\n * \t\t\t\t- on composition :\r\n * \t\t\t\t\t- handle reactivity and event subscription : each component as a \"unique ID from the def\" => retrieve queries from the \"reactivity\" register\r\n * \t\t\t- then instanciate DOM objects through cloning : DOM attributes are always static\r\n * \t\t\t\t\t=> iterate on the \"views\" register\r\n * \t\t\t- then get back to hosts elem : they're in the \"hosts\" register\r\n * \t\t\t\t\t- accessing to the component's view, decorate DOM Objects with :\r\n * \t\t\t\t\t\t- streams\r\n * \t\t\t\t\t\t- reflexive props\r\n * \t\t\t\t\t- assign reflectedObj to streams\r\n * \t\t\t- finally reflect streams on the model\r\n */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * CORE CACHES\r\n */\r\nvar caches = {};\r\n(function initCaches() {\r\n\tpropsAreArray.forEach(function(prop) {\r\n\t\tcaches[prop] = new PropertyCache(prop);\r\n\t});\r\n})();\r\n\r\nvar hostsDefinitionsCacheRegistry = new PropertyCache('hostsDefinitionsCacheRegistry');\r\nvar listsDefinitionsCacheRegistry = new PropertyCache('listsDefinitionsCacheRegistry');\r\nvar permanentProvidersRegistry = new RequestCache('permanentProvidersRegistry');\r\nvar boundingBoxesCache = new PropertyCache('boundingBoxesCache');\r\n\r\n// MAYBE TODO: this cache is used by the RichComponenentInternalsPicker, \r\n// to resolve the sWrapper associated with a component out of its UID (? to be confirmed/precised), but\r\n// we also need a MasterStyleCache, to store each CSS rule at global level,\r\n// and resolve the binding between a matched rules and a (pseudo-)DOM node, from any outer scope.\r\n// \t\t=> could we enhance this cache so it would allow to retrieve a whole sWrapper\r\n//\t\tal well as a single CSS rule, in order -not- to duplicate the caches used for CSS ?\r\n// \t=> think of that deeply, and validate any choice regarding performances.\r\nvar sWrappersCache = new PropertyCache('sWrappersCache');\r\n\r\nvar hostsRegistry = [];\r\nvar typedHostsRegistry = new PropertyCache('typedHostsRegistry');\r\n\r\n/**\r\n * @typedCache {CachedNode} {UID : {nodeName : nodeName, isCustomElem : isCustomElem, cloneMother : DOMNode -but not yet-}}\r\n */\r\nvar nodesRegistry = new PropertyCache('nodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredView} {UID : view}\r\n */\r\nvar viewsRegistry = [];\r\n\r\n/**\r\n * @typedStore {StoredAssocWithModel} {UID : keyOnModel}\r\n */\r\nvar dataStoreRegistry = new PropertyCache('dataStoreRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheOpitimizedSelectorBuffer}\r\n */\r\nvar masterStyleRegistry = new PropertyCache('masterStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheViewIdentifiedAsNeedingUpdate}\r\n */\r\nvar pendingStyleRegistry = new PropertyCache('pendingStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredStyleIFace} {UID : UID_OfTheViewIdentifiedAsNeedingUpdate}\r\n */\r\nvar UApendingStyleRegistry = new PropertyCache('UApendingStyleRegistry');\r\n\r\n/**\r\n * @typedStore {StoredNodeFromNaiveDOM} {UID : nodeUID}\r\n */\r\nvar naiveDOMRegistry = new PropertyCache('naiveDOMRegistry');\r\n\r\n/**\r\n * @typedStore {StoredLayoutNode} {UID : nodeUID}\r\n */\r\nvar layoutNodesRegistry = new PropertyCache('layoutNodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredTextNode} {UID : nodeUID}\r\n */\r\nvar textNodesRegistry = new PropertyCache('textNodesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredRasterShape} {UID : nodeUID}\r\n */\r\nvar rasterShapesRegistry = new PropertyCache('rasterShapesRegistry');\r\n\r\n/**\r\n * @typedStore {StoredFlexCtx} {UID : nodeUID}\r\n */\r\nvar flexCtxRegistry = new PropertyCache('flexCtxRegistry');\r\n\r\n/**\r\n * @typedStore {StoredLayoutCallback} {UID : nodeUID}\r\n */\r\nvar layoutCallbacksRegistry = new PropertyCache('layoutCallbacksRegistry');\r\n\r\n/**\r\n * @typedStore {FontSizeCache} {UID : nodeUID}\r\n */\r\nvar fontSizeBuffersCache = new PropertyCache('fontSizeBuffersCache');\r\n\r\n//console.log(exportedObjects.definitionsCache);\r\n\r\n//console.log(hostsDefinitionsCacheRegistry);\r\n//console.log(listsDefinitionsCacheRegistry);\r\n//console.log(naiveDOMRegistry);\r\n//console.log(masterStyleRegistry);\r\n//console.log(rasterShapesRegistry);\r\n//console.log(permanentProvidersRegistry);\r\n\r\n//console.log(viewsRegistry);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @aliases\r\n */\r\nObject.assign(exportedObjects, {\r\n\tPropertyCache : PropertyCache,\r\n\thostsDefinitionsCacheRegistry : hostsDefinitionsCacheRegistry,\t// Object PropertyCache\r\n\tlistsDefinitionsCacheRegistry : listsDefinitionsCacheRegistry,\t// Object PropertyCache\r\n\tpermanentProvidersRegistry : permanentProvidersRegistry,\t\t// Object RequestCache\r\n\tboundingBoxesCache : boundingBoxesCache,\t\t\t\t\t\t// Object PropertyCache\r\n\tstateMachineCache : stateMachineCache,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tsWrappersCache : sWrappersCache,\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\ttypedHostsRegistry : typedHostsRegistry,\t\t\t\t\t\t// Object PropertyCache {defUID : [Components]}\r\n\tnaiveDOMRegistry : naiveDOMRegistry,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tmasterStyleRegistry : masterStyleRegistry,\t\t\t\t\t\t// Object PropertyCache\r\n\tUApendingStyleRegistry : UApendingStyleRegistry,\t\t\t\t\t// Object PropertyCache\r\n\tpendingStyleRegistry : pendingStyleRegistry,\t\t\t\t\t// Object PropertyCache\r\n\trasterShapesRegistry : rasterShapesRegistry,\t\t\t\t\t// Object PropertyCache\r\n\tlayoutNodesRegistry :layoutNodesRegistry,\t\t\t\t\t\t// Object PropertyCache\r\n\ttextNodesRegistry : textNodesRegistry,\t\t\t\t\t\t\t// Object PropertyCache\r\n\tflexCtxRegistry : flexCtxRegistry,\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\tlayoutCallbacksRegistry : layoutCallbacksRegistry,\t\t\t\t// Object PropertyCache\r\n\tfontSizeBuffersCache : fontSizeBuffersCache,\t\t\t\t\t\t\t\t\t// Object PropertyCache\r\n\tcaches : caches,\t\t\t\t\t\t\t\t\t\t\t\t// Object {prop : PropertyCache}\r\n\tnodesRegistry : nodesRegistry,\r\n\tviewsRegistry : viewsRegistry,\r\n\tdataStoreRegistry : dataStoreRegistry,\r\n\tpropsAreArray : propsAreArray,\r\n\treactivityQueries : reactivityQueries,\r\n\teventQueries : eventQueries,\r\n\tpropsArePrimitives : propsArePrimitives,\r\n\tdefinitionsCache : new ComponentDefCache(),\r\n\tattributesModel : PropFactory,\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tstatesModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tpropsModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tstreamsModel : PropFactory,\t\t\t\t\t\t\t\t\t\t// Object AbstractProp\r\n\tTaskDefinition : TaskDefinitionModel,\t\t\t\t\t\t\t// Object TaskDefinition\r\n\tPublisherDefinition : PublisherDefinitionModel,\t\t\t\t\t// Object PublisherDefinition\r\n\toptionsModel : OptionsListModel,\t\t\t\t\t\t\t\t// Object OptionsList\r\n\t// \"host\" key catch the special condition and should always be flat (\"artificial\" deepening of flat defs is handled in the factory function)\r\n\thostModel : SingleLevelComponentDefModel,\t\t\t\t\t\t// Object SingleLevelComponentDef\r\n\t// \"numericaly indexed\" keys (in an array) catch the HierarchicalComponentDefModel\r\n\tsubSectionsModel : HierarchicalComponentDefModel,\t\t\t\t// Array [HierarchicalComponentDefModel]\r\n\tmembersModel : HierarchicalComponentDefModel,\t\t\t\t\t// Array [HierarchicalComponentDefModel]\r\n\tlist : ComponentListDefModel,\r\n\treactOnParentModel : ReactivityQueryModel,\t\t\t\t\t\t// Object ReactivityQueryList\r\n\treactOnSelfModel : ReactivityQueryModel,\t\t\t\t\t\t// Object ReactivityQueryList\r\n\tsubscribeOnParentModel : EventSubscriptionModel,\t\t\t\t// Object EventSubscriptionsList\r\n\tsubscribeOnChildModel : EventSubscriptionModel,\t\t\t\t\t// Object EventSubscriptionsList\r\n\tsubscribeOnSelfModel : EventSubscriptionModel,\t\t\t\t\t// Object EventSubscriptionsList\r\n\tcreateSimpleComponentDef : HierarchicalComponentDefModel,\t\t// Object HierarchicalComponentDef\r\n\tsetAcceptsProp : setAcceptsProp,\r\n\tUIDGenerator : UIDGenerator.UIDGenerator,\r\n\tStyleUIDGenerator : UIDGenerator.StyleUIDGenerator,\r\n\tDefUIDGenerator : UIDGenerator.DefUIDGenerator,\r\n//\tdebugFlexCtx : {}\r\n});\r\n\r\n\r\n\r\nmodule.exports = exportedObjects;\r\n\r\n",
    "\"use strict\";\n/**\r\n * @factory UIDGenerator\r\n * \r\n */\r\n\r\nvar Generator = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGenerator.prototype.newUID = function() {\r\n\treturn (this.nextUID++).toString();\r\n}\r\n\r\n\r\n\r\n\r\nvar GeneratorForStyles = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGeneratorForStyles.prototype.newUID = function() {\r\n\treturn 'Style_' + (this.nextUID++).toString();\r\n}\r\n\r\n\r\n\r\n\r\nvar GeneratorForDefs = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGeneratorForDefs.prototype.newUID = function() {\r\n\treturn 'Def_' + (this.nextUID++).toString();\r\n}\r\n\r\n\r\n\r\n\r\nvar GeneratorForLayoutNodes = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGeneratorForLayoutNodes.prototype.newUID = function() {\r\n\treturn (this.nextUID++).toString();\r\n}\r\n\r\nGeneratorForLayoutNodes.prototype.resetCursor = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\n\r\n\r\nvar GeneratorForTweens = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGeneratorForTweens.prototype.newUID = function() {\r\n\treturn (this.nextUID++).toString();\r\n}\r\n\r\nGeneratorForTweens.prototype.resetCursor = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\n\r\n\r\n\r\nvar GeneratorFor16bitsInt = function() {\r\n\tthis.nextUID = 0;\r\n}\r\n\r\nGeneratorFor16bitsInt.prototype.newUID = function() {\r\n\treturn [++this.nextUID & 0x00FF, (this.nextUID & 0x0000FF00) >> 8] ;\r\n}\r\n\r\nGeneratorFor16bitsInt.prototype.intFromNumber = function(number) {\r\n\treturn [number & 0x00FF, (number & 0x0000FF00) >> 8] ;\r\n}\r\n\r\nGeneratorFor16bitsInt.prototype.numberFromInt = function(int16AsArray) {\r\n\treturn int16AsArray[0] | (int16AsArray[1] << 8) ;\r\n}\r\n\r\n\r\n\r\n\r\nmodule.exports =  {\r\n\tUIDGenerator : new Generator(),\r\n\tStyleUIDGenerator : new GeneratorForStyles(),\r\n\tDefUIDGenerator : new GeneratorForDefs(),\r\n\tNodeUIDGenerator : new GeneratorForLayoutNodes(),\r\n\tTweenUIDGenerator : GeneratorForTweens,\r\n\tGeneratorFor16bitsInt : new GeneratorFor16bitsInt()\r\n}",
    "\"use strict\";\n/**\r\n * @helpers _functionalStyleHelpers\r\n */\r\n\r\n\r\nfunction noOp() {}\r\n\r\n\r\nfunction falseCombinator() {\r\n\treturn false;\r\n}\r\n\r\nfunction zeroOrOneCombinator(value) {\r\n\treturn +(value >= 0) || 0;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tnoOp : noOp,\r\n\tfalseCombinator : falseCombinator,\r\n\tzeroOrOneCombinator : zeroOrOneCombinator\r\n}",
    "\"use strict\";\n/**\r\n * @mixin elementConstructorDecorator_HSD\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\n\r\nvar elementConstructorDecorator_HSD = {}\r\n\r\nelementConstructorDecorator_HSD['Hyphen-Star-Dash'] = {\r\n\t\tdecorateAttributes : function (nodeName, componentAttributes) {\r\n\t\t\t\r\n\t\t\tvar titleAttr;\r\n\t\t\tif (!(titleAttr = componentAttributes.findObjectByKey('title')) || typeof titleAttr['title'] !== 'string')\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tvar labelAttr, attrName, trim;\t\t\t\r\n\t\t\tvar trim = (titleAttr && typeof titleAttr['title'] === 'string' && titleAttr['title'].indexOf('-') === 0) || false;\r\n\t\t\t\r\n\t\t\t// what to do whit existing attributes : not clear.\r\n\t\t\t// seems this update syntax shall respect the type : test it\r\n//\t\t\tcomponentAttributes.forEach(function(attr) {\r\n//\t\t\t\tattrName = attr.getName();\r\n//\t\t\t\tswitch(attrName) {\r\n//\t\t\t\t\tcase 'label' :\r\n//\t\t\t\t\t\tlabelAttr = attr['label'] = this.labelDecorator(titleAttr['title'], trim);\r\n//\t\t\t\t\t\tbreak;\r\n//\t\t\t\t\tcase 'id' :\r\n//\t\t\t\t\t\tattr['id'] = this.IdDecorator(attr['id'], titleAttr['title'], trim);\r\n//\t\t\t\t\t\tbreak;\r\n//\t\t\t\t\t}\r\n//\r\n//\t\t\t}, this);\r\n\t\t\t\r\n\t\t\tif (!(labelAttr = componentAttributes.findObjectByKey('label')))\r\n\t\t\t\tcomponentAttributes.push(new TypeManager.attributesModel({label : (labelAttr = this.labelDecorator(titleAttr['title'], trim))}));\r\n\t\t\t\r\n\t\t\t// CAUTION: don't double-decorate the id\r\n\t\t\t// Here we'd like to rely on a existing id if it's present, but have short-circuited that option for now\r\n\t\t\tcomponentAttributes.push(new TypeManager.attributesModel({id : this.IdDecorator('', titleAttr['title'], trim)}));\r\n\t\t\t\r\n\t\t\t// clean title completely\r\n\t\t\ttitleAttr['title'] = this.titleDecorator(titleAttr['title'], trim);\r\n\t\t\t\r\n\t\t\t// set a name & a placeholder on input nodes\r\n\t\t\tif (nodeName && nodeName.toLowerCase().match(/input|smart-input/)) {\r\n\t\t\t\tcomponentAttributes.push(new TypeManager.attributesModel({name : this.nameDecorator(titleAttr['title'])}));\r\n\t\t\t\tcomponentAttributes.push(new TypeManager.attributesModel({placeholder : this.placeHolderDecorator(labelAttr)}));\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tlabelDecorator : function (title, trim) {\r\n\t\t\tif (trim)\r\n\t\t\t\treturn title.replace(/_/g, ' ').slice(1);\r\n\t\t\telse\r\n\t\t\t\treturn title.replace(/_/g, ' ');\r\n\t\t},\r\n\t\tIdDecorator : function (id, title, trim) {\r\n\t\t\tif (id && trim)\r\n\t\t\t\treturn id + title;\r\n\t\t\telse\r\n\t\t\t\treturn trim ? title.slice(1) : title.slice(0);\r\n\t\t},\r\n\t\ttitleDecorator : function (title, trim) {\r\n\t\t\tif (trim)\r\n\t\t\t\treturn title.slice(1);\r\n\t\t\telse\r\n\t\t\t\treturn title.slice(0);\r\n\t\t},\r\n\t\tnameDecorator : function (title) {\r\n\t\t\treturn title.replace(/-/g, '').toLowerCase();\r\n\t\t},\r\n\t\tplaceHolderDecorator : function (label) {\r\n\t\t\treturn 'Please type a' + (label.toLowerCase().match(/^[aeio]/) ? 'n ' : ' ') + label + '...';\r\n\t\t}\r\n}\r\n\r\nmodule.exports = elementConstructorDecorator_HSD;",
    "\"use strict\";\n/**\r\n * @mixin elementDecorator_Offset\r\n * \r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\n\r\n\r\nvar elementDecorator = {\r\n\toffset: function() {\r\n\r\n\t\tvar rect, win,\r\n\t\t\telem = this;\r\n\r\n\t\t// Get document-relative position by adding viewport scroll to viewport-relative gBCR\r\n\t\trect = elem.getBoundingClientRect();\r\n\t\twin = elem.ownerDocument.defaultView;\r\n\r\n\t\treturn {\r\n\t\t\ttop: rect.top + win.pageYOffset,\r\n\t\t\tleft: rect.left + win.pageXOffset\r\n\t\t};\r\n\t},\r\n\r\n\t// This method will return documentElement in the following cases:\r\n\t// 1) For the element inside the iframe without offsetParent, this method will return\r\n\t//    documentElement of the parent window\r\n\t// 2) For the hidden or detached element\r\n\t// 3) For body or html element, i.e. in case of the html node - it will return itself\r\n\t//\r\n\t// but those exceptions were never presented as a real life use-cases\r\n\t// and might be considered as more preferable results.\r\n\t//\r\n\t// This logic, however, is not guaranteed and can change at any point in the future\r\n\toffsetParentGlobal: function() {\r\n\t\tvar offsetParent = this.offsetParent;\r\n\r\n\t\twhile ( offsetParent && offsetParent.style.position === \"static\" ) {\r\n\t\t\toffsetParent = offsetParent.offsetParent;\r\n\t\t}\r\n\r\n\t\treturn offsetParent || documentElement;\r\n\t}\r\n}\r\n\r\nmodule.exports = elementDecorator;",
    "\"use strict\";\n\n\nObject.defineProperty(Array.prototype, 'populateNewObj', {\n\twritable : true,\n\tvalue : function() {\n\t\tthis.members = 0;\n\t\tthis.sum = 0;\n\t\tthis.sumSquares = 0;\n\t\tthis.md = 0;\n\t\tthis.avg = 0;\n\t\tthis.rms = 0;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'average', {\n\twritable : false,\n\tvalue : function (newValue) {\n\t\tif (typeof this.sum === 'undefined')\n\t\t\tthis.populateNewObj();\n\t\tif (typeof newValue !== 'undefined') {\n\t\t\tthis.push(newValue);\n\t\t\tthis.sum += newValue;\n\t\t}\n\t\tthis.avg = this.sum / (this.members || this.length);\n\t}\n});\nObject.defineProperty(Array.prototype, 'sortNumeric', {\n\twritable : false,\n\tvalue : function () {\n\t\tfunction compareNumbers(a, b) {\n\t\t\treturn a - b;\n\t\t}\n\t\tthis.sort(compareNumbers);\n\t}\n});\nObject.defineProperty(Array.prototype, 'median', {\n\twritable : false,\n\tvalue : function(value) {\n\t\tif (typeof this.md === 'undefined')\n\t\t\tthis.populateNewObj();\n\t\tif (typeof value === 'undefined') {\n\t\t\tthis.sortNumeric();\n\t\t\tthis.md = this[Math.floor(this.length / 2)];\n\t\t}\n\t\telse\n\t\t\tthis.md = value;\n\t}\n});\nObject.defineProperty(Array.prototype, 'rmsCompute', {\n\twritable : false,\n\tvalue : function (newValue) {\n\t\tif (typeof this.sum === 'undefined')\n\t\t\tthis.populateNewObj();\n\t\tif (typeof newValue !== 'undefined') {\n\t\t\tthis.push(newValue);\n\t\t\tthis.sum += newValue;\n\t\t}\n\t\tthis.sumSquares = 0;\n\t\tif (typeof this.avg !== 'undefined') {\n\t\t\tfor (var i = 0; i < this.length; i++) {\n\t\t\t\tthis.sumSquares += Math.pow(this[i] - this.avg, 2);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tconsole.error('Array Exception : rms Compute without defining average value');\n\t\tthis.rms = Math.sqrt(this.sumSquares / this.members || this.length);\n\t}\n});\nObject.defineProperty(Array.prototype, 'intersectOnCommonKey', {\n\twritable : false,\n\tvalue : function (b, commonKey) {\n\t\tvar a = this,\n\t      lastIndex = 0,\n\t      result,\n\t      shortLen, longLen, i, j, k;\n\t\t\n\t    if (b.length > a.length) {\n\t      a = b;\n\t      b = this;\n\t    }\n\t    \n\t    shortLen = b.length;\n\t    longLen = a.length;\n\t    result = Array(shortLen);\n\t    k = 0;\n\t    \n\t    for (i = 0; i < shortLen; i++) {\n\t      for (j = lastIndex; j < longLen; j++) {\n\t        if (b[i][commonKey] == a[j][commonKey]) {\n\t          result[k] = b[i];\n\t          k++;\n\t          lastIndex = j + 1;\n\t          break;\n\t        }\n\t      }\n\t    }\n\t    return result.slice(0, k);\n\t  }\n});\n\nObject.defineProperty(Array.prototype, 'filterOnCommonKey', {\n\twritable : false,\n\tvalue : function (b, commonKey) {\n\t\t\n\t\t\n\t\tvar a = this,\n\t      lastIndex = 0,\n\t      result,\n\t      shortLen, longLen, i, j, k;\n\t\t\n\t    if (b.length > a.length) {\n\t      a = b;\n\t      b = this;\n\t    }\n\t    \n\t    shortLen = b.length;\n\t    longLen = a.length;\n\t    result = Array(shortLen);\n\t    k = 0;\n\t    \n\t    for (i = 0; i < shortLen; i++) {\n\t      if (a.findIndex(function(el) {return el[commonKey] === b[i][commonKey]}) !== -1) {\n\t    \tresult[k] = b[i];\n\t      \tk++;\n\t      }\n\t    }\n\t    return result.slice(0, k);\n\t  }\n});\n\nObject.defineProperty(Array.prototype, 'append', {\n\twritable: false,\n\tvalue : function (array2, position) {\n\t\tvar or = this.slice(0);\n\t\tif (typeof position !== 'undefined') {\n\t\t\tfor (var i = 0, j = 0, l = this.length, L = array2.length; i < l + L; i++) {\n\t\t\t\tif (i > position) {\n\t\t\t\t\tif (j < L) {\n\t\t\t\t\t\tthis[i] = array2[j];\n\t\t\t\t\t\tj++;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis[i] = or[i - L]; \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (typeof position === 'undefined'){\n\t\t\tfor (var j = 0, l = this.length, L = array2.length; j < L; j++) {\n\t\t\t\tthis[j + l] = array2[j];\n\t\t\t}\n\t\t}\n\t}\n});\n\nObject.defineProperty(ArrayBuffer.prototype, 'append', {\n\tenumerable : false, \t// not necessary : false is the default value\n\twritable: false,\n\tvalue : function (buffer2, position, filesize) {\n\t\t\tvar tmp, a, b, ret;\n\t\t\ta = new Uint8Array(this);\n\t\t\tb = new Uint8Array(buffer2);\n\n\t\t\ttry {\n\t\t\t  if (typeof position !== 'undefined') {\n\t\t\t\t  tmp = new Uint8Array(new ArrayBuffer(filesize));\n\t\t\t\t  tmp.set(a, 0);\n\t\t\t\t  tmp.set(b, position);\n\t\t\t  }\n\t\t\t  else {\n\t\t\t\t  tmp = new Uint8Array(this.byteLength + buffer2.byteLength);\n\t\t\t\t  tmp.set(a, 0);\n\t\t\t\t  tmp.set(b, this.byteLength);\n\t\t\t  }\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\t\n\t\t\tret = tmp.buffer.slice(0, tmp.buffer.byteLength);\n\t\t\t\n\t\t\ta = b = tmp = undefined;\n\t\t\t\n\t\t\treturn ret;\n\t\t}\n\t}\n);\n\n\nObject.defineProperty(Array.prototype, 'hasObjectByKey', {\n\tvalue : function(key) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (typeof this[i][key] !== 'undefined' || this[i].hasOwnProperty(key))\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'fastHasObjectByKey', {\n\tvalue : function(key) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (this[i].__proto__.key === key)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'findObjectByKey', {\n\tvalue : function(key) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (typeof this[i][key] !== 'undefined' || this[i].hasOwnProperty(key))\n\t\t\t\treturn this[i];\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'getObjectValueByKey', {\n\tvalue : function(key) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (typeof this[i][key] !== 'undefined' || this[i].hasOwnProperty(key))\n\t\t\t\treturn this[i][key];\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'findObjectByValue', {\n\tvalue : function(prop, value) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (this[i][prop] === value)\n\t\t\t\treturn this[i];\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'indexOfObjectByKey', {\n\tvalue : function(key) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (typeof this[i][key] !== 'undefined' || this[i].hasOwnProperty(key))\n\t\t\t\treturn i;\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'indexOfObjectByValue',  {\n\tvalue : function(prop, value) {\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (this[i][prop] === value)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'findObjectsByValue',  {\n\tvalue : function(prop, value) {\n\t\tvar arr = [];\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (this[i][prop] === value)\n\t\t\t\tarr.push(this[i]);\n\t\t}\n\t\treturn arr.length ? arr : false;\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'findObjectsByPartialValue',  {\n\tvalue : function(prop, value) {\n\t\tvar arr = [];\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tif (this[i][prop].indexOf(value) !== -1)\n\t\t\t\tarr.push(this[i]);\n\t\t}\n\t\treturn arr.length ? arr : false;\n\t}\n});\n\n\n\nObject.defineProperty(Array.prototype, 'recitalClearAll',  {\n\tvalue : function(ComponentGroupObj) {\n\t\tif (ComponentGroupObj) {\n\t\t\tComponentGroupObj.clearAllModules();\n\t\t\tthis.length = 0;\n\t\t}\n\t\telse\n\t\t\treturn false;\n\t}\n});\n\n\n\n\nObject.defineProperty(Array.prototype, '_sortForPropHostingArrayOnArrayIdx',  {\n\tvalue : function(prop, idx) {\n\t\tvar sortedArr = [], register  = new Map(), newArray;\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tsortedArr.push(this[i][prop][idx])\n\t\t\tregister.set(this[i][prop][idx], i);\n\t\t}\n\t\tsortedArr.sort();\n\t\tvar tmpThis = [];\n\t\tfor (let i = 0, l = sortedArr.length; i < l; i++) {\n\t\t\ttmpThis.push(this[register.get(sortedArr[i])][prop].slice(0));\n\t\t}\n\t\tfor (let i = 0, l = this.length; i < l; i++) {\n\t\t\tfor (let k = 0, L = this[i][prop].length; k < L; k++) {\n\t\t\t\tthis[i][prop][k] = tmpThis[i][k];\n\t\t\t}\n\t\t}\n\t}\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nObject.defineProperty(Array.prototype, 'sortOnObjectProp',  {\n\tvalue : function(prop, a, b) {\n\t\tif (typeof a[prop] === 'string')\n\t\t\treturn a[prop].charCodeAt(0) - b[prop].charCodeAt(0)\n\t\telse\n\t\t\treturn parseInt(a[prop], 10) - parseInt(b[prop], 10);\n\t}\n});\n\nObject.defineProperty(Array.prototype, 'inverseSortOnObjectProp',  {\n\tvalue : function(prop, a, b) {\n\t\tif (typeof a[prop] === 'string')\n\t\t\treturn b[prop].charCodeAt(0) - a[prop].charCodeAt(0)\n\t\telse\n\t\t\treturn parseInt(b[prop], 10) - parseInt(a[prop], 10);\n\t}\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nObject.defineProperty(ArrayBuffer.prototype, 'bufferToString', {\n\twritable : false,\n\tvalue : function (strLength) {\n\t\tvar tArray;\n\t\tif (strLength) {\n\t\t\ttArray = new Uint8Array(this, 0, strLength);\n\t\t}\n\t\telse {\n\t\t\ttArray = new Uint8Array(this);\n\t\t\tfor(var i = 0, l = this.byteLength; i < l; i++) {\n\t\t\t\tif (tArray[i] === 0) {\n\t\t\t\t\ttArray = tArray.slice(0, i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t//\t\t\tstr += String.fromCharCode(tArray[i]);\n\t\t\t}\n\t//\t\treturn str;\n\t\t}\n//\t\tconsole.log(Array.prototype.slice.call(tArray));\n\t\treturn String.fromCharCode(...Array.prototype.slice.call(tArray));\n\t}\n});\n\nObject.defineProperty(Uint8Array.prototype, 'bufferToString', {\n\twritable : false,\n\tvalue : function (strLength) {\n\t\tif (strLength) {\n\t\t\treturn String.fromCharCode(...Array.prototype.slice.call(this.slice(0, strLength)));\n\t\t}\n\t\telse {\n\t\t\tvar tArray = this;\n\t\t\tfor(var i = 0, l = this.byteLength; i < l; i++) {\n\t\t\t\tif (this[i] === 0) {\n\t\t\t\t\ttArray = this.slice(0, i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn String.fromCharCode(...Array.prototype.slice.call(tArray));\n\t\t}\n\t}\n});\n\nObject.defineProperty(Uint8Array.prototype, 'bufferToPartialString', {\n\twritable : false,\n\tvalue : function (startIdx, strLength) {\n\t\tif (strLength) {\n\t\t\treturn String.fromCharCode(...Array.prototype.slice.call(this.slice(startIdx, startIdx + strLength)));\n\t\t}\n\t\telse {\n\t\t\tvar tArray = this;\n\t\t\tfor(var i = startIdx, l = this.byteLength; i < l; i++) {\n\t\t\t\tif (this[i] === 0) {\n\t\t\t\t\ttArray = this.slice(startIdx, i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn String.fromCharCode(...Array.prototype.slice.call(tArray));\n\t\t}\n\t}\n});\n\n\n\n\n\nArray.mergeSort = function(arr,l, r, mergeFunction){\n\tif (typeof mergeFunction === 'undefined')\n\t\tmergeFunction = merge;\n    if(l>=r){\n        return;\n    }\n    var m =l+ parseInt((r-l)/2);\n    mergeSort(arr,l,m);\n    mergeSort(arr,m+1,r);\n    merge(arr,l,m,r);\n}\n\n// JavaScript program for Merge Sort\n \n// Merges two subarrays of arr[].\n// First subarray is arr[l..m]\n// Second subarray is arr[m+1..r]\nfunction merge(arr, l, m, r)\n{\n    var n1 = m - l + 1;\n    var n2 = r - m;\n \n    // Create temp arrays\n    var L = new Array(n1);\n    var R = new Array(n2);\n \n    // Copy data to temp arrays L[] and R[]\n    for (var i = 0; i < n1; i++)\n        L[i] = arr[l + i];\n    for (var j = 0; j < n2; j++)\n        R[j] = arr[m + 1 + j];\n \n    // Merge the temp arrays back into arr[l..r]\n \n    // Initial index of first subarray\n    var i = 0;\n \n    // Initial index of second subarray\n    var j = 0;\n \n    // Initial index of merged subarray\n    var k = l;\n \n    while (i < n1 && j < n2) {\n        if (L[i] <= R[j]) {\n            arr[k] = L[i];\n            i++;\n        }\n        else {\n            arr[k] = R[j];\n            j++;\n        }\n        k++;\n    }\n \n    // Copy the remaining elements of\n    // L[], if there are any\n    while (i < n1) {\n        arr[k] = L[i];\n        i++;\n        k++;\n    }\n \n    // Copy the remaining elements of\n    // R[], if there are any\n    while (j < n2) {\n        arr[k] = R[j];\n        j++;\n        k++;\n    }\n}\n \n// l is for left index and r is\n// right index of the sub-array\n// of arr to be sorted\nArray.mergeSort = function(arr,l, r, mergeFunction){\n\tif (typeof mergeFunction === 'undefined')\n\t\tmergeFunction = merge;\n    if(l>=r){\n        return;\n    }\n    var m =l+ parseInt((r-l)/2);\n    mergeSort(arr,l,m);\n    mergeSort(arr,m+1,r);\n    merge(arr,l,m,r);\n}\n",
    "\"use strict\";\nObject.defineProperty(Boolean.prototype, 'tryParse', {\r\n\tvalue : function(val) {\r\n//\t\tconsole.log('tryParse', typeof val);\r\n\t\tif (typeof val !== 'string')\r\n\t\t\treturn val;\r\n\t\telse {\r\n\t\t\tif (val === 'false')\r\n\t\t\t\treturn false;\r\n\t\t\telse if (val === 'true')\r\n\t\t\t\treturn true;\r\n\t\t\telse\r\n\t\t\t\treturn val;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nBoolean.tryParse = Boolean.prototype.tryParse;",
    "\"use strict\";\n/**\r\n * Method sortByPropName\r\n * \r\n * returns Array(obj[propNameA], obj[propNameB], obj[propNameC], etc.)\r\n */\r\nObject.defineProperty(Object.prototype, 'sortSelfByPropName', {\r\n\twritable : false,\r\n\tvalue : function () {\r\n\t\tvar keys = Object.keys(this).sort();\r\n\r\n\t\tvar newObj = {}; \r\n\t\tfor(var i = 0, l = keys.length; i < l; i++) {\r\n\t\t\tnewObj[keys[i]] = this[keys[i]];\r\n\t\t}\r\n\t\treturn newObj;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(Object.prototype, 'sortObjectByPropName', {\r\n\tvalue : function (obj) {\r\n\t\tvar arr = Object.keys(obj).sort(), newObj = {};\r\n\t\tfor (var key in arr) {\r\n\t\t\tnewObj[arr[key]] = obj[arr[key]];\r\n\t\t}\r\n\t\treturn newObj;\t\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n// As the Array ctor inherits from the Object ctor,\r\n// any method present on Object.prototype should be available on Array\r\nObject.defineProperty(Object.prototype, 'toDebugString', {\r\n\tvalue : function() {\r\n\t\treturn JSON.stringify(Object.fromEntries(Object.entries(this)));\r\n\t}\r\n});\r\n\r\n\r\n!function(Object, getPropertyDescriptor){\r\n  // (C) WebReflection - Mit Style License\r\n  if (!(getPropertyDescriptor in Object)) {\r\n    var getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\r\n    Object[getPropertyDescriptor] = function getPropertyDescriptor(o, name) {\r\n      var proto = o, descriptor;\r\n      while (proto && !(\r\n        descriptor = getOwnPropertyDescriptor(proto, name))\r\n      ) proto = proto.__proto__;\r\n      return descriptor;\r\n    };\r\n  }\r\n}(Object, \"getPropertyDescriptor\");\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "\"use strict\";\nRegExp.escapeLitteral = /[-\\/\\\\^$*+?.()|[\\]{}]/g;\r\n\r\nRegExp.escape= function(s) {\r\n    return s.replace(this.escapeLitteral, '\\\\$&');\r\n};\r\nRegExp.protect= function(s) {\r\n\treturn s.replace(/\\\\/g, '\\\\\\\\');\r\n};",
    "\"use strict\";\n\nObject.defineProperty(String.prototype, 'escapeRegExp', {\n\tenumerable : false,\n\tconfigurable : false,\n\twritable : false,\n\tvalue : function () {\n\t\treturn this.replace(/[.*+\\-?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n\t}\n});\n\n\nObject.defineProperty(String.prototype, 'splice', {\n\tenumerable : false,\n\tconfigurable : false,\n\twritable : false,\n\tvalue : function (index, count, add) {\n\t\t// We cannot pass negative indexes directly to the 2nd slicing operation.\n\t\tif (index < 0) {\n\t\t\tindex = this.length + index;\n\t\t\tif (index < 0) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t}\n\t\n\t\treturn this.slice(0, index) + (add || '') + this.slice(index + count);\n\t}\n});\nfunction padNumber(n, width, z) {\n  z = String(z) || '0';\n  n = n + '';\n  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n}\n\n//https://github.com/uxitten/polyfill/blob/master/string.polyfill.js\n//https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart\nif (!String.prototype.padStart) {\n\tObject.defineProperty(String.prototype, 'padStart', {\n\t\t\tvalue : function padStart(targetLength,padString) {\n\t\t\t\t\t     targetLength = targetLength>>0; //floor if number or convert non-number to 0;\n\t\t\t\t\t     padString = String(padString || ' ');\n\t\t\t\t\t     if (this.length > targetLength) {\n\t\t\t\t\t         return String(this);\n\t\t\t\t\t     }\n\t\t\t\t\t     else {\n\t\t\t\t\t         targetLength = targetLength-this.length;\n\t\t\t\t\t         if (targetLength > padString.length) {\n\t\t\t\t\t             padString += padString.repeat(targetLength/padString.length); //append to original to ensure we are longer than needed\n\t\t\t\t\t         }\n\t\t\t\t\t         return padString.slice(0,targetLength) + String(this);\n\t\t\t\t\t     }\n\t\t\t\t\t },\n\t\t\t\t\tenumerable : false,\n\t\t\t\t\twritable : false,\n\t\t\t\t\tconfigurable : false\n\t\t\t\t}\n\t);\n}\n\nObject.defineProperty(String.prototype, 'dromedarToHyphens', { \t\t\t\t\t\t// accepts camel & dromedar\n\tvalue : function() {\n\t\t\t\treturn this.replace(/[A-Z]/g, function(match, offset, str) {\n\t\t\t\t\treturn (offset > 0 ? '-' : '') + String(match).toLowerCase() \t// accept camel & dromedar\n\t\t\t\t});\n\t\t\t},\n\t\t\tenumerable : false,\n\t\t\twritable : false,\n\t\t\tconfigurable : false\n\t}\n);\n\nObject.defineProperty(String.prototype, 'hyphensToDromedar', {\n\tvalue : function() {\n\t\t\t\treturn this.replace(/\\-(\\w)/g, function(match, p1, offset, str) {\n//\t\t\t\t\treturn (offset > 0 ? p1.toUpperCase() : '');\n\t\t\t\t\treturn p1.toUpperCase();\n\t\t\t\t});\n\t\t\t},\n\t\t\tenumerable : false,\n\t\t\twritable : false,\n\t\t\tconfigurable : false\n\t}\n);\n\nObject.defineProperty(String.prototype, 'capitalizeFirstChar', {\n\tvalue : function() {\n\t\treturn this.slice(0, 1).toUpperCase() + this.slice(1).toLowerCase();\n\t}\n});\n\nObject.defineProperty(String.prototype, 'lowerCaseFirstChar', {\n\tvalue : function() {\n\t\treturn this.slice(0, 1).toLowerCase() + this.slice(1);\n\t}\n});\n\nObject.defineProperty(String.prototype, 'hexEncode', {\n\tvalue : function(){\n\t\t\t\tvar hex, i;\n\t\t\t\t\n\t\t\t\tvar result = \"\";\n\t\t\t\tfor (i = 0; i < this.length; i++) {\n\t\t\t\t  hex = this.charCodeAt(i).toString(16);\n\t\t\t\t  result += (\"000\"+hex).slice(-4) + ' ';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn result\n\t\t\t},\n\t\t\tenumerable : false,\n\t\t\twritable : false,\n\t\t\tconfigurable : false\n\t\t\t}\n);\n\nObject.defineProperty(String.prototype, 'indentOnXMLTags', {\n\tvalue : function(){\n\t\t\t\tvar lineCounter = 0; depthCounter = -1, returnedString = '', d = 0, indentChars = '';\n\t\t\t\tfor(var i = 0, l = this.length; i < l; i++) {\n\t\t\t\t\td = 0, indentChars = '';\n\t\t\t\t\tif (this.charAt(i) === '<') {\n\t\t\t\t\t\tif (this.charAt(i + 1) !== '/')\n\t\t\t\t\t\t\tdepthCounter++;\n\t\t\t\t\t\t\n\t\t\t\t\t\tindentChars += '\\n';\n\t\t\t\t\t\tfor(d; d < depthCounter; d++) {\n\t\t\t\t\t\t\tindentChars += '\\t';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturnedString += indentChars + this.charAt(i);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (this.charAt(i + 1) === '/')\n\t\t\t\t\t\t\tdepthCounter--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.charAt(i) === '>') {\n\t\t\t\t\t\tif (this.charAt(i + 1) !== '<')\n\t\t\t\t\t\t\tindentChars += '\\n';\n\t\t\t\t\t\tfor(d; d < depthCounter + 1; d++) {\n\t\t\t\t\t\t\tindentChars += '\\t';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturnedString += this.charAt(i) + indentChars;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturnedString += this.charAt(i)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn returnedString;\n\t\t\t},\n\t\t\tenumerable : false,\n\t\t\twritable : false,\n\t\t\tconfigurable : false\n\t\t\t}\n);\n\nObject.defineProperty(String.prototype, 'nbsp2ws', {\n\tvalue : function(){\n\t\treturn this.replace(/&nbsp;/g, ' ');\n\t},\n\tenumerable : false,\n\twritable : false,\n\tconfigurable : false\n\t}\n);\nObject.defineProperty(String.prototype, 'ws2nbsp', {\n\tvalue : function(){\n\t\treturn this.replace(/ /g, '&nbsp;');\n\t},\n\tenumerable : false,\n\twritable : false,\n\tconfigurable : false\n\t}\n);\n\nObject.defineProperty(String.prototype, 'getNcharsAsCharArray', {\n\tvalue : function(length, offset) {\n\t\tif (offset > this.length) {\n\t\t\toffset = 0;\n\t\t\tlength = this.length;\n\t\t}\n\t\telse if ((offset + length) > this.length) {\n\t\t\tlength = this.length - offset;\n\t\t}\n//\t\t\tMath.max(0, this.length - offset);\n\t\tvar i = 0, ret = [];\n\t\twhile (i < length) {\n\t\t\tret.push(this[offset + i]);\n\t\t\ti++;\n\t\t}\n\t\treturn ret;\n\t}\n});\n\nObject.defineProperty(String.prototype, 'getNcharsAsCharCodesArray', {\n\tvalue : function(length, offset) {\n//\t\tconsole.log(offset, this.length, this, offset >= this.length);\n\t\tif (offset >= this.length) {\n\t\t\toffset = 0;\n\t\t\tlength = this.length < length ? this.length : length;\n\t\t}\n\t\telse if ((offset + length) > this.length) {\n\t\t\t// Avoid capturing only one char...\n\t\t\tif ((offset + length) > (this.length - (length - 1))) {\n\t\t\t\toffset = 0;\n\t\t\t\tlength = this.length < length ? this.length : length;\n\t\t\t}\n\t\t\telse\n\t\t\t\tlength = this.length - offset;\n\t\t}\n//\t\t\tMath.max(0, this.length - offset);\n\t\tvar i = offset, end = i + length, ret = [];\n//\t\tconsole.log(i, end);\n\t\twhile (i < end) {\n//\t\t\tconsole.log(this[i]);\n\t\t\tret.push(this.charCodeAt(i));\n\t\t\ti++;\n\t\t}\n//\t\tconsole.log(ret);\n\t\treturn [offset, ret];\n\t}\n});\n\n// Source: http://www.antiyes.com/jquery-blink-plugin\n//http://www.antiyes.com/jquery-blink/jquery-blink.js\n//(function($) {\n// $.fn.blink = function(options) {\n//     var defaults = {\n//         delay: 113,\n//         iterations : 3\n//     };\n//     var options = $.extend(defaults, options);\n//\n//     return this.each(function() {\n//         var obj = $(this), inter, iterations = 0;\n//         inter = setInterval(function() {\n//             if ($(obj).css(\"visibility\") == \"visible\") {\n//                 $(obj).css('visibility', 'hidden');\n//             }\n//             else {\n//                 $(obj).css('visibility', 'visible');\n//             }\n//             iterations++;\n//             if (iterations / 2 === options.iterations)\n//            \t clearInterval(inter);\n//         }, options.delay);\n//     });\n// }\n//}(jQuery)) ",
    "\"use strict\";\n/*\r\n * Hamster.js v1.1.2\r\n * (c) 2013 Monospaced http://monospaced.com\r\n * License: MIT\r\n */\r\n\r\n(function(window, document){\r\n'use strict';\r\n\r\n/**\r\n * Hamster\r\n * use this to create instances\r\n * @returns {Hamster.Instance}\r\n * @constructor\r\n */\r\nvar Hamster = function(element) {\r\n  return new Hamster.Instance(element);\r\n};\r\n\r\n// default event name\r\nHamster.SUPPORT = 'wheel';\r\n\r\n// default DOM methods\r\nHamster.ADD_EVENT = 'addEventListener';\r\nHamster.REMOVE_EVENT = 'removeEventListener';\r\nHamster.PREFIX = '';\r\n\r\n// until browser inconsistencies have been fixed...\r\nHamster.READY = false;\r\n\r\nHamster.Instance = function(element){\r\n  if (!Hamster.READY) {\r\n    // fix browser inconsistencies\r\n    Hamster.normalise.browser();\r\n\r\n    // Hamster is ready...!\r\n    Hamster.READY = true;\r\n  }\r\n\r\n  this.element = element;\r\n\r\n  // store attached event handlers\r\n  this.handlers = [];\r\n\r\n  // return instance\r\n  return this;\r\n};\r\n\r\n/**\r\n * create new hamster instance\r\n * all methods should return the instance itself, so it is chainable.\r\n * @param   {HTMLElement}       element\r\n * @returns {Hamster.Instance}\r\n * @constructor\r\n */\r\nHamster.Instance.prototype = {\r\n  /**\r\n   * bind events to the instance\r\n   * @param   {Function}    handler\r\n   * @param   {Boolean}     useCapture\r\n   * @returns {Hamster.Instance}\r\n   */\r\n  wheel: function onEvent(handler, useCapture){\r\n    Hamster.event.add(this, Hamster.SUPPORT, handler, useCapture);\r\n\r\n    // handle MozMousePixelScroll in older Firefox\r\n    if (Hamster.SUPPORT === 'DOMMouseScroll') {\r\n      Hamster.event.add(this, 'MozMousePixelScroll', handler, useCapture);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * unbind events to the instance\r\n   * @param   {Function}    handler\r\n   * @param   {Boolean}     useCapture\r\n   * @returns {Hamster.Instance}\r\n   */\r\n  unwheel: function offEvent(handler, useCapture){\r\n    // if no handler argument,\r\n    // unbind the last bound handler (if exists)\r\n    if (handler === undefined && (handler = this.handlers.slice(-1)[0])) {\r\n      handler = handler.original;\r\n    }\r\n\r\n    Hamster.event.remove(this, Hamster.SUPPORT, handler, useCapture);\r\n\r\n    // handle MozMousePixelScroll in older Firefox\r\n    if (Hamster.SUPPORT === 'DOMMouseScroll') {\r\n      Hamster.event.remove(this, 'MozMousePixelScroll', handler, useCapture);\r\n    }\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nHamster.event = {\r\n  /**\r\n   * cross-browser 'addWheelListener'\r\n   * @param   {Instance}    hamster\r\n   * @param   {String}      eventName\r\n   * @param   {Function}    handler\r\n   * @param   {Boolean}     useCapture\r\n   */\r\n  add: function add(hamster, eventName, handler, useCapture){\r\n    // store the original handler\r\n    var originalHandler = handler;\r\n\r\n    // redefine the handler\r\n    handler = function(originalEvent){\r\n\r\n      if (!originalEvent) {\r\n        originalEvent = window.event;\r\n      }\r\n\r\n      // create a normalised event object,\r\n      // and normalise \"deltas\" of the mouse wheel\r\n      var event = Hamster.normalise.event(originalEvent),\r\n          delta = Hamster.normalise.delta(originalEvent);\r\n\r\n      // fire the original handler with normalised arguments\r\n      return originalHandler(event, delta[0], delta[1], delta[2]);\r\n\r\n    };\r\n\r\n    // cross-browser addEventListener\r\n    hamster.element[Hamster.ADD_EVENT](Hamster.PREFIX + eventName, handler, useCapture || false);\r\n\r\n    // store original and normalised handlers on the instance\r\n    hamster.handlers.push({\r\n      original: originalHandler,\r\n      normalised: handler\r\n    });\r\n  },\r\n\r\n  /**\r\n   * removeWheelListener\r\n   * @param   {Instance}    hamster\r\n   * @param   {String}      eventName\r\n   * @param   {Function}    handler\r\n   * @param   {Boolean}     useCapture\r\n   */\r\n  remove: function remove(hamster, eventName, handler, useCapture){\r\n    // find the normalised handler on the instance\r\n    var originalHandler = handler,\r\n        lookup = {},\r\n        handlers;\r\n    for (var i = 0, len = hamster.handlers.length; i < len; ++i) {\r\n      lookup[hamster.handlers[i].original] = hamster.handlers[i];\r\n    }\r\n    handlers = lookup[originalHandler];\r\n    handler = handlers.normalised;\r\n\r\n    // cross-browser removeEventListener\r\n    hamster.element[Hamster.REMOVE_EVENT](Hamster.PREFIX + eventName, handler, useCapture || false);\r\n\r\n    // remove original and normalised handlers from the instance\r\n    for (var h in hamster.handlers) {\r\n      if (hamster.handlers[h] == handlers) {\r\n        hamster.handlers.splice(h, 1);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * these hold the lowest deltas,\r\n * used to normalise the delta values\r\n * @type {Number}\r\n */\r\nvar lowestDelta,\r\n    lowestDeltaXY;\r\n\r\nHamster.normalise = {\r\n  /**\r\n   * fix browser inconsistencies\r\n   */\r\n  browser: function normaliseBrowser(){\r\n    // detect deprecated wheel events\r\n    if (!('onwheel' in document || document.documentMode >= 9)) {\r\n      Hamster.SUPPORT = document.onmousewheel !== undefined ?\r\n                        'mousewheel' : // webkit and IE < 9 support at least \"mousewheel\"\r\n                        'DOMMouseScroll'; // assume remaining browsers are older Firefox\r\n    }\r\n\r\n    // detect deprecated event model\r\n    if (!window.addEventListener) {\r\n      // assume IE < 9\r\n      Hamster.ADD_EVENT = 'attachEvent';\r\n      Hamster.REMOVE_EVENT = 'detachEvent';\r\n      Hamster.PREFIX = 'on';\r\n    }\r\n\r\n  },\r\n\r\n  /**\r\n   * create a normalised event object\r\n   * @param   {Function}    originalEvent\r\n   * @returns {Object}      event\r\n   */\r\n   event: function normaliseEvent(originalEvent){\r\n    var event = {\r\n          // keep a reference to the original event object\r\n          originalEvent: originalEvent,\r\n          target: originalEvent.target || originalEvent.srcElement,\r\n          type: 'wheel',\r\n          deltaMode: originalEvent.type === 'MozMousePixelScroll' ? 0 : 1,\r\n          deltaX: 0,\r\n          deltaZ: 0,\r\n          preventDefault: function(){\r\n            if (originalEvent.preventDefault) {\r\n              originalEvent.preventDefault();\r\n            } else {\r\n              originalEvent.returnValue = false;\r\n            }\r\n          },\r\n          stopPropagation: function(){\r\n            if (originalEvent.stopPropagation) {\r\n              originalEvent.stopPropagation();\r\n            } else {\r\n              originalEvent.cancelBubble = false;\r\n            }\r\n          }\r\n        };\r\n\r\n    // calculate deltaY (and deltaX) according to the event\r\n\r\n    // 'mousewheel'\r\n    if (originalEvent.wheelDelta) {\r\n      event.deltaY = - 1/40 * originalEvent.wheelDelta;\r\n    }\r\n    // webkit\r\n    if (originalEvent.wheelDeltaX) {\r\n      event.deltaX = - 1/40 * originalEvent.wheelDeltaX;\r\n    }\r\n\r\n    // 'DomMouseScroll'\r\n    if (originalEvent.detail) {\r\n      event.deltaY = originalEvent.detail;\r\n    }\r\n\r\n    return event;\r\n  },\r\n\r\n  /**\r\n   * normalise 'deltas' of the mouse wheel\r\n   * @param   {Function}    originalEvent\r\n   * @returns {Array}       deltas\r\n   */\r\n  delta: function normaliseDelta(originalEvent){\r\n    var delta = 0,\r\n      deltaX = 0,\r\n      deltaY = 0,\r\n      absDelta = 0,\r\n      absDeltaXY = 0,\r\n      fn;\r\n\r\n    // normalise deltas according to the event\r\n\r\n    // 'wheel' event\r\n    if (originalEvent.deltaY) {\r\n      deltaY = originalEvent.deltaY * -1;\r\n      delta  = deltaY;\r\n    }\r\n    if (originalEvent.deltaX) {\r\n      deltaX = originalEvent.deltaX;\r\n      delta  = deltaX * -1;\r\n    }\r\n\r\n    // 'mousewheel' event\r\n    if (originalEvent.wheelDelta) {\r\n      delta = originalEvent.wheelDelta;\r\n    }\r\n    // webkit\r\n    if (originalEvent.wheelDeltaY) {\r\n      deltaY = originalEvent.wheelDeltaY;\r\n    }\r\n    if (originalEvent.wheelDeltaX) {\r\n      deltaX = originalEvent.wheelDeltaX * -1;\r\n    }\r\n\r\n    // 'DomMouseScroll' event\r\n    if (originalEvent.detail) {\r\n      delta = originalEvent.detail * -1;\r\n    }\r\n\r\n    // Don't return NaN\r\n    if (delta === 0) {\r\n      return [0, 0, 0];\r\n    }\r\n\r\n    // look for lowest delta to normalize the delta values\r\n    absDelta = Math.abs(delta);\r\n    if (!lowestDelta || absDelta < lowestDelta) {\r\n      lowestDelta = absDelta;\r\n    }\r\n    absDeltaXY = Math.max(Math.abs(deltaY), Math.abs(deltaX));\r\n    if (!lowestDeltaXY || absDeltaXY < lowestDeltaXY) {\r\n      lowestDeltaXY = absDeltaXY;\r\n    }\r\n\r\n    // convert deltas to whole numbers\r\n    fn = delta > 0 ? 'floor' : 'ceil';\r\n    delta  = Math[fn](delta / lowestDelta);\r\n    deltaX = Math[fn](deltaX / lowestDeltaXY);\r\n    deltaY = Math[fn](deltaY / lowestDeltaXY);\r\n\r\n    return [delta, deltaX, deltaY];\r\n  }\r\n};\r\n\r\nif (typeof window.define === 'function' && window.define.amd) {\r\n  // AMD\r\n  window.define('hamster', [], function(){\r\n    return Hamster;\r\n  });\r\n} else if (typeof exports === 'object') {\r\n  // CommonJS\r\n  module.exports = Hamster;\r\n} else {\r\n  // Browser global\r\n  window.Hamster = Hamster;\r\n}\r\n\r\n})(window, window.document);\r\n",
    "\"use strict\";\n/*!\n * validate.js 0.13.1\n * http://validatejs.org/\n * (c) 2013-2015 Nicklas Ansman, 2013 Wrapp\n * validate.js may be freely distributed under the MIT license.\n*/\n\n(function(a,b,c){\"use strict\";var d=function(a,b,c){c=e.extend({},e.options,c);var f=e.runValidations(a,b,c);if(f.some(function(a){return e.isPromise(a.error)}))throw new Error(\"Use validate.async if you want support for promises\");return d.processValidationResults(f,c)},e=d;e.extend=function(a){return[].slice.call(arguments,1).forEach(function(b){for(var c in b)a[c]=b[c]}),a},e.extend(d,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var a=e.format(\"%{major}.%{minor}.%{patch}\",e.version);return e.isEmpty(e.version.metadata)||(a+=\"+\"+e.version.metadata),a}},Promise:\"undefined\"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\\s*$/,runValidations:function(a,b,c){var d,f,g,h,i,j,k,l=[];(e.isDomElement(a)||e.isJqueryElement(a))&&(a=e.collectFormValues(a));for(d in b){g=e.getDeepObjectValue(a,d),h=e.result(b[d],g,a,d,c,b);for(f in h){if(i=e.validators[f],!i)throw k=e.format(\"Unknown validator %{name}\",{name:f}),new Error(k);j=h[f],j=e.result(j,g,a,d,c,b),j&&l.push({attribute:d,value:g,validator:f,globalOptions:c,attributes:a,options:j,error:i.call(i,g,j,d,a,c)})}}return l},processValidationResults:function(a,b){a=e.pruneEmptyErrors(a,b),a=e.expandMultipleErrors(a,b),a=e.convertErrorMessages(a,b);var c=b.format||\"grouped\";if(\"function\"!=typeof e.formatters[c])throw new Error(e.format(\"Unknown format %{format}\",b));return a=e.formatters[c](a),e.isEmpty(a)?void 0:a},async:function(a,b,c){c=e.extend({},e.async.options,c);var d=c.wrapErrors||function(a){return a};c.cleanAttributes!==!1&&(a=e.cleanAttributes(a,b));var f=e.runValidations(a,b,c);return new e.Promise(function(g,h){e.waitForResults(f).then(function(){var i=e.processValidationResults(f,c);i?h(new d(i,c,a,b)):g(a)},function(a){h(a)})})},single:function(a,b,c){return c=e.extend({},e.single.options,c,{format:\"flat\",fullMessages:!1}),e({single:a},{single:b},c)},waitForResults:function(a){return a.reduce(function(a,b){return e.isPromise(b.error)?a.then(function(){return b.error.then(function(a){b.error=a||null})}):a},new e.Promise(function(a){a()}))},result:function(a){var b=[].slice.call(arguments,1);return\"function\"==typeof a&&(a=a.apply(null,b)),a},isNumber:function(a){return\"number\"==typeof a&&!isNaN(a)},isFunction:function(a){return\"function\"==typeof a},isInteger:function(a){return e.isNumber(a)&&a%1===0},isBoolean:function(a){return\"boolean\"==typeof a},isObject:function(a){return a===Object(a)},isDate:function(a){return a instanceof Date},isDefined:function(a){return null!==a&&void 0!==a},isPromise:function(a){return!!a&&e.isFunction(a.then)},isJqueryElement:function(a){return a&&e.isString(a.jquery)},isDomElement:function(a){return!!a&&(!(!a.querySelectorAll||!a.querySelector)&&(!(!e.isObject(document)||a!==document)||(\"object\"==typeof HTMLElement?a instanceof HTMLElement:a&&\"object\"==typeof a&&null!==a&&1===a.nodeType&&\"string\"==typeof a.nodeName)))},isEmpty:function(a){var b;if(!e.isDefined(a))return!0;if(e.isFunction(a))return!1;if(e.isString(a))return e.EMPTY_STRING_REGEXP.test(a);if(e.isArray(a))return 0===a.length;if(e.isDate(a))return!1;if(e.isObject(a)){for(b in a)return!1;return!0}return!1},format:e.extend(function(a,b){return e.isString(a)?a.replace(e.format.FORMAT_REGEXP,function(a,c,d){return\"%\"===c?\"%{\"+d+\"}\":String(b[d])}):a},{FORMAT_REGEXP:/(%?)%\\{([^\\}]+)\\}/g}),prettify:function(a){return e.isNumber(a)?100*a%1===0?\"\"+a:parseFloat(Math.round(100*a)/100).toFixed(2):e.isArray(a)?a.map(function(a){return e.prettify(a)}).join(\", \"):e.isObject(a)?e.isDefined(a.toString)?a.toString():JSON.stringify(a):(a=\"\"+a,a.replace(/([^\\s])\\.([^\\s])/g,\"$1 $2\").replace(/\\\\+/g,\"\").replace(/[_-]/g,\" \").replace(/([a-z])([A-Z])/g,function(a,b,c){return\"\"+b+\" \"+c.toLowerCase()}).toLowerCase())},stringifyValue:function(a,b){var c=b&&b.prettify||e.prettify;return c(a)},isString:function(a){return\"string\"==typeof a},isArray:function(a){return\"[object Array]\"==={}.toString.call(a)},isHash:function(a){return e.isObject(a)&&!e.isArray(a)&&!e.isFunction(a)},contains:function(a,b){return!!e.isDefined(a)&&(e.isArray(a)?a.indexOf(b)!==-1:b in a)},unique:function(a){return e.isArray(a)?a.filter(function(a,b,c){return c.indexOf(a)==b}):a},forEachKeyInKeypath:function(a,b,c){if(e.isString(b)){var d,f=\"\",g=!1;for(d=0;d<b.length;++d)switch(b[d]){case\".\":g?(g=!1,f+=\".\"):(a=c(a,f,!1),f=\"\");break;case\"\\\\\":g?(g=!1,f+=\"\\\\\"):g=!0;break;default:g=!1,f+=b[d]}return c(a,f,!0)}},getDeepObjectValue:function(a,b){if(e.isObject(a))return e.forEachKeyInKeypath(a,b,function(a,b){if(e.isObject(a))return a[b]})},collectFormValues:function(a,b){var c,d,f,g,h,i,j={};if(e.isJqueryElement(a)&&(a=a[0]),!a)return j;for(b=b||{},g=a.querySelectorAll(\"input[name], textarea[name]\"),c=0;c<g.length;++c)if(f=g.item(c),!e.isDefined(f.getAttribute(\"data-ignored\"))){var k=f.name.replace(/\\./g,\"\\\\\\\\.\");i=e.sanitizeFormValue(f.value,b),\"number\"===f.type?i=i?+i:null:\"checkbox\"===f.type?f.attributes.value?f.checked||(i=j[k]||null):i=f.checked:\"radio\"===f.type&&(f.checked||(i=j[k]||null)),j[k]=i}for(g=a.querySelectorAll(\"select[name]\"),c=0;c<g.length;++c)if(f=g.item(c),!e.isDefined(f.getAttribute(\"data-ignored\"))){if(f.multiple){i=[];for(d in f.options)h=f.options[d],h&&h.selected&&i.push(e.sanitizeFormValue(h.value,b))}else{var l=\"undefined\"!=typeof f.options[f.selectedIndex]?f.options[f.selectedIndex].value:\"\";i=e.sanitizeFormValue(l,b)}j[f.name]=i}return j},sanitizeFormValue:function(a,b){return b.trim&&e.isString(a)&&(a=a.trim()),b.nullify!==!1&&\"\"===a?null:a},capitalize:function(a){return e.isString(a)?a[0].toUpperCase()+a.slice(1):a},pruneEmptyErrors:function(a){return a.filter(function(a){return!e.isEmpty(a.error)})},expandMultipleErrors:function(a){var b=[];return a.forEach(function(a){e.isArray(a.error)?a.error.forEach(function(c){b.push(e.extend({},a,{error:c}))}):b.push(a)}),b},convertErrorMessages:function(a,b){b=b||{};var c=[],d=b.prettify||e.prettify;return a.forEach(function(a){var f=e.result(a.error,a.value,a.attribute,a.options,a.attributes,a.globalOptions);return e.isString(f)?(\"^\"===f[0]?f=f.slice(1):b.fullMessages!==!1&&(f=e.capitalize(d(a.attribute))+\" \"+f),f=f.replace(/\\\\\\^/g,\"^\"),f=e.format(f,{value:e.stringifyValue(a.value,b)}),void c.push(e.extend({},a,{error:f}))):void c.push(a)}),c},groupErrorsByAttribute:function(a){var b={};return a.forEach(function(a){var c=b[a.attribute];c?c.push(a):b[a.attribute]=[a]}),b},flattenErrorsToArray:function(a){return a.map(function(a){return a.error}).filter(function(a,b,c){return c.indexOf(a)===b})},cleanAttributes:function(a,b){function c(a,b,c){return e.isObject(a[b])?a[b]:a[b]=!!c||{}}function d(a){var b,d={};for(b in a)a[b]&&e.forEachKeyInKeypath(d,b,c);return d}function f(a,b){if(!e.isObject(a))return a;var c,d,g=e.extend({},a);for(d in a)c=b[d],e.isObject(c)?g[d]=f(g[d],c):c||delete g[d];return g}return e.isObject(b)&&e.isObject(a)?(b=d(b),f(a,b)):{}},exposeModule:function(a,b,c,d,e){c?(d&&d.exports&&(c=d.exports=a),c.validate=a):(b.validate=a,a.isFunction(e)&&e.amd&&e([],function(){return a}))},warn:function(a){\"undefined\"!=typeof console&&console.warn&&console.warn(\"[validate.js] \"+a)},error:function(a){\"undefined\"!=typeof console&&console.error&&console.error(\"[validate.js] \"+a)}}),d.validators={presence:function(a,b){if(b=e.extend({},this.options,b),b.allowEmpty!==!1?!e.isDefined(a):e.isEmpty(a))return b.message||this.message||\"can't be blank\"},length:function(a,b,c){if(e.isDefined(a)){b=e.extend({},this.options,b);var d,f=b.is,g=b.maximum,h=b.minimum,i=b.tokenizer||function(a){return a},j=[];a=i(a);var k=a.length;return e.isNumber(k)?(e.isNumber(f)&&k!==f&&(d=b.wrongLength||this.wrongLength||\"is the wrong length (should be %{count} characters)\",j.push(e.format(d,{count:f}))),e.isNumber(h)&&k<h&&(d=b.tooShort||this.tooShort||\"is too short (minimum is %{count} characters)\",j.push(e.format(d,{count:h}))),e.isNumber(g)&&k>g&&(d=b.tooLong||this.tooLong||\"is too long (maximum is %{count} characters)\",j.push(e.format(d,{count:g}))),j.length>0?b.message||j:void 0):b.message||this.notValid||\"has an incorrect length\"}},numericality:function(a,b,c,d,f){if(e.isDefined(a)){b=e.extend({},this.options,b);var g,h,i=[],j={greaterThan:function(a,b){return a>b},greaterThanOrEqualTo:function(a,b){return a>=b},equalTo:function(a,b){return a===b},lessThan:function(a,b){return a<b},lessThanOrEqualTo:function(a,b){return a<=b},divisibleBy:function(a,b){return a%b===0}},k=b.prettify||f&&f.prettify||e.prettify;if(e.isString(a)&&b.strict){var l=\"^-?(0|[1-9]\\\\d*)\";if(b.onlyInteger||(l+=\"(\\\\.\\\\d+)?\"),l+=\"$\",!new RegExp(l).test(a))return b.message||b.notValid||this.notValid||this.message||\"must be a valid number\"}if(b.noStrings!==!0&&e.isString(a)&&!e.isEmpty(a)&&(a=+a),!e.isNumber(a))return b.message||b.notValid||this.notValid||this.message||\"is not a number\";if(b.onlyInteger&&!e.isInteger(a))return b.message||b.notInteger||this.notInteger||this.message||\"must be an integer\";for(g in j)if(h=b[g],e.isNumber(h)&&!j[g](a,h)){var m=\"not\"+e.capitalize(g),n=b[m]||this[m]||this.message||\"must be %{type} %{count}\";i.push(e.format(n,{count:h,type:k(g)}))}return b.odd&&a%2!==1&&i.push(b.notOdd||this.notOdd||this.message||\"must be odd\"),b.even&&a%2!==0&&i.push(b.notEven||this.notEven||this.message||\"must be even\"),i.length?b.message||i:void 0}},datetime:e.extend(function(a,b){if(!e.isFunction(this.parse)||!e.isFunction(this.format))throw new Error(\"Both the parse and format functions needs to be set to use the datetime/date validator\");if(e.isDefined(a)){b=e.extend({},this.options,b);var c,d=[],f=b.earliest?this.parse(b.earliest,b):NaN,g=b.latest?this.parse(b.latest,b):NaN;return a=this.parse(a,b),isNaN(a)||b.dateOnly&&a%864e5!==0?(c=b.notValid||b.message||this.notValid||\"must be a valid date\",e.format(c,{value:arguments[0]})):(!isNaN(f)&&a<f&&(c=b.tooEarly||b.message||this.tooEarly||\"must be no earlier than %{date}\",c=e.format(c,{value:this.format(a,b),date:this.format(f,b)}),d.push(c)),!isNaN(g)&&a>g&&(c=b.tooLate||b.message||this.tooLate||\"must be no later than %{date}\",c=e.format(c,{date:this.format(g,b),value:this.format(a,b)}),d.push(c)),d.length?e.unique(d):void 0)}},{parse:null,format:null}),date:function(a,b){return b=e.extend({},b,{dateOnly:!0}),e.validators.datetime.call(e.validators.datetime,a,b)},format:function(a,b){(e.isString(b)||b instanceof RegExp)&&(b={pattern:b}),b=e.extend({},this.options,b);var c,d=b.message||this.message||\"is invalid\",f=b.pattern;if(e.isDefined(a))return e.isString(a)?(e.isString(f)&&(f=new RegExp(b.pattern,b.flags)),c=f.exec(a),c&&c[0].length==a.length?void 0:d):d},inclusion:function(a,b){if(e.isDefined(a)&&(e.isArray(b)&&(b={within:b}),b=e.extend({},this.options,b),!e.contains(b.within,a))){var c=b.message||this.message||\"^%{value} is not included in the list\";return e.format(c,{value:a})}},exclusion:function(a,b){if(e.isDefined(a)&&(e.isArray(b)&&(b={within:b}),b=e.extend({},this.options,b),e.contains(b.within,a))){var c=b.message||this.message||\"^%{value} is restricted\";return e.isString(b.within[a])&&(a=b.within[a]),e.format(c,{value:a})}},email:e.extend(function(a,b){b=e.extend({},this.options,b);var c=b.message||this.message||\"is not a valid email\";if(e.isDefined(a))return e.isString(a)&&this.PATTERN.exec(a)?void 0:c},{PATTERN:/^(?:[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i}),equality:function(a,b,c,d,f){if(e.isDefined(a)){e.isString(b)&&(b={attribute:b}),b=e.extend({},this.options,b);var g=b.message||this.message||\"is not equal to %{attribute}\";if(e.isEmpty(b.attribute)||!e.isString(b.attribute))throw new Error(\"The attribute must be a non empty string\");var h=e.getDeepObjectValue(d,b.attribute),i=b.comparator||function(a,b){return a===b},j=b.prettify||f&&f.prettify||e.prettify;return i(a,h,b,c,d)?void 0:e.format(g,{attribute:j(b.attribute)})}},url:function(a,b){if(e.isDefined(a)){b=e.extend({},this.options,b);var c=b.message||this.message||\"is not a valid url\",d=b.schemes||this.schemes||[\"http\",\"https\"],f=b.allowLocal||this.allowLocal||!1,g=b.allowDataUrl||this.allowDataUrl||!1;if(!e.isString(a))return c;var h=\"^(?:(?:\"+d.join(\"|\")+\")://)(?:\\\\S+(?::\\\\S*)?@)?(?:\",i=\"(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff]{2,}))\";if(f?i+=\"?\":h+=\"(?!(?:10|127)(?:\\\\.\\\\d{1,3}){3})(?!(?:169\\\\.254|192\\\\.168)(?:\\\\.\\\\d{1,3}){2})(?!172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})\",h+=\"(?:[1-9]\\\\d?|1\\\\d\\\\d|2[01]\\\\d|22[0-3])(?:\\\\.(?:1?\\\\d{1,2}|2[0-4]\\\\d|25[0-5])){2}(?:\\\\.(?:[1-9]\\\\d?|1\\\\d\\\\d|2[0-4]\\\\d|25[0-4]))|(?:(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*\"+i+\")(?::\\\\d{2,5})?(?:[/?#]\\\\S*)?$\",g){var j=\"\\\\w+\\\\/[-+.\\\\w]+(?:;[\\\\w=]+)*\",k=\"[A-Za-z0-9-_.!~\\\\*'();\\\\/?:@&=+$,%]*\",l=\"data:(?:\"+j+\")?(?:;base64)?,\"+k;h=\"(?:\"+h+\")|(?:^\"+l+\"$)\"}var m=new RegExp(h,\"i\");return m.exec(a)?void 0:c}},type:e.extend(function(a,b,c,d,f){if(e.isString(b)&&(b={type:b}),e.isDefined(a)){var g=e.extend({},this.options,b),h=g.type;if(!e.isDefined(h))throw new Error(\"No type was specified\");var i;if(i=e.isFunction(h)?h:this.types[h],!e.isFunction(i))throw new Error(\"validate.validators.type.types.\"+h+\" must be a function.\");if(!i(a,g,c,d,f)){var j=b.message||this.messages[h]||this.message||g.message||(e.isFunction(h)?\"must be of the correct type\":\"must be of type %{type}\");return e.isFunction(j)&&(j=j(a,b,c,d,f)),e.format(j,{attribute:e.prettify(c),type:h})}}},{types:{object:function(a){return e.isObject(a)&&!e.isArray(a)},array:e.isArray,integer:e.isInteger,number:e.isNumber,string:e.isString,date:e.isDate,\"boolean\":e.isBoolean},messages:{}})},d.formatters={detailed:function(a){return a},flat:e.flattenErrorsToArray,grouped:function(a){var b;a=e.groupErrorsByAttribute(a);for(b in a)a[b]=e.flattenErrorsToArray(a[b]);return a},constraint:function(a){var b;a=e.groupErrorsByAttribute(a);for(b in a)a[b]=a[b].map(function(a){return a.validator}).sort();return a}},d.exposeModule(d,this,a,b,c)}).call(this,\"undefined\"!=typeof exports?exports:null,\"undefined\"!=typeof module?module:null,\"undefined\"!=typeof define?define:null);",
    "\"use strict\";\n!function(n){\"use strict\";function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(n,t,r,e,o,u){return d((u=d(d(t,n),d(e,u)))<<o|u>>>32-o,r)}function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}function g(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}function v(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}function c(n,t){var r,e,o,u;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;for(var c=1732584193,f=-271733879,i=-1732584194,a=271733878,h=0;h<n.length;h+=16)c=l(r=c,e=f,o=i,u=a,n[h],7,-680876936),a=l(a,c,f,i,n[h+1],12,-389564586),i=l(i,a,c,f,n[h+2],17,606105819),f=l(f,i,a,c,n[h+3],22,-1044525330),c=l(c,f,i,a,n[h+4],7,-176418897),a=l(a,c,f,i,n[h+5],12,1200080426),i=l(i,a,c,f,n[h+6],17,-1473231341),f=l(f,i,a,c,n[h+7],22,-45705983),c=l(c,f,i,a,n[h+8],7,1770035416),a=l(a,c,f,i,n[h+9],12,-1958414417),i=l(i,a,c,f,n[h+10],17,-42063),f=l(f,i,a,c,n[h+11],22,-1990404162),c=l(c,f,i,a,n[h+12],7,1804603682),a=l(a,c,f,i,n[h+13],12,-40341101),i=l(i,a,c,f,n[h+14],17,-1502002290),c=g(c,f=l(f,i,a,c,n[h+15],22,1236535329),i,a,n[h+1],5,-165796510),a=g(a,c,f,i,n[h+6],9,-1069501632),i=g(i,a,c,f,n[h+11],14,643717713),f=g(f,i,a,c,n[h],20,-373897302),c=g(c,f,i,a,n[h+5],5,-701558691),a=g(a,c,f,i,n[h+10],9,38016083),i=g(i,a,c,f,n[h+15],14,-660478335),f=g(f,i,a,c,n[h+4],20,-405537848),c=g(c,f,i,a,n[h+9],5,568446438),a=g(a,c,f,i,n[h+14],9,-1019803690),i=g(i,a,c,f,n[h+3],14,-187363961),f=g(f,i,a,c,n[h+8],20,1163531501),c=g(c,f,i,a,n[h+13],5,-1444681467),a=g(a,c,f,i,n[h+2],9,-51403784),i=g(i,a,c,f,n[h+7],14,1735328473),c=v(c,f=g(f,i,a,c,n[h+12],20,-1926607734),i,a,n[h+5],4,-378558),a=v(a,c,f,i,n[h+8],11,-2022574463),i=v(i,a,c,f,n[h+11],16,1839030562),f=v(f,i,a,c,n[h+14],23,-35309556),c=v(c,f,i,a,n[h+1],4,-1530992060),a=v(a,c,f,i,n[h+4],11,1272893353),i=v(i,a,c,f,n[h+7],16,-155497632),f=v(f,i,a,c,n[h+10],23,-1094730640),c=v(c,f,i,a,n[h+13],4,681279174),a=v(a,c,f,i,n[h],11,-358537222),i=v(i,a,c,f,n[h+3],16,-722521979),f=v(f,i,a,c,n[h+6],23,76029189),c=v(c,f,i,a,n[h+9],4,-640364487),a=v(a,c,f,i,n[h+12],11,-421815835),i=v(i,a,c,f,n[h+15],16,530742520),c=m(c,f=v(f,i,a,c,n[h+2],23,-995338651),i,a,n[h],6,-198630844),a=m(a,c,f,i,n[h+7],10,1126891415),i=m(i,a,c,f,n[h+14],15,-1416354905),f=m(f,i,a,c,n[h+5],21,-57434055),c=m(c,f,i,a,n[h+12],6,1700485571),a=m(a,c,f,i,n[h+3],10,-1894986606),i=m(i,a,c,f,n[h+10],15,-1051523),f=m(f,i,a,c,n[h+1],21,-2054922799),c=m(c,f,i,a,n[h+8],6,1873313359),a=m(a,c,f,i,n[h+15],10,-30611744),i=m(i,a,c,f,n[h+6],15,-1560198380),f=m(f,i,a,c,n[h+13],21,1309151649),c=m(c,f,i,a,n[h+4],6,-145523070),a=m(a,c,f,i,n[h+11],10,-1120210379),i=m(i,a,c,f,n[h+2],15,718787259),f=m(f,i,a,c,n[h+9],21,-343485551),c=d(c,r),f=d(f,e),i=d(i,o),a=d(a,u);return[c,f,i,a]}function i(n){for(var t=\"\",r=32*n.length,e=0;e<r;e+=8)t+=String.fromCharCode(n[e>>5]>>>e%32&255);return t}function a(n){var t=[];for(t[(n.length>>2)-1]=void 0,e=0;e<t.length;e+=1)t[e]=0;for(var r=8*n.length,e=0;e<r;e+=8)t[e>>5]|=(255&n.charCodeAt(e/8))<<e%32;return t}function e(n){for(var t,r=\"0123456789abcdef\",e=\"\",o=0;o<n.length;o+=1)t=n.charCodeAt(o),e+=r.charAt(t>>>4&15)+r.charAt(15&t);return e}function r(n){return unescape(encodeURIComponent(n))}function o(n){return i(c(a(n=r(n)),8*n.length))}function u(n,t){return function(n,t){var r,e=a(n),o=[],u=[];for(o[15]=u[15]=void 0,16<e.length&&(e=c(e,8*n.length)),r=0;r<16;r+=1)o[r]=909522486^e[r],u[r]=1549556828^e[r];return t=c(o.concat(a(t)),512+8*t.length),i(c(u.concat(t),640))}(r(n),r(t))}function t(n,t,r){return t?r?u(t,n):e(u(t,n)):r?o(n):e(o(n))}\"function\"==typeof define&&define.amd?define(function(){return t}):\"object\"==typeof module&&module.exports?module.exports=t:n.md5=t}(this);\r\n",
    "\"use strict\";\n(function (root, factory) {\r\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,\r\n    // Rhino, and plain browser loading.\r\n    if (typeof define === 'function' && define.amd) {\r\n        define(['exports'], factory);\r\n    } else if (typeof exports !== 'undefined') {\r\n        factory(exports);\r\n    } else {\r\n        factory(root);\r\n    }\r\n}(this, function (exports) {\r\n\r\nvar between = function (num, first, last) { return num >= first && num <= last; }\r\nfunction digit(code) { return between(code, 0x30,0x39); }\r\nfunction hexdigit(code) { return digit(code) || between(code, 0x41,0x46) || between(code, 0x61,0x66); }\r\nfunction uppercaseletter(code) { return between(code, 0x41,0x5a); }\r\nfunction lowercaseletter(code) { return between(code, 0x61,0x7a); }\r\nfunction letter(code) { return uppercaseletter(code) || lowercaseletter(code); }\r\nfunction nonascii(code) { return code >= 0x80; }\r\nfunction namestartchar(code) { return letter(code) || nonascii(code) || code == 0x5f; }\r\nfunction namechar(code) { return namestartchar(code) || digit(code) || code == 0x2d; }\r\nfunction nonprintable(code) { return between(code, 0,8) || code == 0xb || between(code, 0xe,0x1f) || code == 0x7f; }\r\nfunction newline(code) { return code == 0xa; }\r\nfunction whitespace(code) { return newline(code) || code == 9 || code == 0x20; }\r\nfunction badescape(code) { return newline(code) || isNaN(code); }\r\n\r\nvar maximumallowedcodepoint = 0x10ffff;\r\n\r\nvar InvalidCharacterError = function(message) {\r\n\tthis.message = message;\r\n};\r\nInvalidCharacterError.prototype = new Error;\r\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\r\n\r\nfunction preprocess(str) {\r\n\t// Turn a string into an array of code points,\r\n\t// following the preprocessing cleanup rules.\r\n\tvar codepoints = [];\r\n\tfor(var i = 0; i < str.length; i++) {\r\n\t\tvar code = str.charCodeAt(i);\r\n\t\tif(code == 0xd && str.charCodeAt(i+1) == 0xa) {\r\n\t\t\tcode = 0xa; i++;\r\n\t\t}\r\n\t\tif(code == 0xd || code == 0xc) code = 0xa;\r\n\t\tif(code == 0x0) code = 0xfffd;\r\n\t\tif(between(code, 0xd800, 0xdbff) && between(str.charCodeAt(i+1), 0xdc00, 0xdfff)) {\r\n\t\t\t// Decode a surrogate pair into an astral codepoint.\r\n\t\t\tvar lead = code - 0xd800;\r\n\t\t\tvar trail = str.charCodeAt(i+1) - 0xdc00;\r\n\t\t\tcode = Math.pow(2, 16) + lead * Math.pow(2, 10) + trail;\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tcodepoints.push(code);\r\n\t}\r\n\treturn codepoints;\r\n}\r\n\r\nfunction stringFromCode(code) {\r\n\tif(code <= 0xffff) return String.fromCharCode(code);\r\n\t// Otherwise, encode astral char as surrogate pair.\r\n\tcode -= Math.pow(2, 16);\r\n\tvar lead = Math.floor(code/Math.pow(2, 10)) + 0xd800;\r\n\tvar trail = code % Math.pow(2, 10) + 0xdc00;\r\n\treturn String.fromCharCode(lead) + String.fromCharCode(trail);\r\n}\r\n\r\nfunction tokenize(str) {\r\n\tstr = preprocess(str);\r\n\tvar i = -1;\r\n\tvar tokens = [];\r\n\tvar code;\r\n\r\n\t// Line number information.\r\n\tvar line = 0;\r\n\tvar column = 0;\r\n\t// The only use of lastLineLength is in reconsume().\r\n\tvar lastLineLength = 0;\r\n\tvar incrLineno = function() {\r\n\t\tline += 1;\r\n\t\tlastLineLength = column;\r\n\t\tcolumn = 0;\r\n\t};\r\n\tvar locStart = {line:line, column:column};\r\n\r\n\tvar codepoint = function(i) {\r\n\t\tif(i >= str.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn str[i];\r\n\t}\r\n\tvar next = function(num) {\r\n\t\tif(num === undefined)\r\n\t\t\tnum = 1;\r\n\t\tif(num > 3)\r\n\t\t\tthrow \"Spec Error: no more than three codepoints of lookahead.\";\r\n\t\treturn codepoint(i+num);\r\n\t};\r\n\tvar consume = function(num) {\r\n\t\tif(num === undefined)\r\n\t\t\tnum = 1;\r\n\t\ti += num;\r\n\t\tcode = codepoint(i);\r\n\t\tif(newline(code)) incrLineno();\r\n\t\telse column += num;\r\n\t\t//console.log('Consume '+i+' '+String.fromCharCode(code) + ' 0x' + code.toString(16));\r\n\t\treturn true;\r\n\t};\r\n\tvar reconsume = function() {\r\n\t\ti -= 1;\r\n\t\tif (newline(code)) {\r\n\t\t\tline -= 1;\r\n\t\t\tcolumn = lastLineLength;\r\n\t\t} else {\r\n\t\t\tcolumn -= 1;\r\n\t\t}\r\n\t\tlocStart.line = line;\r\n\t\tlocStart.column = column;\r\n\t\treturn true;\r\n\t};\r\n\tvar eof = function(codepoint) {\r\n\t\tif(codepoint === undefined) codepoint = code;\r\n\t\treturn codepoint == -1;\r\n\t};\r\n\tvar donothing = function() {};\r\n\tvar parseerror = function() { console.log(\"Parse error at index \" + i + \", processing codepoint 0x\" + code.toString(16) + \".\");return true; };\r\n\r\n\tvar consumeAToken = function() {\r\n\t\tconsumeComments();\r\n\t\tconsume();\r\n\t\tif(whitespace(code)) {\r\n\t\t\twhile(whitespace(next())) consume();\r\n\t\t\treturn new WhitespaceToken;\r\n\t\t}\r\n\t\telse if(code == 0x22) return consumeAStringToken();\r\n\t\telse if(code == 0x23) {\r\n\t\t\tif(namechar(next()) || areAValidEscape(next(1), next(2))) {\r\n\t\t\t\tvar token = new HashToken();\r\n\t\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) token.type = \"id\";\r\n\t\t\t\ttoken.value = consumeAName();\r\n\t\t\t\treturn token;\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x24) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new SuffixMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x27) return consumeAStringToken();\r\n\t\telse if(code == 0x28) return new OpenParenToken();\r\n\t\telse if(code == 0x29) return new CloseParenToken();\r\n\t\telse if(code == 0x2a) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new SubstringMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2b) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2c) return new CommaToken();\r\n\t\telse if(code == 0x2d) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else if(next(1) == 0x2d && next(2) == 0x3e) {\r\n\t\t\t\tconsume(2);\r\n\t\t\t\treturn new CDCToken();\r\n\t\t\t} else if(startsWithAnIdentifier()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2e) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x3a) return new ColonToken;\r\n\t\telse if(code == 0x3b) return new SemicolonToken;\r\n\t\telse if(code == 0x3c) {\r\n\t\t\tif(next(1) == 0x21 && next(2) == 0x2d && next(3) == 0x2d) {\r\n\t\t\t\tconsume(3);\r\n\t\t\t\treturn new CDOToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x40) {\r\n\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\r\n\t\t\t\treturn new AtKeywordToken(consumeAName());\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x5b) return new OpenSquareToken();\r\n\t\telse if(code == 0x5c) {\r\n\t\t\tif(startsWithAValidEscape()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t\t} else {\r\n\t\t\t\tparseerror();\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x5d) return new CloseSquareToken();\r\n\t\telse if(code == 0x5e) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new PrefixMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x7b) return new OpenCurlyToken();\r\n\t\telse if(code == 0x7c) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new DashMatchToken();\r\n\t\t\t} else if(next() == 0x7c) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new ColumnToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x7d) return new CloseCurlyToken();\r\n\t\telse if(code == 0x7e) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new IncludeMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(digit(code)) {\r\n\t\t\treconsume();\r\n\t\t\treturn consumeANumericToken();\r\n\t\t}\r\n\t\telse if(namestartchar(code)) {\r\n\t\t\treconsume();\r\n\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t}\r\n\t\telse if(eof()) return new EOFToken();\r\n\t\telse return new DelimToken(code);\r\n\t};\r\n\r\n\tvar consumeComments = function() {\r\n\t\twhile(next(1) == 0x2f && next(2) == 0x2a) {\r\n\t\t\tconsume(2);\r\n\t\t\twhile(true) {\r\n\t\t\t\tconsume();\r\n\t\t\t\tif(code == 0x2a && next() == 0x2f) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(eof()) {\r\n\t\t\t\t\tparseerror();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeANumericToken = function() {\r\n\t\tvar num = consumeANumber();\r\n\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\r\n\t\t\tvar token = new DimensionToken();\r\n\t\t\ttoken.value = num.value;\r\n\t\t\ttoken.repr = num.repr;\r\n\t\t\ttoken.type = num.type;\r\n\t\t\ttoken.unit = consumeAName();\r\n\t\t\treturn token;\r\n\t\t} else if(next() == 0x25) {\r\n\t\t\tconsume();\r\n\t\t\tvar token = new PercentageToken();\r\n\t\t\ttoken.value = num.value;\r\n\t\t\ttoken.repr = num.repr;\r\n\t\t\treturn token;\r\n\t\t} else {\r\n\t\t\tvar token = new NumberToken();\r\n\t\t\ttoken.value = num.value;\r\n\t\t\ttoken.repr = num.repr;\r\n\t\t\ttoken.type = num.type;\r\n\t\t\treturn token;\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAnIdentlikeToken = function() {\r\n\t\tvar str = consumeAName();\r\n\t\tif(str.toLowerCase() == \"url\" && next() == 0x28) {\r\n\t\t\tconsume();\r\n\t\t\twhile(whitespace(next(1)) && whitespace(next(2))) consume();\r\n\t\t\tif(next() == 0x22 || next() == 0x27) {\r\n\t\t\t\treturn new FunctionToken(str);\r\n\t\t\t} else if(whitespace(next()) && (next(2) == 0x22 || next(2) == 0x27)) {\r\n\t\t\t\treturn new FunctionToken(str);\r\n\t\t\t} else {\r\n\t\t\t\treturn consumeAURLToken();\r\n\t\t\t}\r\n\t\t} else if(next() == 0x28) {\r\n\t\t\tconsume();\r\n\t\t\treturn new FunctionToken(str);\r\n\t\t} else {\r\n\t\t\treturn new IdentToken(str);\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAStringToken = function(endingCodePoint) {\r\n\t\tif(endingCodePoint === undefined) endingCodePoint = code;\r\n\t\tvar string = \"\";\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == endingCodePoint || eof()) {\r\n\t\t\t\treturn new StringToken(string);\r\n\t\t\t} else if(newline(code)) {\r\n\t\t\t\tparseerror();\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn new BadStringToken();\r\n\t\t\t} else if(code == 0x5c) {\r\n\t\t\t\tif(eof(next())) {\r\n\t\t\t\t\tdonothing();\r\n\t\t\t\t} else if(newline(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstring += stringFromCode(consumeEscape())\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstring += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAURLToken = function() {\r\n\t\tvar token = new URLToken(\"\");\r\n\t\twhile(whitespace(next())) consume();\r\n\t\tif(eof(next())) return token;\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == 0x29 || eof()) {\r\n\t\t\t\treturn token;\r\n\t\t\t} else if(whitespace(code)) {\r\n\t\t\t\twhile(whitespace(next())) consume();\r\n\t\t\t\tif(next() == 0x29 || eof(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\treturn token;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\t\treturn new BadURLToken();\r\n\t\t\t\t}\r\n\t\t\t} else if(code == 0x22 || code == 0x27 || code == 0x28 || nonprintable(code)) {\r\n\t\t\t\tparseerror();\r\n\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\treturn new BadURLToken();\r\n\t\t\t} else if(code == 0x5c) {\r\n\t\t\t\tif(startsWithAValidEscape()) {\r\n\t\t\t\t\ttoken.value += stringFromCode(consumeEscape());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparseerror();\r\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\t\treturn new BadURLToken();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoken.value += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeEscape = function() {\r\n\t\t// Assume the the current character is the \\\r\n\t\t// and the next code point is not a newline.\r\n\t\tconsume();\r\n\t\tif(hexdigit(code)) {\r\n\t\t\t// Consume 1-6 hex digits\r\n\t\t\tvar digits = [code];\r\n\t\t\tfor(var total = 0; total < 5; total++) {\r\n\t\t\t\tif(hexdigit(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\tdigits.push(code);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(whitespace(next())) consume();\r\n\t\t\tvar value = parseInt(digits.map(function(x){return String.fromCharCode(x);}).join(''), 16);\r\n\t\t\tif( value > maximumallowedcodepoint ) value = 0xfffd;\r\n\t\t\treturn value;\r\n\t\t} else if(eof()) {\r\n\t\t\treturn 0xfffd;\r\n\t\t} else {\r\n\t\t\treturn code;\r\n\t\t}\r\n\t};\r\n\r\n\tvar areAValidEscape = function(c1, c2) {\r\n\t\tif(c1 != 0x5c) return false;\r\n\t\tif(newline(c2)) return false;\r\n\t\treturn true;\r\n\t};\r\n\tvar startsWithAValidEscape = function() {\r\n\t\treturn areAValidEscape(code, next());\r\n\t};\r\n\r\n\tvar wouldStartAnIdentifier = function(c1, c2, c3) {\r\n\t\tif(c1 == 0x2d) {\r\n\t\t\treturn namestartchar(c2) || c2 == 0x2d || areAValidEscape(c2, c3);\r\n\t\t} else if(namestartchar(c1)) {\r\n\t\t\treturn true;\r\n\t\t} else if(c1 == 0x5c) {\r\n\t\t\treturn areAValidEscape(c1, c2);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\tvar startsWithAnIdentifier = function() {\r\n\t\treturn wouldStartAnIdentifier(code, next(1), next(2));\r\n\t};\r\n\r\n\tvar wouldStartANumber = function(c1, c2, c3) {\r\n\t\tif(c1 == 0x2b || c1 == 0x2d) {\r\n\t\t\tif(digit(c2)) return true;\r\n\t\t\tif(c2 == 0x2e && digit(c3)) return true;\r\n\t\t\treturn false;\r\n\t\t} else if(c1 == 0x2e) {\r\n\t\t\tif(digit(c2)) return true;\r\n\t\t\treturn false;\r\n\t\t} else if(digit(c1)) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\tvar startsWithANumber = function() {\r\n\t\treturn wouldStartANumber(code, next(1), next(2));\r\n\t};\r\n\r\n\tvar consumeAName = function() {\r\n\t\tvar result = \"\";\r\n\t\twhile(consume()) {\r\n\t\t\tif(namechar(code)) {\r\n\t\t\t\tresult += stringFromCode(code);\r\n\t\t\t} else if(startsWithAValidEscape()) {\r\n\t\t\t\tresult += stringFromCode(consumeEscape());\r\n\t\t\t} else {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeANumber = function() {\r\n\t\tvar repr = [];\r\n\t\tvar type = \"integer\";\r\n\t\tif(next() == 0x2b || next() == 0x2d) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t}\r\n\t\twhile(digit(next())) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t}\r\n\t\tif(next(1) == 0x2e && digit(next(2))) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar c1 = next(1), c2 = next(2), c3 = next(3);\r\n\t\tif((c1 == 0x45 || c1 == 0x65) && digit(c2)) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t} else if((c1 == 0x45 || c1 == 0x65) && (c2 == 0x2b || c2 == 0x2d) && digit(c3)) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar value = convertAStringToANumber(repr);\r\n\t\treturn {type:type, value:value, repr:repr};\r\n\t};\r\n\r\n\tvar convertAStringToANumber = function(string) {\r\n\t\t// CSS's number rules are identical to JS, afaik.\r\n\t\treturn +string;\r\n\t};\r\n\r\n\tvar consumeTheRemnantsOfABadURL = function() {\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == 0x29 || eof()) {\r\n\t\t\t\treturn;\r\n\t\t\t} else if(startsWithAValidEscape()) {\r\n\t\t\t\tconsumeEscape();\r\n\t\t\t\tdonothing();\r\n\t\t\t} else {\r\n\t\t\t\tdonothing();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\tvar iterationCount = 0;\r\n\twhile(!eof(next())) {\r\n\t\ttokens.push(consumeAToken());\r\n\t\titerationCount++;\r\n\t\tif(iterationCount > str.length*2) return \"I'm infinite-looping!\";\r\n\t}\r\n\treturn tokens;\r\n}\r\n\r\nfunction CSSParserToken() { throw \"Abstract Base Class\"; }\r\nCSSParserToken.prototype.toJSON = function() {\r\n\treturn {token: this.tokenType};\r\n}\r\nCSSParserToken.prototype.toString = function() { return this.tokenType; }\r\nCSSParserToken.prototype.toSource = function() { return ''+this; }\r\n\r\nfunction BadStringToken() { return this; }\r\nBadStringToken.prototype = Object.create(CSSParserToken.prototype);\r\nBadStringToken.prototype.tokenType = \"BADSTRING\";\r\n\r\nfunction BadURLToken() { return this; }\r\nBadURLToken.prototype = Object.create(CSSParserToken.prototype);\r\nBadURLToken.prototype.tokenType = \"BADURL\";\r\n\r\nfunction WhitespaceToken() { return this; }\r\nWhitespaceToken.prototype = Object.create(CSSParserToken.prototype);\r\nWhitespaceToken.prototype.tokenType = \"WHITESPACE\";\r\nWhitespaceToken.prototype.toString = function() { return \"WS\"; }\r\nWhitespaceToken.prototype.toSource = function() { return \" \"; }\r\n\r\nfunction CDOToken() { return this; }\r\nCDOToken.prototype = Object.create(CSSParserToken.prototype);\r\nCDOToken.prototype.tokenType = \"CDO\";\r\nCDOToken.prototype.toSource = function() { return \"<!--\"; }\r\n\r\nfunction CDCToken() { return this; }\r\nCDCToken.prototype = Object.create(CSSParserToken.prototype);\r\nCDCToken.prototype.tokenType = \"CDC\";\r\nCDCToken.prototype.toSource = function() { return \"-->\"; }\r\n\r\nfunction ColonToken() { return this; }\r\nColonToken.prototype = Object.create(CSSParserToken.prototype);\r\nColonToken.prototype.tokenType = \"COLON\";\r\n\r\nfunction SemicolonToken() { return this; }\r\nSemicolonToken.prototype = Object.create(CSSParserToken.prototype);\r\nSemicolonToken.prototype.tokenType = \"SEMICOLON\";\r\n\r\nfunction CommaToken() { return this; }\r\nCommaToken.prototype = Object.create(CSSParserToken.prototype);\r\nCommaToken.prototype.tokenType = \"COMMA\";\r\n\r\nfunction GroupingToken() { throw \"Abstract Base Class\"; }\r\nGroupingToken.prototype = Object.create(CSSParserToken.prototype);\r\n\r\nfunction OpenCurlyToken() { this.value = \"{\"; this.mirror = \"}\"; return this; }\r\nOpenCurlyToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenCurlyToken.prototype.tokenType = \"OPENCURLY\";\r\n\r\nfunction CloseCurlyToken() { this.value = \"}\"; this.mirror = \"{\"; return this; }\r\nCloseCurlyToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseCurlyToken.prototype.tokenType = \"CLOSECURLY\";\r\n\r\nfunction OpenSquareToken() { this.value = \"[\"; this.mirror = \"]\"; return this; }\r\nOpenSquareToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenSquareToken.prototype.tokenType = \"OPENSQUARE\";\r\n\r\nfunction CloseSquareToken() { this.value = \"]\"; this.mirror = \"[\"; return this; }\r\nCloseSquareToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseSquareToken.prototype.tokenType = \"CLOSESQUARE\";\r\n\r\nfunction OpenParenToken() { this.value = \"(\"; this.mirror = \")\"; return this; }\r\nOpenParenToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenParenToken.prototype.tokenType = \"OPENPAREN\";\r\n\r\nfunction CloseParenToken() { this.value = \")\"; this.mirror = \"(\"; return this; }\r\nCloseParenToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseParenToken.prototype.tokenType = \"CLOSEPAREN\";\r\n\r\nfunction IncludeMatchToken() { return this; }\r\nIncludeMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nIncludeMatchToken.prototype.tokenType = \"~=\";\r\n\r\nfunction DashMatchToken() { return this; }\r\nDashMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nDashMatchToken.prototype.tokenType = \"|=\";\r\n\r\nfunction PrefixMatchToken() { return this; }\r\nPrefixMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nPrefixMatchToken.prototype.tokenType = \"^=\";\r\n\r\nfunction SuffixMatchToken() { return this; }\r\nSuffixMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nSuffixMatchToken.prototype.tokenType = \"$=\";\r\n\r\nfunction SubstringMatchToken() { return this; }\r\nSubstringMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nSubstringMatchToken.prototype.tokenType = \"*=\";\r\n\r\nfunction ColumnToken() { return this; }\r\nColumnToken.prototype = Object.create(CSSParserToken.prototype);\r\nColumnToken.prototype.tokenType = \"||\";\r\n\r\nfunction EOFToken() { return this; }\r\nEOFToken.prototype = Object.create(CSSParserToken.prototype);\r\nEOFToken.prototype.tokenType = \"EOF\";\r\nEOFToken.prototype.toSource = function() { return \"\"; }\r\n\r\nfunction DelimToken(code) {\r\n\tthis.value = stringFromCode(code);\r\n\treturn this;\r\n}\r\nDelimToken.prototype = Object.create(CSSParserToken.prototype);\r\nDelimToken.prototype.tokenType = \"DELIM\";\r\nDelimToken.prototype.toString = function() { return \"DELIM(\"+this.value+\")\"; }\r\nDelimToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\treturn json;\r\n}\r\nDelimToken.prototype.toSource = function() {\r\n\tif(this.value == \"\\\\\")\r\n\t\treturn \"\\\\\\n\";\r\n\telse\r\n\t\treturn this.value;\r\n}\r\n\r\nfunction StringValuedToken() { throw \"Abstract Base Class\"; }\r\nStringValuedToken.prototype = Object.create(CSSParserToken.prototype);\r\nStringValuedToken.prototype.ASCIIMatch = function(str) {\r\n\treturn this.value.toLowerCase() == str.toLowerCase();\r\n}\r\nStringValuedToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\treturn json;\r\n}\r\n\r\nfunction IdentToken(val) {\r\n\tthis.value = val;\r\n}\r\nIdentToken.prototype = Object.create(StringValuedToken.prototype);\r\nIdentToken.prototype.tokenType = \"IDENT\";\r\nIdentToken.prototype.toString = function() { return \"IDENT(\"+this.value+\")\"; }\r\nIdentToken.prototype.toSource = function() {\r\n\treturn escapeIdent(this.value);\r\n}\r\n\r\nfunction FunctionToken(val) {\r\n\tthis.value = val;\r\n\tthis.mirror = \")\";\r\n}\r\nFunctionToken.prototype = Object.create(StringValuedToken.prototype);\r\nFunctionToken.prototype.tokenType = \"FUNCTION\";\r\nFunctionToken.prototype.toString = function() { return \"FUNCTION(\"+this.value+\")\"; }\r\nFunctionToken.prototype.toSource = function() {\r\n\treturn escapeIdent(this.value) + \"(\";\r\n}\r\n\r\nfunction AtKeywordToken(val) {\r\n\tthis.value = val;\r\n}\r\nAtKeywordToken.prototype = Object.create(StringValuedToken.prototype);\r\nAtKeywordToken.prototype.tokenType = \"ATKEYWORD\";\r\nAtKeywordToken.prototype.toString = function() { return \"AT(\"+this.value+\")\"; }\r\nAtKeywordToken.prototype.toSource = function() {\r\n\treturn \"@\" + escapeIdent(this.value);\r\n}\r\n\r\nfunction HashToken(val) {\r\n\tthis.value = val;\r\n\tthis.type = \"unrestricted\";\r\n}\r\nHashToken.prototype = Object.create(StringValuedToken.prototype);\r\nHashToken.prototype.tokenType = \"HASH\";\r\nHashToken.prototype.toString = function() { return \"HASH(\"+this.value+\")\"; }\r\nHashToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.type = this.type;\r\n\treturn json;\r\n}\r\nHashToken.prototype.toSource = function() {\r\n\tif(this.type == \"id\") {\r\n\t\treturn \"#\" + escapeIdent(this.value);\r\n\t} else {\r\n\t\treturn \"#\" + escapeHash(this.value);\r\n\t}\r\n}\r\n\r\nfunction StringToken(val) {\r\n\tthis.value = val;\r\n}\r\nStringToken.prototype = Object.create(StringValuedToken.prototype);\r\nStringToken.prototype.tokenType = \"STRING\";\r\nStringToken.prototype.toString = function() {\r\n\treturn '\"' + escapeString(this.value) + '\"';\r\n}\r\n\r\nfunction URLToken(val) {\r\n\tthis.value = val;\r\n}\r\nURLToken.prototype = Object.create(StringValuedToken.prototype);\r\nURLToken.prototype.tokenType = \"URL\";\r\nURLToken.prototype.toString = function() { return \"URL(\"+this.value+\")\"; }\r\nURLToken.prototype.toSource = function() {\r\n\treturn 'url(\"' + escapeString(this.value) + '\")';\r\n}\r\n\r\nfunction NumberToken() {\r\n\tthis.value = null;\r\n\tthis.type = \"integer\";\r\n\tthis.repr = \"\";\r\n}\r\nNumberToken.prototype = Object.create(CSSParserToken.prototype);\r\nNumberToken.prototype.tokenType = \"NUMBER\";\r\nNumberToken.prototype.toString = function() {\r\n\tif(this.type == \"integer\")\r\n\t\treturn \"INT(\"+this.value+\")\";\r\n\treturn \"NUMBER(\"+this.value+\")\";\r\n}\r\nNumberToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.type = this.type;\r\n\tjson.repr = this.repr;\r\n\treturn json;\r\n}\r\nNumberToken.prototype.toSource = function() { return this.repr; };\r\n\r\nfunction PercentageToken() {\r\n\tthis.value = null;\r\n\tthis.repr = \"\";\r\n}\r\nPercentageToken.prototype = Object.create(CSSParserToken.prototype);\r\nPercentageToken.prototype.tokenType = \"PERCENTAGE\";\r\nPercentageToken.prototype.toString = function() { return \"PERCENTAGE(\"+this.value+\")\"; }\r\nPercentageToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.repr = this.repr;\r\n\treturn json;\r\n}\r\nPercentageToken.prototype.toSource = function() { return this.repr + \"%\"; }\r\n\r\nfunction DimensionToken() {\r\n\tthis.value = null;\r\n\tthis.type = \"integer\";\r\n\tthis.repr = \"\";\r\n\tthis.unit = \"\";\r\n}\r\nDimensionToken.prototype = Object.create(CSSParserToken.prototype);\r\nDimensionToken.prototype.tokenType = \"DIMENSION\";\r\nDimensionToken.prototype.toString = function() { return \"DIM(\"+this.value+\",\"+this.unit+\")\"; }\r\nDimensionToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.type = this.type;\r\n\tjson.repr = this.repr;\r\n\tjson.unit = this.unit;\r\n\treturn json;\r\n}\r\nDimensionToken.prototype.toSource = function() {\r\n\tvar source = this.repr;\r\n\tvar unit = escapeIdent(this.unit);\r\n\tif(unit[0].toLowerCase() == \"e\" && (unit[1] == \"-\" || between(unit.charCodeAt(1), 0x30, 0x39))) {\r\n\t\t// Unit is ambiguous with scinot\r\n\t\t// Remove the leading \"e\", replace with escape.\r\n\t\tunit = \"\\\\65 \" + unit.slice(1, unit.length);\r\n\t}\r\n\treturn source+unit;\r\n}\r\n\r\nfunction escapeIdent(string) {\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tvar firstcode = string.charCodeAt(0);\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tbetween(code, 0x1, 0x1f) || code == 0x7f ||\r\n\t\t\t(i == 0 && between(code, 0x30, 0x39)) ||\r\n\t\t\t(i == 1 && between(code, 0x30, 0x39) && firstcode == 0x2d)\r\n\t\t) {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t} else if(\r\n\t\t\tcode >= 0x80 ||\r\n\t\t\tcode == 0x2d ||\r\n\t\t\tcode == 0x5f ||\r\n\t\t\tbetween(code, 0x30, 0x39) ||\r\n\t\t\tbetween(code, 0x41, 0x5a) ||\r\n\t\t\tbetween(code, 0x61, 0x7a)\r\n\t\t) {\r\n\t\t\tresult += string[i];\r\n\t\t} else {\r\n\t\t\tresult += '\\\\' + string[i];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction escapeHash(string) {\r\n\t// Escapes the contents of \"unrestricted\"-type hash tokens.\r\n\t// Won't preserve the ID-ness of \"id\"-type hash tokens;\r\n\t// use escapeIdent() for that.\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tvar firstcode = string.charCodeAt(0);\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tcode >= 0x80 ||\r\n\t\t\tcode == 0x2d ||\r\n\t\t\tcode == 0x5f ||\r\n\t\t\tbetween(code, 0x30, 0x39) ||\r\n\t\t\tbetween(code, 0x41, 0x5a) ||\r\n\t\t\tbetween(code, 0x61, 0x7a)\r\n\t\t) {\r\n\t\t\tresult += string[i];\r\n\t\t} else {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction escapeString(string) {\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(between(code, 0x1, 0x1f) || code == 0x7f) {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t} else if(code == 0x22 || code == 0x5c) {\r\n\t\t\tresult += '\\\\' + string[i];\r\n\t\t} else {\r\n\t\t\tresult += string[i];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n// Exportation.\r\nexports.tokenize = tokenize;\r\nexports.IdentToken = IdentToken;\r\nexports.FunctionToken = FunctionToken;\r\nexports.AtKeywordToken = AtKeywordToken;\r\nexports.HashToken = HashToken;\r\nexports.StringToken = StringToken;\r\nexports.BadStringToken = BadStringToken;\r\nexports.URLToken = URLToken;\r\nexports.BadURLToken = BadURLToken;\r\nexports.DelimToken = DelimToken;\r\nexports.NumberToken = NumberToken;\r\nexports.PercentageToken = PercentageToken;\r\nexports.DimensionToken = DimensionToken;\r\nexports.IncludeMatchToken = IncludeMatchToken;\r\nexports.DashMatchToken = DashMatchToken;\r\nexports.PrefixMatchToken = PrefixMatchToken;\r\nexports.SuffixMatchToken = SuffixMatchToken;\r\nexports.SubstringMatchToken = SubstringMatchToken;\r\nexports.ColumnToken = ColumnToken;\r\nexports.WhitespaceToken = WhitespaceToken;\r\nexports.CDOToken = CDOToken;\r\nexports.CDCToken = CDCToken;\r\nexports.ColonToken = ColonToken;\r\nexports.SemicolonToken = SemicolonToken;\r\nexports.CommaToken = CommaToken;\r\nexports.OpenParenToken = OpenParenToken;\r\nexports.CloseParenToken = CloseParenToken;\r\nexports.OpenSquareToken = OpenSquareToken;\r\nexports.CloseSquareToken = CloseSquareToken;\r\nexports.OpenCurlyToken = OpenCurlyToken;\r\nexports.CloseCurlyToken = CloseCurlyToken;\r\nexports.EOFToken = EOFToken;\r\nexports.CSSParserToken = CSSParserToken;\r\nexports.GroupingToken = GroupingToken;\r\n\r\nfunction TokenStream(tokens) {\r\n\t// Assume that tokens is an array.\r\n\tthis.tokens = tokens;\r\n\tthis.i = -1;\r\n}\r\nTokenStream.prototype.tokenAt = function(i) {\r\n\tif(i < this.tokens.length)\r\n\t\treturn this.tokens[i];\r\n\treturn new EOFToken();\r\n}\r\nTokenStream.prototype.consume = function(num) {\r\n\tif(num === undefined) num = 1;\r\n\tthis.i += num;\r\n\tthis.token = this.tokenAt(this.i);\r\n\t//console.log(this.i, this.token);\r\n\treturn true;\r\n}\r\nTokenStream.prototype.next = function() {\r\n\treturn this.tokenAt(this.i+1);\r\n}\r\nTokenStream.prototype.reconsume = function() {\r\n\tthis.i--;\r\n}\r\n\r\nfunction parseerror(s, msg) {\r\n\tconsole.log(\"Parse error at token \" + s.i + \": \" + s.token + \".\\n\" + msg);\r\n\treturn true;\r\n}\r\nfunction donothing(){ return true; };\r\n\r\nfunction consumeAListOfRules(s, topLevel) {\r\n\tvar rules = [];\r\n\tvar rule;\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof WhitespaceToken) {\r\n\t\t\tcontinue;\r\n\t\t} else if(s.token instanceof EOFToken) {\r\n\t\t\treturn rules;\r\n\t\t} else if(s.token instanceof CDOToken || s.token instanceof CDCToken) {\r\n\t\t\tif(topLevel == \"top-level\") continue;\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAQualifiedRule(s)) rules.push(rule);\r\n\t\t} else if(s.token instanceof AtKeywordToken) {\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAnAtRule(s)) rules.push(rule);\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAQualifiedRule(s)) rules.push(rule);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAnAtRule(s) {\r\n\ts.consume();\r\n\tvar rule = new AtRule(s.token.value);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof SemicolonToken || s.token instanceof EOFToken) {\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof OpenCurlyToken) {\r\n\t\t\trule.value = consumeASimpleBlock(s);\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\r\n\t\t\trule.value = s.token;\r\n\t\t\treturn rule;\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\trule.prelude.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAQualifiedRule(s) {\r\n\tvar rule = new QualifiedRule();\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken) {\r\n\t\t\tparseerror(s, \"Hit EOF when trying to parse the prelude of a qualified rule.\");\r\n\t\t\treturn;\r\n\t\t} else if(s.token instanceof OpenCurlyToken) {\r\n\t\t\trule.value = consumeASimpleBlock(s);\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\r\n\t\t\trule.value = s.token;\r\n\t\t\treturn rule;\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\trule.prelude.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAListOfDeclarations(s) {\r\n\tvar decls = [];\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof WhitespaceToken || s.token instanceof SemicolonToken) {\r\n\t\t\tdonothing();\r\n\t\t} else if(s.token instanceof EOFToken) {\r\n\t\t\treturn decls;\r\n\t\t} else if(s.token instanceof AtKeywordToken) {\r\n\t\t\ts.reconsume();\r\n\t\t\tdecls.push(consumeAnAtRule(s));\r\n\t\t} else if(s.token instanceof IdentToken) {\r\n\t\t\tvar temp = [s.token];\r\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\r\n\t\t\t\ttemp.push(consumeAComponentValue(s));\r\n\t\t\tvar decl;\r\n\t\t\tif(decl = consumeADeclaration(new TokenStream(temp))) decls.push(decl);\r\n\t\t} else {\r\n\t\t\tparseerror(s);\r\n\t\t\ts.reconsume();\r\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\r\n\t\t\t\tconsumeAComponentValue(s);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeADeclaration(s) {\r\n\t// Assumes that the next input token will be an ident token.\r\n\ts.consume();\r\n\tvar decl = new Declaration(s.token.value);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(!(s.next() instanceof ColonToken)) {\r\n\t\tparseerror(s);\r\n\t\treturn;\r\n\t} else {\r\n\t\ts.consume();\r\n\t}\r\n\twhile(!(s.next() instanceof EOFToken)) {\r\n\t\tdecl.value.push(consumeAComponentValue(s));\r\n\t}\r\n\tvar foundImportant = false;\r\n\tfor(var i = decl.value.length - 1; i >= 0; i--) {\r\n\t\tif(decl.value[i] instanceof WhitespaceToken) {\r\n\t\t\tcontinue;\r\n\t\t} else if(decl.value[i] instanceof IdentToken && decl.value[i].ASCIIMatch(\"important\")) {\r\n\t\t\tfoundImportant = true;\r\n\t\t} else if(foundImportant && decl.value[i] instanceof DelimToken && decl.value[i].value == \"!\") {\r\n\t\t\tdecl.value.splice(i, decl.value.length);\r\n\t\t\tdecl.important = true;\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn decl;\r\n}\r\n\r\nfunction consumeAComponentValue(s) {\r\n\ts.consume();\r\n\tif(s.token instanceof OpenCurlyToken || s.token instanceof OpenSquareToken || s.token instanceof OpenParenToken)\r\n\t\treturn consumeASimpleBlock(s);\r\n\tif(s.token instanceof FunctionToken)\r\n\t\treturn consumeAFunction(s);\r\n\treturn s.token;\r\n}\r\n\r\nfunction consumeASimpleBlock(s) {\r\n\tvar mirror = s.token.mirror;\r\n\tvar block = new SimpleBlock(s.token.value);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken || (s.token instanceof GroupingToken && s.token.value == mirror))\r\n\t\t\treturn block;\r\n\t\telse {\r\n\t\t\ts.reconsume();\r\n\t\t\tblock.value.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAFunction(s) {\r\n\tvar func = new Func(s.token.value);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken || s.token instanceof CloseParenToken)\r\n\t\t\treturn func;\r\n\t\telse {\r\n\t\t\ts.reconsume();\r\n\t\t\tfunc.value.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction normalizeInput(input) {\r\n\tif(typeof input == \"string\")\r\n\t\treturn new TokenStream(tokenize(input));\r\n\telse if(typeof input == \"number\")\r\n\t\treturn new TokenStream(tokenize(input.toString()));\r\n\tif(input instanceof TokenStream)\r\n\t\treturn input;\r\n\tif(input.length !== undefined)\r\n\t\treturn new TokenStream(input);\r\n\telse throw SyntaxError(String(input) + ' ' + typeof input);\r\n}\r\n\r\nfunction parseAStylesheet(s) {\r\n\ts = normalizeInput(s);\r\n\tvar sheet = new Stylesheet();\r\n\tsheet.value = consumeAListOfRules(s, \"top-level\");\r\n\treturn sheet;\r\n}\r\n\r\nfunction parseAListOfRules(s) {\r\n\ts = normalizeInput(s);\r\n\treturn consumeAListOfRules(s);\r\n}\r\n\r\nfunction parseARule(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\r\n\tif(s.next() instanceof AtKeywordToken) {\r\n\t\tvar rule = consumeAnAtRule(s);\r\n\t} else {\r\n\t\tvar rule = consumeAQualifiedRule(s);\r\n\t\tif(!rule) throw SyntaxError();\r\n\t}\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken)\r\n\t\treturn rule;\r\n\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseADeclaration(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(!(s.next() instanceof IdentToken)) throw SyntaxError();\r\n\tvar decl = consumeADeclaration(s);\r\n\tif(decl)\r\n\t\treturn decl\r\n\telse\r\n\t\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseAListOfDeclarations(s) {\r\n\ts = normalizeInput(s);\r\n\treturn consumeAListOfDeclarations(s);\r\n}\r\n\r\nfunction parseAComponentValue(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\r\n\tvar val = consumeAComponentValue(s);\r\n\tif(!val) throw SyntaxError();\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken)\r\n\t\treturn val;\r\n\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseAListOfComponentValues(s) {\r\n\ts = normalizeInput(s);\r\n\tvar vals = [];\r\n\twhile(true) {\r\n\t\tvar val = consumeAComponentValue(s);\r\n\t\tif(val instanceof EOFToken)\r\n\t\t\treturn vals\r\n\t\telse\r\n\t\t\tvals.push(val);\r\n\t}\r\n}\r\n\r\nfunction parseACommaSeparatedListOfComponentValues(s) {\r\n\ts = normalizeInput(s);\r\n\tvar listOfCVLs = [];\r\n\twhile(true) {\r\n\t\tvar vals = [];\r\n\t\twhile(true) {\r\n\t\t\tvar val = consumeAComponentValue(s);\r\n\t\t\tif(val instanceof EOFToken) {\r\n\t\t\t\tlistOfCVLs.push(vals);\r\n\t\t\t\treturn listOfCVLs;\r\n\t\t\t} else if(val instanceof CommaToken) {\r\n\t\t\t\tlistOfCVLs.push(vals);\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tvals.push(val);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction CSSParserRule() { throw \"Abstract Base Class\"; }\r\nCSSParserRule.prototype.toString = function(indent) {\r\n\treturn JSON.stringify(this,null,indent);\r\n}\r\nCSSParserRule.prototype.toJSON = function() {\r\n\treturn {type:this.type, value:this.value};\r\n}\r\n\r\nfunction Stylesheet() {\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nStylesheet.prototype = Object.create(CSSParserRule.prototype);\r\nStylesheet.prototype.type = \"STYLESHEET\";\r\n\r\nfunction AtRule(name) {\r\n\tthis.name = name;\r\n\tthis.prelude = [];\r\n\tthis.value = null;\r\n\treturn this;\r\n}\r\nAtRule.prototype = Object.create(CSSParserRule.prototype);\r\nAtRule.prototype.type = \"AT-RULE\";\r\nAtRule.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\tjson.prelude = this.prelude;\r\n\treturn json;\r\n}\r\n\r\nfunction QualifiedRule() {\r\n\tthis.prelude = [];\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nQualifiedRule.prototype = Object.create(CSSParserRule.prototype);\r\nQualifiedRule.prototype.type = \"QUALIFIED-RULE\";\r\nQualifiedRule.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.prelude = this.prelude;\r\n\treturn json;\r\n}\r\n\r\nfunction Declaration(name) {\r\n\tthis.name = name;\r\n\tthis.value = [];\r\n\tthis.important = false;\r\n\treturn this;\r\n}\r\nDeclaration.prototype = Object.create(CSSParserRule.prototype);\r\nDeclaration.prototype.type = \"DECLARATION\";\r\nDeclaration.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\tjson.important = this.important;\r\n\treturn json;\r\n}\r\n\r\nfunction SimpleBlock(type) {\r\n\tthis.name = type;\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nSimpleBlock.prototype = Object.create(CSSParserRule.prototype);\r\nSimpleBlock.prototype.type = \"BLOCK\";\r\nSimpleBlock.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\treturn json;\r\n}\r\n\r\nfunction Func(name) {\r\n\tthis.name = name;\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nFunc.prototype = Object.create(CSSParserRule.prototype);\r\nFunc.prototype.type = \"FUNCTION\";\r\nFunc.prototype.tokenType = \"FUNCTION\";\r\nFunc.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\treturn json;\r\n}\r\n\r\n\r\n/* Grammar Application */\r\n\r\nfunction canonicalize(rule, grammar, topGrammar) {\r\n\tif(grammar === undefined) grammar = CSSGrammar;\r\n\tif(topGrammar === undefined) topGrammar = grammar\r\n\tif(!validateGrammar(grammar)) return;\r\n\tif(grammar) {\r\n\t\tif(grammar.stylesheet) grammar = topGrammar;\r\n\t\tvar unknownTransformer = grammar.unknown || function(){return};\r\n\t}\r\n\tvar ret = {\"type\":rule.type.toLowerCase()};\r\n\r\n\tif(rule.type == \"STYLESHEET\") {\r\n\t\tvar contents = rule.value;\r\n\t} else if(rule.type == \"BLOCK\") {\r\n\t\tvar unparsedContents = rule.value;\r\n\t\tret.name = rule.name;\r\n\t} else if(rule.type == \"QUALIFIED-RULE\") {\r\n\t\tvar unparsedContents = rule.value.value;\r\n\t\tret.prelude = rule.prelude;\r\n\t} else if(rule.type == \"AT-RULE\") {\r\n\t\tvar unparsedContents = rule.value.value;\r\n\t\tret.name = rule.name;\r\n\t\tret.prelude = rule.prelude;\r\n\t} else if(rule.type == \"DECLARATION\") {\r\n\t\t// I don't do grammar-checking of declarations yet.\r\n\t\tret.name = rule.name;\r\n\t\tret.value = rule.value;\r\n\t\tret.important = rule.important;\r\n\t\treturn ret;\r\n\t}\r\n\tif(unparsedContents) {\r\n\t\tif(grammar.declarations) {\r\n\t\t\tvar contents = parseAListOfDeclarations(unparsedContents);\r\n\t\t} else if(grammar.qualified) {\r\n\t\t\tvar contents = parseAListOfRules(unparsedContents);\r\n\t\t}\r\n\t}\r\n\r\n\tif(!grammar) {\r\n\t\treturn ret;\r\n\t} else if(grammar.declarations) {\r\n\t\tret.declarations = {}; // simple key/value map of declarations\r\n\t\tret.rules = []; // in-order list of both decls and at-rules\r\n\t\tret.errors = [];\r\n\t\tfor(var i = 0; i < contents.length; i++) {\r\n\t\t\tvar rule = contents[i];\r\n\t\t\tif(rule instanceof Declaration) {\r\n\t\t\t\tvar decl = canonicalize(rule, {}, topGrammar);\r\n\t\t\t\tret.declarations[rule.name] = decl;\r\n\t\t\t\tret.rules.push(decl);\r\n\t\t\t} else { // rule is instanceof AtRule\r\n\t\t\t\tvar subGrammar = grammar[\"@\" + rule.name];\r\n\t\t\t\tif(subGrammar) { // Rule is valid in this context\r\n\t\t\t\t\tret.rules.push(canonicalize(rule, subGrammar, topGrammar));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar result = unknownTransformer(rule);\r\n\t\t\t\t\tif(result) {\r\n\t\t\t\t\t\tret.rules.push(result);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret.errors.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tret.rules = [];\r\n\t\tret.errors = [];\r\n\t\tfor(var i = 0; i < contents.length; i++) {\r\n\t\t\tvar rule = contents[i];\r\n\t\t\tif(rule instanceof QualifiedRule) {\r\n\t\t\t\tret.rules.push(canonicalize(rule, grammar.qualified, topGrammar));\r\n\t\t\t} else {\r\n\t\t\t\tvar subGrammar = grammar[\"@\" + rule.name];\r\n\t\t\t\tif(subGrammar) { // Rule is valid in this context\r\n\t\t\t\t\tret.rules.push(canonicalize(rule, subGrammar, topGrammar));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar result = unknownTransformer(rule);\r\n\t\t\t\t\tif(result) {\r\n\t\t\t\t\t\tret.rules.push(result);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret.errors.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction validateGrammar(grammar) {\r\n\t// TODO\r\n\treturn true\r\n}\r\n\r\nvar CSSGrammar = {\r\n\tqualified: {declarations:true},\r\n\t\"@media\": {stylesheet:true},\r\n\t\"@keyframes\": {qualified:{declarations:true}},\r\n\t\"@font-face\": {declarations:true},\r\n\t\"@supports\": {stylesheet:true},\r\n\t\"@scope\": {stylesheet:true},\r\n\t\"@counter-style\": {declarations:true},\r\n\t\"@import\": null,\r\n\t\"@font-feature-values\": {\r\n\t\t// No qualified rules actually allowed,\r\n\t\t// but have to declare it one way or the other.\r\n\t\tqualified: true,\r\n\t\t\"@stylistic\": {declarations:true},\r\n\t\t\"@styleset\": {declarations:true},\r\n\t\t\"@character-variants\": {declarations:true},\r\n\t\t\"@swash\": {declarations:true},\r\n\t\t\"@ornaments\": {declarations:true},\r\n\t\t\"@annotation\": {declarations:true},\r\n\t},\r\n\t\"@viewport\": {declarations:true},\r\n\t\"@page\": {\r\n\t\tdeclarations: true,\r\n\t\t\"@top-left-corner\": {declarations:true},\r\n\t\t\"@top-left\": {declarations:true},\r\n\t\t\"@top-center\": {declarations:true},\r\n\t\t\"@top-right\": {declarations:true},\r\n\t\t\"@top-right-corner\": {declarations:true},\r\n\t\t\"@right-top\": {declarations:true},\r\n\t\t\"@right-middle\": {declarations:true},\r\n\t\t\"@right-bottom\": {declarations:true},\r\n\t\t\"@right-bottom-corner\": {declarations:true},\r\n\t\t\"@bottom-right\": {declarations:true},\r\n\t\t\"@bottom-center\": {declarations:true},\r\n\t\t\"@bottom-left\": {declarations:true},\r\n\t\t\"@bottom-left-corner\": {declarations:true},\r\n\t\t\"@left-bottom\": {declarations:true},\r\n\t\t\"@left-center\": {declarations:true},\r\n\t\t\"@left-top\": {declarations:true},\r\n\t},\r\n\t\"@custom-selector\": null,\r\n\t\"@custom-media\": null\r\n}\r\n\r\n\r\n\r\n// Exportation.\r\nexports.CSSParserRule = CSSParserRule;\r\nexports.Stylesheet = Stylesheet;\r\nexports.AtRule = AtRule;\r\nexports.QualifiedRule = QualifiedRule;\r\nexports.Declaration = Declaration;\r\nexports.SimpleBlock = SimpleBlock;\r\nexports.Func = Func;\r\nexports.parseAStylesheet = parseAStylesheet;\r\nexports.parseAListOfRules = parseAListOfRules;\r\nexports.parseARule = parseARule;\r\nexports.parseADeclaration = parseADeclaration;\r\nexports.parseAListOfDeclarations = parseAListOfDeclarations;\r\nexports.parseAComponentValue = parseAComponentValue;\r\nexports.parseAListOfComponentValues = parseAListOfComponentValues;\r\nexports.parseACommaSeparatedListOfComponentValues = parseACommaSeparatedListOfComponentValues;\r\nexports.canonicalizeRule = canonicalize;\r\nexports.CSSGrammar = CSSGrammar;\r\n\r\n}));\r\n",
    "\"use strict\";\n(function (root, factory) {\r\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,\r\n    // Rhino, and plain browser loading.\r\n    if (typeof define === 'function' && define.amd) {\r\n        define(['exports'], factory);\r\n    } else if (typeof exports !== 'undefined') {\r\n        factory(exports);\r\n    } else {\r\n        factory(root);\r\n    }\r\n}(this, function (exports) {\r\n\r\nvar between = function (num, first, last) { return num >= first && num <= last; }\r\nfunction digit(code) { return between(code, 0x30,0x39); }\r\nfunction hexdigit(code) { return digit(code) || between(code, 0x41,0x46) || between(code, 0x61,0x66); }\r\nfunction uppercaseletter(code) { return between(code, 0x41,0x5a); }\r\nfunction lowercaseletter(code) { return between(code, 0x61,0x7a); }\r\nfunction letter(code) { return uppercaseletter(code) || lowercaseletter(code); }\r\nfunction nonascii(code) { return code >= 0x80; }\r\nfunction namestartchar(code) { return letter(code) || nonascii(code) || code == 0x5f; }\r\nfunction namechar(code) { return namestartchar(code) || digit(code) || code == 0x2d; }\r\nfunction nonprintable(code) { return between(code, 0,8) || code == 0xb || between(code, 0xe,0x1f) || code == 0x7f; }\r\nfunction newline(code) { return code == 0xa; }\r\nfunction whitespace(code) { return newline(code) || code == 9 || code == 0x20; }\r\nfunction badescape(code) { return newline(code) || isNaN(code); }\r\n\r\nvar maximumallowedcodepoint = 0x10ffff;\r\n\r\nvar InvalidCharacterError = function(message) {\r\n\tthis.message = message;\r\n};\r\nInvalidCharacterError.prototype = new Error;\r\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\r\n\r\nfunction preprocess(str) {\r\n\t// Turn a string into an array of code points,\r\n\t// following the preprocessing cleanup rules.\r\n\tvar codepoints = [];\r\n\tfor(var i = 0; i < str.length; i++) {\r\n\t\tvar code = str.charCodeAt(i);\r\n\t\tif(code == 0xd && str.charCodeAt(i+1) == 0xa) {\r\n\t\t\tcode = 0xa; i++;\r\n\t\t}\r\n\t\tif(code == 0xd || code == 0xc) code = 0xa;\r\n\t\tif(code == 0x0) code = 0xfffd;\r\n\t\tif(between(code, 0xd800, 0xdbff) && between(str.charCodeAt(i+1), 0xdc00, 0xdfff)) {\r\n\t\t\t// Decode a surrogate pair into an astral codepoint.\r\n\t\t\tvar lead = code - 0xd800;\r\n\t\t\tvar trail = str.charCodeAt(i+1) - 0xdc00;\r\n\t\t\tcode = Math.pow(2, 16) + lead * Math.pow(2, 10) + trail;\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tcodepoints.push(code);\r\n\t}\r\n//\tconsole.log(str, codepoints);\r\n\treturn codepoints;\r\n}\r\n\r\nfunction stringFromCode(code) {\r\n\tif(code <= 0xffff) return String.fromCharCode(code);\r\n\t// Otherwise, encode astral char as surrogate pair.\r\n\tcode -= Math.pow(2, 16);\r\n\tvar lead = Math.floor(code/Math.pow(2, 10)) + 0xd800;\r\n\tvar trail = code % Math.pow(2, 10) + 0xdc00;\r\n\treturn String.fromCharCode(lead) + String.fromCharCode(trail);\r\n}\r\n\r\nfunction tokenize(str) {\r\n\tstr = preprocess(str);\r\n\tvar i = -1;\r\n\tvar tokens = [];\r\n\tvar code;\r\n\r\n\t// Line number information.\r\n\tvar line = 0;\r\n\tvar column = 0;\r\n\t// The only use of lastLineLength is in reconsume().\r\n\tvar lastLineLength = 0;\r\n\tvar incrLineno = function() {\r\n\t\tline += 1;\r\n\t\tlastLineLength = column;\r\n\t\tcolumn = 0;\r\n\t};\r\n\tvar locStart = {line:line, column:column};\r\n\r\n\tvar codepoint = function(i) {\r\n\t\tif(i >= str.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn str[i];\r\n\t}\r\n\tvar next = function(num) {\r\n\t\tif(num === undefined)\r\n\t\t\tnum = 1;\r\n\t\tif(num > 3)\r\n\t\t\tthrow \"Spec Error: no more than three codepoints of lookahead.\";\r\n\t\treturn codepoint(i+num);\r\n\t};\r\n\tvar consume = function(num) {\r\n\t\tif(num === undefined)\r\n\t\t\tnum = 1;\r\n\t\ti += num;\r\n\t\tcode = codepoint(i);\r\n\t\tif(newline(code)) incrLineno();\r\n\t\telse column += num;\r\n\t\t//console.log('Consume '+i+' '+String.fromCharCode(code) + ' 0x' + code.toString(16));\r\n\t\treturn true;\r\n\t};\r\n\tvar reconsume = function() {\r\n\t\ti -= 1;\r\n\t\tif (newline(code)) {\r\n\t\t\tline -= 1;\r\n\t\t\tcolumn = lastLineLength;\r\n\t\t} else {\r\n\t\t\tcolumn -= 1;\r\n\t\t}\r\n\t\tlocStart.line = line;\r\n\t\tlocStart.column = column;\r\n\t\treturn true;\r\n\t};\r\n\tvar eof = function(codepoint) {\r\n\t\tif(codepoint === undefined) codepoint = code;\r\n\t\treturn codepoint == -1;\r\n\t};\r\n\tvar donothing = function() {};\r\n\tvar parseerror = function() { console.log(\"Parse error at index \" + i + \", processing codepoint 0x\" + code.toString(16) + \".\");return true; };\r\n\r\n\tvar consumeAToken = function() {\r\n\t\tconsumeComments();\r\n\t\tconsume();\r\n\t\tif(code == 0x22) return consumeAStringToken();\r\n\t\telse if(whitespace(code)) {\r\n\t\t\twhile(whitespace(next())) consume();\r\n\t\t\treturn new WhitespaceToken;\r\n\t\t}\r\n\t\telse if(code == 0x23) {\r\n\t\t\tif(namechar(next()) || areAValidEscape(next(1), next(2))) {\r\n\t\t\t\tvar token = new HashToken();\r\n\t\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) token.type = \"id\";\r\n//\t\t\t\ttoken.value = consumeAName();\r\n\t\t\t\ttoken.repr = '#' + consumeAName()\r\n\t\t\t\treturn token;\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x24) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new SuffixMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x27) return consumeAStringToken();\r\n\t\telse if(code == 0x28) return new OpenParenToken();\r\n\t\telse if(code == 0x29) return new CloseParenToken();\r\n\t\telse if(code == 0x2a) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new SubstringMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2b) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2c) return new CommaToken();\r\n\t\telse if(code == 0x2d) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else if(next(1) == 0x2d && next(2) == 0x3e) {\r\n\t\t\t\tconsume(2);\r\n\t\t\t\treturn new CDCToken();\r\n\t\t\t} else if(startsWithAnIdentifier()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x2e) {\r\n\t\t\tif(startsWithANumber()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeANumericToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x3a) return new ColonToken;\r\n\t\telse if(code == 0x3b) return new SemicolonToken;\r\n\t\telse if(code == 0x3c) {\r\n\t\t\tif(next(1) == 0x21 && next(2) == 0x2d && next(3) == 0x2d) {\r\n\t\t\t\tconsume(3);\r\n\t\t\t\treturn new CDOToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x40) {\r\n\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\r\n\t\t\t\treturn new AtKeywordToken(consumeAName());\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x5b) return new OpenSquareToken();\r\n\t\telse if(code == 0x5c) {\r\n\t\t\tif(startsWithAValidEscape()) {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t\t} else {\r\n\t\t\t\tparseerror();\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x5d) return new CloseSquareToken();\r\n\t\telse if(code == 0x5e) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new PrefixMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x7b) return new OpenCurlyToken();\r\n\t\telse if(code == 0x7c) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new DashMatchToken();\r\n\t\t\t} else if(next() == 0x7c) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new ColumnToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(code == 0x7d) return new CloseCurlyToken();\r\n\t\telse if(code == 0x7e) {\r\n\t\t\tif(next() == 0x3d) {\r\n\t\t\t\tconsume();\r\n\t\t\t\treturn new IncludeMatchToken();\r\n\t\t\t} else {\r\n\t\t\t\treturn new DelimToken(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(digit(code)) {\r\n\t\t\treconsume();\r\n\t\t\treturn consumeANumericToken();\r\n\t\t}\r\n\t\telse if(namestartchar(code)) {\r\n\t\t\treconsume();\r\n\t\t\treturn consumeAnIdentlikeToken();\r\n\t\t}\r\n\t\telse if(eof()) return new EOFToken();\r\n\t\telse return new DelimToken(code);\r\n\t};\r\n\r\n\tvar consumeComments = function() {\r\n\t\twhile(next(1) == 0x2f && next(2) == 0x2a) {\r\n\t\t\tconsume(2);\r\n\t\t\twhile(true) {\r\n\t\t\t\tconsume();\r\n\t\t\t\tif(code == 0x2a && next() == 0x2f) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(eof()) {\r\n\t\t\t\t\tparseerror();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\t// DONE: normalize type\r\n\tvar consumeANumericToken = function() {\r\n\t\tvar num = consumeANumber();\r\n\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\r\n\t\t\tvar token = new DimensionToken();\r\n\t\t\ttoken.value = num.value;\r\n//\t\t\ttoken.repr = num.repr;\r\n\t\t\ttoken.type = num.type;\r\n\t\t\ttoken.unit = consumeAName();\r\n\t\t\ttoken.repr = num.repr + token.unit;\r\n\t\t\treturn token;\r\n\t\t} else if(next() == 0x25) {\r\n\t\t\tconsume();\r\n\t\t\tvar token = new PercentageToken();\r\n\t\t\ttoken.value = num.value;\r\n\t\t\ttoken.repr = num.repr + '%';\r\n\t\t\treturn token;\r\n\t\t} else {\r\n\t\t\tvar token = new NumberToken();\r\n\t\t\ttoken.value = num.value;\r\n\t\t\ttoken.repr = num.repr;\r\n\t\t\ttoken.type = num.type;\r\n\t\t\treturn token;\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAnIdentlikeToken = function() {\r\n\t\tvar str = consumeAName();\r\n\t\tif(str.toLowerCase() == \"url\" && next() == 0x28) {\r\n\t\t\tconsume();\r\n\t\t\twhile(whitespace(next(1)) && whitespace(next(2))) consume();\r\n\t\t\tif(next() == 0x22 || next() == 0x27) {\r\n\t\t\t\treturn new FunctionToken(str);\r\n\t\t\t} else if(whitespace(next()) && (next(2) == 0x22 || next(2) == 0x27)) {\r\n\t\t\t\treturn new FunctionToken(str);\r\n\t\t\t} else {\r\n\t\t\t\treturn consumeAURLToken();\r\n\t\t\t}\r\n\t\t} else if(next() == 0x28) {\r\n\t\t\tconsume();\r\n\t\t\treturn new FunctionToken(str);\r\n\t\t} else {\r\n\t\t\treturn new IdentToken(str);\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAStringToken = function(endingCodePoint) {\r\n\t\tif(endingCodePoint === undefined) endingCodePoint = code;\r\n\t\tvar string = \"\";\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == endingCodePoint || eof()) {\r\n\t\t\t\treturn new StringToken(string);\r\n\t\t\t} else if(newline(code)) {\r\n\t\t\t\tparseerror();\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn new BadStringToken();\r\n\t\t\t} else if(code == 0x5c) {\r\n\t\t\t\tif(eof(next())) {\r\n\t\t\t\t\tdonothing();\r\n\t\t\t\t} else if(newline(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstring += stringFromCode(consumeEscape())\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstring += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeAURLToken = function() {\r\n\t\tvar token = new URLToken(\"\");\r\n\t\twhile(whitespace(next())) consume();\r\n\t\tif(eof(next())) return token;\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == 0x29 || eof()) {\r\n\t\t\t\treturn token;\r\n\t\t\t} else if(whitespace(code)) {\r\n\t\t\t\twhile(whitespace(next())) consume();\r\n\t\t\t\tif(next() == 0x29 || eof(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\treturn token;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\t\treturn new BadURLToken();\r\n\t\t\t\t}\r\n\t\t\t} else if(code == 0x22 || code == 0x27 || code == 0x28 || nonprintable(code)) {\r\n\t\t\t\tparseerror();\r\n\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\treturn new BadURLToken();\r\n\t\t\t} else if(code == 0x5c) {\r\n\t\t\t\tif(startsWithAValidEscape()) {\r\n\t\t\t\t\ttoken.value += stringFromCode(consumeEscape());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparseerror();\r\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\r\n\t\t\t\t\treturn new BadURLToken();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoken.value += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeEscape = function() {\r\n\t\t// Assume the the current character is the \\\r\n\t\t// and the next code point is not a newline.\r\n\t\tconsume();\r\n\t\tif(hexdigit(code)) {\r\n\t\t\t// Consume 1-6 hex digits\r\n\t\t\tvar digits = [code];\r\n\t\t\tfor(var total = 0; total < 5; total++) {\r\n\t\t\t\tif(hexdigit(next())) {\r\n\t\t\t\t\tconsume();\r\n\t\t\t\t\tdigits.push(code);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(whitespace(next())) consume();\r\n\t\t\tvar value = parseInt(digits.map(function(x){return String.fromCharCode(x);}).join(''), 16);\r\n\t\t\tif( value > maximumallowedcodepoint ) value = 0xfffd;\r\n\t\t\treturn value;\r\n\t\t} else if(eof()) {\r\n\t\t\treturn 0xfffd;\r\n\t\t} else {\r\n\t\t\treturn code;\r\n\t\t}\r\n\t};\r\n\r\n\tvar areAValidEscape = function(c1, c2) {\r\n\t\tif(c1 != 0x5c) return false;\r\n\t\tif(newline(c2)) return false;\r\n\t\treturn true;\r\n\t};\r\n\tvar startsWithAValidEscape = function() {\r\n\t\treturn areAValidEscape(code, next());\r\n\t};\r\n\r\n\tvar wouldStartAnIdentifier = function(c1, c2, c3) {\r\n\t\tif(c1 == 0x2d) {\r\n\t\t\treturn namestartchar(c2) || c2 == 0x2d || areAValidEscape(c2, c3);\r\n\t\t} else if(namestartchar(c1)) {\r\n\t\t\treturn true;\r\n\t\t} else if(c1 == 0x5c) {\r\n\t\t\treturn areAValidEscape(c1, c2);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\tvar startsWithAnIdentifier = function() {\r\n\t\treturn wouldStartAnIdentifier(code, next(1), next(2));\r\n\t};\r\n\r\n\tvar wouldStartANumber = function(c1, c2, c3) {\r\n\t\tif(c1 == 0x2b || c1 == 0x2d) {\r\n\t\t\tif(digit(c2)) return true;\r\n\t\t\tif(c2 == 0x2e && digit(c3)) return true;\r\n\t\t\treturn false;\r\n\t\t} else if(c1 == 0x2e) {\r\n\t\t\tif(digit(c2)) return true;\r\n\t\t\treturn false;\r\n\t\t} else if(digit(c1)) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\tvar startsWithANumber = function() {\r\n\t\treturn wouldStartANumber(code, next(1), next(2));\r\n\t};\r\n\r\n\tvar consumeAName = function() {\r\n\t\tvar result = \"\";\r\n\t\twhile(consume()) {\r\n\t\t\tif(namechar(code)) {\r\n\t\t\t\tresult += stringFromCode(code);\r\n\t\t\t} else if(startsWithAValidEscape()) {\r\n\t\t\t\tresult += stringFromCode(consumeEscape());\r\n\t\t\t} else {\r\n\t\t\t\treconsume();\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar consumeANumber = function() {\r\n\t\tvar repr = [];\r\n\t\tvar type = \"integer\";\r\n\t\tif(next() == 0x2b || next() == 0x2d) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t}\r\n\t\twhile(digit(next())) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t}\r\n\t\tif(next(1) == 0x2e && digit(next(2))) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar c1 = next(1), c2 = next(2), c3 = next(3);\r\n\t\tif((c1 == 0x45 || c1 == 0x65) && digit(c2)) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t} else if((c1 == 0x45 || c1 == 0x65) && (c2 == 0x2b || c2 == 0x2d) && digit(c3)) {\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\tconsume();\r\n\t\t\trepr += stringFromCode(code);\r\n\t\t\ttype = \"number\";\r\n\t\t\twhile(digit(next())) {\r\n\t\t\t\tconsume();\r\n\t\t\t\trepr += stringFromCode(code);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar value = convertAStringToANumber(repr);\r\n\t\treturn {type:type, value:value, repr:repr};\r\n\t};\r\n\r\n\tvar convertAStringToANumber = function(string) {\r\n\t\t// CSS's number rules are identical to JS, afaik.\r\n\t\treturn +string;\r\n\t};\r\n\r\n\tvar consumeTheRemnantsOfABadURL = function() {\r\n\t\twhile(consume()) {\r\n\t\t\tif(code == 0x29 || eof()) {\r\n\t\t\t\treturn;\r\n\t\t\t} else if(startsWithAValidEscape()) {\r\n\t\t\t\tconsumeEscape();\r\n\t\t\t\tdonothing();\r\n\t\t\t} else {\r\n\t\t\t\tdonothing();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\tvar iterationCount = 0;\r\n\twhile(!eof(next())) {\r\n\t\ttokens.push(consumeAToken());\r\n\t\titerationCount++;\r\n\t\tif(iterationCount > str.length*2) return \"I'm infinite-looping!\";\r\n\t}\r\n\treturn tokens;\r\n}\r\n\r\n// DONE: normalize type\r\nfunction CSSParserToken() {\r\n\tthis.value = 0;\r\n\tthis.repr = '';\r\n\tthis.type = \"unrestricted\";\r\n\tthis.unit = \"\";\r\n}//throw \"Abstract Base Class\"; }\r\nCSSParserToken.prototype.toJSON = function() {\r\n\treturn {token: this.tokenType};\r\n}\r\nCSSParserToken.prototype.toString = function() { return this.tokenType; }\r\nCSSParserToken.prototype.toSource = function() { return ''+this; }\r\n\r\nfunction BadStringToken() { return this; }\r\nBadStringToken.prototype = Object.create(CSSParserToken.prototype);\r\nBadStringToken.prototype.tokenType = \"BADSTRING\";\r\n\r\nfunction BadURLToken() { return this; }\r\nBadURLToken.prototype = Object.create(CSSParserToken.prototype);\r\nBadURLToken.prototype.tokenType = \"BADURL\";\r\n\r\nfunction WhitespaceToken() { return this; }\r\nWhitespaceToken.prototype = Object.create(CSSParserToken.prototype);\r\nWhitespaceToken.prototype.tokenType = \"WHITESPACE\";\r\nWhitespaceToken.prototype.toString = function() { return \"WS\"; }\r\nWhitespaceToken.prototype.toSource = function() { return \" \"; }\r\n\r\nfunction CDOToken() { return this; }\r\nCDOToken.prototype = Object.create(CSSParserToken.prototype);\r\nCDOToken.prototype.tokenType = \"CDO\";\r\nCDOToken.prototype.toSource = function() { return \"<!--\"; }\r\n\r\nfunction CDCToken() { return this; }\r\nCDCToken.prototype = Object.create(CSSParserToken.prototype);\r\nCDCToken.prototype.tokenType = \"CDC\";\r\nCDCToken.prototype.toSource = function() { return \"-->\"; }\r\n\r\nfunction ColonToken() { return this; }\r\nColonToken.prototype = Object.create(CSSParserToken.prototype);\r\nColonToken.prototype.tokenType = \"COLON\";\r\n\r\nfunction SemicolonToken() { return this; }\r\nSemicolonToken.prototype = Object.create(CSSParserToken.prototype);\r\nSemicolonToken.prototype.tokenType = \"SEMICOLON\";\r\n\r\nfunction CommaToken() { return this; }\r\nCommaToken.prototype = Object.create(CSSParserToken.prototype);\r\nCommaToken.prototype.tokenType = \"COMMA\";\r\n\r\nfunction GroupingToken() { throw \"Abstract Base Class\"; }\r\nGroupingToken.prototype = Object.create(CSSParserToken.prototype);\r\n\r\nfunction OpenCurlyToken() { this.value = \"{\"; this.mirror = \"}\"; return this; }\r\nOpenCurlyToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenCurlyToken.prototype.tokenType = \"OPENCURLY\";\r\n\r\nfunction CloseCurlyToken() { this.value = \"}\"; this.mirror = \"{\"; return this; }\r\nCloseCurlyToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseCurlyToken.prototype.tokenType = \"CLOSECURLY\";\r\n\r\nfunction OpenSquareToken() { this.value = \"[\"; this.mirror = \"]\"; return this; }\r\nOpenSquareToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenSquareToken.prototype.tokenType = \"OPENSQUARE\";\r\n\r\nfunction CloseSquareToken() { this.value = \"]\"; this.mirror = \"[\"; return this; }\r\nCloseSquareToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseSquareToken.prototype.tokenType = \"CLOSESQUARE\";\r\n\r\nfunction OpenParenToken() { this.value = \"(\"; this.mirror = \")\"; return this; }\r\nOpenParenToken.prototype = Object.create(GroupingToken.prototype);\r\nOpenParenToken.prototype.tokenType = \"OPENPAREN\";\r\n\r\nfunction CloseParenToken() { this.value = \")\"; this.mirror = \"(\"; return this; }\r\nCloseParenToken.prototype = Object.create(GroupingToken.prototype);\r\nCloseParenToken.prototype.tokenType = \"CLOSEPAREN\";\r\n\r\nfunction IncludeMatchToken() { return this; }\r\nIncludeMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nIncludeMatchToken.prototype.tokenType = \"~=\";\r\n\r\nfunction DashMatchToken() { return this; }\r\nDashMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nDashMatchToken.prototype.tokenType = \"|=\";\r\n\r\nfunction PrefixMatchToken() { return this; }\r\nPrefixMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nPrefixMatchToken.prototype.tokenType = \"^=\";\r\n\r\nfunction SuffixMatchToken() { return this; }\r\nSuffixMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nSuffixMatchToken.prototype.tokenType = \"$=\";\r\n\r\nfunction SubstringMatchToken() { return this; }\r\nSubstringMatchToken.prototype = Object.create(CSSParserToken.prototype);\r\nSubstringMatchToken.prototype.tokenType = \"*=\";\r\n\r\nfunction ColumnToken() { return this; }\r\nColumnToken.prototype = Object.create(CSSParserToken.prototype);\r\nColumnToken.prototype.tokenType = \"||\";\r\n\r\nfunction EOFToken() { return this; }\r\nEOFToken.prototype = Object.create(CSSParserToken.prototype);\r\nEOFToken.prototype.tokenType = \"EOF\";\r\nEOFToken.prototype.toSource = function() { return \"\"; }\r\n\r\n// TODO: normalize type\r\nfunction DelimToken(code) {\r\n\tthis.value = stringFromCode(code);\r\n\treturn this;\r\n}\r\nDelimToken.prototype = Object.create(CSSParserToken.prototype);\r\nDelimToken.prototype.tokenType = \"DELIM\";\r\nDelimToken.prototype.toString = function() { return \"DELIM(\"+this.value+\")\"; }\r\nDelimToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\treturn json;\r\n}\r\nDelimToken.prototype.toSource = function() {\r\n\tif(this.value == \"\\\\\")\r\n\t\treturn \"\\\\\\n\";\r\n\telse\r\n\t\treturn this.value;\r\n}\r\n\r\n// DONE: normalize type\r\nfunction StringValuedToken() {\r\n\tCSSParserToken.call(this);\r\n}//throw \"Abstract Base Class\"; }\r\nStringValuedToken.prototype = Object.create(CSSParserToken.prototype);\r\nStringValuedToken.prototype.ASCIIMatch = function(str) {\r\n\treturn this.value.toLowerCase() == str.toLowerCase();\r\n}\r\nStringValuedToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n//\tjson.value = this.value;\r\n\tjson.value = this.repr;\r\n\treturn json;\r\n}\r\n\r\n// DONE: normalize type\r\nfunction IdentToken(val) {\r\n\tStringValuedToken.call(this);\r\n\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n}\r\nIdentToken.prototype = Object.create(StringValuedToken.prototype);\r\nIdentToken.prototype.tokenType = \"IDENT\";\r\nIdentToken.prototype.toString = function() { return \"IDENT(\"+this.repr+\")\"; }//return \"IDENT(\"+this.value+\")\"; }\r\nIdentToken.prototype.toSource = function() {\r\n//\treturn escapeIdent(this.value);\r\n\treturn escapeIdent(this.repr);\r\n}\r\n\r\n// DONE: normalize type\r\nfunction FunctionToken(val) {\r\n\tStringValuedToken.call(this);\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n\tthis.mirror = \")\";\r\n}\r\nFunctionToken.prototype = Object.create(StringValuedToken.prototype);\r\nFunctionToken.prototype.tokenType = \"FUNCTION\";\r\nFunctionToken.prototype.toString = function() { return \"FUNCTION(\"+this.repr+\")\"; }//return \"FUNCTION(\"+this.value+\")\"; }\r\nFunctionToken.prototype.toSource = function() {\r\n//\treturn escapeIdent(this.value) + \"(\";\r\n\treturn escapeIdent(this.repr) + \"(\";\r\n}\r\n\r\n// DONE: normalize type\r\nfunction AtKeywordToken(val) {\r\n\tStringValuedToken.call(this);\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n}\r\nAtKeywordToken.prototype = Object.create(StringValuedToken.prototype);\r\nAtKeywordToken.prototype.tokenType = \"ATKEYWORD\";\r\nAtKeywordToken.prototype.toString = function() { return \"AT(\"+this.repr+\")\"; }//return \"AT(\"+this.value+\")\"; }\r\nAtKeywordToken.prototype.toSource = function() {\r\n//\treturn \"@\" + escapeIdent(this.value);\r\n\treturn \"@\" + escapeIdent(this.repr);\r\n}\r\n\r\n// TODO: normalize type\r\nfunction HashToken(val) {\r\n\tStringValuedToken.call(this);\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n\tthis.type = \"unrestricted\";\r\n}\r\nHashToken.prototype = Object.create(StringValuedToken.prototype);\r\nHashToken.prototype.tokenType = \"HASH\";\r\nHashToken.prototype.toString = function() { return \"HASH(\"+this.repr+\")\";}  //return \"HASH(\"+this.value+\")\"; }\r\nHashToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n//\tjson.value = this.value;\r\n\tjson.value = this.repr;\r\n\tjson.type = this.type;\r\n\treturn json;\r\n}\r\nHashToken.prototype.toSource = function() {\r\n//\tif(this.type == \"id\") {\r\n//\t\treturn \"#\" + escapeIdent(this.value);\r\n//\t} else {\r\n//\t\treturn \"#\" + escapeHash(this.value);\r\n//\t}\r\n\tif(this.type == \"id\") {\r\n\t\treturn \"#\" + escapeIdent(this.repr);\r\n\t} else {\r\n\t\treturn \"#\" + escapeHash(this.repr);\r\n\t}\r\n}\r\n\r\n// DONE: normalize type\r\nfunction StringToken(val) {\r\n\tStringValuedToken.call(this);\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n}\r\nStringToken.prototype = Object.create(StringValuedToken.prototype);\r\nStringToken.prototype.tokenType = \"STRING\";\r\nStringToken.prototype.toString = function() {\r\n//\treturn '\"' + escapeString(this.value) + '\"';\r\n\treturn '\"' + escapeString(this.repr) + '\"';\r\n}\r\n\r\n// DONE: normalize type\r\nfunction URLToken(val) {\r\n\tStringValuedToken.call(this);\r\n//\tthis.value = val;\r\n\tthis.repr = val;\r\n}\r\nURLToken.prototype = Object.create(StringValuedToken.prototype);\r\nURLToken.prototype.tokenType = \"URL\";\r\nURLToken.prototype.toString = function() { return \"URL(\"+this.repr+\")\"; }//return \"URL(\"+this.value+\")\"; }\r\nURLToken.prototype.toSource = function() {\r\n//\treturn 'url(\"' + escapeString(this.value) + '\")';\r\n\treturn 'url(\"' + escapeString(this.repr) + '\")';\r\n}\r\n\r\n// DONE: normalize type\r\nfunction NumberToken() {\r\n\tCSSParserToken.call(this);\r\n\tthis.value = 0;\r\n\tthis.type = \"integer\";\r\n\tthis.repr = \"\";\r\n}\r\nNumberToken.prototype = Object.create(CSSParserToken.prototype);\r\nNumberToken.prototype.tokenType = \"NUMBER\";\r\nNumberToken.prototype.toString = function() {\r\n//\tif(this.type == \"integer\")\r\n//\t\treturn \"INT(\"+this.value+\")\";\r\n//\treturn \"NUMBER(\"+this.value+\")\";\r\n\tif(this.type == \"integer\")\r\n\t\treturn \"INT(\"+this.repr+\")\";\r\n\treturn \"NUMBER(\"+this.repr+\")\";\r\n}\r\nNumberToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.type = this.type;\r\n\tjson.repr = this.repr;\r\n\treturn json;\r\n}\r\nNumberToken.prototype.toSource = function() { return this.repr; };\r\n\r\n// DONE: normalize type\r\nfunction PercentageToken() {\r\n\tCSSParserToken.call(this);\r\n\tthis.value = 0;\r\n\tthis.repr = \"\";\r\n\tthis.type = \"percentage\";\r\n}\r\nPercentageToken.prototype = Object.create(CSSParserToken.prototype);\r\nPercentageToken.prototype.tokenType = \"PERCENTAGE\";\r\nPercentageToken.prototype.toString = function() { return \"PERCENTAGE(\"+this.repr+\")\"; }//return \"PERCENTAGE(\"+this.value+\")\"; }\r\nPercentageToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.repr = this.repr;\r\n\treturn json;\r\n}\r\nPercentageToken.prototype.toSource = function() { return this.repr + \"%\"; }\r\n\r\n// DONE: normalize type\r\nfunction DimensionToken() {\r\n\tCSSParserToken.call(this);\r\n\tthis.value = null;\r\n\tthis.type = \"integer\";\r\n\tthis.repr = \"\";\r\n\tthis.unit = \"\";\r\n}\r\nDimensionToken.prototype = Object.create(CSSParserToken.prototype);\r\nDimensionToken.prototype.tokenType = \"DIMENSION\";\r\nDimensionToken.prototype.toString = function() { return \"DIM(\"+this.repr+\",\"+this.unit+\")\"; }//return \"DIM(\"+this.value+\",\"+this.unit+\")\"; }\r\nDimensionToken.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.value = this.value;\r\n\tjson.type = this.type;\r\n\tjson.repr = this.repr;\r\n\tjson.unit = this.unit;\r\n\treturn json;\r\n}\r\nDimensionToken.prototype.toSource = function() {\r\n\tvar source = this.repr;\r\n\tvar unit = escapeIdent(this.unit);\r\n\tif(unit[0].toLowerCase() == \"e\" && (unit[1] == \"-\" || between(unit.charCodeAt(1), 0x30, 0x39))) {\r\n\t\t// Unit is ambiguous with scinot\r\n\t\t// Remove the leading \"e\", replace with escape.\r\n\t\tunit = \"\\\\65 \" + unit.slice(1, unit.length);\r\n\t}\r\n\treturn source+unit;\r\n}\r\n\r\nfunction escapeIdent(string) {\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tvar firstcode = string.charCodeAt(0);\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tbetween(code, 0x1, 0x1f) || code == 0x7f ||\r\n\t\t\t(i == 0 && between(code, 0x30, 0x39)) ||\r\n\t\t\t(i == 1 && between(code, 0x30, 0x39) && firstcode == 0x2d)\r\n\t\t) {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t} else if(\r\n\t\t\tcode >= 0x80 ||\r\n\t\t\tcode == 0x2d ||\r\n\t\t\tcode == 0x5f ||\r\n\t\t\tbetween(code, 0x30, 0x39) ||\r\n\t\t\tbetween(code, 0x41, 0x5a) ||\r\n\t\t\tbetween(code, 0x61, 0x7a)\r\n\t\t) {\r\n\t\t\tresult += string[i];\r\n\t\t} else {\r\n\t\t\tresult += '\\\\' + string[i];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction escapeHash(string) {\r\n\t// Escapes the contents of \"unrestricted\"-type hash tokens.\r\n\t// Won't preserve the ID-ness of \"id\"-type hash tokens;\r\n\t// use escapeIdent() for that.\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tvar firstcode = string.charCodeAt(0);\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tcode >= 0x80 ||\r\n\t\t\tcode == 0x2d ||\r\n\t\t\tcode == 0x5f ||\r\n\t\t\tbetween(code, 0x30, 0x39) ||\r\n\t\t\tbetween(code, 0x41, 0x5a) ||\r\n\t\t\tbetween(code, 0x61, 0x7a)\r\n\t\t) {\r\n\t\t\tresult += string[i];\r\n\t\t} else {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction escapeString(string) {\r\n\tstring = ''+string;\r\n\tvar result = '';\r\n\tfor(var i = 0; i < string.length; i++) {\r\n\t\tvar code = string.charCodeAt(i);\r\n\r\n\t\tif(code == 0x0) {\r\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\r\n\t\t}\r\n\r\n\t\tif(between(code, 0x1, 0x1f) || code == 0x7f) {\r\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\r\n\t\t} else if(code == 0x22 || code == 0x5c) {\r\n\t\t\tresult += '\\\\' + string[i];\r\n\t\t} else {\r\n\t\t\tresult += string[i];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n// Exportation.\r\nexports.tokenize = tokenize;\r\nexports.IdentToken = IdentToken;\r\nexports.FunctionToken = FunctionToken;\r\nexports.AtKeywordToken = AtKeywordToken;\r\nexports.HashToken = HashToken;\r\nexports.StringToken = StringToken;\r\nexports.BadStringToken = BadStringToken;\r\nexports.URLToken = URLToken;\r\nexports.BadURLToken = BadURLToken;\r\nexports.DelimToken = DelimToken;\r\nexports.NumberToken = NumberToken;\r\nexports.PercentageToken = PercentageToken;\r\nexports.DimensionToken = DimensionToken;\r\nexports.IncludeMatchToken = IncludeMatchToken;\r\nexports.DashMatchToken = DashMatchToken;\r\nexports.PrefixMatchToken = PrefixMatchToken;\r\nexports.SuffixMatchToken = SuffixMatchToken;\r\nexports.SubstringMatchToken = SubstringMatchToken;\r\nexports.ColumnToken = ColumnToken;\r\nexports.WhitespaceToken = WhitespaceToken;\r\nexports.CDOToken = CDOToken;\r\nexports.CDCToken = CDCToken;\r\nexports.ColonToken = ColonToken;\r\nexports.SemicolonToken = SemicolonToken;\r\nexports.CommaToken = CommaToken;\r\nexports.OpenParenToken = OpenParenToken;\r\nexports.CloseParenToken = CloseParenToken;\r\nexports.OpenSquareToken = OpenSquareToken;\r\nexports.CloseSquareToken = CloseSquareToken;\r\nexports.OpenCurlyToken = OpenCurlyToken;\r\nexports.CloseCurlyToken = CloseCurlyToken;\r\nexports.EOFToken = EOFToken;\r\nexports.CSSParserToken = CSSParserToken;\r\nexports.GroupingToken = GroupingToken;\r\n\r\nfunction TokenStream(tokens) {\r\n\t// Assume that tokens is an array.\r\n\tthis.tokens = tokens;\r\n\tthis.i = -1;\r\n}\r\nTokenStream.prototype.tokenAt = function(i) {\r\n\tif(i < this.tokens.length)\r\n\t\treturn this.tokens[i];\r\n\treturn new EOFToken();\r\n}\r\nTokenStream.prototype.consume = function(num) {\r\n\tif(num === undefined) num = 1;\r\n\tthis.i += num;\r\n\tthis.token = this.tokenAt(this.i);\r\n\t//console.log(this.i, this.token);\r\n\treturn true;\r\n}\r\nTokenStream.prototype.next = function() {\r\n\treturn this.tokenAt(this.i+1);\r\n}\r\nTokenStream.prototype.reconsume = function() {\r\n\tthis.i--;\r\n}\r\n\r\nfunction parseerror(s, msg) {\r\n\tconsole.log(\"Parse error at token \" + s.i + \": \" + s.token + \".\\n\" + msg);\r\n\treturn true;\r\n}\r\nfunction donothing(){ return true; };\r\n\r\nfunction consumeAListOfRules(s, topLevel) {\r\n\tvar rules = [];\r\n\tvar rule;\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof WhitespaceToken) {\r\n\t\t\tcontinue;\r\n\t\t} else if(s.token instanceof EOFToken) {\r\n\t\t\treturn rules;\r\n\t\t} else if(s.token instanceof CDOToken || s.token instanceof CDCToken) {\r\n\t\t\tif(topLevel == \"top-level\") continue;\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAQualifiedRule(s)) rules.push(rule);\r\n\t\t} else if(s.token instanceof AtKeywordToken) {\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAnAtRule(s)) rules.push(rule);\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\tif(rule = consumeAQualifiedRule(s)) rules.push(rule);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAnAtRule(s) {\r\n\ts.consume();\r\n\tvar rule = new AtRule(s.token.value);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof SemicolonToken || s.token instanceof EOFToken) {\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof OpenCurlyToken) {\r\n\t\t\trule.value = consumeASimpleBlock(s);\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\r\n\t\t\trule.value = s.token;\r\n\t\t\treturn rule;\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\trule.prelude.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAQualifiedRule(s) {\r\n\tvar rule = new QualifiedRule();\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken) {\r\n\t\t\tparseerror(s, \"Hit EOF when trying to parse the prelude of a qualified rule.\");\r\n\t\t\treturn;\r\n\t\t} else if(s.token instanceof OpenCurlyToken) {\r\n\t\t\trule.value = consumeASimpleBlock(s);\r\n\t\t\treturn rule;\r\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\r\n\t\t\trule.value = s.token;\r\n\t\t\treturn rule;\r\n\t\t} else {\r\n\t\t\ts.reconsume();\r\n\t\t\trule.prelude.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeAListOfDeclarations(s) {\r\n\tvar decls = [];\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof WhitespaceToken || s.token instanceof SemicolonToken) {\r\n\t\t\tdonothing();\r\n\t\t} else if(s.token instanceof EOFToken) {\r\n\t\t\treturn decls;\r\n\t\t} else if(s.token instanceof AtKeywordToken) {\r\n\t\t\ts.reconsume();\r\n\t\t\tdecls.push(consumeAnAtRule(s));\r\n\t\t} else if(s.token instanceof IdentToken) {\r\n\t\t\tvar temp = [s.token];\r\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\r\n\t\t\t\ttemp.push(consumeAComponentValue(s));\r\n\t\t\tvar decl;\r\n\t\t\tif(decl = consumeADeclaration(new TokenStream(temp))) decls.push(decl);\r\n\t\t} else {\r\n\t\t\tparseerror(s);\r\n\t\t\ts.reconsume();\r\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\r\n\t\t\t\tconsumeAComponentValue(s);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction consumeADeclaration(s) {\r\n\t// Assumes that the next input token will be an ident token.\r\n\ts.consume();\r\n\tvar decl = new Declaration(s.token.value);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(!(s.next() instanceof ColonToken)) {\r\n\t\tparseerror(s);\r\n\t\treturn;\r\n\t} else {\r\n\t\ts.consume();\r\n\t}\r\n\twhile(!(s.next() instanceof EOFToken)) {\r\n\t\tdecl.value.push(consumeAComponentValue(s));\r\n\t}\r\n\tvar foundImportant = false;\r\n\tfor(var i = decl.value.length - 1; i >= 0; i--) {\r\n\t\tif(decl.value[i] instanceof WhitespaceToken) {\r\n\t\t\tcontinue;\r\n\t\t} else if(decl.value[i] instanceof IdentToken && decl.value[i].ASCIIMatch(\"important\")) {\r\n\t\t\tfoundImportant = true;\r\n\t\t} else if(foundImportant && decl.value[i] instanceof DelimToken && decl.value[i].value == \"!\") {\r\n\t\t\tdecl.value.splice(i, decl.value.length);\r\n\t\t\tdecl.important = true;\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn decl;\r\n}\r\n\r\nfunction consumeAComponentValue(s) {\r\n\ts.consume();\r\n\tif(s.token instanceof OpenCurlyToken || s.token instanceof OpenSquareToken || s.token instanceof OpenParenToken)\r\n\t\treturn consumeASimpleBlock(s);\r\n\tif(s.token instanceof FunctionToken)\r\n\t\treturn consumeAFunction(s);\r\n\treturn s.token;\r\n}\r\n\r\nfunction consumeASimpleBlock(s) {\r\n\tvar mirror = s.token.mirror;\r\n\tvar block = new SimpleBlock(s.token.value);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken || (s.token instanceof GroupingToken && s.token.value == mirror))\r\n\t\t\treturn block;\r\n\t\telse {\r\n\t\t\ts.reconsume();\r\n\t\t\tblock.value.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// DONE: normalize type\r\nfunction consumeAFunction(s) {\r\n//\tvar func = new Func(s.token.value);\r\n\tvar func = new Func(s.token.repr);\r\n\twhile(s.consume()) {\r\n\t\tif(s.token instanceof EOFToken || s.token instanceof CloseParenToken)\r\n\t\t\treturn func;\r\n\t\telse {\r\n\t\t\ts.reconsume();\r\n\t\t\tfunc.value.push(consumeAComponentValue(s));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction normalizeInput(input) {\r\n\tif(typeof input == \"string\")\r\n\t\treturn new TokenStream(tokenize(input));\r\n\telse if(typeof input == \"number\")\r\n\t\treturn new TokenStream(tokenize(input.toString()));\r\n\tif(input instanceof TokenStream)\r\n\t\treturn input;\r\n\tif(input.length !== undefined)\r\n\t\treturn new TokenStream(input);\r\n\telse throw SyntaxError(String(input) + ' ' + typeof input);\r\n}\r\n\r\nfunction parseAStylesheet(s) {\r\n\ts = normalizeInput(s);\r\n\tvar sheet = new Stylesheet();\r\n\tsheet.value = consumeAListOfRules(s, \"top-level\");\r\n\treturn sheet;\r\n}\r\n\r\nfunction parseAListOfRules(s) {\r\n\ts = normalizeInput(s);\r\n\treturn consumeAListOfRules(s);\r\n}\r\n\r\nfunction parseARule(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\r\n\tif(s.next() instanceof AtKeywordToken) {\r\n\t\tvar rule = consumeAnAtRule(s);\r\n\t} else {\r\n\t\tvar rule = consumeAQualifiedRule(s);\r\n\t\tif(!rule) throw SyntaxError();\r\n\t}\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken)\r\n\t\treturn rule;\r\n\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseADeclaration(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(!(s.next() instanceof IdentToken)) throw SyntaxError();\r\n\tvar decl = consumeADeclaration(s);\r\n\tif(decl)\r\n\t\treturn decl\r\n\telse\r\n\t\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseAListOfDeclarations(s) {\r\n\ts = normalizeInput(s);\r\n\treturn consumeAListOfDeclarations(s);\r\n}\r\n\r\nfunction parseAComponentValue(s) {\r\n\ts = normalizeInput(s);\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\r\n\tvar val = consumeAComponentValue(s);\r\n\tif(!val) throw SyntaxError();\r\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\r\n\tif(s.next() instanceof EOFToken)\r\n\t\treturn val;\r\n\tthrow SyntaxError();\r\n}\r\n\r\nfunction parseAListOfComponentValues(s) {\r\n\ts = normalizeInput(s);\r\n\tvar vals = [];\r\n\twhile(true) {\r\n\t\tvar val = consumeAComponentValue(s);\r\n\t\tif(val instanceof EOFToken)\r\n\t\t\treturn vals\r\n\t\telse\r\n\t\t\tvals.push(val);\r\n\t}\r\n}\r\n\r\nfunction parseACommaSeparatedListOfComponentValues(s) {\r\n\ts = normalizeInput(s);\r\n\tvar listOfCVLs = [];\r\n\twhile(true) {\r\n\t\tvar vals = [];\r\n\t\twhile(true) {\r\n\t\t\tvar val = consumeAComponentValue(s);\r\n\t\t\tif(val instanceof EOFToken) {\r\n\t\t\t\tlistOfCVLs.push(vals);\r\n\t\t\t\treturn listOfCVLs;\r\n\t\t\t} else if(val instanceof CommaToken) {\r\n\t\t\t\tlistOfCVLs.push(vals);\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tvals.push(val);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction CSSParserRule() { throw \"Abstract Base Class\"; }\r\nCSSParserRule.prototype.toString = function(indent) {\r\n\treturn JSON.stringify(this,null,indent);\r\n}\r\nCSSParserRule.prototype.toJSON = function() {\r\n\treturn {type:this.type, value:this.value};\r\n}\r\n\r\nfunction Stylesheet() {\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nStylesheet.prototype = Object.create(CSSParserRule.prototype);\r\nStylesheet.prototype.type = \"STYLESHEET\";\r\n\r\nfunction AtRule(name) {\r\n\tthis.name = name;\r\n\tthis.prelude = [];\r\n\tthis.value = null;\r\n\treturn this;\r\n}\r\nAtRule.prototype = Object.create(CSSParserRule.prototype);\r\nAtRule.prototype.type = \"AT-RULE\";\r\nAtRule.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\tjson.prelude = this.prelude;\r\n\treturn json;\r\n}\r\n\r\nfunction QualifiedRule() {\r\n\tthis.prelude = [];\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nQualifiedRule.prototype = Object.create(CSSParserRule.prototype);\r\nQualifiedRule.prototype.type = \"QUALIFIED-RULE\";\r\nQualifiedRule.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.prelude = this.prelude;\r\n\treturn json;\r\n}\r\n\r\nfunction Declaration(name) {\r\n\tthis.name = name;\r\n\tthis.value = [];\r\n\tthis.important = false;\r\n\treturn this;\r\n}\r\nDeclaration.prototype = Object.create(CSSParserRule.prototype);\r\nDeclaration.prototype.type = \"DECLARATION\";\r\nDeclaration.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\tjson.important = this.important;\r\n\treturn json;\r\n}\r\n\r\nfunction SimpleBlock(type) {\r\n\tthis.name = type;\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nSimpleBlock.prototype = Object.create(CSSParserRule.prototype);\r\nSimpleBlock.prototype.type = \"BLOCK\";\r\nSimpleBlock.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\treturn json;\r\n}\r\n\r\nfunction Func(name) {\r\n\tthis.name = name;\r\n\tthis.value = [];\r\n\treturn this;\r\n}\r\nFunc.prototype = Object.create(CSSParserRule.prototype);\r\nFunc.prototype.type = \"FUNCTION\";\r\nFunc.prototype.tokenType = \"FUNCTION\";\r\nFunc.prototype.toJSON = function() {\r\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\r\n\tjson.name = this.name;\r\n\treturn json;\r\n}\r\n\r\n\r\n/* Grammar Application */\r\n\r\nfunction canonicalize(rule, grammar, topGrammar) {\r\n\tif(grammar === undefined) grammar = CSSGrammar;\r\n\tif(topGrammar === undefined) topGrammar = grammar\r\n\tif(!validateGrammar(grammar)) return;\r\n\tif(grammar) {\r\n\t\tif(grammar.stylesheet) grammar = topGrammar;\r\n\t\tvar unknownTransformer = grammar.unknown || function(){return};\r\n\t}\r\n\tvar ret = {\"type\":rule.type.toLowerCase()};\r\n\r\n\tif(rule.type == \"STYLESHEET\") {\r\n\t\tvar contents = rule.value;\r\n\t} else if(rule.type == \"BLOCK\") {\r\n\t\tvar unparsedContents = rule.value;\r\n\t\tret.name = rule.name;\r\n\t} else if(rule.type == \"QUALIFIED-RULE\") {\r\n\t\tvar unparsedContents = rule.value.value;\r\n\t\tret.prelude = rule.prelude;\r\n\t} else if(rule.type == \"AT-RULE\") {\r\n\t\tvar unparsedContents = rule.value.value;\r\n\t\tret.name = rule.name;\r\n\t\tret.prelude = rule.prelude;\r\n\t} else if(rule.type == \"DECLARATION\") {\r\n\t\t// I don't do grammar-checking of declarations yet.\r\n\t\tret.name = rule.name;\r\n\t\tret.value = rule.value;\r\n\t\tret.important = rule.important;\r\n\t\treturn ret;\r\n\t}\r\n\tif(unparsedContents) {\r\n\t\tif(grammar.declarations) {\r\n\t\t\tvar contents = parseAListOfDeclarations(unparsedContents);\r\n\t\t} else if(grammar.qualified) {\r\n\t\t\tvar contents = parseAListOfRules(unparsedContents);\r\n\t\t}\r\n\t}\r\n\r\n\tif(!grammar) {\r\n\t\treturn ret;\r\n\t} else if(grammar.declarations) {\r\n\t\tret.declarations = {}; // simple key/value map of declarations\r\n\t\tret.rules = []; // in-order list of both decls and at-rules\r\n\t\tret.errors = [];\r\n\t\tfor(var i = 0; i < contents.length; i++) {\r\n\t\t\tvar rule = contents[i];\r\n\t\t\tif(rule instanceof Declaration) {\r\n\t\t\t\tvar decl = canonicalize(rule, {}, topGrammar);\r\n\t\t\t\tret.declarations[rule.name] = decl;\r\n\t\t\t\tret.rules.push(decl);\r\n\t\t\t} else { // rule is instanceof AtRule\r\n\t\t\t\tvar subGrammar = grammar[\"@\" + rule.name];\r\n\t\t\t\tif(subGrammar) { // Rule is valid in this context\r\n\t\t\t\t\tret.rules.push(canonicalize(rule, subGrammar, topGrammar));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar result = unknownTransformer(rule);\r\n\t\t\t\t\tif(result) {\r\n\t\t\t\t\t\tret.rules.push(result);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret.errors.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tret.rules = [];\r\n\t\tret.errors = [];\r\n\t\tfor(var i = 0; i < contents.length; i++) {\r\n\t\t\tvar rule = contents[i];\r\n\t\t\tif(rule instanceof QualifiedRule) {\r\n\t\t\t\tret.rules.push(canonicalize(rule, grammar.qualified, topGrammar));\r\n\t\t\t} else {\r\n\t\t\t\tvar subGrammar = grammar[\"@\" + rule.name];\r\n\t\t\t\tif(subGrammar) { // Rule is valid in this context\r\n\t\t\t\t\tret.rules.push(canonicalize(rule, subGrammar, topGrammar));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar result = unknownTransformer(rule);\r\n\t\t\t\t\tif(result) {\r\n\t\t\t\t\t\tret.rules.push(result);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret.errors.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction validateGrammar(grammar) {\r\n\t// TODO\r\n\treturn true\r\n}\r\n\r\nvar CSSGrammar = {\r\n\tqualified: {declarations:true},\r\n\t\"@media\": {stylesheet:true},\r\n\t\"@keyframes\": {qualified:{declarations:true}},\r\n\t\"@font-face\": {declarations:true},\r\n\t\"@supports\": {stylesheet:true},\r\n\t\"@scope\": {stylesheet:true},\r\n\t\"@counter-style\": {declarations:true},\r\n\t\"@import\": null,\r\n\t\"@font-feature-values\": {\r\n\t\t// No qualified rules actually allowed,\r\n\t\t// but have to declare it one way or the other.\r\n\t\tqualified: true,\r\n\t\t\"@stylistic\": {declarations:true},\r\n\t\t\"@styleset\": {declarations:true},\r\n\t\t\"@character-variants\": {declarations:true},\r\n\t\t\"@swash\": {declarations:true},\r\n\t\t\"@ornaments\": {declarations:true},\r\n\t\t\"@annotation\": {declarations:true},\r\n\t},\r\n\t\"@viewport\": {declarations:true},\r\n\t\"@page\": {\r\n\t\tdeclarations: true,\r\n\t\t\"@top-left-corner\": {declarations:true},\r\n\t\t\"@top-left\": {declarations:true},\r\n\t\t\"@top-center\": {declarations:true},\r\n\t\t\"@top-right\": {declarations:true},\r\n\t\t\"@top-right-corner\": {declarations:true},\r\n\t\t\"@right-top\": {declarations:true},\r\n\t\t\"@right-middle\": {declarations:true},\r\n\t\t\"@right-bottom\": {declarations:true},\r\n\t\t\"@right-bottom-corner\": {declarations:true},\r\n\t\t\"@bottom-right\": {declarations:true},\r\n\t\t\"@bottom-center\": {declarations:true},\r\n\t\t\"@bottom-left\": {declarations:true},\r\n\t\t\"@bottom-left-corner\": {declarations:true},\r\n\t\t\"@left-bottom\": {declarations:true},\r\n\t\t\"@left-center\": {declarations:true},\r\n\t\t\"@left-top\": {declarations:true},\r\n\t},\r\n\t\"@custom-selector\": null,\r\n\t\"@custom-media\": null\r\n}\r\n\r\n\r\n\r\n// Exportation.\r\nexports.CSSParserRule = CSSParserRule;\r\nexports.Stylesheet = Stylesheet;\r\nexports.AtRule = AtRule;\r\nexports.QualifiedRule = QualifiedRule;\r\nexports.Declaration = Declaration;\r\nexports.SimpleBlock = SimpleBlock;\r\nexports.Func = Func;\r\nexports.parseAStylesheet = parseAStylesheet;\r\nexports.parseAListOfRules = parseAListOfRules;\r\nexports.parseARule = parseARule;\r\nexports.parseADeclaration = parseADeclaration;\r\nexports.parseAListOfDeclarations = parseAListOfDeclarations;\r\nexports.parseAComponentValue = parseAComponentValue;\r\nexports.parseAListOfComponentValues = parseAListOfComponentValues;\r\nexports.parseACommaSeparatedListOfComponentValues = parseACommaSeparatedListOfComponentValues;\r\nexports.canonicalizeRule = canonicalize;\r\nexports.CSSGrammar = CSSGrammar;\r\n\r\n}));\r\n",
    "\"use strict\";\n/**\r\n * @constructor AbstractStylesheet\r\n * \r\n * @param {object} styleRules\r\n * @returns self\r\n */\r\n\r\nvar appConstants = require('src/appLauncher/appLauncher');\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar StyleRule = require('src/editing/StyleRule');\r\nvar Style = require('src/editing/Style');\r\nvar AdvancedAttributesList = require('src/editing/SplittedAttributes');\r\n\r\n\t\r\nvar AbstractStylesheet = function(styleRules, name) {\r\n\tthis.objectType = 'AbstractStylesheet';\r\n\tif (name)\r\n\t\tthis.name = name;\r\n\t\r\n\tif (!Array.isArray(styleRules)) {\r\n\t\tconsole.warn(this.objectType, 'styleRules isn\\'t an Array. Returning..., \"', styleRules, '\" has been received');\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tthis.length = 0;\r\n\tthis.rules = {};\r\n\tthis.currentAPI = new DOMStyleAPI(name);\r\n\t\r\n\tthis.iterateOnRules(styleRules);\r\n}\r\n\r\nAbstractStylesheet.prototype.getName = function() {\r\n\treturn this.currentAPI.getName();\r\n}\r\n\r\nAbstractStylesheet.prototype.getStyleNode = function() {\r\n\treturn this.currentAPI.getStyleNode();\r\n}\r\n\r\n//AbstractStylesheet.prototype.export = function(defUID) {\r\n//\tvar cachedUnderUID = TypeManager.sWrappersCache.getItem(defUID);\r\n//\tif (Object.prototype.toString.call(cachedUnderUID) === '[object Object]')\r\n//\t\treturn cachedUnderUID.clone();\r\n//\telse {\r\n//\t\tTypeManager.sWrappersCache.setItem(defUID, this);\r\n//\t\treturn this.clone()\t\r\n//\t}\r\n//}\r\n\r\nAbstractStylesheet.prototype.getProp = function(selector, prop) {\r\n\treturn this.rules[selector].getAttr(prop);\r\n}\r\n\r\nAbstractStylesheet.prototype.setProp = function(selector, prop, value) {\r\n\tthis.rules[selector].setAttr(prop, value);\r\n\tthis.replaceRule(selector);\r\n}\r\n\r\nAbstractStylesheet.prototype.iterateOnRules = function(styleRules) {\r\n\tstyleRules.forEach(function(rawRule) {\r\n\t\tthis.addRule(rawRule);\r\n\t}, this);\r\n}\r\n\r\nAbstractStylesheet.prototype.newRule = function(rawRule) {\r\n\tif (rawRule instanceof AdvancedAttributesList) {\r\n\t\tvar selector = rawRule.selector;\r\n\t\tdelete rawRule.selector;\r\n\t\treturn StyleRule.fromAdvancedStyleAttributes(this.length++, selector, rawRule)\r\n\t}\r\n\telse\r\n\t\treturn new StyleRule(this.length++, rawRule);\r\n}\r\n\r\nAbstractStylesheet.prototype.deleteRule = function(selector) {\r\n\tdelete this[selector];\r\n\treturn --this.length;\r\n}\r\n\r\nAbstractStylesheet.prototype.addRule = function(rule, selector) {\r\n\tvar sRule;\r\n\tif (!(rule instanceof StyleRule))\r\n\t\tsRule = this.newRule(rule);\r\n\telse\r\n\t\tsRule = rule;\r\n\tselector = rule.selector || sRule.selector || (rule.attrIFace && rule.attrIFace.selector) || selector;\r\n\t\r\n\tif (!selector) {\r\n\t\tconsole.warn('AbstractStylesheet: constructing a styleRule based on an empty selector', rule, 'Returning...');\r\n\t\treturn;\r\n\t}\r\n\tthis.rules[selector] = sRule;\r\n}\r\n\r\nAbstractStylesheet.prototype.addRules = function(rules) {\r\n\tif (!Array.isArray(rules)) {\r\n\t\tconsole.warn(this.objectType, 'addRules only accepts arrays. Returning...');\r\n\t\treturn;\r\n\t}\r\n\trules.forEach(function(rule) {\r\n\t\tthis.addRule(rule);\r\n\t}, this);\r\n}\r\n\r\n\r\n\r\nAbstractStylesheet.prototype.updateRule = function(rawRule, selector) {\r\n\tselector = rawRule.selector || selector;\r\n\tthis.rules[selector].setAttributes(rawRule);\r\n\tthis.replaceRule(selector);\r\n}\r\n\r\nAbstractStylesheet.prototype.replaceRule = function(selector) {\r\n\tif (!this.rules[selector].strRule.length)\r\n\t\treturn;\r\n\tvar newStrRule = this.rules[selector].styleIFace.linearize();\r\n\tthis.currentAPI.replaceRule(this.rules[selector].strRule, newStrRule);\r\n\tthis.rules[selector].strRule = newStrRule;\r\n}\r\n\r\nAbstractStylesheet.prototype.removeRule = function(selector) {\r\n\tthis.currentAPI.removeRule(this.rules[selector].strRule);\r\n\tthis.deleteRule(selector);\r\n}\r\n\r\nAbstractStylesheet.prototype.overrideStyles = function(styleRules) {\r\n\tif (!styleRules || !Array.isArray(styleRules)) {\r\n\t\tconsole.warn(this.objectType, 'overrideStyles only accepts arrays.', styleRules === null ? 'null' : typeof styleRules, 'given. Returning...');\r\n\t\treturn;\r\n\t}\r\n\tstyleRules.forEach(function(rawRule) {\r\n\t\tif (rawRule.selector)\r\n\t\t\tthis.safeMergeStyleRule(rawRule.selector, rawRule);\r\n\t}, this);\r\n}\r\n\r\nAbstractStylesheet.prototype.safeMergeStyleRule = function(selector, rawRule) {\r\n\tif (typeof this.rules[selector] !=='undefined')\r\n\t\tthis.rules[selector].safeMergeAttributes(rawRule);\r\n\telse\r\n\t\tthis.addRule(rawRule, selector);\r\n}\r\n\r\nAbstractStylesheet.prototype.clone = function() {\r\n\tvar styleRules = [];\r\n\tfor (let selector in this.rules) {\r\n\t\tstyleRules.push(\r\n\t\t\tObject.assign(\r\n\t\t\t\tthis.rules[selector].cloneAttributes(),\r\n\t\t\t\t{selector : selector}\r\n\t\t\t)\r\n\t\t);\r\n\t\t// HACK\r\n//\t\tif (this.rules[selector].hasOverride) {\r\n//\t\t\tconsole.log(this.objectType, selector, 'hasOverride : ', styleRules[styleRules.length - 1]);\r\n//\t\t\tObject.assign(styleRules[styleRules.length - 1], this.rules[selector].additionalAttributes);\r\n//\t\t}\r\n\t}\r\n\tif (!Array.isArray(styleRules))\r\n\t\tconsole.error(styleRules);\r\n\treturn new AbstractStylesheet(styleRules, this.currentAPI.getName());\r\n}\r\n\r\nAbstractStylesheet.prototype.shouldSerializeOne = function(selector) {\r\n\tif (this.rules[selector].strRule.length) {\r\n\t\tthis.replaceRule(selector);\r\n\t\treturn;\r\n\t}\r\n\tthis.rules[selector].strRule = this.rules[selector].styleIFace.linearize();\r\n\tthis.currentAPI.appendRule(this.rules[selector].strRule);\r\n}\r\n\r\nAbstractStylesheet.prototype.shouldSerializeAll = function() {\r\n\tvar styleAsString = '';\r\n\tfor (let selector in this.rules) {\r\n\t\tthis.rules[selector].applyAdditionnalStyleAsOverride();\r\n\t\tstyleAsString += (this.rules[selector].strRule = this.rules[selector].styleIFace.linearize());\r\n\t}\r\n\tthis.currentAPI.setContent(styleAsString);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar DOMStyleAPI = function(name) {\r\n\tthis.styleElem = {};\t\t\t\t// should be null\r\n\tname = this.getStyleElem(name);\t\t// cache temporary registration magic...\r\n\tthis.styleElem.name = name;\r\n\tthis.stylesheet = this.styleElem.sheet;\r\n}\r\n\r\nDOMStyleAPI.prototype.getStyleElem = function(name) {\r\n\tvar cachedUnderUID = appConstants.isKnownUID(name);\r\n\tif (Object.prototype.toString.call(cachedUnderUID) === '[object Object]') {\r\n\t\tthis.styleElem = cachedUnderUID.currentAPI.getStyleNode().cloneNode(true);\r\n\t\treturn name;\r\n\t}\r\n\telse {\r\n\t\t// HACK: before we generalize the API for style objects, there's only this one...\r\n\t\t//\t\t=> don't try to get a stylElement if we're outside the browser\r\n\t\tif (typeof document === 'undefined' || typeof document.ownerDocument === 'undefined')\r\n\t\t\treturn cachedUnderUID;\r\n\t\tthis.styleElem = document.createElement('style');\r\n\t\treturn cachedUnderUID;\r\n\t}\r\n}\r\n\r\nDOMStyleAPI.prototype.getName = function() {\r\n\treturn this.styleElem.name;\r\n}\r\n\r\nDOMStyleAPI.prototype.getStyleNode = function() {\r\n\treturn this.styleElem;\r\n}\r\n\r\nDOMStyleAPI.prototype.appendRule = function(strRule) {\r\n\tthis.styleElem.innerHTML += strRule;\r\n}\r\n\r\nDOMStyleAPI.prototype.setContent = function(strContent) {\r\n\tthis.styleElem.innerHTML = strContent;\r\n}\r\n\r\nDOMStyleAPI.prototype.removeRule = function(strRule) {\r\n\tthis.styleElem.innerHTML = this.styleElem.innerHTML.replace(strRule, '');\r\n}\r\n\r\nDOMStyleAPI.prototype.replaceRule = function(strRule, newStrRule) {\r\n\tthis.styleElem.innerHTML = this.styleElem.innerHTML.replace(strRule, newStrRule);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = AbstractStylesheet;\r\n",
    "\"use strict\";\n/**\r\n * @constructor CSSPropertyBuffer\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar BinarySchemaFactory = require('src/core/BinarySchema');\r\nvar GeneratorFor16bitsInt = require('src/core/UIDGenerator').GeneratorFor16bitsInt;\r\n//var CSSPropertyDescriptors = require('src/editing/CSSPropertyDescriptors');\r\nvar parser = require('src/parsers/css-parser_forked_normalized');\r\n\r\nvar CSSPropertyBuffer = function(initialLoad, propName) {\r\n\tthis.objectType = 'CSSPropertyBuffer';\r\n\tthis.propName = propName;\r\n\tthis._buffer = new Uint8Array(initialLoad || this.bufferSchema.size);\r\n\t\r\n//\tif (typeof initialLoad === 'undefined' || initialLoad === null\r\n//\t\t\t|| (\r\n//\t\t\t\tObject.getPrototypeOf(initialLoad) === Uint8Array.prototype\r\n//\t\t\t\t\t&& initialLoad[0] === 0\r\n//\t\t\t)\r\n//\t\t) {\r\n//\t\t\tvar defaultValue = CSSPropertyDescriptors[propName].prototype.initialValue;\r\n//\t\t\t\r\n//\t\t\tif (typeof defaultValue !== 'undefined' && defaultValue !== null) {\r\n//\t\t\t\tthis.setValue(this.parseValue(defaultValue));\r\n//\t\t\t}\r\n//\t}\r\n}\r\nCSSPropertyBuffer.prototype = {};\r\nCSSPropertyBuffer.prototype.objectType = 'CSSPropertyBuffer';\r\n\r\nCSSPropertyBuffer.prototype.setValue = function(value) {\r\n\t\r\n//\tif (/\\s/.test(value))\r\n//\t\tparsedValue = parser.parseAListOfComponentValues(value);\r\n//\telse\r\n//\t\tparsedValue = [value];\r\n//\tconsole.log('setValue', value);\r\n\t// For now, we haven't yet populated the initlaValue for each CSSPropertyDescriptor.\r\n\t// So this function is very frequently called with an empty array\r\n\tif (!value.length)\r\n\t\treturn;\r\n\t\r\n\tvar valueAsParsed, tokenType, concatVal;\r\n\t// if the property is a shorthand property, or if the property may be abbreviated,\r\n\t// we concatenate back\r\n\t// => shorthands are then handled (expanded) in CSSPropertySetBuffer.setPropFromShorthand()\r\n\t// => abbreviated props are also handled (in a branch) of CSSPropertySetBuffer.setPropFromShorthand()\r\n\t\r\n\tif (!/\\s/.test(value.trim())) {\r\n\t\tvar parsedValue = parser.parseAListOfComponentValues(value.trim());\r\n\t\tif (!parsedValue.length)\r\n\t\t\treturn;\r\n//\t\tif (Object.getPrototypeOf(parsedValue[0]).tokenType === 'WHITESPACE')\r\n//\t\t\tconsole.log(parsedValue);\r\n\r\n\t\ttokenType = Object.getPrototypeOf(parsedValue[0]).tokenType.capitalizeFirstChar() + 'Token';\r\n\r\n\t\tif (tokenType === 'FunctionToken') {\r\n//\t\t\tconsole.log('CSS function found');\r\n\t\t\tvalueAsParsed = this.functionToCanonical(parsedValue[0]);\r\n\t\t}\r\n\t\telse\r\n\t\t\tvalueAsParsed = parsedValue[0]; //this.fixValueFromParser(parsedValue[0]);\r\n\t\t\t\r\n//\t\tif (this.propName === 'backgroundImage')\r\n//\t\t\tconsole.log('valueAsParsed', parsedValue);\r\n\t}\r\n\telse {\r\n//\t\tconcatVal = this.concatenateBackFromParser(parsedValue);\r\n\t\tconcatVal = value.trim();\r\n\t\ttokenType = 'NonparsedToken';\r\n\t\t\r\n\t\t// Concatenated values are typed as \"Non Parsed\",\r\n\t\t// and then, the valueAsParsed only has a repr property.\r\n\t\tvalueAsParsed = new (\r\n\t\t\tLocalTokenFromParserFactory(null, 'NONPARSED')\r\n\t\t\t)(\r\n\t\t\t\ttokenType,\r\n\t\t\t\tnull,\r\n\t\t\t\tnull,\r\n\t\t\t\t'string',\r\n\t\t\t\tconcatVal\r\n\t\t\t);\r\n\t}\r\n\t\r\n\tthis.populate(tokenType, valueAsParsed);\r\n}\r\n\r\n// WON'T WORK FOR RELATIVE DIMENSIONS,\r\n// as, for example, we have no clue of the value of the inherited font-size property for the current property\r\n//CSSPropertyBuffer.prototype.unitToCanonical = function(valueAsParsed) {\r\n//\tswitch(valueAsParsed.unit) {\r\n//\t\tcase 'em' : \r\n//\t\t\tconsole.log(\"EM FOUND\");\r\n//\t\t\tbreak;\r\n//\t\tdefault :\r\n//\t\t\tbreak;\r\n//\t}\r\n//\t\r\n//\treturn valueAsParsed;\r\n//}\r\n\r\nCSSPropertyBuffer.prototype.functionToCanonical = function(valueAsParsed) {\r\n\tvar value, tokenTypeFromParser;\r\n\tif (valueAsParsed.name === 'rgb' || valueAsParsed.name === 'rgba') {\r\n//\t\tconsole.log('rgb found');\r\n\t\tvalue = new (LocalTokenFromParserFactory(null, 'HASH'))();\r\n\t\tvalue.type = 'hash';\r\n\t\tvalue.repr = '#';\r\n\t\tvalueAsParsed.value.forEach(function(val) {\r\n\t\t\ttokenTypeFromParser = Object.getPrototypeOf(val).tokenType;\r\n\t\t\tif (tokenTypeFromParser === \"WHITESPACE\" || tokenTypeFromParser === \"COMMA\")\r\n\t\t\t\treturn;\r\n\t\t\telse\r\n\t\t\t\tvalue.repr += parseInt(val.value).toString(16).padStart(2, '0');\r\n\t\t}, this);\r\n//\t\tconsole.log(value)\r\n\t\treturn value;\r\n\t}\r\n\telse {\r\n\t\t// As for now, \"format\" and \"local\" are seen as unsupported functions\r\n\t\tif ((valueAsParsed.name === 'format' || valueAsParsed.name === 'local')\r\n\t\t\t|| (valueAsParsed.name === 'animation' || valueAsParsed.name === 'animationName' || valueAsParsed.name === 'animationDuration' || valueAsParsed.name === 'animationIterationCount' || valueAsParsed.name === 'animationIterationFunction' || valueAsParsed.name === 'animationDelay'))\r\n\t\t\treturn new (LocalTokenFromParserFactory(null, 'UNDEFINED'))();\r\n\t\telse if (valueAsParsed.name === 'url') {\r\n\t\t\tvalue = new (LocalTokenFromParserFactory(null, 'URL'))();\r\n\t\t\tvalue.type = 'url';\r\n\t\t\tvalue.repr = 'url(\"';\r\n\t\t\tvalueAsParsed.value.forEach(function(val) {\r\n\t\t\t\tvalue.repr += val.repr;\r\n\t\t\t});\r\n\t\t\tvalue.repr += '\")';\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse if (valueAsParsed.name === 'translate' || valueAsParsed.name === 'rotate' || valueAsParsed.name === 'scale') {\r\n\t\t\tvalue = new (LocalTokenFromParserFactory(null, 'TRANSFORM'))();\r\n\t\t\tvalue.type = valueAsParsed.name;\r\n\t\t\tvalue.repr = valueAsParsed.name + '(';\r\n\t\t\tvalueAsParsed.value.forEach(function(val, key) {\r\n\t\t\t\tvalue.repr += val.repr;\r\n\t\t\t\tif (key < valueAsParsed.value.length - 1)\r\n\t\t\t\t\tvalue.repr += ', ';\r\n\t\t\t});\r\n\t\t\tvalue.repr += ')';\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t\r\n\t\tconsole.warn('CSSPropertyBuffer->functionToCanonical: unsupported function given (' + valueAsParsed.name + ').');\r\n\t\treturn new (LocalTokenFromParserFactory(null, 'UNDEFINED'))();\r\n\t} \r\n}\r\n\r\nCSSPropertyBuffer.prototype.populate = function(tokenType, value) {\r\n\t\r\n\t// the buffer size : 64 bytes buffers shall align well on a 2048KB L2 CPU cache\r\n\t// 16 bits values have to be declared as byte-tuples ([1, 0] would then represent 1, as all CPU's are now little-endian) \r\n\t// (GeneratorFor16bitsInt, responsible for the UID, shall return an array)\r\n\t\r\n\tvar normalizedValue = value;//this.fixValueFromParser(value);\r\n\tif (typeof normalizedValue.repr === 'undefined')\r\n\t\tconsole.error('normalizedValue', normalizedValue);\r\n\tvar strVal = normalizedValue.repr,\r\n\t\tstrLength = strVal.length,\r\n\t\tstrBuf = strVal.getNcharsAsCharCodesArray(this.stdStrLength, 0)[1],\r\n\t\tvalueBuf = GeneratorFor16bitsInt.intFromNumber(normalizedValue.value);\r\n\t\t\r\n//\tconsole.log('POPULATE', strVal, strBuf, value);\r\n\r\n\t// this.TokenTypes[tokenType] is the TokenType from the parser\r\n\t// represented as a numeric constant\r\n\tthis._buffer.set(\r\n\t\t\t[this.TokenTypes[tokenType]],\r\n\t\t\tthis.bufferSchema.tokenType.start\r\n\t\t);\r\n\t// value type\r\n\tvar valueTypeAsConst = this.ValueTypes[value.type];\r\n\tthis._buffer.set(\r\n\t\t\t[valueTypeAsConst],\r\n\t\t\tthis.bufferSchema.propertyType.start\r\n\t\t);\r\n\t// value\r\n\t// FIXME: floats are NOT handled by our CSSPropertyBuffer type,\r\n\t// and flexGrow, font[em], and even dimensions may be float\r\n\t// For now, it acts like if we had parseInt the number\r\n\tthis._buffer.set(\r\n\t\t\tvalueBuf,\r\n\t\t\tthis.bufferSchema.propertyValue.start\r\n\t\t);\r\n\t// representation\r\n\tthis._buffer.set(\r\n\t\t\tstrBuf,\r\n\t\t\tthis.bufferSchema.repr.start\r\n\t\t);\r\n\t// representation string length\r\n\tvar strLength;\r\n\tthis._buffer.set(\r\n\t\t[strLength],\r\n\t\tthis.bufferSchema.reprLength.start\r\n\t);\r\n\t// unit\r\n\tthis._buffer.set(\r\n\t\t\t[value.unit ? this.Units[value.unit].idx : 0],\r\n\t\t\tthis.bufferSchema.unit.start\r\n\t\t);\r\n}\r\n\r\nCSSPropertyBuffer.prototype.parseAndSetValue = function(singleValueAsString) {\r\n\tvar parsedValue;\r\n\tif ((parsedValue = this.parseValue(singleValueAsString)).length)\r\n\t\tthis.setValue(parsedValue);\r\n}\r\n\r\nCSSPropertyBuffer.prototype.parseValue = function(singleValueAsString) {\r\n\treturn parser.parseAListOfComponentValues(singleValueAsString);\r\n}\r\n\r\nCSSPropertyBuffer.prototype.fixValueFromParser = function(parsedValue) {\r\n\treturn (new (LocalTokenFromParserFactory(parsedValue, Object.getPrototypeOf(parsedValue).tokenType))(\r\n\t\tnull,\r\n\t\tparsedValue.value,\r\n\t\tparsedValue.name,\r\n\t\tparsedValue.type,\r\n\t\tparsedValue.repr,\r\n\t\tparsedValue.unit\r\n\t\t)\r\n\t);\r\n}\r\n\r\nCSSPropertyBuffer.prototype.concatenateBackFromParser = function(parsedValue) {\r\n\tvar tokenTypeFromParser;\r\n\tvar concatVal = ''; \r\n\tparsedValue.forEach(function(val) {\r\n\t\ttokenTypeFromParser = Object.getPrototypeOf(val).tokenType;\r\n\t\tswitch (tokenTypeFromParser) {\r\n\t\t\tcase 'WHITESPACE' :\r\n\t\t\t\t\tconcatVal += ' ';\r\n\t\t\t\t\tbreak;\r\n\t\t\tcase 'PERCENTAGE' :\r\n\t\t\t\t\tconcatVal += val.repr + '%';\r\n\t\t\t\t\tbreak;\r\n\t\t\tcase 'HASH' :\r\n\t\t\t\t\tconcatVal += val.value ? '#' + val.value : val.repr;\r\n\t\t\t\t\tbreak;\r\n\t\t\tcase 'COMMA' :\r\n\t\t\t\t\tconcatVal += ',';\r\n\t\t\t\t\tbreak;\r\n\t\t\tcase 'FUNCTION' : \r\n\t\t\t\t\tconcatVal += this.functionToCanonical(val).repr;\r\n\t\t\tcase 'OPENPAREN' :\r\n\t\t\t\t\tconcatVal += '(';\r\n\t\t\t\t\tbreak;\r\n\t\t\tcase 'CLOSEPAREN' :\r\n\t\t\t\t\tconcatVal += ')';\r\n\t\t\t\t\tbreak;\r\n\t\t\tdefault : concatVal += typeof val.repr !== 'undefined' ? val.repr + this.Units[val.unit || ''].unit : val.value.toString() + this.Units[val.Units || ''].unit;\r\n\t\t}\r\n\t}, this);\r\n\treturn concatVal;\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getIsInitialValue = function() {\r\n\treturn this._buffer[this.bufferSchema.isInitialValue.start];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getIsInitialValueAsBool = function() {\r\n\treturn !!this._buffer[this.bufferSchema.isInitialValue.start];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.setIsInitialValue = function() {\r\n\tthis._buffer.set([1], this.bufferSchema.isInitialValue.start);\r\n}\r\n\r\nCSSPropertyBuffer.prototype.tokenTypeToString = function() {\r\n\treturn Object.keys(this.TokenTypes)[this._buffer[this.bufferSchema['tokenType'].start]];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.tokenTypeToNumber = function() {\r\n\treturn this._buffer[this.bufferSchema['tokenType'].start];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getValueTypeAsString = function() {\r\n\treturn Object.keys(this.ValueTypes)[this._buffer[this.bufferSchema['propertyType'].start]];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getValueTypeAsNumber = function() {\r\n\treturn this._buffer[this.bufferSchema['propertyType'].start];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getUnitAsString = function() {\r\n\treturn this.unitToString();\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getTokenTypeAsString = function() {\r\n\treturn this.TokenTypesAsArray[this._buffer[this.bufferSchema['tokenType'].start]];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.getTokenTypeAsNumber = function() {\r\n\treturn this._buffer[this.bufferSchema['tokenType'].start];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.unitToString = function() {\r\n\treturn this.UnitsAsArray[this._buffer[this.bufferSchema['unit'].start]];\r\n}\r\n\r\nCSSPropertyBuffer.prototype.setUnit = function(unit) {\r\n\tvar idxOfUnit = this.UnitsAsArray.indexOf(unit);\r\n\tif (idxOfUnit === -1)\r\n\t\treturn;\r\n\tthis._buffer.set([idxOfUnit], this.bufferSchema.unit.start);\r\n}\r\n\r\n\r\n\r\n\r\n// getValueAsString() is an alias for bufferedValueToString()\r\n// TODO: unify\r\nCSSPropertyBuffer.prototype.getValueAsString = function() {\r\n\treturn this.bufferedValueToString();\r\n}\r\n\r\n\r\n//CSSPropertyBuffer.prototype.getValueAsHash = function() {\r\n//\treturn '#' + this.bufferedValueToString();\r\n//}\r\n\r\n// getValueAsNumber() is an alias for bufferedValueToNumber()\r\n// TODO: unify\r\nCSSPropertyBuffer.prototype.getValueAsNumber = function() {\r\n\treturn this.bufferedValueToNumber();\r\n}\r\n\r\n// bufferedValueToString() is an alias for getValueAsString()\r\n// TODO: unify\r\nCSSPropertyBuffer.prototype.bufferedValueToString = function() {\r\n\tvar start = this.bufferSchema.repr.start, end = start + this.bufferSchema.repr.length,\r\n\t\tstrLengthIdx = this.bufferSchema.reprLength.start;\r\n//\tconsole.log(start, end, this._buffer.slice(start, end));\r\n//\tvar test = this._buffer.slice(start, end).bufferToString(this._buffer[strLengthIdx]);\r\n//\tif (test.slice(0, 1) === '#')\r\n//\t\tconsole.log(test);\r\n\treturn this._buffer.slice(start, end).bufferToString(this._buffer[strLengthIdx]);\r\n}\r\n\r\n// bufferedValueToNumber() is an alias for getValueAsNumber()\r\n// TODO: unify\r\nCSSPropertyBuffer.prototype.bufferedValueToNumber = function() {\r\n\tvar start = this.bufferSchema['propertyValue'].start, end = start + this.bufferSchema['propertyValue'].length\r\n\treturn this.byteTuppleTo16bits(this._buffer.slice(start, end));\r\n}\r\n\r\nCSSPropertyBuffer.prototype.byteTuppleTo16bits = function(bytesInt8Array) {\r\n\treturn GeneratorFor16bitsInt.numberFromInt(bytesInt8Array);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n//var countTokenTypes = {\r\n//\tIDENT : 0,\r\n//\tNUMBER : 0,\r\n//\tPERCENTAGE : 0,\r\n//\tCOLORorFUNCTION : 0,\r\n//\tun_defined : 0\r\n//}\r\n//console.log(countTokenTypes);\r\n\r\n\r\nvar LocalTokenFromParserFactory = function(parsedValue, tokenTypeFromParser) {\r\n\t\r\n\tif (tokenTypeFromParser && LocalTokenFromParserCache[tokenTypeFromParser])\r\n\t\treturn LocalTokenFromParserCache[tokenTypeFromParser];\r\n\telse {\r\n\t\ttokenTypeFromParser = parsedValue ? Object.getPrototypeOf(parsedValue).tokenType : tokenTypeFromParser;\r\n\t\t\r\n\t\tvar LocalTokenFromParser = function(tokenType, value, name, type, repr, unit) {\r\n\t\t\tvar localValue = 0, localType = 'string', localRepr = '';\r\n\t\t\tif (tokenTypeFromParser === 'IDENT' || tokenTypeFromParser === 'NONPARSED') {\r\n\t\t\t\tlocalRepr  = repr || (value ? value.toString() : '');\r\n\t\t\t\tlocalType = 'string';\r\n//\t\t\t\tcountTokenTypes['IDENT']++;\r\n\t\t\t}\r\n\t\t\telse if (tokenTypeFromParser === 'NUMBER' || tokenTypeFromParser === 'DIMENSION') {\t// typeof value !== 'undefined' && Object.getPrototypeOf(value) === Number.prototype\r\n\t\t\t\tlocalRepr = (value || localValue).toString() + (unit || '');\r\n\t\t\t\tlocalValue = value || localValue;\r\n\t\t\t\tlocalType = 'number';\r\n//\t\t\t\tcountTokenTypes['NUMBER']++;\r\n\t\t\t}\r\n\t\t\telse if (type === 'hash' || type === 'id' || type === 'unrestricted' || (tokenTypeFromParser === 'FUNCTION' && name === 'rgb')) {\r\n\t\t\t\tlocalRepr  = repr || '#' + (value || localValue).toString();\r\n\t\t\t\tlocalType = 'hash';\r\n//\t\t\t\tcountTokenTypes['COLORorFUNCTION']++;\r\n\t\t\t}\r\n\t\t\telse if (tokenTypeFromParser === 'PERCENTAGE') {\r\n\t\t\t\tlocalValue = value || localValue;\r\n\t\t\t\tlocalRepr  = (repr ? (repr.slice(-1) === '%' ? repr : repr + '%') : (value ? value.toString() : '0')  + '%');\r\n\t\t\t\tlocalType = 'percentage';\r\n//\t\t\t\tcountTokenTypes['PERCENTAGE']++;\r\n\t\t\t}\r\n\t\t\telse if (typeof type === 'undefined') {\r\n\t\t\t\tlocalRepr  = value ? value.toString() : '';\r\n//\t\t\t\tcountTokenTypes['un_defined']++;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.localTokenType = tokenType ? tokenType : tokenTypeFromParser.capitalizeFirstChar() + 'Token';\r\n\t\t\tthis.value = localValue;\r\n\t\t\tthis.type = localType;\r\n\t\t\tthis.repr = localRepr;\r\n\t\t\tthis.reprLength = this.repr.length;\r\n\t\t\tthis.unit = unit || '';\r\n\t\t}\r\n\t\tLocalTokenFromParser.prototype = {\r\n\t\t\ttokenType : tokenTypeFromParser || 'NONE'\r\n\t\t}\r\n\t\tLocalTokenFromParserCache[LocalTokenFromParser] = LocalTokenFromParser;\r\n\t\t\r\n\t\treturn LocalTokenFromParser\r\n\t}\r\n}\r\n\r\nvar LocalTokenFromParserCache = {\r\n\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'TokenTypes', {\r\n\tvalue : {\r\n\t\t\tUndefinedToken : 0, \r\n\t\t\tBadstringToken : 1,\r\n\t\t\tBadurlToken : 2,\r\n\t\t\tWhitespaceToken : 3,\r\n\t\t\tCdoToken : 4,\r\n\t\t\tCdcToken : 5,\r\n\t\t\tColonToken : 6,\r\n\t\t\tSemicolonToken : 7,\r\n\t\t\tCommaToken : 8,\r\n\t\t\tOpencurlyToken : 9,\r\n\t\t\tClosecurlyToken : 10,\r\n\t\t\tOpensquareToken : 11,\r\n\t\t\tClosesquareToken : 12,\r\n\t\t\tOpenparenToken : 13,\r\n\t\t\tCloseparenToken : 14,\r\n\t\t\tIncludeMatchToken : 15,\r\n\t\t\tDashmatchToken : 16,\r\n\t\t\tPrefixmatchToken : 17,\r\n\t\t\tSuffixmatchToken : 18,\r\n\t\t\tSubstringmatchToken : 19,\r\n\t\t\tColumnToken : 20,\r\n\t\t\tEOFToken : 21,\r\n\t\t\tDelimToken : 22,\r\n\t\t\tIdentToken : 23,\r\n\t\t\tFunctionToken : 24,\r\n\t\t\tAtkeywordToken : 25,\r\n\t\t\tHashToken : 26,\r\n\t\t\tStringToken : 27,\r\n\t\t\tUrlToken : 28,\r\n\t\t\tNumberToken : 29,\r\n\t\t\tPercentageToken : 30,\r\n\t\t\tDimensionToken : 31,\r\n\t\t\tNonparsedToken : 32\r\n\t\t\t}\r\n});\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'stdStrLength', {\r\n\tvalue : 89\r\n});\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'ValueTypes', {\r\n\tvalue : {\r\n\t\tinteger : 0,\r\n\t\tpercentage : 1,\r\n\t\tfloat : 2,\r\n\t\tstring : 3,\r\n\t\thash : 4,\r\n\t\tnumericalArray : 5,\r\n\t\t'' : 6\r\n\t}\r\n});\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'Units', {\r\n\tvalue : {\r\n\t\t'' : {\r\n\t\t\tidx : 0,\r\n\t\t\tunit : '',\r\n\t\t\tfullName : 'non-applicable',\r\n\t\t\tequivStr : 'some values have no unit'\r\n\t\t},\r\n\t\tcm : {\r\n\t\t\tidx : 1,\r\n\t\t\tunit : 'cm',\r\n\t\t\tfullName : 'centimeters',\r\n\t\t\tequivStr : '1cm : 96px/2.54'\r\n\t\t} ,\r\n\t\tmm : {\r\n\t\t\tidx : 2,\r\n\t\t\tunit : 'mm',\r\n\t\t\tfullName : 'millimeters',\r\n\t\t\tequivStr : '1mm : 1/10th of 1cm'\r\n\t\t} ,\r\n\t\tQ : {\r\n\t\t\tidx : 3,\r\n\t\t\tunit : 'Q',\r\n\t\t\tfullName : 'quarter',\r\n\t\t\tequivStr : '1Q : 1/40th of 1cm'\r\n\t\t},\r\n\t\tin : {\r\n\t\t\tidx : 4,\r\n\t\t\tunit : 'in',\r\n\t\t\tfullName : 'inches',\r\n\t\t\tequivStr : '1in : 2.54cm : 96px'\r\n\t\t},\r\n\t\tpc : {\r\n\t\t\tidx : 5,\r\n\t\t\tunit : 'pc',\r\n\t\t\tfullName : 'picas',\r\n\t\t\tequivStr : '1pc : 1/6th of 1in'\r\n\t\t},\r\n\t\tpt : {\r\n\t\t\tidx : 6,\r\n\t\t\tunit : 'pt',\r\n\t\t\tfullName : 'points',\r\n\t\t\tequivStr : '1pt : 1/72th of 1in'\r\n\t\t},\r\n\t\tpx : {\r\n\t\t\tidx : 7,\r\n\t\t\tunit : 'px',\r\n\t\t\tfullName : 'pixels',\r\n\t\t\tequivStr : '1px : 1/96th of 1in '\r\n\t\t},\r\n\t\tem : {\r\n\t\t\tidx : 8,\r\n\t\t\tunit : 'em',\r\n\t\t\tfullName : 'size of the uppercase M',\r\n\t\t\tequivStr : '1em is equivalent to the inherited font-size'\r\n\t\t},\r\n\t\trem : {\r\n\t\t\tidx : 9,\r\n\t\t\tunit : 'rem',\r\n\t\t\tfullName : 'root em',\r\n\t\t\tequivStr : '1rem is equivalent to the root element\\'s font-size'\r\n\t\t},\r\n\t\tfr : {\r\n\t\t\tidx : 10,\r\n\t\t\tunit : 'fr',\r\n\t\t\tfullName : 'flex grid unit',\r\n\t\t\tequivStr : 'flexibility factor of a grid track'\r\n\t\t},\r\n\t\ts : {\r\n\t\t\tidx : 11,\r\n\t\t\tunit : 's',\r\n\t\t\tfullName : 'seconds',\r\n\t\t\tequivStr : 'seconds are used when defining the duration of an animation'\r\n\t\t}\r\n\t}\r\n});\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'UnitsAsArray', {\r\n\tvalue : (function() {\r\n\t\tvar ret = [];\r\n\t\tfor (var unitDef in CSSPropertyBuffer.prototype.Units)  {\r\n\t\t\tret.push(CSSPropertyBuffer.prototype.Units[unitDef].unit)\r\n\t\t}\r\n\t\treturn ret;\r\n\t})()\r\n});\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'TokenTypesAsArray', {\r\n\tvalue : (function() {\r\n\t\treturn Object.keys(CSSPropertyBuffer.prototype.TokenTypes);\r\n\t})()\r\n});\r\n\r\n\r\n//var sample = {\r\n//\ttoken: \"DIMENSION\",\r\n//\tvalue: 1,\r\n//\ttype: \"integer\",\r\n//\trepr: \"1\",\r\n//\tunit: \"px\"\r\n//}\r\n\r\nObject.defineProperty(CSSPropertyBuffer.prototype, 'bufferSchema', {\r\n\tvalue : BinarySchemaFactory(\r\n\t\t'compactedViewOnProperty',\r\n\t\t[\r\n\t\t\t'tokenType',\r\n\t\t\t'propertyValue',\r\n\t\t\t'propertyType',\r\n\t\t\t'repr',\r\n\t\t\t'reprLength',\r\n\t\t\t'unit',\r\n\t\t\t'isInitialValue'\r\n\t\t],\r\n\t\t[\r\n\t\t\t1,\r\n\t\t\t2,\r\n\t\t\t1,\r\n\t\t\tCSSPropertyBuffer.prototype.stdStrLength,\t\t// defining a tight limit to the size of the representation of a string is obviously a strong opinion: lets keep some neurons on it)\r\n\t\t\t1,\r\n\t\t\t1,\r\n\t\t\t1\r\n\t\t]\r\n)\r\n});\r\n\r\n//console.log(CSSPropertyBuffer.prototype.bufferSchema);\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = CSSPropertyBuffer;",
    "\"use strict\";\n/**\r\n * @constructor CSSPropertyDescriptors\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager', false);\r\nvar CSSPropertyBuffer = require('src/editing/CSSPropertyBuffer', false);\r\n\r\nvar CSSPropertyDescriptors = {};\r\nvar SplittedCSSPropertyDescriptors = {};\r\n\r\nvar CSSPropertyDescriptorFactory = function(attrName, initialValue, isShorthand, expandedPropNames, mayBeAbbreviated, isAlias) {\r\n\t\r\n\tvar CSSPropertyDescriptor = function(value) {\r\n\t\t\r\n\t};\r\n\tCSSPropertyDescriptor.prototype = {\r\n\t\tpropName : attrName,\r\n\t\tisShorthand : isShorthand,\r\n\t\tmayBeAbbreviated : mayBeAbbreviated,\r\n\t\tisAlias : isAlias,\r\n\t\tinitialValue : initialValue,\r\n\t\texpandedPropNames : expandedPropNames\r\n\t};\r\n\tCSSPropertyDescriptors[attrName] = CSSPropertyDescriptor;\r\n\t\r\n\treturn CSSPropertyDescriptor;\r\n}\r\n\r\nSplittedCSSPropertyDescriptors.inheritedAttributes = {\r\n\twritingMode : CSSPropertyDescriptorFactory('writingMode', '', false, [], false, false),\r\n\ttextDirection : CSSPropertyDescriptorFactory('textDirection', '', false, [], false, false),\r\n\tdirection : CSSPropertyDescriptorFactory('direction', '', false, [], false, false),\r\n\tcaptionSide : CSSPropertyDescriptorFactory('captionSide', '', false, [], false, false),\r\n\tlistStyleType : CSSPropertyDescriptorFactory('listStyleType', '', false, [], false, false),\r\n\tlistStylePosition : CSSPropertyDescriptorFactory('listStylePosition', '', false, [], false, false),\r\n\tvisibility : CSSPropertyDescriptorFactory('visibility', '', false, [], false, false),\r\n\tfont : CSSPropertyDescriptorFactory('font', '', true, ['fontFamily', 'fontSize', 'fontWeight', 'fontStyle'], false, false),\r\n\tfontFamily : CSSPropertyDescriptorFactory('fontFamily', '', false, [], false, false),\r\n\tfontSize : CSSPropertyDescriptorFactory('fontSize', '', false, [], false, false),\r\n\tfontWeight  : CSSPropertyDescriptorFactory('fontWeight', '', false, [], false, false),\r\n\tfontStyle : CSSPropertyDescriptorFactory('fontStyle', '', false, [], false, false),\r\n\tfontVariant : CSSPropertyDescriptorFactory('fontVariant', '', false, [], false, false),\r\n\tfontFeatureSettings : CSSPropertyDescriptorFactory('fontFeatureSettings', '', false, [], false, false),\r\n\tsrc : CSSPropertyDescriptorFactory('src', '', false, [], false, false),\t// only present in a @font-face rule\r\n\tlineHeight : CSSPropertyDescriptorFactory('lineHeight', '', false, [], false, false),\r\n\tcolor : CSSPropertyDescriptorFactory('color', '#000000', false, [], false, false), // the CSS spec says \"depends on the user-agent\" : https://www.w3.org/TR/2011/REC-CSS2-20110607/propidx.html#q24.0\r\n\ttextOrientation : CSSPropertyDescriptorFactory('textOrientation', '', false, [], false, false),\r\n\ttextAlign : CSSPropertyDescriptorFactory('textAlign', '', false, ['textAlignAll', 'textAlignLast'], false, false),\r\n\ttextAlignAll : CSSPropertyDescriptorFactory('textAlignAll', '', false, [], false, false),\r\n\ttextAlignLast : CSSPropertyDescriptorFactory('textAlignLast', '', false, [], false, false),\r\n\ttextTransform : CSSPropertyDescriptorFactory('textTransform', '', false, [], false, false),\r\n\ttextDecoration : CSSPropertyDescriptorFactory('textDecoration', '', false, [], false, false),\r\n\ttextShadow : CSSPropertyDescriptorFactory('textShadow', '', false, [], false, false),\r\n\tcursor : CSSPropertyDescriptorFactory('cursor', 'auto', false, [], false, false),\r\n\tpointerEvents : CSSPropertyDescriptorFactory('pointerEvents', 'auto', false, [], false, false),\r\n\tborderCollapse : CSSPropertyDescriptorFactory('borderCollapse', '', false, [], false, false),\r\n\twhiteSpace : CSSPropertyDescriptorFactory('whiteSpace', '', false, [], false, false),\r\n\tspeak : CSSPropertyDescriptorFactory('speak', 'auto', false, [], false, false),\t\t\t\t\t\t\t\t\t// auto | always | never\r\n\twordBreak : CSSPropertyDescriptorFactory('wordBreak', 'normal', false, [], false, false),\r\n\twordSpacing : CSSPropertyDescriptorFactory('wordSpacing', 'normal', false, [], false, false),\r\n\tlineBreak : CSSPropertyDescriptorFactory('lineBreak', 'auto', false, [], false, false),\r\n\thyphens : CSSPropertyDescriptorFactory('hyphens', 'manual', false, [], false, false),\r\n\toverflowWrap : CSSPropertyDescriptorFactory('overflowWrap', 'auto', false, [], false, false),\t\t\t\t\t\t// The wordWrap property is an alias for overflowWrap\r\n\twordWrap : CSSPropertyDescriptorFactory('wordWrap', 'auto', false, [], false, false),\t\t\t\t\t\t\t\t// The overflowWrap property is an alias for wordWrap\r\n\tletterSpacing : CSSPropertyDescriptorFactory('letterSpacing', 'normal', false, [], false, false),\t\t\t\t\t// normal | <length>\r\n\tfontVariantLigatures : CSSPropertyDescriptorFactory('fontVariantLigatures', '', false, [], false, false),\r\n\t// dash-prefixed properties (specific to a UA) are rendered with an Uppercase first letter by our translation function\r\n\tWebkitFontSmoothing : CSSPropertyDescriptorFactory('WebkitFontSmoothing', '', false, [], false, false),\r\n\tWebkitFontFeatureSettings : CSSPropertyDescriptorFactory('WebkitFontFeatureSettings', '', false, [], false, false),\r\n\tWebkitFontVariantLigatures : CSSPropertyDescriptorFactory('WebkitFontVariantLigatures', '', false, [], false, false),\r\n\t\r\n\tWebkitTapHighlightColor : CSSPropertyDescriptorFactory('WebkitTapHighlightColor', 'black', false, [], false)\r\n}\r\n\r\nSplittedCSSPropertyDescriptors.locallyEffectiveAttributes = {\r\n\tdisplay : CSSPropertyDescriptorFactory('display', 'inline', false, [], false, false),\r\n\toverflow : CSSPropertyDescriptorFactory('overflow', 'visible', false, [], false, false),\r\n\toverflowX : CSSPropertyDescriptorFactory('overflowX', '', false, [], false, false),\r\n\toverflowY : CSSPropertyDescriptorFactory('overflowY', '', false, [], false, false),\r\n\tverticalAlign : CSSPropertyDescriptorFactory('verticalAlign', 'baseline', false, [], false, false),\r\n\tclear : CSSPropertyDescriptorFactory('clear', '', false, [], false, false),\r\n\tfloat : CSSPropertyDescriptorFactory('float', '', false, [], false, false),\r\n\tposition : CSSPropertyDescriptorFactory('position', '', false, [], false, false),\r\n\tresize : CSSPropertyDescriptorFactory('resize', 'none', false, [], false, false),\r\n\t\r\n\tflex : CSSPropertyDescriptorFactory('flex', '0 1 auto', true, ['flexGrow', 'flexShrink', 'flexBasis'], false, false),\r\n\tflexFlow : CSSPropertyDescriptorFactory('flexFlow', 'row nowrap', true, ['flexDirection', 'flexWrap'], false, false),\r\n\tflexDirection : CSSPropertyDescriptorFactory('flexDirection', 'row', false, [], false, false),\r\n\tflexWrap : CSSPropertyDescriptorFactory('flexWrap', 'nowrap', false, [], false, false),\r\n\tflexGrow : CSSPropertyDescriptorFactory('flexGrow', 0, false, [], false, false),\r\n\tflexShrink : CSSPropertyDescriptorFactory('flexShrink', 1, false, [], false, false),\r\n\tflexBasis : CSSPropertyDescriptorFactory('flexBasis', 'auto', false, [], false, false),\r\n\tjustifyContent : CSSPropertyDescriptorFactory('justifyContent', 'flex-start', false, [], false, false), \r\n\talignItems : CSSPropertyDescriptorFactory('alignItems', 'stretch', false, [], false, false),\r\n\talignSelf : CSSPropertyDescriptorFactory('alignSelf', 'auto', false, [], false, false),\r\n\talignContent : CSSPropertyDescriptorFactory('alignContent', 'stretch', false, [], false, false),\r\n\tgap : CSSPropertyDescriptorFactory('gap', 'normal', false, [], false, false),\r\n\t\r\n\tgridTemplateRows : CSSPropertyDescriptorFactory('gridTemplateRows', '', false, [], false, false),\r\n\tgridTemplateColumns : CSSPropertyDescriptorFactory('gridTemplateColumns', '', false, [], false, false),\r\n\t\r\n\tgridRow : CSSPropertyDescriptorFactory('gridRow', '', false, [], false, false),\r\n\tgridColumn : CSSPropertyDescriptorFactory('gridColumn', '', false, [], false, false),\r\n\t\r\n\ttabSize : CSSPropertyDescriptorFactory('tabSize', '', false, [], false, false),\r\n\tMozTabSize : CSSPropertyDescriptorFactory('MozTabSize', '', false, [], false, false),\r\n\t\r\n\topacity : CSSPropertyDescriptorFactory('opacity', '1', false, [], false, false),\r\n\tzIndex : CSSPropertyDescriptorFactory('zIndex', '1', false, [], false)\r\n}\r\n\r\nSplittedCSSPropertyDescriptors.boxModelAttributes = {\r\n\tboxSizing : CSSPropertyDescriptorFactory('boxSizing', 'content-box', false, [], false, false),\r\n\t// dash-prefixed properties (specific to a UA) are rendered with an Uppercase first letter by our translation function\r\n\tMozBoxSizing : CSSPropertyDescriptorFactory('MozBoxSizing', 'content-box', false, [], false, false),\r\n\twidth : CSSPropertyDescriptorFactory('width', 'auto', false, [], false, false),\r\n\theight : CSSPropertyDescriptorFactory('height', 'auto', false, [], false, false),\r\n\tminWidth : CSSPropertyDescriptorFactory('minWidth', 'auto', false, [], false, false),\r\n\tminHeight : CSSPropertyDescriptorFactory('minHeight', 'auto', false, [], false, false),\r\n\tmaxWidth : CSSPropertyDescriptorFactory('maxWidth', 'auto', false, [], false, false),\r\n\tmaxHeight : CSSPropertyDescriptorFactory('maxHeight', 'auto', false, [], false, false),\r\n\ttop : CSSPropertyDescriptorFactory('top', 'auto', false, [], false, false),\r\n\tleft : CSSPropertyDescriptorFactory('left', 'auto', false, [], false, false),\r\n\tright : CSSPropertyDescriptorFactory('right', 'auto', false, [], false, false),\r\n\tbottom : CSSPropertyDescriptorFactory('bottom', 'auto', false, [], false, false),\r\n\r\n\tpadding : CSSPropertyDescriptorFactory('padding', 0, true, ['paddingBlockStart', 'paddingInlineEnd', 'paddingBlockEnd', 'paddingInlineStart'], true),\r\n\tmargin : CSSPropertyDescriptorFactory('margin', 0, true, ['marginBlockStart', 'marginInlineEnd', 'marginBlockEnd', 'marginInlineStart'], true),\r\n\tborder : CSSPropertyDescriptorFactory('border', 0, true, ['borderWidth', 'borderStyle', 'borderColor'], false, false),\r\n\t\r\n\t// TODO: Should be accounted by an alias mechanism: theses props exist but are not the ones we request\r\n\tpaddingTop : CSSPropertyDescriptorFactory('paddingTop', 0, false, ['paddingBlockStart'], false, true),\r\n\tpaddingRight : CSSPropertyDescriptorFactory('paddingRight', 0, false, ['paddingInlineEnd'], false, true),\r\n\tpaddingBottom : CSSPropertyDescriptorFactory('paddingBottom', 0, false, ['paddingBlockEnd'], false, true),\r\n\tpaddingLeft : CSSPropertyDescriptorFactory('paddingLeft', 0, false, ['paddingInlineStart'], false, true),\r\n\t\r\n\tpaddingBlockStart : CSSPropertyDescriptorFactory('paddingBlockStart', 0, false, [], false, false),\r\n\tpaddingInlineEnd : CSSPropertyDescriptorFactory('paddingInlineEnd', 0, false, [], false, false),\r\n\tpaddingBlockEnd : CSSPropertyDescriptorFactory('paddingBlockEnd', 0, false, [], false, false),\r\n\tpaddingInlineStart : CSSPropertyDescriptorFactory('paddingInlineStart', 0, false, [], false, false),\r\n\t\r\n\t// TODO: Should be accounted by an alias mechanism: theses props exist but are not the ones we request\r\n\tmarginTop : CSSPropertyDescriptorFactory('marginTop', 0, false, ['marginBlockStart'], false, true),\r\n\tmarginRight : CSSPropertyDescriptorFactory('marginRight', 0, false, ['marginInlineEnd'], false, true),\r\n\tmarginBottom : CSSPropertyDescriptorFactory('marginBottom', 0, false, ['marginBlockEnd'], false, true),\r\n\tmarginLeft : CSSPropertyDescriptorFactory('marginLeft', 0, false, ['marginInlineStart'], false, true),\r\n\t\r\n\tmarginBlockStart : CSSPropertyDescriptorFactory('marginBlockStart', 0, false, [], false, false),\r\n\tmarginBlockEnd : CSSPropertyDescriptorFactory('marginBlockEnd', 0, false, [], false, false),\r\n\tmarginInlineStart : CSSPropertyDescriptorFactory('marginInlineStart', 0, false, [], false, false),\r\n\tmarginInlineEnd : CSSPropertyDescriptorFactory('marginInlineEnd', 0, false, [], false, false),\r\n\t\r\n\t// TODO: Should be accounted by an alias mechanism: theses props exist but are not the ones we request\r\n\tborderTop : CSSPropertyDescriptorFactory('borderTop', '0 medium #000000', false, ['borderBlockStart'], false, true),\r\n\tborderRight : CSSPropertyDescriptorFactory('borderRight', '0 medium #000000', false, ['borderInlineEnd'], false, true),\r\n\tborderBottom : CSSPropertyDescriptorFactory('borderBottom', '0 medium #000000', false, ['borderBlockEnd'], false, true),\r\n\tborderLeft : CSSPropertyDescriptorFactory('borderLeft', '0 medium #000000', false, ['borderInlineStart'], false, true),\r\n\r\n\tborderBlockStart : CSSPropertyDescriptorFactory('borderBlockStart', '0 medium #000000', true, ['borderBlockStartWidth', 'borderBlockStartStyle', 'borderBlockStartColor'], false, false),\r\n\tborderBlockEnd : CSSPropertyDescriptorFactory('borderBlockEnd', '0 medium #000000', true, ['borderBlockEndWidth', 'borderBlockEndStyle', 'borderBlockEndColor'], false, false),\r\n\tborderInlineStart : CSSPropertyDescriptorFactory('borderInlineStart', '0 medium #000000', true, ['borderInlineStartWidth', 'borderInlineStartStyle', 'borderInlineStartColor'], false, false),\r\n\tborderInlineEnd : CSSPropertyDescriptorFactory('borderInlineEnd', '0 medium #000000', true, ['borderInlineEndWidth', 'borderInlineEndStyle', 'borderInlineEndColor'], false, false),\r\n\r\n\tborderWidth : CSSPropertyDescriptorFactory('borderWidth', 0, true, ['borderBlockStartWidth', 'borderInlineEndWidth', 'borderBlockEndWidth', 'borderInlineStartWidth'], true),\r\n\tborderBlockStartWidth : CSSPropertyDescriptorFactory('borderBlockStartWidth', 0, false, [], false, false),\r\n\tborderBlockEndWidth : CSSPropertyDescriptorFactory('borderBlockEndWidth', 0, false, [], false, false),\r\n\tborderInlineStartWidth : CSSPropertyDescriptorFactory('borderInlineStartWidth', 0, false, [], false, false),\r\n\tborderInlineEndWidth : CSSPropertyDescriptorFactory('borderInlineEndWidth', 0, false, [], false, false),\r\n\r\n\tborderStyle : CSSPropertyDescriptorFactory('borderStyle', 'none', true, ['borderBlockStartStyle', 'borderInlineEndStyle', 'borderBlockEndStyle', 'borderInlineStartStyle'], true),\r\n\tborderBlockStartStyle : CSSPropertyDescriptorFactory('borderBlockStartStyle', 'none', false, [], false, false),\r\n\tborderBlockEndStyle : CSSPropertyDescriptorFactory('borderBlockEndStyle', 'none', false, [], false, false),\r\n\tborderInlineStartStyle : CSSPropertyDescriptorFactory('borderInlineStartStyle', 'none', false, [], false, false),\r\n\tborderInlineEndStyle : CSSPropertyDescriptorFactory('borderInlineEndStyle', 'none', false, [], false, false),\r\n\r\n\tborderColor : CSSPropertyDescriptorFactory('borderColor', '#000000', true, ['borderBlockStartColor', 'borderInlineEndColor', 'borderBlockEndColor', 'borderInlineStartColor'], true),\r\n\tborderBlockStartColor : CSSPropertyDescriptorFactory('borderBlockStartColor', '#000000', false, [], false, false),\r\n\tborderBlockEndColor : CSSPropertyDescriptorFactory('borderBlockEndColor', '#000000', false, [], false, false),\r\n\tborderInlineStartColor : CSSPropertyDescriptorFactory('borderInlineStartColor', '#000000', false, [], false, false),\r\n\tborderInlineEndColor : CSSPropertyDescriptorFactory('borderInlineEndColor', '#000000', false, [], false, false),\r\n\r\n\tborderRadius : CSSPropertyDescriptorFactory('borderRadius', '', true, ['borderStartStartRadius', 'borderEndStartRadius', 'borderEndEndRadius', 'borderStartEndRadius'], true, false),\r\n\t// dash-prefixed properties (specific to a UA) are rendered with an Uppercase first letter by our translation function\r\n\tMozBorderRadius : CSSPropertyDescriptorFactory('MozBorderRadius', '', true, ['borderStartStartRadius', 'borderEndStartRadius', 'borderEndEndRadius', 'borderEndStartRadius'], false, false),\r\n\tWebkitBorderRadius : CSSPropertyDescriptorFactory('WebkitBorderRadius', '', true, ['borderStartStartRadius', 'borderEndStartRadius', 'borderEndEndRadius', 'borderEndStartRadius'], false, false),\r\n\tborderTopLeftRadius : CSSPropertyDescriptorFactory('borderTopLeftRadius', '', false, [], false, false),\r\n\tborderTopRightRadius : CSSPropertyDescriptorFactory('borderTopRightRadius', '', false, [], false, false),\r\n\tborderBottomRightRadius : CSSPropertyDescriptorFactory('borderBottomRightRadius', '', false, [], false, false),\r\n\tborderBottomLeftRadius : CSSPropertyDescriptorFactory('borderBottomLeftRadius', '', false, [], false, false),\r\n\tborderStartStartRadius : CSSPropertyDescriptorFactory('borderStartStartRadius', '', false, [], false, false),\r\n\tborderEndStartRadius : CSSPropertyDescriptorFactory('borderEndStartRadius', '', false, [], false, false),\r\n\tborderEndEndRadius : CSSPropertyDescriptorFactory('borderEndEndRadius', '', false, [], false, false),\r\n\tborderStartEndRadius : CSSPropertyDescriptorFactory('borderStartEndRadius', '', false, [], false),\r\n\t\r\n\ttransform : CSSPropertyDescriptorFactory('transform', '', false, [], false)\r\n}\r\n\r\nSplittedCSSPropertyDescriptors.strictlyLocalAttributes = {\r\n\tbackground : CSSPropertyDescriptorFactory('background', '', true, ['backgroundColor', 'backgroundImage', 'backgroundRepeat', 'backgroundAttachment', 'backgroundPositionTop', 'backgroundPositionLeft'], false, false),\r\n\tbackgroundColor : CSSPropertyDescriptorFactory('backgroundColor', 'transparent', false, [], false, false),\r\n\tobjectFit : CSSPropertyDescriptorFactory('objectFit', 'fill', false, [], false, false),\r\n\t\r\n\t// CSSOM properties are not supported by Browsers for now : change the \"isShorthand\" (first) flag to true when available\r\n\tbackgroundPosition : CSSPropertyDescriptorFactory('backgroundPosition', '0% 0%', false, ['backgroundPositionTop', 'backgroundPositionLeft'], false, false),\r\n\tbackgroundSize : CSSPropertyDescriptorFactory('backgroundSize', 'auto auto', false, [], false, false),\r\n\tbackgroundPositionTop : CSSPropertyDescriptorFactory('backgroundPositionTop', '0%', false, [], false, false),\r\n\tbackgroundPositionLeft : CSSPropertyDescriptorFactory('backgroundPositionLeft', '0%', false, [], false, false),\r\n\tbackgroundImage : CSSPropertyDescriptorFactory('backgroundImage', 'none', false, [], false, false),\r\n\tbackgroundAttachment : CSSPropertyDescriptorFactory('backgroundAttachment', '', false, [], false, false),\r\n\tbackgroundRepeat : CSSPropertyDescriptorFactory('backgroundRepeat', 'repeat', false, [], false, false),\r\n\tboxShadow : CSSPropertyDescriptorFactory('boxShadow', 'none', false, [], false, false),\r\n\t\r\n\t// CSSOM properties are not supported by Browsers for now : change the \"isShorthand\" (first) flag to true when available\r\n\toutline : CSSPropertyDescriptorFactory('outline', '', false, ['outlineColor', 'outlineStyle', 'outlineWidth', ], false, false),\r\n\t// not supported by Browsers for now : change the \"isShorthand\" and \"mayBeAbbreviated\" (two) flags to true when available\r\n\toutlineColor : CSSPropertyDescriptorFactory('outlineColor', 'none', false, ['outlineColorBlockStart', 'outlineColorInlineEnd', 'outlineColorBlockEnd', 'outlineColorInlineStart'], false),\r\n\toutlineStyle : CSSPropertyDescriptorFactory('outlineStyle', 'none', false, ['outlineStyleBlockStart', 'outlineStyleInlineEnd', 'outlineStyleBlockEnd', 'outlineStyleInlineStart'], false),\r\n\toutlineWidth : CSSPropertyDescriptorFactory('outlineWidth', 'none', false, ['outlineWidthBlockStart', 'outlineWidthInlineEnd', 'outlineWidthBlockEnd', 'outlineWidthInlineStart'], false),\r\n\t\r\n\toutlineColorBlockStart : CSSPropertyDescriptorFactory('outlineColorBlockStart', 0, false, [], false, false),\r\n\toutlineColorInlineEnd : CSSPropertyDescriptorFactory('outlineColorInlineEnd', 0, false, [], false, false),\r\n\toutlineColorBlockEnd : CSSPropertyDescriptorFactory('outlineColorBlockEnd', 0, false, [], false, false),\r\n\toutlineColorInlineStart : CSSPropertyDescriptorFactory('outlineColorInlineStart', 0, false, [], false, false),\r\n\t\r\n\toutlineStyleBlockStart : CSSPropertyDescriptorFactory('outlineStyleBlockStart', 0, false, [], false, false),\r\n\toutlineStyleInlineEnd : CSSPropertyDescriptorFactory('outlineStyleInlineEnd', 0, false, [], false, false),\r\n\toutlineStyleBlockEnd : CSSPropertyDescriptorFactory('outlineStyleBlockEnd', 0, false, [], false, false),\r\n\toutlineStyleInlineStart : CSSPropertyDescriptorFactory('outlineStyleInlineStart', 0, false, [], false, false),\r\n\t\r\n\toutlineWidthBlockStart : CSSPropertyDescriptorFactory('outlineWidthBlockStart', 0, false, [], false, false),\r\n\toutlineWidthInlineEnd : CSSPropertyDescriptorFactory('outlineWidthInlineEnd', 0, false, [], false, false),\r\n\toutlineWidthBlockEnd : CSSPropertyDescriptorFactory('outlineWidthBlockEnd', 0, false, [], false, false),\r\n\toutlineWidthInlineStart : CSSPropertyDescriptorFactory('outlineWidthInlineStart', 0, false, [], false, false),\r\n\t\r\n\tcontent : CSSPropertyDescriptorFactory('content', 'normal', false, [], false, false),\t\t\t\t\t\t\t\t\t// normal | none | [ <content-replacement> | <content-list> ] [/ [ <string> | <counter> ]+ ]?\r\n\t\r\n\tanimation : CSSPropertyDescriptorFactory('animation', 'normal', false, [], false, false),\r\n\tanimationName : CSSPropertyDescriptorFactory('animationName', 'none', false, [], false, false),\r\n\tanimationDuration : CSSPropertyDescriptorFactory('animationDuration', '1', false, [], false, false),\r\n\tanimationIterationCount : CSSPropertyDescriptorFactory('animationIterationCount', '1', false, [], false, false),\r\n\tanimationIterationFunction : CSSPropertyDescriptorFactory('animationIterationFunction', '', false, [], false, false),\r\n\tanimationTimingFunction : CSSPropertyDescriptorFactory('animationTimingFunction', '', false, [], false, false),\r\n\tanimationDelay : CSSPropertyDescriptorFactory('animationDelay', '0', false, [], false, false)\r\n}\r\n\r\n\r\n\r\n\r\n\r\nvar boundaries = {}, c = 0, l = 0;\r\nfor (var groupName in SplittedCSSPropertyDescriptors) {\r\n\tl = Object.keys(SplittedCSSPropertyDescriptors[groupName]).length;\r\n\tboundaries[groupName] = {\r\n\t\tstart : c,\r\n\t\tlength : l\r\n\t};\r\n\tc += l;\r\n}\r\n// DEBUG: stdAttributes is the complete list of attributes for a given CSS rule (to be deleted)\r\nboundaries.stdAttributes = {\r\n\tstart : 0,\r\n\tlength : c\r\n}\r\n\r\n\r\n\r\nmodule.exports = {\r\n\tall : CSSPropertyDescriptors,\r\n\tsplitted : SplittedCSSPropertyDescriptors,\r\n\tboundaries : boundaries\r\n};",
    "\"use strict\";\n/**\r\n * construct. CSSPropertySetBuffer\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar MemoryMapBuffer = require('src/core/MemoryMapBuffer');\r\n\r\nvar CSSPropertyBuffer = require('src/editing/CSSPropertyBuffer');\r\nvar CSSPropertyDescriptors = require('src/editing/CSSPropertyDescriptors');\r\nvar FontSizeBuffer = require('src/editing/FontSizeBuffer');\r\nvar StylePropertyEnhancer = require('src/editing/StylePropertyEnhancer');\r\nvar stylePropertyConverter = new StylePropertyEnhancer();\r\n\r\nvar parser = require('src/parsers/css-parser_forked_normalized');\r\n\r\nvar TextSizeGetter = require('src/core/TextSizeGetter');\r\nvar textSizeGetter = new TextSizeGetter();\r\n\r\n/**\r\n * @constructor CSSPropertySetBuffer\r\n */\r\nvar CSSPropertySetBuffer = function(initialContent) {\r\n\tvar itemSize = CSSPropertyBuffer.prototype.bufferSchema.size;\r\n\tMemoryMapBuffer.call(this, itemSize, initialContent);\r\n\tthis.objectType = 'CSSPropertySetBuffer';\r\n\t\r\n\tif (!initialContent)\r\n\t\tthis.populateInitialValues();\r\n}\r\nCSSPropertySetBuffer.prototype = Object.create(MemoryMapBuffer.prototype);\r\nCSSPropertySetBuffer.prototype.objectType = 'CSSPropertySetBuffer';\r\n\r\nCSSPropertySetBuffer.prototype.propertiesStaticArray = Object.keys(CSSPropertyDescriptors.all);\r\nCSSPropertySetBuffer.prototype.inheritedPropertiesStaticArray = Object.keys(CSSPropertyDescriptors.splitted.inheritedAttributes);\r\nCSSPropertySetBuffer.prototype.propertiesAccessGroupsBoundaries = CSSPropertyDescriptors.boundaries;\r\n\r\nCSSPropertySetBuffer.prototype.populateInitialValues = function() {\r\n\tvar start = 0, end = 0;\r\n\t// we assume the propertiesAccessGroupsBoundaries object isn't ordered, although JS objects are ordered now\r\n\tfor (var attrGroup in this.propertiesAccessGroupsBoundaries) {\r\n\t\tif (this.propertiesAccessGroupsBoundaries[attrGroup].start > start) {\r\n\t\t\tstart = this.propertiesAccessGroupsBoundaries[attrGroup].start;\r\n\t\t\tend = start + this.propertiesAccessGroupsBoundaries[attrGroup].length;\r\n\t\t}\r\n\t}\r\n\tthis._buffer.set(\r\n\t\tCachedCSSPropertySetBuffer._buffer.slice(\r\n\t\t\t0,\r\n\t\t\tend * this.itemSize\r\n\t\t)\r\n\t);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getPosForProp = function(propName) {\r\n\tvar propIdx = 0;\r\n\r\n\tif ((propIdx = this.propertiesStaticArray.indexOf(propName)) !== -1) {\r\n\t\treturn propIdx;\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getPropForPos = function(pos) {\r\n\treturn this.propertiesStaticArray[pos];\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getProp = function(propName) {\r\n\tvar posForProp = this.getPosForProp(propName) * this.itemSize;\r\n//\tif (propName === 'display')\r\n//\t\tconsole.log(posForProp);\r\n\tvar propAsBuffer = new CSSPropertyBuffer(\r\n\t\t\tthis._buffer.slice(posForProp, posForProp + this.itemSize),\r\n\t\t\tpropName\r\n\t\t);\r\n\treturn propAsBuffer; \r\n}\r\n\r\nCSSPropertySetBuffer.prototype.setPropFromBuffer = function(propName, propBuffer) {\r\n\tvar resolvedPropName = propName, posForProp;\r\n\t\r\n\tif (CSSPropertyDescriptors.all[resolvedPropName].prototype.isShorthand) {\r\n\t\tthis.setPropFromShorthand(resolvedPropName, propBuffer.getValueAsString());\r\n\t}\r\n//\telse if (propBuffer.getTokenTypeAsString() === 'DimensionToken') {\r\n//\t\tthis.setPropAfterResolvingCanonicalUnits(resolvedPropName, propBuffer)\r\n//\t}\r\n\telse {\r\n\t\tif (CSSPropertyDescriptors.all[resolvedPropName].prototype.isAlias)\r\n\t\t\tresolvedPropName = CSSPropertyDescriptors.all[resolvedPropName].prototype.expandedPropNames[0];\r\n\t\tif ((posForProp = this.getPosForProp(resolvedPropName) * this.itemSize) < 0)\r\n\t\t\treturn;\r\n\t\tthis._buffer.set(propBuffer._buffer, posForProp);\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.setPropFromShorthand = function(propName, value) {\r\n\t\r\n//\tconsole.log('\t', propName, value);\r\n\tif (CSSPropertyDescriptors.all[propName].prototype.mayBeAbbreviated) {\r\n//\t\tconsole.log('setPropFromShorthand', propName, value);\r\n\t\tthis.handleAbbreviatedValues(propName, value);\r\n\t\treturn;\r\n\t}\r\n\t\r\n//\tconsole.log('\tsetPropFromShorthand', propName, value);\r\n\t\r\n\t// FIXME: (IMPROVEME)\r\n\t// We rely on the order of CSSPropertyDescriptors.all[propName].prototype.expandedPropNames\r\n\t// The sorting function won't work for all use-cases,\r\n\t// as it relies on the fact that shorthands contains uniquely typed values in the sequence of tokens\r\n\tvar tmpBuffer, expandedPropertyName;\r\n\tvar valueList = this.sortValuesFromShorthand(propName, value);\r\n\t\r\n//\tif (!valueList)\r\n//\t\treturn;\r\n\t\r\n\t// TODO: optimization : this may be passed a real result from the parser => benchmark\r\n//\tconsole.log('\t\tsetPropFromShorthand', propName, valueList);\r\n\tvalueList.forEach(function(val, key) {\r\n\t\tif (val === null)\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\texpandedPropertyName = CSSPropertyDescriptors.all[propName].prototype.expandedPropNames[key];\r\n\t\tif (CSSPropertyDescriptors.all[expandedPropertyName].prototype.mayBeAbbreviated) {\r\n\t\t\tthis.handleAbbreviatedValues(expandedPropertyName, val);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\ttmpBuffer = new CSSPropertyBuffer(null, expandedPropertyName);\r\n//\t\tconsole.log('\t', expandedPropertyName, val);\r\n\t\ttmpBuffer.setValue(val);\r\n//\t\tconsole.log('\t\t', tmpBuffer.bufferedValueToString());\r\n\t\tthis.setPropFromBuffer(expandedPropertyName, tmpBuffer);\r\n\t}, this);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.sortValuesFromShorthand = function(propName, value) {\r\n\t\r\n\tif (CSSPropertyDescriptors.splitted.boxModelAttributes[propName]) {\r\n\t\tvar tokenTypeFromParser;\r\n\t\tvar parsedValue = parser.parseAListOfComponentValues(value);\r\n\t\tvar sortedProp = {dimension : null, ident : null, hash : null}\r\n\t\tparsedValue.forEach(function(val) {\r\n\t\t\ttokenTypeFromParser = Object.getPrototypeOf(val).tokenType;\r\n//\t\t\tconsole.log('\t', tokenTypeFromParser);\r\n\t\t\tswitch (tokenTypeFromParser) {\r\n\t\t\t\tcase 'WHITESPACE' :\r\n\t\t\t\tcase 'COMMA' :\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NUMBER' :\r\n\t\t\t\t\t// There's an ambiguity in the CSS spec:\r\n\t\t\t\t\t// The parser is designed to assume that every integer/float\r\n\t\t\t\t\t// non-followed by an alphabetic char is a number (css-parser.js - line 254 && https://www.w3.org/TR/css-syntax-3/#consume-a-numeric-token).\r\n\t\t\t\t\t// But border-width may only be of type <length>,\r\n\t\t\t\t\t// and then is a dimension => it has to be an ident-like, then it is of type string\r\n\t\t\t\t\tif (propName === 'border')\r\n\t\t\t\t\t\tsortedProp.dimension = val.repr;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tsortedProp.dimension = val.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'DIMENSION' :\r\n\t\t\t\t\t\tsortedProp.dimension = val.repr;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'PERCENTAGE' :\r\n\t\t\t\t\t\tsortedProp.dimension = val.repr;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'HASH' :\r\n\t\t\t\t\t\tsortedProp.hash = val.repr;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'IDENT' :\r\n\t\t\t\t\t\tsortedProp.ident = val.repr;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'FUNCTION' : \r\n\t\t\t\t\t\tsortedProp.hash = CSSPropertyBuffer.prototype.functionToCanonical.call(null, val).repr;\r\n\t\t\t\tdefault : break;\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\treturn Object.values(sortedProp);\r\n\t}\r\n//\telse if (propName === 'background') {\r\n//\t\t\r\n//\t} etc.\r\n\telse {\r\n\t\treturn value.match(/[a-zA-Z0-9#\\/:.,%-]+/g) || [];\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.handleAbbreviatedValues = function(propName, value) {\r\n\tvar offset = 0, tmpBuffer, valueList = value.split(' '), expandedPropertyName;\r\n\t// valueList = parser.parseAListOfComponentValues(value.trim())\r\n\tif (valueList.length === 1) {\r\n\t\tCSSPropertyDescriptors.all[propName].prototype.expandedPropNames.forEach(function(expandedPropertyName, key) {\r\n\t\t\ttmpBuffer = new CSSPropertyBuffer(null, expandedPropertyName);\r\n\t\t\ttmpBuffer.setValue(valueList[0]);\r\n\t\t\tthis.setPropFromBuffer(expandedPropertyName, tmpBuffer);\r\n\t\t}, this);\r\n\t}\r\n\telse if (valueList.length === 2) {\t\t\t// the property shall include 1 whitespace\r\n\t\tCSSPropertyDescriptors.all[propName].prototype.expandedPropNames.forEach(function(expandedPropertyName, key) {\r\n\t\t\ttmpBuffer = new CSSPropertyBuffer(null, expandedPropertyName);\r\n\t\t\tif (key === 0 || key === 2)\r\n\t\t\t\ttmpBuffer.setValue(valueList[0]);\r\n\t\t\telse\r\n\t\t\t\ttmpBuffer.setValue(valueList[1]);\r\n\t\t\tthis.setPropFromBuffer(expandedPropertyName, tmpBuffer);\r\n\t\t}, this);\r\n\t}\r\n\telse if (valueList.length === 3) {\t\t\t// the property shall include 2 whitespace\r\n\t\tCSSPropertyDescriptors.all[propName].prototype.expandedPropNames.forEach(function(expandedPropertyName, key) {\r\n\t\t\ttmpBuffer = new CSSPropertyBuffer(null, expandedPropertyName);\r\n\t\t\tif (key !== 3)\r\n\t\t\t\ttmpBuffer.setValue(valueList[key]);\r\n\t\t\telse\r\n\t\t\t\ttmpBuffer.setValue(valueList[1]);\r\n//\t\t\toffset++;\r\n\t\t\tthis.setPropFromBuffer(expandedPropertyName, tmpBuffer);\r\n\t\t}, this);\r\n\t}\r\n\telse if (valueList.length === 4) {\t\t\t// the property shall include 3 whitespace\r\n\t\tCSSPropertyDescriptors.all[propName].prototype.expandedPropNames.forEach(function(expandedPropertyName, key) {\r\n\t\t\ttmpBuffer = new CSSPropertyBuffer(null, expandedPropertyName);\r\n\t\t\ttmpBuffer.setValue(valueList[key]);\r\n//\t\t\toffset++;\r\n\t\t\tthis.setPropFromBuffer(expandedPropertyName, tmpBuffer);\r\n\t\t}, this);\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.setPropAfterResolvingCanonicalUnits = function(overridePropBuffer, isFontSizeProp, originalPropName) {\r\n\tvar propName = 'fontSize',\r\n\t\tfontSize = this.getPropAsNumber(propName);\r\n\t\r\n\tif (isFontSizeProp) {\r\n\t\toverridePropBuffer.setValue(\r\n\t\t\tString(\r\n\t\t\t\tMath.floor(fontSize * overridePropBuffer.getValueAsNumber() / 100)\r\n\t\t\t) + 'px'\r\n\t\t);\r\n\t}\r\n\t\r\n\tvar\tfontFamily = this.getPropAsString('fontFamily'),\r\n\t\tfontStyle = fontSize + this.getUnitAsString(propName) + ' ' + fontFamily,\r\n\t\tsizeOfM = 0;\r\n\t\r\n\tswitch(overridePropBuffer.getUnitAsString()) {\r\n\t\tcase 'em' :\r\n\t\t\tsizeOfM = this.getTextDimensions('M', fontStyle);\r\n//\t\t\tconsole.log('NEW SIZE', overridePropBuffer.getValueAsNumber(), sizeOfM, fontStyle);\r\n\t\t\toverridePropBuffer.setValue(\r\n\t\t\t\tString(\r\n\t\t\t\t\tMath.floor(overridePropBuffer.getValueAsNumber() * sizeOfM)\r\n\t\t\t\t) + 'px'\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\t\tdefault :\r\n\t\t\tbreak;\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getDefinedPropertiesAsAttributesList = function() {\r\n\tvar propName;\r\n\tvar c = 0;\r\n\t\r\n\tvar ret = {};\r\n\t\r\n\tfor (var i = 0, end = i + this.propertiesStaticArray.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tpropName = this.propertiesStaticArray[c];\r\n\t\tif (this._buffer[i + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] === 0) {\r\n\t\t\tret[propName] = this.getProp(propName).getValueAsString();\r\n\t\t}\r\n\t\tc++;\r\n\t}\r\n\t\r\n\treturn ret;\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getPropertyGroupAsBufferMap = function(groupName) {\r\n\tvar propName;\r\n\tvar c = 0;\r\n\tvar boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\t\r\n\tvar ret = {};\r\n\tfor (var i = boundaries.start * this.itemSize, end = i + boundaries.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tpropName = this.propertiesStaticArray[boundaries.start + c];\r\n\t\tret[propName] = (new CSSPropertyBuffer(\r\n\t\t\tthis._buffer.slice(i, i + this.itemSize),\r\n\t\t\tpropName\r\n\t\t\t))\r\n\t\tc++;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getPropertyGroupAsAttributesList = function(groupName) {\r\n\tvar propName;\r\n\tvar c = 0;\r\n\tvar boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\t\r\n\tvar ret = {};\r\n\tfor (var i = boundaries.start * this.itemSize, end = i + boundaries.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tpropName = this.propertiesStaticArray[boundaries.start + c];\r\n\t\tret[propName] = this.getProp(propName).getValueAsString();\r\n\t\tc++;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getDefinedPropertiesFromGroupAsAttributesList = function(groupName) {\r\n\tvar propName, propValue;\r\n\tvar c = 0;\r\n\tvar boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\t\r\n\tvar ret = {};\r\n\tfor (var i = boundaries.start * this.itemSize, end = i + boundaries.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tpropName = this.propertiesStaticArray[boundaries.start + c];\r\n\t\tif (this._buffer[i + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] === 0)\r\n\t\t\tret[propName] = this.getProp(propName).getValueAsString();\r\n\t\tc++;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getPropertyGroupAsBuffer = function(groupName) {\r\n\tvar boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\tvar start = boundaries.start * this.itemSize, end = start + boundaries.length * this.itemSize;\r\n\treturn this._buffer.slice(start, end);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.setPropertyGroupFromGroupBuffer = function(groupName, groupBuffer) {\r\n\tvar boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\tvar start = boundaries.start * this.itemSize;\r\n\tthis._buffer.set(groupBuffer, start);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.overridePropertyGroupFromGroupBuffer = function(groupName, groupBuffer, setFromInherited) {\r\n//\tconsole.log('called');\r\n\tvar inheritedAttributesStr = 'inheritedAttributes',\r\n\t\tfontSizeStr = 'fontSize',\r\n\t\tfontFamilyStr = 'fontFamily',\r\n\t\tisFontSizeProp = false; \r\n\tvar c = 0,\r\n\t\tboundaries = this.propertiesAccessGroupsBoundaries[groupName],\r\n\t\tfontSizeIdx = 0,\r\n\t\ttmpPropertyBuffer,\r\n\t\tfontFamily = '',\r\n\t\tfontSize = 0;\r\n\t\r\n\tfor (var i = boundaries.start * this.itemSize, end = i + boundaries.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tisFontSizeProp = false;\r\n\t\t\r\n\t\t// groupBuffer[c + offset] represents the flag \"isInitialValue\"\r\n//\t\tconsole.log('TokenType', groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.tokenType.start])\r\n//\t\tconsole.log(i / this.itemSize, this.propertiesStaticArray[i / this.itemSize], fontFamilyStr);\r\n\t\t// Not optimized way to handle 'em' CSS units (they depend on the size of the letter \"M\" in the current font-style)\r\n\t\t// TODO: is there a way to optimize this ?\r\n\t\t// FIXME: \r\n\t\tif (groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.tokenType.start] === CSSPropertyBuffer.prototype.TokenTypes.DimensionToken) {\r\n\t\t\t// && groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] !== 1\r\n\t\t\ttmpPropertyBuffer = new CSSPropertyBuffer(null, '');\r\n\t\t\ttmpPropertyBuffer._buffer.set(groupBuffer.slice(c, c + this.itemSize), 0);\r\n\t\t\t\r\n\t\t\tthis.setPropAfterResolvingCanonicalUnits(tmpPropertyBuffer, isFontSizeProp);\r\n\t\t\tthis._buffer.set(tmpPropertyBuffer._buffer, i);\r\n\t\t\t\r\n\t\t\tc += this.itemSize;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t// Handling of the font-sizes caches : we must have the size AND the family to compute a cache\r\n\t\t// So we trigger cache-building only when we apply styles on a layout node\r\n\t\telse if (groupName === \tinheritedAttributesStr\t\t\t\t\t\t\t\t// hard-coded for optimization\r\n\t\t\t&& this.propertiesStaticArray[i / this.itemSize] === fontFamilyStr\r\n\t\t\t&& groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] !== 1) {\r\n//\t\t\tconsole.error(groupName);\r\n\t\t\t\r\n\t\t\tfontFamily = groupBuffer.bufferToPartialString(c + CSSPropertyBuffer.prototype.bufferSchema.repr.start);\r\n\t\t\t\r\n\t\t\t// Get the fontSize from the next Buffer in the loop, as we don't know yet if the local size is the actual size\r\n\t\t\t// In the PropertyDescriptors, we chose to have the family before the size\r\n\t\t\ttmpPropertyBuffer = new CSSPropertyBuffer(null, fontFamilyStr);\r\n\t\t\ttmpPropertyBuffer._buffer.set(groupBuffer.slice(c + this.itemSize, c + this.itemSize * 2), 0);\r\n\t\t\tfontSize = tmpPropertyBuffer.getValueAsNumber().toString() + tmpPropertyBuffer.getUnitAsString();\r\n\t\t\t\r\n\t\t\t// TODO: find in which cases the fontSize is 0 : seems we apply populateStyles before inheritedStyles\r\n//\t\t\tif (fontSize === '0')\r\n//\t\t\t\tfontSize = this.getPropAsNumber(fontSizeStr) + this.getUnitAsString(fontSizeStr);\r\n\t\t\t\r\n\t\t\tif (fontSize !== '0') {\r\n\t\t\t\tif (!this.isFontSizeBufferInCache(fontSize, fontFamily))\r\n\t\t\t\t\tthis.addFontSizeBufferToCache(fontSize, fontFamily)\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Handling of fontSizes in percents\r\n\t\telse if (!setFromInherited\r\n\t\t\t&& groupName === inheritedAttributesStr\t\t\t\t\t\t\t\t// hard-coded for optimization\r\n\t\t\t&& this.propertiesStaticArray[i / this.itemSize] === fontSizeStr\r\n\t\t\t&& groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] !== 1) {\r\n\t\t\t\r\n\t\t\ttmpPropertyBuffer = new CSSPropertyBuffer(null, fontSizeStr);\r\n\t\t\ttmpPropertyBuffer._buffer.set(groupBuffer.slice(c, c + this.itemSize), 0);\r\n\t\t\t\r\n\t\t\tif (tmpPropertyBuffer.getTokenTypeAsNumber() === CSSPropertyBuffer.prototype.TokenTypes.PercentageToken) {\r\n\t\t\t\tthis.setPropAfterResolvingCanonicalUnits(tmpPropertyBuffer, true);\r\n\t\t\t\tgroupBuffer.set(tmpPropertyBuffer._buffer, c);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (groupBuffer[c + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start] !== 1)\r\n\t\t\tthis._buffer.set(groupBuffer.slice(c, c + this.itemSize), i);\r\n\t\tc += this.itemSize;\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.isFontSizeBufferInCache = function(fontSize, fontFamily) {\r\n\treturn TypeManager.fontSizeBuffersCache.cache.hasOwnProperty(fontSize +' ' + fontFamily);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.addFontSizeBufferToCache = function(fontSize, fontFamily) {\r\n//\tconsole.log(fontSize, fontFamily);\r\n\tTypeManager.fontSizeBuffersCache.cache[fontSize +' ' + fontFamily] = new FontSizeBuffer(fontSize, fontFamily);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.setGroupIsInitialValue = function(groupName, bool) {\r\n\tvar c = 0, boundaries = this.propertiesAccessGroupsBoundaries[groupName];\r\n\tfor (var i = boundaries.start * this.itemSize, end = i + boundaries.length * this.itemSize; i < end; i += this.itemSize) {\r\n\t\tthis._buffer.set([+(bool || 0)], i + CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start);\r\n\t}\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getIsInitialValue = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.getIsInitialValue();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getIsInitialValueAsBool = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.getIsInitialValueAsBool();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getTokenTypeForPropAsString = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.tokenTypeToString();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getTokenTypeForPropAsConstant = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.tokenTypeToNumber();\r\n}\r\n\r\n// getPropAsString() is an alias for bufferedValueToString()\r\n// TODO: unify\r\nCSSPropertySetBuffer.prototype.getPropAsString = function(propName) {\r\n\treturn this.bufferedValueToString(propName);\r\n}\r\n\r\n// getPropAsNumber() is an alias for bufferedValueToNumber(propName)\r\n// TODO: unify\r\nCSSPropertySetBuffer.prototype.getPropAsNumber = function(propName) {\r\n\treturn this.bufferedValueToNumber(propName);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getUnitAsString = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.getUnitAsString();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getValueTypeAsString = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.getValueTypeAsString();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.getValueTypeAsNumber = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.getValueTypeAsNumber();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.bufferedValueToString = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n\treturn propBuffer.bufferedValueToString();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.bufferedValueToNumber = function(propName) {\r\n\tvar propBuffer = this.getProp(propName);\r\n//\tconsole.log(propBuffer);\r\n\treturn propBuffer.bufferedValueToNumber();\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.fastBufferedValueToString = function(propName) {\r\n\tvar propIndex = this.getPosForProp(propName) * this.itemSize,\r\n\t\tpropLength = this._buffer[propIndex + CSSPropertyBuffer.prototype.bufferSchema.reprLength.start],\r\n\t\tpropOffset = CSSPropertyBuffer.prototype.bufferSchema.repr.start,\r\n\t\tpropStartIndex = propIndex + propOffset,\r\n\t\tpropEndIndex = propStartIndex + propLength;\r\n\treturn this._buffer.slice(propStartIndex, propEndIndex).bufferToString(propLength);\r\n}\r\n\r\nCSSPropertySetBuffer.prototype.fastBufferedValueToNumber = function(propName) {\r\n\tvar propIndex = this.getPosForProp(propName) * this.itemSize,\r\n\t\tpropOffset = CSSPropertyBuffer.prototype.bufferSchema.propertyValue.start,\r\n\t\tpropStartIndex = propIndex + propOffset,\r\n\t\tpropEndIndex = propStartIndex + CSSPropertyBuffer.prototype.bufferSchema.propertyValue.length;\r\n\treturn CSSPropertyBuffer.prototype.byteTuppleTo16bits(this._buffer.slice(propStartIndex, propEndIndex));\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * @method getTextDimensions\r\n * @param {String} textContent\r\n */\r\nCSSPropertySetBuffer.prototype.getTextDimensions = function(textContent, fontStyle) {\r\n//\tconsole.log(this.getAugmentedFontStyle());\r\n\tif (!textContent.length)\r\n\t\treturn 0;\r\n\tvar textSize = textSizeGetter.getTextSizeDependingOnStyle(\r\n\t\t\ttextContent,\r\n\t\t\tfontStyle\r\n\t\t);\r\n\treturn textSize[0] - textSize[0] / 21;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CachedCSSPropertySetBuffer = (function() {\r\n\tvar packedCSSProperty, propertySetBuffer = new CSSPropertySetBuffer(new Uint8Array());\r\n\tfor (var attrGroup in CSSPropertyDescriptors.splitted) {\r\n\t\tObject.keys(CSSPropertyDescriptors.splitted[attrGroup]).forEach(function(attrName) {\r\n//\t\t\tconsole.log(attrName, CSSPropertyDescriptors.all[attrName].prototype.initialValue);\r\n\t\t\tpackedCSSProperty = new CSSPropertyBuffer(null, attrName);\r\n\t\t\tpackedCSSProperty.setValue(\r\n//\t\t\t\tparser.parseAListOfComponentValues(\r\n\t\t\t\t\tCSSPropertyDescriptors.all[attrName].prototype.initialValue\r\n//\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tpropertySetBuffer.setPropFromBuffer(attrName, packedCSSProperty);\r\n\t\t});\r\n\t\tpropertySetBuffer.setGroupIsInitialValue(attrGroup, true);\r\n\t}\r\n\treturn propertySetBuffer;\r\n})()\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = CSSPropertySetBuffer;",
    "\"use strict\";\n/**\r\n * construct. CSSSelectorSetBuffer\r\n */\r\n\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar CSSSelectorsList = require('src/editing/CSSSelectorsList');\r\nvar MemoryMapBuffer = require('src/core/MemoryMapBuffer');\r\nvar MemorySingleBuffer = require('src/core/MemorySingleBuffer');\r\nvar GeneratorFor16bitsInt = require('src/core/UIDGenerator').GeneratorFor16bitsInt;\r\n\r\n\r\n/**\r\n * @constructor CSSSelectorSetBuffer\r\n */\r\nvar CSSSelectorSetBuffer = function(initialContent, selectorsList) {\r\n\tthis.itemSize = CSSSelectorsList.prototype.optimizedSelectorBufferSchema.size;\r\n\tMemoryMapBuffer.call(this, this.itemSize, initialContent);\r\n\tthis.objectType = 'CSSSelectorSetBuffer';\r\n\tthis._byteLength = 0;\r\n\t\r\n\tthis.entryList = [];\r\n\t\r\n\tif (selectorsList)\r\n\t\tthis.populateFromSelectorsList(selectorsList);\r\n}\r\nCSSSelectorSetBuffer.prototype = Object.create(MemoryMapBuffer.prototype);\r\nCSSSelectorSetBuffer.prototype.objectType = 'CSSSelectorSetBuffer';\r\n\r\nCSSSelectorSetBuffer.prototype.getPosForEntry = function(entryName) {\r\n\tvar entryIdx = 0;\r\n\tif ((entryIdx = this.entryList.indexOf(entryName)) !== -1) {\r\n\t\treturn entryIdx;\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\nCSSSelectorSetBuffer.prototype.getEntryForPos = function(pos) {\r\n\treturn this.entryList[pos];\r\n}\r\n\r\nCSSSelectorSetBuffer.prototype.getEntry = function(entryName) {\r\n\tvar posForEntry = this.getPosForEntry(entryName) * this.itemSize;\r\n//\tconsole.log(entryName, posForEntry, this._buffer, this._buffer.slice(posForEntry, posForEntry + this.itemSize));\r\n\tif (posForEntry < 0)\r\n\t\treturn new MemorySingleBuffer(CSSSelectorsList.prototype.optimizedSelectorBufferSchema);\r\n\t\r\n\tvar propAsBuffer = new MemorySingleBuffer(\r\n\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema,\r\n\t\tthis._buffer.slice(posForEntry, posForEntry + this.itemSize)\r\n\t\t);\r\n\treturn propAsBuffer; \r\n}\r\n\r\nCSSSelectorSetBuffer.prototype.addEntryFromBuffer = function(entryName, selectorBuffer) {\r\n\tif (this._byteLength + selectorBuffer._byteLength > this._buffer.byteLength) {\r\n\t\tthis._buffer = new Uint8Array(this._buffer.buffer.append(new ArrayBuffer(selectorBuffer._byteLength)));\r\n\t\tthis._byteLength += selectorBuffer._byteLength;\r\n\t}\r\n\t\r\n\tvar posForEntry = this.entryList.length * this.itemSize;\r\n\tthis.entryList.push(entryName);\r\n\tthis._buffer.set(selectorBuffer._buffer, posForEntry);\r\n}\r\n\r\nCSSSelectorSetBuffer.prototype.populateFromSelectorsList = function(selectorsList) {\r\n\tvar substrDef, bufferUIDforList = GeneratorFor16bitsInt.newUID();\r\n//\tconsole.log(bufferUIDforList);\r\n\tselectorsList.forEach(function(selector) {\r\n\t\t// TAKE CARE OF PERF: Our fail-fast strategy: we optimized the String.prototype.getNCharAsCharCodes method to get 3 chars most of the time,\r\n\t\t// \t\tand then we only match on the first char.\r\n\t\t\r\n\t\t// We're matching insensitive to case: eg https://www.w3.org/TR/2011/REC-CSS2-20110607/syndata.html#characters\r\n\t\t// \t\t=> \"All CSS syntax is case-insensitive within the ASCII range.\"\r\n\t\t// (selector.rightMost.toLowerCase().getNcharsAsCharCodesArray(3, 4);)\r\n//\t\tconsole.log(selector.rightMostHasPseudoClassFlag);\r\n\t\tsubstrDef = selector.rightMost.toLowerCase().getNcharsAsCharCodesArray(3, 4);\r\n\t\tthis.addEntryFromBuffer(\r\n\t\t\tselector.selectorStr,\r\n\t\t\tthis.getCompactedViewOnSelector(\r\n\t\t\t\tsubstrDef,\r\n\t\t\t\tselector.selectorProofingPartType,\r\n\t\t\t\tbufferUIDforList,\r\n\t\t\t\tselector.rightMostHasPseudoClassFlag,\r\n\t\t\t\tselector.rightMostPseudoClassType\r\n\t\t\t\t));\r\n\t}, this);\r\n}\r\n\r\nCSSSelectorSetBuffer.prototype.getCompactedViewOnSelector = function(substrDef, proofingPartType, bufferUIDforList, hasPseudoClass, pseudoClassType) {\r\n\tvar buffer = new MemorySingleBuffer(CSSSelectorsList.prototype.optimizedSelectorBufferSchema);\r\n\t// 16 bits values have to be declared as byte-tuples ([1, 0] would then represent 1, as all CPU's are now little-endian) \r\n\t// (GeneratorFor16bitsInt, responsible for the UID, shall return an array)\r\n\t// Offset of the extracted string from the original string\r\n\t\r\n\tbuffer.set(\r\n\t\t\t[substrDef[0]],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.startingOffsetInString.start\r\n\t\t);\r\n\t// Length of the extracted string from the original string\r\n\tbuffer.set(\r\n\t\t\t[substrDef[1].length],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.stringLength.start\r\n\t\t);\r\n\t// Inject the most specific selector (specificity priority is: !important -> \"style\" DOM attr as a rule -> ID -> class/attribute/prop/pseudo-class -> nodeType/pseudo-elem)\r\n\tbuffer.set(\r\n\t\t\tsubstrDef[1],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.stringBinaryEncoded.start\r\n\t\t);\r\n\t// ProofingPartType\r\n\tbuffer.set(\r\n\t\t\t[proofingPartType],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.selectorProofingPartType.start\r\n\t\t);\r\n\t// hasPseudoClass\r\n\tbuffer.set(\r\n\t\t\t[hasPseudoClass],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.selectorHasPseudoClass.start\r\n\t\t);\r\n\t// pseudoClassType\r\n\tbuffer.set(\r\n\t\t\t[pseudoClassType],\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.selectorPseudoClassType.start\r\n\t\t);\r\n\t// bufferUIDforList\r\n\tbuffer.set(\r\n\t\t\tbufferUIDforList,\r\n\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.bufferUID.start\r\n\t\t);\r\n//\tconsole.log(buffer);\r\n\treturn buffer;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = CSSSelectorSetBuffer;",
    "\"use strict\";\n/**\r\n * construct. CSSSelectorsList\r\n */\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar BinarySchemaFactory = require('src/core/BinarySchema');\r\n\r\n\r\n\r\n/**\r\n * @constructor CSSSelectorsList\r\n */\r\nvar CSSSelectorsList = function(selectorAsStr) {\r\n\tObject.defineProperty(this, 'objectType', {value : 'CSSSelectorsList'});\r\n\tvar selectorsList;\r\n\t\r\n\tif (selectorAsStr.match(/,/)) {\r\n\t\tselectorsList = selectorAsStr.split(/,\\s/);\r\n\t\tif (selectorsList === null) {\r\n\t\t\tconsole.warn('CSSSelectorsList: no actual selector could be identified. selectorAsStr is \"' + selectorAsStr + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tselectorsList.forEach(function(selector){\r\n\t\t\tthis.push(new CSSSelector(selector));\r\n\t\t}, this);\r\n\t}\r\n\telse\r\n\t\tthis.push(new CSSSelector(selectorAsStr));\r\n\r\n\tObject.defineProperty(CSSSelectorsList.prototype, 'maxSpecificity', {\r\n\t\tvalue : this.getMaxSpecificity()\r\n\t});\r\n}\r\nCSSSelectorsList.prototype = Object.create(Array.prototype);\r\nCSSSelectorsList.prototype.objectType = 'CSSSelectorsList';\r\n\r\nObject.defineProperty(CSSSelectorsList.prototype, 'getMaxSpecificity', {\r\n\tvalue : function() {\r\n\t\t\r\n\t}\r\n});\r\n\r\nObject.defineProperty(CSSSelectorsList.prototype, 'optimizedSelectorBufferSchema', {\r\n\tvalue : BinarySchemaFactory(\r\n\t\t'compactedViewOnSelector',\r\n\t\t[\t\r\n\t\t\t'startingOffsetInString',\r\n\t\t\t'stringLength',\r\n\t\t\t'stringBinaryEncoded',\r\n\t\t\t'selectorProofingPartType',\r\n\t\t\t'selectorHasPseudoClass',\r\n\t\t\t'selectorPseudoClassType',\r\n\t\t\t'reservedForFutureUse',\r\n\t\t\t'bufferUID',\r\n\t\t],\r\n\t\t[\r\n\t\t\t1,\r\n\t\t\t1,\r\n\t\t\t3,\r\n\t\t\t1,\r\n\t\t\t1,\r\n\t\t\t1,\r\n\t\t\t6,\r\n\t\t\t2\r\n\t\t]\r\n\t)\r\n});\r\n\r\n// UTILITY FUNCTIONS: to be used when matching the selectors\r\nCSSSelectorsList.prototype.DHLstr = function(DHL) {\r\n\tvar ret = '';\r\n\tfor (var i = 0, l = DHL; i < l; i++) {\r\n\t\tret += '\t';\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nCSSSelectorsList.prototype.localDebugLog = function() {\r\n//\tconsole.log.apply(null, Array.prototype.slice.call(arguments));\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CSSSelector = function(selectorAsStr) {\r\n\t//TODO: A CSS selector may be a list of selectors\r\n\t//\t\t=> instanciate a list by default\r\n\r\n\tthis.selectorStr = selectorAsStr;\r\n\tthis.components = new CSSSelectorComponentList();\t// Dummy object to avoid hidden-class transition\r\n\tthis.selectorProofingPartType = 0;\r\n\tthis.rightMost = this.extractMostSpecificPartFromSelector();\r\n//\tconsole.log(this.rightMost);\r\n\tthis.rightMostHasPseudoClassFlag = this.components[this.components.length - 1].hasPseudoClassFlag;\r\n\tthis.rightMostPseudoClassType = this.components[this.components.length - 1].pseudoClassType;\r\n\tthis.specificity = this.getSpecificity();\r\n}\r\nCSSSelector.prototype = {};\r\nCSSSelector.prototype.objectType = 'CSSSelector';\r\n\r\nCSSSelector.prototype.toString = function() {\r\n\treturn this.selectorStr;\r\n}\r\n\r\nCSSSelector.prototype.extractMostSpecificPartFromSelector = function() {\r\n\tthis.components = new CSSSelectorComponentList(this.selectorStr);\r\n\tthis.specificity = this.components.specificity;\r\n\treturn this.cascadeOnSpecificity(this.components[this.components.length - 1].value);\r\n}\r\n\r\nCSSSelector.prototype.cascadeOnSpecificity = function(rightMost) {\r\n\tvar match;\r\n//\tconsole.log(rightMost);\r\n//\t(rightMost === ':host' && console.log(rightMost, match));\r\n\tmatch = rightMost.match(this.typeIsId);\r\n\r\n\tif (match) {\r\n\t\tthis.selectorProofingPartType = this.constants.idIsProof;\r\n\t\treturn match[1];\r\n\t}\r\n\telse {\r\n\t\tmatch = rightMost.match(this.typeIsClass);\r\n//\t\t(rightMost === ':host' && console.log(rightMost, match));\r\n\t\tif (match) {\r\n\t\t\tthis.selectorProofingPartType = this.constants.classIsProof;\r\n\t\t\treturn match[1] || match[2];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmatch = rightMost.match(this.typeIsHost);\r\n//\t\t\t(rightMost === ':host' && console.log(rightMost, match));\r\n\t\t\tif (match) {\r\n\t\t\t\tthis.selectorProofingPartType = this.constants.hostIsProof;\r\n\t\t\t\treturn match[0];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmatch = rightMost.match(this.typeIsTag);\r\n\t//\t\t\t(rightMost === ':host' && console.log(rightMost, match));\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tthis.selectorProofingPartType = this.constants.tagIsProof;\r\n\t\t\t\t\treturn match[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn rightMost;\r\n}\r\n\r\nCSSSelector.prototype.getSpecificity = function(selectorAsStr) {\r\n\treturn this.components.specificity;\r\n}\r\n\r\nCSSSelector.prototype.constants = {\r\n\trawSelectorIsProof : 0,\r\n\tidIsProof : 1,\r\n\tclassIsProof : 2,\r\n\ttagIsProof : 3,\r\n\thostIsProof : 4\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CSSSelectorComponentList = function(selectorAsStr) {\r\n\tif (!selectorAsStr)\r\n\t\treturn;\r\n\t\t\r\n\tthis.captureRelationship(selectorAsStr);\r\n\t\r\n\tObject.defineProperty(this, 'specificity', {\r\n\t\tvalue : this.getSpecificity()\r\n\t});\r\n\t \r\n\tif (!this.length)\r\n\t\tconsole.warn('CSSSelectorComponentList:', 'selectorAsStr => [' + selectorAsStr + ']', 'instanciation of the CSSSelectorComponentList failed.')\r\n}\r\nCSSSelectorComponentList.prototype = Object.create(Array.prototype);\r\n\r\nObject.defineProperty(CSSSelectorComponentList.prototype, 'objectType', {\r\n\tvalue : 'CSSSelectorComponentList'\r\n});\r\n\r\nObject.defineProperty(CSSSelectorComponentList.prototype, 'getSpecificity', {\r\n\tvalue : function() {\r\n\t\tvar specificity = 0;\r\n\t\tthis.forEach(function(component) {\r\n\t\t\tspecificity += component.getSpecificity();\r\n\t\t}, this);\r\n\t\treturn specificity;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(CSSSelectorComponentList.prototype, 'captureRelationship', {\r\n\tvalue : function(selectorAsStr) {\r\n\t\t// TODO: Ensure we can't encounter a coma here, that would be a list of selectors\r\n\t\tvar leftSibbling;\r\n\t\tvar splitted = selectorAsStr.trim().split(CSSSelectorComponent.prototype.splitter);\r\n\t\t\r\n\t\tsplitted.forEach(function(rawComponent) {\r\n\t\t\tif (!rawComponent.match(CSSSelectorComponent.prototype.typeIsCombinator))\r\n\t\t\t\tthis.push(new CSSSelectorComponent(rawComponent, leftSibbling));\r\n\t\t\tleftSibbling = rawComponent;\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CSSSelectorComponent = function(componentAsStr, leftSibbling) {\r\n\tvar match;\r\n\tthis.objectType = 'CSSSelectorComponent';\r\n\t\r\n\tthis.value = componentAsStr;\r\n\tthis.type = this.getType(componentAsStr);\r\n\tthis.relation = this.getRelation(leftSibbling);\r\n\t\r\n\tthis.compoundValues = this.getCompoundValues(componentAsStr);\r\n\tthis.isCompound = this.compoundValues.valuesCount > 1;\r\n\t\r\n\t// FIXME: this code does not support having multiple pseudo-classes\r\n\tthis.hasPseudoClassFlag = this.getHasPseudoClass(componentAsStr) || 0;\r\n\tthis.pseudoClassMicroSyntax = [];\r\n\tthis.pseudoClassType = (this.hasPseudoClassFlag && this.getPseudoClassConstant(componentAsStr)) || 0;\r\n\t\r\n\tthis.hasAttributesFlag = this.getHasAttributes(componentAsStr) || 0;\r\n\t\r\n\treturn (this.type && this.relation) || undefined;\r\n}\r\nCSSSelectorComponent.prototype = {};\r\nCSSSelectorComponent.prototype.objectType = 'CSSSelectorComponent';\r\n\r\nCSSSelectorComponent.prototype.splitter = /\\s/;\r\nCSSSelectorComponent.prototype.hostPseudoFunction = /^(:host)\\((.+?)\\)/;\r\nCSSSelectorComponent.prototype.attributesComponent = /^(\\w+?)\\[(\\w+?)([=~^]+?)(.+?)\\]/;\r\n\r\nCSSSelectorComponent.prototype.shadowDOMHostSpecialKeyword = ':host';\r\n\r\n// /\\w/ matches on alphaNum AND underscore\r\nCSSSelectorComponent.prototype.typeIsCombinator = /^[>~+]/;\r\nCSSSelectorComponent.prototype.typeIsUniversal = /^\\*$/;\r\nCSSSelectorComponent.prototype.typeIsId = /^#(\\w+)/;\r\nCSSSelectorComponent.prototype.typeIsClass = /^\\.([\\w-]+)|\\[class.?=\"([\\w-]+)\"\\]/;\r\nCSSSelectorComponent.prototype.typeIsAttribute = CSSSelectorComponent.prototype.attributesComponent;\r\nCSSSelectorComponent.prototype.typeIsHost = /^:host/;\t// we removed the $ flag, cause it failed in getType() with :host(.class-name) (but if I remeber well, we had added the $ because it failed in other cases, but which?) \r\nCSSSelectorComponent.prototype.typeIsTag = /^(?<![\\.#\\:])[\\w_-]+/;\t\t // Negative lookbehind : (?<!...)\r\n\r\nCSSSelectorComponent.prototype.hasPseudoClass = /(?<=[^:]):[\\w-]+/;\r\nCSSSelectorComponent.prototype.pseudoClassTypeFormat = /(.+?):([\\w-]+?)\\(([\\wn+-]+?)\\)(.+)?/;\r\nCSSSelectorComponent.prototype.pseudoClassMicroSyntaxFormat = /(-?[0-9]n\\s?)?\\s?([+-]?\\s?(-?[0-9]*))?/;\r\n\r\nCSSSelectorComponent.prototype.getType = function(componentAsStr) {\r\n\t// TODO: this MUST return a value qualifying ONLY the first part of the component (poorly tested till then)\r\n\tif (this.typeIsId.test(componentAsStr))\r\n\t\treturn this.typeConstants.idType;\r\n\telse if (this.typeIsClass.test(componentAsStr))\r\n\t\treturn this.typeConstants.classType;\r\n\telse if (this.typeIsAttribute.test(componentAsStr))\r\n\t\treturn this.typeConstants.attributeType;\r\n\telse if (this.typeIsTag.test(componentAsStr))\r\n\t\treturn this.typeConstants.tagType;\r\n\telse if (this.typeIsHost.test(componentAsStr))\r\n\t\treturn this.typeConstants.hostType;\r\n\telse if (this.typeIsUniversal.test(componentAsStr))\r\n\t\treturn this.typeConstants.universalType;\r\n\telse {\r\n//\t\tconsole.warn('CSSSelectorComponent:', 'unknown type case should not be reachable.');\r\n\t\treturn this.relationConstants.unknownType;\r\n\t}\r\n}\r\n\r\nCSSSelectorComponent.prototype.getHasPseudoClass = function(componentAsStr) {\r\n//\tconsole.log(componentAsStr);\r\n\treturn +(this.hasPseudoClass.test(componentAsStr) && !this.typeIsHost.test(componentAsStr));\r\n}\r\n\r\nCSSSelectorComponent.prototype.getHasAttributes = function(componentAsStr) {\r\n//\tconsole.log(componentAsStr);\r\n\treturn this.attributesComponent.test(componentAsStr);\r\n}\r\n\r\nCSSSelectorComponent.prototype.getPseudoClassConstant = function(componentAsStr) {\r\n\tvar match;\r\n\r\n\tif ((match = componentAsStr.match(this.pseudoClassTypeFormat)) && match.length >= 4) {\r\n\t\tthis.isCompound = true;\r\n\t\tvar newComponentAsStr = match[1] + (match[4] || '');\r\n\t\tthis.compoundValues = this.getCompoundValues(newComponentAsStr);\r\n\t\t\r\n\t\tvar microSyntax;\r\n\t\tif ((microSyntax = match[3].match(this.pseudoClassMicroSyntaxFormat)) && microSyntax[0]) {\r\n\t\t\tthis.pseudoClassMicroSyntax = [microSyntax[1] ? parseInt(microSyntax[1].slice(0, -1)) : 0, microSyntax[3] ? parseInt(microSyntax[3]) : 0];\r\n\t\t\treturn this.pseudoClassConstants[match[2].hyphensToDromedar() + 'ANpB'];\r\n\t\t}\r\n\t\t\r\n\t\treturn this.pseudoClassConstants[match[2].hyphensToDromedar() + match[3].capitalizeFirstChar()];\r\n\t}\r\n\telse\r\n\t\treturn this.pseudoClassConstants['unknown'];\r\n}\r\n\r\nCSSSelectorComponent.prototype.getRelation = function(leftSibbling) {\r\n\tif (!leftSibbling)\r\n\t\treturn this.relationConstants.none;\r\n\telse if (this.isValidComponent(leftSibbling))\r\n\t\treturn this.relationConstants.descendant;\r\n\telse if (leftSibbling === this.interestingTokens.immediateDescendantToken)\r\n\t\treturn this.relationConstants.immediateDescendant;\r\n\telse if (leftSibbling === this.interestingTokens.immediateNextSibblingToken)\r\n\t\treturn this.relationConstants.immediateNextSibbling;\r\n\telse if (leftSibbling === this.interestingTokens.anyForwardSibblingToken)\r\n\t\treturn this.relationConstants.anyForwardSibbling;\r\n\telse {\r\n\t\tconsole.warn('CSSSelectorComponent,', 'unsupported relation : leftSibbling is /' + leftSibbling + '/,', 'that case should not be reachable. (possible parsing error on our side)');\r\n\t\treturn this.relationConstants.unknown;\r\n\t}\r\n}\r\n\r\nCSSSelectorComponent.prototype.getCompoundValues = function(selectorAsStr) {\r\n\tvar classPart1, classPart2;\r\n\tvar splittedOnId = selectorAsStr.split('#');\r\n\tvar tagPart = (classPart1 = splittedOnId[0].split('.')) && classPart1.shift();\r\n\tvar idPart = (splittedOnId.length > 1 && (classPart2 = splittedOnId[1].split('.')).shift());\r\n\tvar classPart = classPart2 ? classPart1.concat(classPart2) : classPart1;\r\n\r\n\treturn (new CSSSelectorComponentValues(selectorAsStr, tagPart, idPart, classPart));\r\n}\r\n\r\nCSSSelectorComponent.prototype.getSpecificity = function() {\r\n\tvar simpleSpecificity, compoundSpecificity;\r\n\tif (this.isCompound) {\r\n\t\tcompoundSpecificity = this.compoundValues.getSpecificity();\r\n\t\t// FIXME: There may be multiple pseudo-classes\r\n\t\tif (this.hasPseudoClassFlag)\r\n\t\t\treturn compoundSpecificity | (1 << 8)\r\n\t\telse\r\n\t\t\treturn compoundSpecificity;\r\n\t}\r\n\telse {\r\n\t\tif (this.type === this.typeConstants.idType)\r\n\t\t\tsimpleSpecificity = 1 << 16;\r\n\t\tif (this.type === this.typeConstants.classType || this.type === this.typeConstants.attributeType)\r\n\t\t\tsimpleSpecificity = 1 << 8;\r\n\t\tif (this.type === this.typeConstants.tagType || this.type === this.typeConstants.hostType)\r\n\t\t\tsimpleSpecificity = 1;\r\n\t\t// FIXME: There may be multiple pseudo-classes\r\n\t\tif (this.hasPseudoClassFlag)\r\n\t\t\treturn simpleSpecificity | (1 << 8)\r\n\t\telse\r\n\t\t\treturn simpleSpecificity;\r\n\t}\r\n}\r\n\r\nCSSSelectorComponent.prototype.isValidComponent = function(leftSibbling) {\r\n\t// HACK: could we really rely on the fact that a component\r\n\t// is valid if it can be resolved to a known type ? \r\n\treturn this.getType(leftSibbling);\r\n}\r\n\r\nCSSSelectorComponent.prototype.interestingTokens = {\r\n\timmediateDescendantToken : '>',\r\n\timmediateNextSibblingToken : '+',\r\n\tanyForwardSibblingToken : '~'\r\n}\r\n\r\nCSSSelectorComponent.prototype.typeConstants = {\r\n\tunknownType : 0,\r\n\tuniversalType : 1,\r\n\tidType : 2,\r\n\tclassType : 3,\r\n\tattributeType : 4,\r\n\ttagType : 5,\r\n\thostType : 6\r\n}\r\n\r\nCSSSelectorComponent.prototype.relationConstants = {\r\n\tunknown : 0,\r\n\tnone : 1,\r\n\tdescendant : 2,\r\n\timmediateDescendant : 3,\r\n\timmediateNextSibbling : 4,\r\n\tanyForwardSibbling : 5\r\n}\r\n\r\nCSSSelectorComponent.prototype.pseudoClassConstants = {\r\n\tunknown : 0,\r\n\tfirstChild : 1,\r\n\tlastChild : 2,\r\n\tnthChildOdd : 3,\r\n\tnthChildEven : 4,\r\n\tnthChildANpB : 5,\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar CSSSelectorComponentValuesCounter = 0;\r\n\r\nvar CSSSelectorComponentValues = function(completeSelector, tagPart, idPart, classPart) {\r\n\t// FIXME: this.isolateAttributesSelectors won't support the case where we must match on 'startwith', 'includes', 'endWith'\r\n\t// ALSO: we haven't yet really implemented all the cases\r\n\t\r\n\tthis.objectType = '';\r\n\tthis.idPart = ''; this.classPart = []; this.tagPart = ''; this.namePart = '';\r\n\tthis.idPart = this.isolateAttributesSelectors(idPart || '');\t\t\t// String\r\n\tthis.classPart = this.isolateAttributesSelectors(classPart || []);\t\t// Array\r\n\tthis.tagPart = this.isolateHostPseudoFunction(\r\n\t\t\tthis.isolateAttributesSelectors(completeSelector || ''),\r\n\t\t\ttagPart\r\n\t\t);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// String\r\n\tthis.attributesPart = new SelectorComponentAttributesValues();\t\t\t// Map (SelectorComponentAttributesValues)\r\n\t\r\n\tthis.valuesCount = +(tagPart.length > 0) + (+(idPart.length > 0)) + (+(classPart.length > 0 && classPart.length));\r\n\tthis.specificity = this.getSpecificity();\r\n//\tconsole.log(completeSelector, this.idPart, this.idPart, this.classPart, this.tagPart)\r\n}\r\nCSSSelectorComponentValues.prototype = {};\r\nCSSSelectorComponentValues.prototype.objectType = 'CSSSelectorComponentValues';\r\n\r\nCSSSelectorComponentValues.prototype.isolateHostPseudoFunction = function(completeSelector, tagPart) {\r\n\tvar pseudoFunction, tmpCapture;\r\n\tif ((pseudoFunction = completeSelector.match(CSSSelectorComponent.prototype.hostPseudoFunction))) {\r\n\t\t// WARNING: There's a risky recursion here, but this code seems to handle that correctly\r\n\t\ttmpCapture = CSSSelectorComponent.prototype.getCompoundValues(pseudoFunction[2]);\r\n\t\tthis.classPart = tmpCapture.classPart;\r\n\t\tthis.idPart = tmpCapture.idPart;\r\n\t\treturn pseudoFunction[1];\r\n\t}\r\n\treturn tagPart;\r\n}\r\n\r\nCSSSelectorComponentValues.prototype.isolateAttributesSelectors = function(componentPart) {\r\n\t// We assume it's worth coding an optimization on the \"attributes\" selector:\r\n\t// \t=> if the attribute targets a class or an id with the \"stricly equals\" operator, we convert that \"attribute\" component\r\n\tvar attribute, tmpCapture;\r\n\t// Case of the class part\r\n\tif (Array.isArray(componentPart) && componentPart.length > 0) {\r\n\t\tvar indexesToRemove = [];\r\n\t\t// Due to the simplicity of our splitter, there may be an attribute part\r\n\t\t// on each classPart element:\r\n\t\t// \t\t=> try to match each time and store immediatly the modified classPart element\r\n\t\t// \t\t=> then, remove these classPart elements before merging the two arrays\r\n\t\tcomponentPart.forEach(function(classFragment, key) {\r\n\t\t\tif ((attribute = classFragment.match(CSSSelectorComponent.prototype.attributesComponent))) {\r\n\t\t\t\t// FIXME: matcher is not used => see constructor\r\n\t\t\t\tvar type = attribute[2], matcher = attribute[3], target = attribute[4];\r\n\t\t\t\t\r\n\t\t\t\t// TODO: implement the other attributes\r\n\t\t\t\tif (type === 'class') {\r\n\t\t\t\t\tthis.classPart.push(target);\r\n\t\t\t\t\tindexesToRemove.push(key);\r\n\t\t\t\t}\r\n\t\t\t\telse if (type === 'id')\r\n\t\t\t\t\tthis.idPart = target;\r\n\t\t\t\telse if (name === 'name')\r\n\t\t\t\t\tthis.attributesPart.set('name', target);\r\n\t\t\t\telse if (name === 'checked')\r\n\t\t\t\t\tthis.attributesPart.set('checked', target);\r\n\t\t\t\telse if (name === 'valid')\r\n\t\t\t\t\tthis.attributesPart.set('valid', target);\r\n\t\t\t\telse if (name === 'selected')\r\n\t\t\t\t\tthis.attributesPart.set('selected', target);\r\n\t\t\t\t\r\n\t\t\t\tthis.classPart.push(attribute[1])\t\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\tfor (var i = componentPart.length - 1; i >= 0; i--) {\r\n\t\t\tif (indexesToRemove.indexOf(i) !== -1)\r\n\t\t\t\tcomponentPart.splice(i, 1);\r\n\t\t}\r\n\t\treturn this.classPart.concat(componentPart);\r\n\t}\r\n\t// other cases\r\n\telse if (componentPart.length) {\r\n\t\tif ((attribute = componentPart.match(CSSSelectorComponent.prototype.attributesComponent))) {\r\n\t\t\t// FIXME: matcher is not used => see constructor\r\n\t\t\tvar type = attribute[2], matcher = attribute[3], target = attribute[4];\r\n\t\t\t\r\n\t\t\t// TODO: implement the other attributes\r\n\t\t\tif (type === 'class')\r\n\t\t\t\tthis.classPart.push(target);\r\n\t\t\telse if (type === 'id')\r\n\t\t\t\tthis.idPart = target;\r\n\t\t\telse if (name === 'name')\r\n\t\t\t\tthis.attributesPart.set('name', target);\r\n\t\t\telse if (name === 'checked')\r\n\t\t\t\tthis.attributesPart.set('checked', target);\r\n\t\t\telse if (name === 'valid')\r\n\t\t\t\tthis.attributesPart.set('valid', target);\r\n\t\t\telse if (name === 'selected')\r\n\t\t\t\tthis.attributesPart.set('selected', target);\r\n\t\t\t\t\r\n\t\t\treturn attribute[1];\r\n\t\t}\r\n\t\treturn componentPart;\r\n\t}\r\n\treturn componentPart;\r\n}\r\n\r\nCSSSelectorComponentValues.prototype.getSpecificity = function() {\r\n\tvar A = 0, B = 0, C = 0;\r\n\t\r\n\tA = +(this.idPart.length > 0);\r\n\tB = this.classPart.length + this.attributesPart.valuesCount;\r\n\tC = +(this.tagPart.length > 0);\r\n//\tconsole.log('A', A, 'B', B, 'C', C);\r\n//\tconsole.log('ABC', (A << 16) | (B << 8) | (C));\r\n\treturn (A << 16) | (B << 8) | (C)\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar SelectorComponentAttributesValues = function() {\r\n\tthis.name = '';\r\n\tthis.checked = '';\r\n\tthis.valid = '';\r\n\tthis.selected = '';\r\n\t\r\n\tObject.defineProperty(this, 'valuesCount', {value : 0});\r\n}\r\nSelectorComponentAttributesValues.prototype = {};\r\nObject.defineProperty(SelectorComponentAttributesValues.prototype, 'objectType', {value : 'SelectorComponentAttributesValues'});\r\n\r\nObject.defineProperty(SelectorComponentAttributesValues.prototype, 'set', {\r\n\tvalue : function(attrName, attrValue) {\r\n\t\t\t\tthis[attrName] = attrValue;\r\n\t\t\t\tthis.countValues();\r\n\t\t\t}\r\n});\r\nObject.defineProperty(SelectorComponentAttributesValues.prototype, 'countValues', {\r\n\tvalue : function() {\r\n\t\tthis.valuesCount = 0;\r\n\t\tfor (var attrName in this) {\r\n\t\t\tif (this[attrName].length)\r\n\t\t\t\tthis.valuesCount++;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nCSSSelector.prototype.typeIsUniversal = CSSSelectorComponent.prototype.typeIsUniversal;\r\nCSSSelector.prototype.typeIsId = CSSSelectorComponent.prototype.typeIsId;\r\nCSSSelector.prototype.typeIsClass = CSSSelectorComponent.prototype.typeIsClass;\r\nCSSSelector.prototype.typeIsTag = CSSSelectorComponent.prototype.typeIsTag;\r\nCSSSelector.prototype.typeIsHost = CSSSelectorComponent.prototype.typeIsHost;\r\n\r\nCSSSelectorsList.prototype.constants = CSSSelector.prototype.constants;\r\nCSSSelectorsList.prototype.interestingTokens = CSSSelectorComponent.prototype.interestingTokens;\r\nCSSSelectorsList.prototype.typeConstants = CSSSelectorComponent.prototype.typeConstants;\r\nCSSSelectorsList.prototype.relationConstants = CSSSelectorComponent.prototype.relationConstants;\r\nCSSSelectorsList.prototype.pseudoClassConstants = CSSSelectorComponent.prototype.pseudoClassConstants;\r\n\r\nCSSSelectorsList.prototype.shadowDOMHostSpecialKeyword = CSSSelectorComponent.prototype.shadowDOMHostSpecialKeyword;\r\n\r\nmodule.exports = CSSSelectorsList;",
    "\"use strict\";\n/**\r\n * construct. FontSizeBuffer\r\n */\r\n\r\n//var TypeManager = require('src/core/TypeManager');\r\n\r\nvar TextSizeGetter = require('src/core/TextSizeGetter');\r\n\r\n/**\r\n * @constructor FontSizeBuffer\r\n */\r\nvar FontSizeBuffer = function(fontSize, fontFamily) {\r\n\tthis._buffer = new Float64Array(new ArrayBuffer(341 * 8));\r\n\tthis.objectType = 'FontSizeBuffer';\r\n\t\r\n\t// For now, we assume we won't have to fall back on the second typeface of the family\r\n\tthis.fontStyle = fontSize + ' ' + fontFamily.split(',')[0];\r\n\tthis.textSizeGetter = new TextSizeGetter(this.fontStyle);\r\n\t\r\n\tif (this.fontStyle)\r\n\t\tthis.populateInitialValues();\r\n}\r\nFontSizeBuffer.prototype = {};\r\nFontSizeBuffer.prototype.objectType = 'FontSizeBuffer';\r\n\r\nFontSizeBuffer.prototype.populateInitialValues = function() {\r\n\t// We need to cache values until 340 tio catch \"oe\"\r\n\tfor (var i = 32, l = 340; i < l; i++) {\r\n//\t\tconsole.log(i, String.fromCharCode(i), this.textSizeGetter.getTextWidth(String.fromCharCode(i)))\r\n\t\tthis._buffer.set([this.textSizeGetter.getTextWidth(String.fromCharCode(i))], i);\r\n\t}\r\n}\r\n\r\nFontSizeBuffer.prototype.getWidthOfSpace = function() {\r\n\treturn this._buffer.at(32);\r\n}\r\n\r\nFontSizeBuffer.prototype.getWidthOfWord = function(str) {\r\n\tvar width = 0;\r\n\tfor (var i = 0, l = str.length; i < l; i++) {\r\n//\t\tconsole.log(i, str.charCodeAt(i), this._buffer.at(str.charCodeAt(i)))\r\n\t\twidth += this._buffer.at(str.charCodeAt(i));\r\n\t}\r\n\treturn width;\r\n}\r\n\r\nmodule.exports = FontSizeBuffer;",
    "\"use strict\";\n/**\r\n * Constructor AttributesList\r\n * \r\n */\r\n\r\n//var StylePropertyEnhancer = require('src/editing/StylePropertyEnhancer');\r\n//var enhancer = new StylePropertyEnhancer();\r\n\r\nvar MemoryMapBuffer = require('src/core/MemoryMapBuffer');\r\nvar CSSPropertyBuffer = require('src/editing/CSSPropertyBuffer');\r\nvar BinarySlice = require('src/core/BinarySlice');\r\nvar CSSPropertyDescriptors = require('src/editing/CSSPropertyDescriptors');\r\nvar CSSPropertySetBuffer = require('src/editing/CSSPropertySetBuffer');\r\nvar parser = require('src/parsers/css-parser_forked_normalized');\r\n\r\n\r\n/**\r\n * Constructor AttributesList\r\n * This abstract type shall be used as a base for the \"splitted\" styles:\r\n * \"Inheritable\" and \"local\" attributes are grouped in 4 different objects\r\n * in the \"style\" type. This allows important optimizations when embracing\r\n * the concept of \"component\" as being decoupled from the DOM.\r\n * \t=> see AdvancedAttributesListFactory()\r\n * \r\n * @param attributes Object : passive partial AttributesList-Like (no methods, only significative keys defined)\r\n */\r\nvar AttributesList = function(attributes) {\r\n\tif (typeof attributes === 'undefined')\r\n\t\treturn this;\r\n\t// backward compatibility with the attributes list we defined in PHP,\r\n\t// and ported as the basic implementation of AttributesList (StyleAttributes.js)\r\n\r\n\t// TODO: WHY Array.isArray ? AttributesList should always be \"object\"...\r\n\t// Find out how we, once upon a time, got an array...\r\n\t// \t\t=> fixed in AdvancedAttributesList\r\n\tif (typeof attributes === 'string' && arguments[1] && Array.isArray(arguments[1]))\r\n\t\tattributes = arguments[1];\r\n\r\n\t// TODO: explicitly type each CSS data-structure so they precisely reproduce\r\n\t// the CSS props we're currently supporting \r\n\tif (typeof attributes === 'object' && Object.keys(attributes).length) {\r\n\t\tfor (var prop in attributes) {\r\n\t\t\tif (attributes.hasOwnProperty(prop) && prop !== 'selector' && prop !== 'type')\r\n\t\t\t\tthis[prop] = attributes[prop];\r\n\t\t};\r\n\t}\r\n}\r\nAttributesList.prototype = {};\r\n\r\nObject.defineProperty(AttributesList.prototype, 'linearize', {\r\n\tvalue: function() {\r\n\t\tvar str = '', current = '', attrCount = Object.keys(this).length, c = 0;\r\n\t\tfor (var prop in this) {\r\n\t\t\tc++;\r\n\t\t\t// may be a typed property\r\n\t\t\tif (typeof this[prop] === 'string')\r\n\t\t\t\tcurrent = this[prop];\r\n\r\n\t\t\tstr += prop.dromedarToHyphens() + ' : ' + current + ';';\r\n\r\n\t\t\tif (c !== attrCount)\r\n\t\t\t\tstr += '\\n';\r\n\t\t};\r\n\t\treturn str;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'get', {\r\n\tvalue: function(attributeName) {\r\n\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'getAttributeAsCSSOM', {\r\n\tvalue: function(attributeName) {\r\n\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'getAttributeAsKeyValue', {\r\n\tvalue: function(attributeName) {\r\n\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'set', {\r\n\tvalue: function(attributeName, attributeValue) {\r\n\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'setAttributeFromCSSOM', {\r\n\tvalue: function(attributeName, attributeValue) {\r\n\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AttributesList.prototype, 'setAttributeFromKeyValue', {\r\n\tvalue: function(attributeName, attributeValue) {\r\n\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n// This is OBSOLETE.\r\n// (re-defined (in another format, and without the \"per-purpose\" classification)\r\n// in CSSPropertyDescriptors)\r\n//var PerPurposeAttributesList = {\r\n//\tinheritedAttributes: [\r\n//\t\t'writingMode',\t\t\t\t\t// horizontal-tb / vertical-lr / vertical-rl / sideways-rl / sideways-lr\r\n//\t\t'captionSide',\t\t\t\t\t// top / bottom (title or legend of a table)\r\n//\t\t'listStyleType', \t\t\t\t// disc / circle / square / decimal / georgian, and anything you want... UNICODE codepoint ?\r\n//\t\t'listStylePosition',\t\t\t// inside / outside (position of the ::marker : first inline box or before first inline box)\r\n//\t\t'visibility',\t\t\t\t\t// visible / hidden\r\n//\t\t'fontFamily',\t\t\t\t\t// list of IDENT values\r\n//\t\t'fontSize',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'lineHeight',\t\t\t\t\t// DIMENSION\r\n//\t\t'color',\t\t\t\t\t\t// HASH or FUNCTION\r\n//\t\t'textOrientation',\t\t\t\t// mixed / upright / sideways / sideways-right / sideways-left / use-glyph-orientation\r\n//\t\t'textAlign',\t\t\t\t\t// left / right / center / justify (start / end)\r\n//\t\t'textTransform',\t\t\t\t// capitalize / uppercase / lowercase / none / full-width / full-size-kana (full-width aligns vertical and horizontal letters on a grid of text)\r\n//\t\t'textDecoration',\t\t\t\t// underline / + dotted / + red / + wavy / + overline\r\n//\t\t'cursor',\t\t\t\t\t\t// help / wait / crosshair / not-allowed / zoom-in / grab\r\n//\t\t'borderCollapse',\t\t\t\t// collapse / separate\r\n//\t\t'whiteSpace',\t\t\t\t\t// normal / nowrap / pre / pre-wrap / pre-line / break-spaces\r\n//\t\t'wordBreak'\t\t\t\t\t\t// normal / break-all / keep-all / break-word\r\n//\r\n//\t],\r\n//\tlocallyEffectiveAttributes: [\r\n//\t\t'display',\t\t\t\t\t\t// grid / flex / inline / inline-block / block / table / table-cell\r\n//\t\t'overflowX',\t\t\t\t\t// hidden / visible / scroll\r\n//\t\t'overflowY',\t\t\t\t\t// hidden / visible / scroll\r\n//\t\t'verticalAlign',\t\t\t\t// baseline / top / middle / bottom / sub / text-top\r\n//\t\t'clear',\t\t\t\t\t\t// left / right / both\r\n//\t\t'float',\t\t\t\t\t\t// left / right (inline-start / inline-end)\r\n//\t\t'position',\t\t\t\t\t\t// static / relative / absolute / fixed / sticky / top / bottom / right / left\r\n//\r\n//\t\t'flex',\t\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'flexFlow',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'flexDirection',\t\t\t\t// row / column\r\n//\t\t'flexWrap',\t\t\t\t\t\t// nowrap / wrap\r\n//\t\t'flexSchrink',\t\t\t\t\t// INTEGER\r\n//\t\t'flexGrow',\t\t\t\t\t\t// INTEGER\r\n//\t\t'flexBasis',\t\t\t\t\t// INTEGER\r\n//\r\n//\t\t'justifyContent',\t\t\t\t// flex-start | flex-end | center | space-evenly | space-between | space-around \r\n//\t\t'alignItems',\t\t\t\t\t// flex-start | flex-end | center | baseline | stretch\r\n//\t\t'alignSelf',\t\t\t\t\t// auto | flex-start | flex-end | center | baseline | stretch\r\n//\t\t'alignContent'\t\t\t\t\t// flex-start | flex-end | center | space-between | space-around | stretch  \t\r\n//\t],\r\n//\tboxModelAttributes: [\r\n//\t\t'boxSizing',\t\t\t\t\t// border-box / content-box\r\n//\t\t'width',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'height',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'top',\t\t\t\t\t\t\t// DIMENSION\r\n//\t\t'left',\t\t\t\t\t\t\t// DIMENSION\r\n//\t\t'right',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'bottom',\t\t\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'padding',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'margin',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'border',\t\t\t\t\t\t// SHORTHAND\r\n//\r\n//\t\t'paddingBlockStart',\t\t\t// DIMENSION\r\n//\t\t'paddingInlineEnd',\t\t\t\t// DIMENSION\r\n//\t\t'paddingBlockEnd',\t\t\t\t// DIMENSION\r\n//\t\t'paddingInlineStart',\t\t\t// DIMENSION\r\n//\r\n//\t\t'marginBlockStart',\t\t\t\t// DIMENSION\r\n//\t\t'marginBlockEnd',\t\t\t\t// DIMENSION\r\n//\t\t'marginInlineStart',\t\t\t// DIMENSION\r\n//\t\t'marginInlineEnd',\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'borderBlockStart',\t\t\t\t// width, style, color\r\n//\t\t'borderBlockEnd',\t\t\t\t// width, style, color\r\n//\t\t'borderInlineStart',\t\t\t// width, style, color\r\n//\t\t'borderInlineEnd',\t\t\t\t// width, style, color\r\n//\r\n//\t\t'borderWidth',\t\t\t\t\t// DIMENSION\r\n//\t\t'borderBlockStartWidth',\t\t// DIMENSION\r\n//\t\t'borderBlockEndWidth',\t\t\t// DIMENSION\r\n//\t\t'borderInlineStartWidth',\t\t// DIMENSION\r\n//\t\t'borderInlineEndWidth',\t\t\t// DIMENSION\r\n//\r\n//\t\t'borderStyle',\t\t\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderBlockStartStyle',\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderBlockEndStyle',\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderInlineStartStyle',\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderInlineEndStyle',\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\r\n//\t\t'borderColor',\t\t\t\t\t// COLOR\r\n//\t\t'borderBlockStartColor',\t\t// COLOR\r\n//\t\t'borderBlockEndColor',\t\t\t// COLOR\r\n//\t\t'borderInlineStartColor',\t\t// COLOR\r\n//\t\t'borderInlineEndColor',\t\t\t// COLOR\r\n//\t\t\r\n//\t\t'borderRadius',\t\t\t\t\t// DIMENSION[1-4] / DIMENSION[1-4]\r\n//\r\n//\t\t'borderTopLeftRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderTopRightRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderBottomRightRadius',\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderBottomLeftRadius',\t\t// DIMENSION / DIMENSION\r\n//\r\n//\t\t'borderStartStartRadius',\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderStartEndRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderEndStartRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderEndEndRadius'\t\t\t// DIMENSION / DIMENSION\r\n//\t],\r\n//\tstrictlyLocalAttributes: [\r\n//\t\t'background',\t\t\t\t\t// SHORTHAND\r\n//\t\t'backgroundColor',\t\t\t\t//\r\n//\t\t'backgroundPosition',\t\t\t// SHORTHAND\r\n//\t\t'backgroundPositionTop',\t\t//\r\n//\t\t'backgroundPositionLeft',\t\t//\r\n//\t\t'backgroundImage',\t\t\t\t//\r\n//\t\t'backgroundRepeat'\t\t\t\t//\r\n//\r\n//\r\n//\t]\r\n//};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Construct. BaseClass SplittedAttributesListBaseClass\r\n * \r\n * @param attributes Object : partial AttributesList-Like (only significative keys defined)\r\n */\r\nvar SplittedAttributesListBaseClass = function(attributes) {\r\n\tObject.defineProperty(this, 'CSSPropertySetBuffer', {value: new CSSPropertySetBuffer()});\r\n\tthis.disambiguateAttributes(attributes);\r\n}\r\nSplittedAttributesListBaseClass.prototype = {};\t//Object.create(AttributesList.prototype);\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'objectType', {value: 'SplittedAttributesListBaseClass'});\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'purpose', {value: 'VirtualAttributes' });\t// virtual\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'VirtualAttributes', {value: [] });\t\t// virtual\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'InheritedAttributes', {value: Object.keys(CSSPropertyDescriptors.splitted.inheritedAttributes)});\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'LocallyEffectiveAttributes', {value: Object.keys(CSSPropertyDescriptors.splitted.locallyEffectiveAttributes)});\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'BoxModelAttributes', {value: Object.keys(CSSPropertyDescriptors.splitted.boxModelAttributes)});\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'StrictlyLocalAttributes', {value: Object.keys(CSSPropertyDescriptors.splitted.strictlyLocalAttributes)});\r\n\r\n/**\r\n * This function ignores attributes depending on the fact they pertain to a certain category of CSS props  :\r\n * \r\n * InheritedAttributes,\r\n * BoxModelAttributes,\r\n * LocallyEffectiveAttributes,\r\n * StrictlyLocalAttributes\r\n * \r\n * and assign the filtered ones to the embedded CSSPropertySetBuffer\r\n * \r\n * It also logs a warning if we encounter a non-supported CSS prop\r\n * (for now, we're not aimed at supporting the entire spec)\r\n */\r\nObject.defineProperty(SplittedAttributesListBaseClass.prototype, 'disambiguateAttributes', {\r\n\tvalue: function(attributes) {\r\n\t\tvar self = this, definedAttributes = Object.keys(attributes), packedCSSProperty;\r\n\t\t\r\n\t\tfor (var i = 0, l = definedAttributes.length; i < l; i++) {\r\n\t\t\t(function(attrIdx, attrName) {\r\n\t\t\t\tif (!CSSPropertyDescriptors.all[attrName]) {\r\n\t\t\t\t\tconsole.warn('Unsupported CSS Property:', attrName);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse if (self[self.purpose].indexOf(attrName) < 0)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t\t\r\n\t\t\t\tpackedCSSProperty = new CSSPropertyBuffer(null, attrName);\r\n\t\t\t\tpackedCSSProperty.setValue(\r\n\t\t\t\t\tattributes[attrName]\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Set the isInitialValue flag to false\r\n\t\t\t\tpackedCSSProperty._buffer.set([0], CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start);\r\n\t\t\t\t\r\n\t\t\t\tself.CSSPropertySetBuffer.setPropFromBuffer(attrName, packedCSSProperty);\r\n\t\t\t})(i, definedAttributes[i]);\r\n\t\t}\r\n//\t\tthis[this.purpose].forEach(function(attrName) {\r\n//\t\t\tpackedCSSProperty = new CSSPropertyBuffer(null, attrName);\r\n//\t\t\tif (attributes[attrName]) {\r\n//\t\t\t\tpackedCSSProperty.setValue(\r\n//\t\t\t\t\tparser.parseAListOfComponentValues(attributes[attrName])\r\n//\t\t\t\t);\r\n//\t\t\t}\r\n//\t\t\telse {\r\n//\t\t\t\tpackedCSSProperty.setValue(\r\n//\t\t\t\t\tparser.parseAListOfComponentValues(\r\n//\t\t\t\t\t\tCSSPropertyDescriptors.all[attrName].prototype.initialValue\r\n//\t\t\t\t\t)\r\n//\t\t\t\t);\r\n//\t\t\t}\r\n//\t\t\tthis.CSSPropertySetBuffer.setPropFromBuffer(attrName, packedCSSProperty);\r\n//\t\t}, this);\r\n\t}\r\n});\r\n\r\n//Object.defineProperty(SplittedAttributesListBaseClass.prototype, 'populateInitialValues', {\r\n//\tvalue: function() {\r\n//\t\t// CAUTION: Categories in CSSPropertyDescriptors don't correspond\r\n//\t\t// to the \"purposes\" used here :\r\n//\t\t// => purposes are camel-case although categories are dromedar-case\r\n//\t\tvar itemSize = this.CSSPropertySetBuffer.itemSize,\r\n//\t\t\tpurpose = this.purpose.lowerCaseFirstChar();\r\n//\t\tvar boundaries = CSSPropertyDescriptors.boundaries[purpose];\r\n//\t\tthis.CSSPropertySetBuffer._buffer.set(\r\n//\t\t\tthis.CachedCSSPropertySetBuffer._buffer.slice(\r\n//\t\t\t\tboundaries.start * itemSize,\r\n//\t\t\t\t(boundaries.start + boundaries.length) * itemSize\r\n//\t\t\t),\r\n//\t\t\tboundaries.start * itemSize\r\n//\t\t);\r\n//\t}\r\n//});\r\n//\r\n//Object.defineProperty(SplittedAttributesListBaseClass.prototype, 'CachedCSSPropertySetBuffer', {\r\n//\tvalue: (function() {\r\n//\t\tvar packedCSSProperty, propertySetBuffer = new CSSPropertySetBuffer();\r\n//\t\tfor (var attrGroup in CSSPropertyDescriptors.splitted) {\r\n//\t\t\tObject.keys(CSSPropertyDescriptors.splitted[attrGroup]).forEach(function(attrName) {\r\n//\t\t\t\tpackedCSSProperty = new CSSPropertyBuffer(null, attrName);\r\n//\t\t\t\tpackedCSSProperty.setValue(\r\n//\t\t\t\t\tparser.parseAListOfComponentValues(\r\n//\t\t\t\t\t\tCSSPropertyDescriptors.all[attrName].prototype.initialValue\r\n//\t\t\t\t\t)\r\n//\t\t\t\t);\r\n//\t\t\t\tpropertySetBuffer.setPropFromBuffer(attrName, packedCSSProperty);\r\n//\t\t\t}, this);\r\n//\t\t\tpropertySetBuffer.setGroupIsInitialValue(attrGroup, true);\r\n//\t\t}\r\n//\t\treturn propertySetBuffer;\r\n//\t})()\r\n//});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @constructor InheritedAttributesList\r\n * @extends SplittedAttributesListBaseClass\r\n * @param attributes Object : partial AttributesList-Like (only significative keys defined)\r\n */\r\nvar InheritedAttributesList = function(attributes) {\r\n\tSplittedAttributesListBaseClass.call(this, attributes);\r\n}\r\nInheritedAttributesList.prototype = Object.create(SplittedAttributesListBaseClass.prototype);\r\nObject.defineProperty(InheritedAttributesList.prototype, 'objectType', { value: 'InheritedAttributesList' });\r\nObject.defineProperty(InheritedAttributesList.prototype, 'purpose', { value: 'InheritedAttributes' });\r\n\r\n\r\n/**\r\n * @constructor LocallyEffectiveAttributesList\r\n * @extends SplittedAttributesListBaseClass\r\n * @param attributes Object : partial AttributesList-Like\r\n */\r\nvar LocallyEffectiveAttributesList = function(attributes) {\r\n\tSplittedAttributesListBaseClass.call(this, attributes);\r\n}\r\nLocallyEffectiveAttributesList.prototype = Object.create(SplittedAttributesListBaseClass.prototype);\r\nObject.defineProperty(LocallyEffectiveAttributesList.prototype, 'objectType', { value: 'LocallyEffectiveAttributesList' });\r\nObject.defineProperty(LocallyEffectiveAttributesList.prototype, 'purpose', { value: 'LocallyEffectiveAttributes' });\r\n\r\n\r\n/**\r\n * @constructor boxModelAttributes\r\n * @extends SplittedAttributesListBaseClass\r\n * @param attributes Object : partial AttributesList-Like \r\n */\r\nvar BoxModelAttributesList = function(attributes) {\r\n\tSplittedAttributesListBaseClass.call(this, attributes);\r\n}\r\nBoxModelAttributesList.prototype = Object.create(SplittedAttributesListBaseClass.prototype);\r\nObject.defineProperty(BoxModelAttributesList.prototype, 'objectType', { value: 'BoxModelAttributesList' });\r\nObject.defineProperty(BoxModelAttributesList.prototype, 'purpose', { value: 'BoxModelAttributes' });\r\n\r\n\r\n/**\r\n * @constructor StrictlyLocalAttributes\r\n * @extends SplittedAttributesListBaseClass\r\n * @param attributes Object : partial AttributesList-Like\r\n */\r\nvar StrictlyLocalAttributesList = function(attributes) {\r\n\tSplittedAttributesListBaseClass.call(this, attributes);\r\n}\r\nStrictlyLocalAttributesList.prototype = Object.create(SplittedAttributesListBaseClass.prototype);\r\nObject.defineProperty(StrictlyLocalAttributesList.prototype, 'objectType', { value: 'StrictlyLocalAttributesList' });\r\nObject.defineProperty(StrictlyLocalAttributesList.prototype, 'purpose', { value: 'StrictlyLocalAttributes' });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar AdvancedAttributesListFactory = function(attributes) {\r\n\tif ((typeof attributes === 'string' || !attributes) && Object.prototype.toString.call(arguments[1]) === '[object Object]')\r\n\t\tattributes = arguments[1];\r\n\r\n\tthis.inheritedAttributes = new InheritedAttributesList(attributes);\r\n\tthis.locallyEffectiveAttributes = new LocallyEffectiveAttributesList(attributes);\r\n\tthis.boxModelAttributes = new BoxModelAttributesList(attributes);\r\n\tthis.strictlyLocalAttributes = new StrictlyLocalAttributesList(attributes);\r\n\r\n//\tthis.stdAttributes = new AttributesList(attributes);\r\n}\r\nAdvancedAttributesListFactory.prototype = {}\r\n\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'get', {\r\n\tvalue: function(attr) {\r\n\t\tvar propBuffer;\r\n\t\tfor (var propGroup in CSSPropertyDescriptors.splitted) {\r\n\t\t\tif (CSSPropertyDescriptors.splitted[propGroup][attr]) {\r\n\t\t\t\treturn this[propGroup].CSSPropertySetBuffer.bufferedValueToString(attr);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'set', {\r\n\tvalue: function(attr, value) {\r\n\t\tif (attr === 'borderLeft')\r\n\t\t\tconsole.log('setAttribute', value);\r\n\t\t\r\n\t\tvar propBuffer;\r\n\t\tfor (var propGroup in CSSPropertyDescriptors.splitted) {\r\n\t\t\tif (CSSPropertyDescriptors.splitted[propGroup][attr]) {\r\n\t\t\t\tpropBuffer = new CSSPropertyBuffer();\r\n\t\t\t\tpropBuffer.setValue(value);\r\n\t\t\t\tthis[propGroup].CSSPropertySetBuffer.setPropFromBuffer(attr, propBuffer);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n// FIXME: should update all partial lists down the object\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'setApply', {\r\n\tvalue: function(attrList) {\r\n//\t\tObject.entries(attrList).forEach(function(pair) {\r\n//\t\t\tthis.stdAttributes.set(pair[0], pair[1]);\r\n//\t\t}, this);\r\n\t}\r\n});\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'getAllAttributes', {\r\n\tvalue: function() {\r\n\t\tvar allAttributes = {};\r\n\t\tfor (var attrGroup in this) {\r\n\t\t\tObject.assign(allAttributes, this[attrGroup].CSSPropertySetBuffer.getPropertyGroupAsAttributesList(attrGroup));\r\n\t\t}\r\n\t\treturn allAttributes;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'getAllDefinedAttributes', {\r\n\tvalue: function() {\r\n\t\tvar allAttributes = {};\r\n\t\tfor (var attrGroup in this) {\r\n//\t\t\tconsole.log(this[attrGroup].CSSPropertySetBuffer.getPropertyGroupAsAttributesList(attrGroup));\r\n\t\t\tObject.assign(allAttributes, this[attrGroup].CSSPropertySetBuffer.getDefinedPropertiesFromGroupAsAttributesList(attrGroup));\r\n\t\t}\r\n//\t\tconsole.log(allAttributes);\r\n\t\treturn allAttributes;\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AdvancedAttributesListFactory.prototype, 'linearize', {\r\n\tvalue: function() {\r\n\t\treturn new AttributesList(this.getAllDefinedAttributes()).linearize();\r\n\t}\r\n});\r\n\r\nObject.defineProperty(AdvancedAttributesListFactory, 'fromAST', {\r\n\tvalue: function(ast) {\r\n\t\tvar name, attrList = {};\r\n\t\t// ast is an array of declarations\r\n\t\tast.forEach(function(declaration) {\r\n\t\t\t// YET CSSOM ? it seems...\r\n\t\t\t\r\n\t\t\tname = declaration.name.hyphensToDromedar();\r\n\t\t\tif (CSSPropertyDescriptors.all.hasOwnProperty(name)) {\r\n\t\t\t\tattrList[name] = declaration.value.reduce(AdvancedAttributesListFactory.flattenDeclarationValues, '');\r\n\t\t\t}\r\n\t\t});\r\n//\t\tconsole.log(attrList);\r\n\t\treturn new AdvancedAttributesListFactory(attrList);\r\n\t}\r\n});\r\n\r\n// A callback for the Reducer we use as a hacky serializer for the objects we get from the CSS ast\r\nObject.defineProperty(AdvancedAttributesListFactory, 'flattenDeclarationValues', {\r\n\tvalue: function(acc, item, key) {\r\n\t\t//\t\t\tconsole.log(acc, key);\r\n\t\tacc += item.tokenType !== 'WHITESPACE'\r\n\t\t\t? (item.tokenType === 'COMMA'\r\n\t\t\t\t? ','\r\n\t\t\t\t: (item.tokenType === 'DIMENSION' || item.tokenType === 'NUMBER'\r\n\t\t\t\t\t? item.repr + (item.unit || '')\r\n\t\t\t\t\t: (item.tokenType === 'PERCENTAGE'\r\n\t\t\t\t\t\t? item.repr + '%'\r\n\t\t\t\t\t\t: (item.type === 'FUNCTION'\t\t// NOT a DECLARATION (item.type): it's a high-level type\r\n\t\t\t\t\t\t\t? item.name + '(' + item.value.reduce(AdvancedAttributesListFactory.flattenDeclarationValues, '') + ')'\r\n\t\t\t\t\t\t\t: item.value)\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t: (acc.length ? ' ' : '');\t\t// no leading space in resulting string CSS values\r\n\t\t//\t\t\tconsole.log(acc);\r\n\t\treturn acc;\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// This is OBSOLETE.\r\n// (already defined sooner in this file, and all the way rightly defined in CSSPropertyDescriptors)\r\n//Object.defineProperty(AdvancedAttributesListFactory.prototype, 'inheritedAttributes', {\r\n//\tvalue: [\r\n//\t\t'writingMode',\t\t\t\t\t// horizontal-tb / vertical-lr / vertical-rl / sideways-rl / sideways-lr\r\n//\t\t'captionSide',\t\t\t\t\t// top / bottom (title or legend of a table)\r\n//\t\t'listStyleType', \t\t\t\t// disc / circle / square / decimal / georgian, and anything you want... UNICODE codepoint ?\r\n//\t\t'listStylePosition',\t\t\t// inside / outside (position of the ::marker : first inline box or before first inline box)\r\n//\t\t'visibility',\t\t\t\t\t// visible / hidden\r\n//\t\t'fontFamily',\t\t\t\t\t// list of IDENT values\r\n//\t\t'fontSize',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'lineHeight',\t\t\t\t\t// DIMENSION\r\n//\t\t'color',\t\t\t\t\t\t// HASH or FUNCTION\r\n//\t\t'textOrientation',\t\t\t\t// mixed / upright / sideways / sideways-right / sideways-left / use-glyph-orientation\r\n//\t\t'textAlign',\t\t\t\t\t// left / right / center / justify (start / end)\r\n//\t\t'textTransform',\t\t\t\t// capitalize / uppercase / lowercase / none / full-width / full-size-kana (full-width aligns vertical and horizontal letters on a grid of text)\r\n//\t\t'textDecoration',\t\t\t\t// underline / + dotted / + red / + wavy / + overline\r\n//\t\t'cursor',\t\t\t\t\t\t// help / wait / crosshair / not-allowed / zoom-in / grab\r\n//\t\t'borderCollapse',\t\t\t\t// collapse / separate\r\n//\t\t'whiteSpace',\t\t\t\t\t// normal / nowrap / pre / pre-wrap / pre-line / break-spaces\r\n//\t\t'wordBreak'\t\t\t\t\t\t// normal / break-all / keep-all / break-word\r\n//\r\n//\t]\r\n//});\r\n//\r\n//Object.defineProperty(AdvancedAttributesListFactory.prototype, 'locallyEffectiveAttributes', {\r\n//\tvalue: [\r\n//\t\t'display',\t\t\t\t\t\t// grid / flex / inline / inline-block / block / table / table-cell\r\n//\t\t'overflowX',\t\t\t\t\t// hidden / visible / scroll\r\n//\t\t'overflowY',\t\t\t\t\t// hidden / visible / scroll\r\n//\t\t'verticalAlign',\t\t\t\t// baseline / top / middle / bottom / sub / text-top\r\n//\t\t'clear',\t\t\t\t\t\t// left / right / both\r\n//\t\t'float',\t\t\t\t\t\t// left / right (inline-start / inline-end)\r\n//\t\t'position',\t\t\t\t\t\t// static / relative / absolute / fixed / sticky / top / bottom / right / left\r\n//\r\n//\t\t'flex',\t\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'flexFlow',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'flexDirection',\t\t\t\t// row / column\r\n//\t\t'flexWrap',\t\t\t\t\t\t// nowrap / wrap\r\n//\t\t'flexSchrink',\t\t\t\t\t// INTEGER\r\n//\t\t'flexGrow',\t\t\t\t\t\t// INTEGER\r\n//\t\t'flexBasis',\t\t\t\t\t\t// INTEGER\r\n//\r\n//\t\t'justifyContent',\t\t\t\t// flex-start | flex-end | center | space-evenly | space-between | space-around \r\n//\t\t'alignItems',\t\t\t\t\t// flex-start | flex-end | center | baseline | stretch\r\n//\t\t'alignSelf',\t\t\t\t\t// auto | flex-start | flex-end | center | baseline | stretch\r\n//\t\t'alignContent'\t\t\t\t\t// flex-start | flex-end | center | space-between | space-around | stretch  \t\r\n//\t]\r\n//});\r\n//\r\n//Object.defineProperty(AdvancedAttributesListFactory.prototype, 'boxModelAttributes', {\r\n//\tvalue: [\r\n//\t\t'boxSizing',\t\t\t\t\t// border-box / content-box\r\n//\t\t'width',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'height',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'top',\t\t\t\t\t\t\t// DIMENSION\r\n//\t\t'left',\t\t\t\t\t\t\t// DIMENSION\r\n//\t\t'right',\t\t\t\t\t\t// DIMENSION\r\n//\t\t'bottom',\t\t\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'padding',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'margin',\t\t\t\t\t\t// SHORTHAND\r\n//\t\t'border',\t\t\t\t\t\t// SHORTHAND\r\n//\r\n//\t\t//\t\t\t'paddingTop',\t\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'paddingBottom',\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'paddingLeft',\t\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'paddingRight',\t\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'paddingBlockStart',\t\t\t// DIMENSION\r\n//\t\t'paddingInlineEnd',\t\t\t\t// DIMENSION\r\n//\t\t'paddingBlockEnd',\t\t\t\t// DIMENSION\r\n//\t\t'paddingInlineStart',\t\t\t// DIMENSION\r\n//\r\n//\t\t//\t\t\t'marginTop',\t\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'marginBottom',\t\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'marginLeft',\t\t\t\t\t// DIMENSION\r\n//\t\t//\t\t\t'marginRight',\t\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'marginBlockStart',\t\t\t\t// DIMENSION\r\n//\t\t'marginBlockEnd',\t\t\t\t// DIMENSION\r\n//\t\t'marginInlineStart',\t\t\t// DIMENSION\r\n//\t\t'marginInlineEnd',\t\t\t\t// DIMENSION\r\n//\r\n//\t\t'borderBlockStart',\t\t\t\t// width, style, color\r\n//\t\t'borderBlockEnd',\t\t\t\t// width, style, color\r\n//\t\t'borderInlineStart',\t\t\t// width, style, color\r\n//\t\t'borderInlineEnd',\t\t\t\t// width, style, color\r\n//\r\n//\t\t'borderWidth',\t\t\t\t\t// DIMENSION\r\n//\t\t'borderBlockStartWidth',\t\t// DIMENSION\r\n//\t\t'borderBlockEndWidth',\t\t\t// DIMENSION\r\n//\t\t'borderInlineStartWidth',\t\t// DIMENSION\r\n//\t\t'borderInlineEndWidth',\t\t\t// DIMENSION\r\n//\r\n//\t\t'borderStyle',\t\t\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderBlockStartStyle',\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderBlockEndStyle',\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderInlineStartStyle',\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\t\t'borderInlineEndStyle',\t\t\t// none / dotted / inset / dashed / solid / double / groove\r\n//\r\n//\t\t'borderColor',\t\t\t\t\t// COLOR\r\n//\t\t'borderBlockStartColor',\t\t// COLOR\r\n//\t\t'borderBlockEndColor',\t\t\t// COLOR\r\n//\t\t'borderInlineStartColor',\t\t// COLOR\r\n//\t\t'borderInlineEndColor'\t\t\t// COLOR\r\n//\t]\r\n//});\r\n//\r\n//Object.defineProperty(AdvancedAttributesListFactory.prototype, 'strictlyLocalAttributes', {\r\n//\tvalue: [\r\n//\t\t'background',\t\t\t\t\t// SHORTHAND\r\n//\t\t'backgroundColor',\t\t\t\t//\r\n//\t\t'backgroundPosition',\t\t\t// SHORTHAND\r\n//\t\t'backgroundPositionTop',\t\t//\r\n//\t\t'backgroundPositionLeft',\t\t//\r\n//\t\t'backgroundImage',\t\t\t\t//\r\n//\t\t'backgroundRepeat',\t\t\t\t//\r\n//\r\n//\t\t'borderRadius',\t\t\t\t\t// DIMENSION[1-4] / DIMENSION[1-4]\r\n//\r\n//\t\t'borderTopLeftRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderTopRightRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderBottomRightRadius',\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderBottomLeftRadius',\t\t// DIMENSION / DIMENSION\r\n//\r\n//\t\t'borderStartStartRadius',\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderStartEndRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderEndStartRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t\t'borderEndEndRadius',\t\t\t// DIMENSION / DIMENSION\r\n//\t]\r\n//});\r\n\r\n\r\n\r\n\r\n/*\r\n * The following values are declared and used in the CSSPropertyBuffer class\r\n */\r\n\r\n\r\n//\\w+\\.prototype\\.tokenType\\s?=\\s?\"[^\"]+\";\r\n\r\n//\tvar TokenTypes = {};\r\n//\tTokenTypes.BadStringToken = 0;\r\n//\tTokenTypes.BadURLToken = 1;\r\n//\tTokenTypes.WhitespaceToken = 2;\r\n//\tTokenTypes.CDOToken = 3;\r\n//\tTokenTypes.CDCToken = 4;\r\n//\tTokenTypes.ColonToken = 5;\r\n//\tTokenTypes.SemicolonToken = 6;\r\n//\tTokenTypes.CommaToken = 7;\r\n//\tTokenTypes.OpenCurlyToken = 8;\r\n//\tTokenTypes.CloseCurlyToken = 9;\r\n//\tTokenTypes.OpenSquareToken = 10;\r\n//\tTokenTypes.CloseSquareToken = 11;\r\n//\tTokenTypes.OpenParenToken = 12;\r\n//\tTokenTypes.CloseParenToken = 13;\r\n//\tTokenTypes.IncludeMatchToken = 14;\r\n//\tTokenTypes.DashMatchToken = 15;\r\n//\tTokenTypes.PrefixMatchToken = 16;\r\n//\tTokenTypes.SuffixMatchToken = 17;\r\n//\tTokenTypes.SubstringMatchToken = 18;\r\n//\tTokenTypes.ColumnToken = 19;\r\n//\tTokenTypes.EOFToken = 20;\r\n//\tTokenTypes.DelimToken = 21;\r\n//\tTokenTypes.IdentToken = 22;\r\n//\tTokenTypes.FunctionToken = 23;\r\n//\tTokenTypes.AtKeywordToken = 24;\r\n//\tTokenTypes.HashToken = 25;\r\n//\tTokenTypes.StringToken = 26;\r\n//\tTokenTypes.URLToken = 27;\r\n//\tTokenTypes.NumberToken = 28;\r\n//\tTokenTypes.PercentageToken = 29;\r\n//\tTokenTypes.DimensionToken = 30;\r\n\r\n// ^\\t(\\w{1,2})\\s?\\t\\s?\\t(\\w+)\r\n// Units.\\1 = {\\Runit : '\\1',\\R\\tfullName : '\\2'\\R}\r\n\r\n//\tvar Units = {};\r\n//\tUnits.cm = {\r\n//\t\tidx : 0,\r\n//\t\tunit : 'cm',\r\n//\t\tfullName : 'centimeters',\r\n//\t\tequivStr : '1cm = 96px/2.54'\r\n//\t} \t\r\n//\tUnits.mm = {\r\n//\t\tidx : 1,\r\n//\t\tunit : 'mm',\r\n//\t\tfullName : 'millimeters',\r\n//\t\tequivStr : '1mm = 1/10th of 1cm'\r\n//\t} \t\r\n//\tUnits.Q = {\r\n//\t\tidx : 2,\r\n//\t\tunit : 'Q',\r\n//\t\tfullName : 'quarter',\r\n//\t\tequivStr : '1Q = 1/40th of 1cm'\r\n//\t}\r\n//\tUnits.in = {\r\n//\t\tidx : 3,\r\n//\t\tunit : 'in',\r\n//\t\tfullName : 'inches',\r\n//\t\tequivStr : '1in = 2.54cm = 96px'\r\n//\t}\r\n//\tUnits.pc = {\r\n//\t\tidx : 4,\r\n//\t\tunit : 'pc',\r\n//\t\tfullName : 'picas',\r\n//\t\tequivStr : '1pc = 1/6th of 1in'\r\n//\t}\r\n//\tUnits.pt = {\r\n//\t\tidx : 5,\r\n//\t\tunit : 'pt',\r\n//\t\tfullName : 'points',\r\n//\t\tequivStr : '1pt = 1/72th of 1in'\r\n//\t}\r\n//\tUnits.px = {\r\n//\t\tidx : 6,\r\n//\t\tunit : 'px',\r\n//\t\tfullName : 'pixels',\r\n//\t\tequivStr : '1px = 1/96th of 1in '\r\n//\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = AdvancedAttributesListFactory;",
    "\"use strict\";\n/**\r\n* Stylesheets\r\n*/\r\n\r\nvar TypeManager = require('src/core/TypeManager');\r\nvar GeneratorFor16bitsInt = require('src/core/UIDGenerator').GeneratorFor16bitsInt;\r\nvar CSSSelectorsList = require('src/editing/CSSSelectorsList');\r\nvar CSSSelectorSetBuffer = require('src/editing/CSSSelectorSetBuffer');\r\n//var StyleAttributes = require('src/editing/StyleAttributes');\r\nvar AdvancedAttributesList = require('src/editing/SplittedAttributes');\r\n\r\n//var MemorySingleBuffer = require('src/core/MemorySingleBuffer');\r\n//var MemoryBufferStack = require('src/core/MemoryBufferStack');\r\n\r\n/**\r\n * @constructor Style\r\n * \r\n * @param type {string} : 'p' || 'span'\r\n * @param selector {string} : CSS selector\r\n * @param optimizedSelector {string} : optimized CSS selector (represented as a 4 bytes sequence and a UID)\r\n * @param attrIface {object} : passive partial PropertiesList-Like (no methods, only significative keys defined)\r\n */\r\n\r\n\r\nvar Style = function(type, selector, attributes) {\r\n\tthis.selectorsList = new CSSSelectorsList(attributes.selector || selector);\r\n\tthis.compactedViewOnSelectorsList = new CSSSelectorSetBuffer(null, this.selectorsList);\r\n\tthis.type = type;\r\n\tthis.attrIFace = new AdvancedAttributesList(this.type, attributes);\r\n\t\r\n\t// Populate the masterStyleRegistry, from which we shall later retrieve\r\n\t// the optimized part of the style object, i.e the current CSS rule\r\n\tthis.selectorsList.forEach(function(currentSelector) {\r\n//\t\tconsole.log(this.compactedViewOnSelectorsList.getEntry(\r\n//\t\t\t\tcurrentSelector.selectorStr\r\n//\t\t\t\t// we unpack 16 and 32 bits integers in the CSSCompactedSelector type (in fact it's a MemorySingleBuffer)\r\n//\t\t\t\t).get(\r\n//\t\t\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.bufferUID.start,\r\n//\t\t\t\t\t2\r\n//\t\t\t\t));\r\n\t\tTypeManager.masterStyleRegistry.setItem(\r\n\t\t\tthis.compactedViewOnSelectorsList.getEntry(\r\n\t\t\t\tcurrentSelector.selectorStr\r\n\t\t\t\t// we unpack 16 and 32 bits integers in the CSSCompactedSelector type (in fact it's a MemorySingleBuffer)\r\n\t\t\t\t).get(\r\n\t\t\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.bufferUID.start,\r\n\t\t\t\t\t2\r\n\t\t\t\t),\r\n\t\t\tthis\r\n\t\t);\r\n\t}, this);\r\n\t\r\n}\r\nStyle.prototype = {};\r\n\r\nStyle.prototype.linearize = function() {\r\n\tvar linearizedSelector = '';\r\n\tthis.selectorsList.forEach(function(selector, key) {\r\n\t\tlinearizedSelector += selector.selectorStr;\r\n\t\tif (key !== this.selectorsList.length - 1)\r\n\t\t\tlinearizedSelector += ', ';\r\n\t}, this);\r\n\tlinearizedSelector += ' { ' + '\\n' + this.attrIFace.linearize() + '\\n' + '}\\n';\r\n\t// FIXME: this should loop on the selectors and interpolate with commas\r\n\treturn linearizedSelector;\r\n}\r\n\r\nStyle.prototype.addToStyleSheet = function(styleSheet) {\r\n\tthis.index = styleSheet.insertRule(this.linearize())\r\n}\r\n\r\nStyle.prototype.removeFromStyleSheet = function(styleSheet) {\r\n\tstyleSheet.deleteRule(this.index);\r\n}\r\n\r\n//Style.prototype.populateCompactedViewOnSelector = function(substrDef, proofingPartType) {\r\n//\t// 16 bits values have to be declared as byte-tuples ([1, 0] would then represent 1, as all CPU's are now little-endian) \r\n//\t// (GeneratorFor16bitsInt, responsible for the UID, shall return an array)\r\n//\t// Offset of the extracted string from the original string\r\n//\tthis.compactedViewOnSelector.set(\r\n//\t\t\t[substrDef[0]],\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.startingOffsetInString.start\r\n//\t\t);\r\n//\t// Length of the extracted string from the original string\r\n//\tthis.compactedViewOnSelector.set(\r\n//\t\t\t[substrDef[1].length],\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.stringLength.start\r\n//\t\t);\r\n//\t// Extract the most specific selector (specificity priority is: !important -> \"style\" DOM attr as a rule -> ID -> class/attribute/prop/pseudo-class -> nodeType/pseudo-elem)\r\n//\tthis.compactedViewOnSelector.set(\r\n//\t\t\tsubstrDef[1],\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.stringBinaryEncoded.start\r\n//\t\t);\r\n//\tthis.compactedViewOnSelector.set(\r\n//\t\t\tproofingPartType,\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.selectorProofingPartType.start\r\n//\t\t);\r\n//\tthis.compactedViewOnSelector.set(\r\n//\t\t\tGeneratorFor16bitsInt.newUID(),\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.bufferUID.start\r\n//\t\t);\r\n//\t\t\r\n//\t\t\r\n//\t// Populate the masterStyleRegistry from which we shall later retrieve\r\n//\t// the optimized part of the style object, i.e the current CSS rule\r\n//\tTypeManager.masterStyleRegistry.setItem(\r\n//\t\tGeneratorFor16bitsInt.numberFromInt(this.compactedViewOnSelector.get(\r\n//\t\t\tCSSSelectorsList.prototype.optimizedSelectorBufferSchema.bufferUID.start,\r\n//\t\t\t2\r\n//\t\t)),\r\n//\t\tthis.attrIFace\r\n//\t)\r\n//}\r\n\r\n// TODO: OPTIMIZE\r\nStyle.prototype.copyAndMergeWithStyle = function(styleObj) {\r\n\tvar attrIFaceCopy = new AdvancedAttributesList('FIXME:noType', this.attrIFace.getAllDefinedAttributes());\r\n\tattrIFaceCopy.setApply(styleObj);\r\n\treturn attrIFaceCopy;\r\n}\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = Style;\r\n",
    "\"use strict\";\n/**\r\n * @constructor StylePropertyEnhancer\r\n * \r\n * \r\n */\r\n\r\nvar CSSPropertyBuffer = require('src/editing/CSSPropertyBuffer');\r\nvar parser = require('src/parsers/css-parser_forked');\r\n\r\n\r\nvar StylePropertyEnhancer = function() {\r\n\tthis.objectType = 'StylePropertyEnhancer';\r\n\t\r\n}\r\n\r\nStylePropertyEnhancer.prototype.toCSSPropertyBuffer = function(attrName, attrValue) {\r\n\tvar packedCSSProperty = new CSSPropertyBuffer(null, attrName);\r\n//\tconsole.log(attrName, attrValue);\r\n//\tconsole.log(packedCSSProperty);\r\n//\tconsole.log(parser.parseAListOfComponentValues(attrValue));\r\n\t\r\n\tpackedCSSProperty.setValue(parser.parseAListOfComponentValues(attrValue));\r\n\tpackedCSSProperty._buffer.set([0], CSSPropertyBuffer.prototype.bufferSchema.isInitialValue.start);\r\n\t\r\n\treturn packedCSSProperty;\r\n}\r\n\r\nStylePropertyEnhancer.prototype.fromCSSPropertyBuffer = function(propBuffer) {\r\n\t\r\n}\r\n\r\nStylePropertyEnhancer.prototype.toCSSOM = function(propBuffer) {\r\n\t\r\n}\r\n\r\nStylePropertyEnhancer.prototype.fromCSSOM = function(propBuffer) {\r\n\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = StylePropertyEnhancer;",
    "\"use strict\";\n/**\r\n * @constructor StyleRule\r\n \r\n * @param {ruleIdx} number \r\n * @param {styleObj} Style\r\n * @returns self\r\n */\r\n\r\nvar Style = require('src/editing/Style');\r\nvar AdvancedAttributesList = require('src/editing/SplittedAttributes');\r\n\r\n\t\r\nvar StyleRule = function(ruleIdx, rawRule) {\r\n\tthis.objectType = 'StyleRule';\r\n\t\r\n\tif (Object.prototype.toString.call(rawRule) !== '[object Object]') {\r\n\t\tconsole.warn(this.objectType, 'rawRule isn\\'t an Object or no ruleIdx given : ' + rawRule + '. Returning...');\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tthis.ruleIdx = ruleIdx || 0;\r\n\tthis.selector = rawRule.selector;\r\n\tthis.hasOverride = false;\r\n\tthis.styleIFace = new Style(null, this.selector, this.getAttributes(rawRule));\r\n\tthis.attrIFace  = this.styleIFace.attrIFace;\r\n\tthis.additionalAttributes = {};\r\n\tthis.strRule = this.attrIFace.linearize();\r\n}\r\nStyleRule.prototype = {};\r\nStyleRule.fromAdvancedStyleAttributes = function(ruleIdx, selector, attrIFace) {\r\n\tvar styleRule = new StyleRule(ruleIdx, {selector : selector});\r\n\tstyleRule.styleIFace.attrIFace = attrIFace;\r\n\tstyleRule.attrIFace = attrIFace;\r\n\tstyleRule.strRule = styleRule.attrIFace.linearize();\r\n\treturn styleRule;\r\n}\r\n\r\nStyleRule.prototype.getAttributes = function(rawRule) {\r\n\tvar attr = {};\r\n\tfor (let prop in rawRule) {\r\n\t\tif (prop !== 'selector')\r\n\t\t\tattr[prop] = rawRule[prop];\r\n\t}\r\n\treturn attr;\r\n}\r\n\r\nStyleRule.prototype.setAttributes = function(rawRule) {\r\n\tfor (let prop in rawRule) {\r\n\t\tif (prop !== 'selector')\r\n\t\t\tthis.attrIFace.set(prop, rawRule[prop]);\r\n\t}\r\n}\r\n\r\nStyleRule.prototype.cloneAttributes = function() {\r\n\treturn (new AdvancedAttributesList(this.attrIFace.getAllDefinedAttributes())).getAllDefinedAttributes();\r\n}\r\n\r\nStyleRule.prototype.populateStrRule = function() {\r\n\tthis.strRule = this.styleIFace.linearize();\r\n}\r\n\r\nStyleRule.prototype.getAttr = function(attr) {\r\n\treturn this.attrIFace.get(attr);\r\n}\r\n\r\nStyleRule.prototype.setAttr = function(attr, value) {\r\n\tthis.attrIFace.set(attr, value);\r\n}\r\n\r\nStyleRule.prototype.safeMergeAttributes = function(rawRule) {\r\n\tfor (let prop in rawRule) {\r\n\t\tthis.additionalAttributes[prop] = rawRule[prop];\r\n\t}\r\n\tthis.hasOverride = true;\r\n}\r\n\r\nStyleRule.prototype.applyAdditionnalStyleAsOverride = function() {\r\n\tif (this.hasOverride) {\r\n\t\tfor (let attr in this.additionalAttributes) {\r\n\t\t\tthis.attrIFace.set(attr, this.additionalAttributes[attr]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = StyleRule;"
  ]
}